# Template file for 'josm'
pkgname=josm
version=19439
revision=1
hostmakedepends="subversion apache-ant openjdk11"
depends="desktop-file-utils hicolor-icon-theme libXtst openjdk17-jre"
short_desc="Extensible editor for OpenStreetMap"
maintainer="Joel Beckmeyer <joel@beckmeyer.us>"
license="GPL-3.0-or-later"
homepage="https://josm.openstreetmap.de/"
changelog="https://josm.openstreetmap.de/wiki/Changelog"
distfiles="https://github.com/JOSM/josm/archive/refs/tags/${version}-tested.tar.gz"
checksum=d1887aab8679e4e508f36541732f0cee137252cf6d640ea26bf7885c3510e5a2
conf_files="/etc/default/josm"

post_patch() {
	vsed -e "s,\(version.entry.commit.revision.*value=\"\).*\(\".*\),\1${version}\2,g" -i build.xml
}

do_build() {
	. /etc/profile
	ant clean dist
}

# adapted from https://gitlab.archlinux.org/archlinux/packaging/packages/josm/-/blob/71ea40e37da136f4c55126fb01ae6dac2a4fcb1d/PKGBUILD#L23
do_install() {
	vinstall dist/josm-custom.jar 644 usr/share/java/josm josm.jar

	vinstall native/linux/tested/usr/share/applications/org.openstreetmap.josm.desktop 644 usr/share/applications
	vinstall native/linux/tested/usr/share/metainfo/org.openstreetmap.josm.appdata.xml 644 usr/share/metainfo

	vman native/linux/tested/usr/share/man/man1/josm.1

	for i in 8 16 22 24 32 36 40 42 48 64 72 80 96 128 192 256 512; do
		vinstall native/linux/tested/usr/share/icons/hicolor/${i}x${i}/apps/org.openstreetmap.josm.png \
			644 usr/share/icons/hicolor/${i}x${i}/apps
	done
	vinstall native/linux/tested/usr/share/icons/hicolor/scalable/apps/org.openstreetmap.josm.svg \
		644 usr/share/icons/hicolor/scalable/apps

	vbin "${FILESDIR}/josm"
	vinstall native/linux/tested/etc/default/josm 644 etc/default
}
