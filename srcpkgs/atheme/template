# Template file for 'atheme'
pkgname=atheme
version=7.3.0.rc2
revision=1
# FIXME: Once atheme 7.3.0 gets tagged use release tarballs, not this
_atheme_hash="7d09d8881f1339d6b31e77fd088bf143c274339f"
_libmowgli_hash="878f7e931b55d36e2e1b27807f7a620cbb0577d8"
_atheme_contrib_hash="6b207738a5f21de7f2aa3dfe13ce235516c6d21e"
build_style=gnu-configure
configure_args="--disable-nls --enable-fhs-paths --sysconfdir=/etc/atheme"
hostmakedepends="pkg-config gettext"
makedepends="libmowgli-devel"
short_desc="Atheme IRC Services"
maintainer="Luca Matei Pintilie <luca@lucamatei.com>"
license="ISC"
homepage="https://atheme.github.io/"
changelog="https://github.com/atheme/atheme/releases"
distfiles="https://github.com/atheme/atheme/archive/${_atheme_hash}.tar.gz
 https://github.com/atheme/libmowgli-2/archive/${_libmowgli_hash}.tar.gz
 https://github.com/atheme/atheme-contrib-modules/archive/${_atheme_contrib_hash}.tar.gz"
checksum="e5c7dac1f8d7c23fd0b3b37735c3f2ae31a11a7be9a21b409510bde94cda6f6f
 b7d92346c777a4e2b73c73ad6789cb85f49dc41c869d92574cfc8b58efcb1ba6
 d2524d6117ad161cb10157f7b0735f4cb2507563c331155c898bb2f22351cb37"
skip_extraction="${_libmowgli_hash}.tar.gz ${_atheme_contrib_hash}.tar.gz"

system_accounts="_atheme"
make_dirs="/var/lib/atheme 0700 _atheme _atheme
 /var/run/atheme 0700 _atheme _atheme
 /etc/atheme 755 _atheme _atheme"

post_extract() {
	vsrcextract -C libmowgli-2 "${_libmowgli_hash}.tar.gz"
	vsrcextract -C modules/contrib "${_atheme_contrib_hash}.tar.gz"
}

post_install() {
	mv "$DESTDIR/usr/bin/"{ecdsakeygen,atheme-ecdsakeygen}
	mv "$DESTDIR/usr/bin/"{dbverify,atheme-dbverify}
	mv "$DESTDIR/usr/bin/"{ecdsasign,atheme-ecdsasign}
	vsv atheme
	vlicense doc/LICENSE
}

atheme-devel_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/pkgconfig
		vmove "usr/lib/*.so"
	}
}
