From 6ae949c6164e63c8f198716accb7f0112d3eeaef Mon Sep 17 00:00:00 2001
From: q66 <q66@chimera-linux.org>
Date: Thu, 4 Jan 2024 15:11:57 +0100
Subject: [PATCH 09/15] use system lld for wasm

---
 compiler/rustc_target/src/spec/base/wasm.rs | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/compiler/rustc_target/src/spec/base/wasm.rs b/compiler/rustc_target/src/spec/base/wasm.rs
index 7ede45766..2324eb9f5 100644
--- a/compiler/rustc_target/src/spec/base/wasm.rs
+++ b/compiler/rustc_target/src/spec/base/wasm.rs
@@ -49,7 +49,11 @@ pub(crate) fn options() -> TargetOptions {
     }
 
     let mut pre_link_args = TargetOptions::link_args(LinkerFlavor::WasmLld(Cc::No), args!(""));
-    add_link_args(&mut pre_link_args, LinkerFlavor::WasmLld(Cc::Yes), args!("-Wl,"));
+    add_link_args(
+        &mut pre_link_args,
+        LinkerFlavor::WasmLld(Cc::Yes),
+        args!("-Wl,"),
+    );
 
     TargetOptions {
         is_like_wasm: true,
@@ -81,8 +85,8 @@ pub(crate) fn options() -> TargetOptions {
         // threaded model which will legalize atomics to normal operations.
         singlethread: true,
 
-        // we use the LLD shipped with the Rust toolchain by default
-        linker: Some("rust-lld".into()),
+        // we use the LLD shipped with the system by default
+        linker: Some("wasm-ld".into()),
         linker_flavor: LinkerFlavor::WasmLld(Cc::No),
 
         pre_link_args,
-- 
2.51.2

