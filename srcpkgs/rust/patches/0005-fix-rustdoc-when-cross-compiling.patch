From c1a07bda893f42ba99c92f135c784d9719cf8235 Mon Sep 17 00:00:00 2001
From: q66 <q66@chimera-linux.org>
Date: Mon, 9 Sep 2024 17:54:43 +0200
Subject: [PATCH 05/15] fix rustdoc when cross-compiling

---
 src/bootstrap/src/bin/rustdoc.rs | 10 +++-------
 1 file changed, 3 insertions(+), 7 deletions(-)

diff --git a/src/bootstrap/src/bin/rustdoc.rs b/src/bootstrap/src/bin/rustdoc.rs
index efb51bdce..d038a3135 100644
--- a/src/bootstrap/src/bin/rustdoc.rs
+++ b/src/bootstrap/src/bin/rustdoc.rs
@@ -7,8 +7,7 @@ use std::path::PathBuf;
 use std::process::Command;
 
 use shared_helpers::{
-    dylib_path, dylib_path_var, maybe_dump, parse_rustc_stage, parse_rustc_verbose,
-    parse_value_from_args,
+    dylib_path_var, maybe_dump, parse_rustc_stage, parse_rustc_verbose, parse_value_from_args,
 };
 
 #[path = "../utils/shared_helpers.rs"]
@@ -28,9 +27,6 @@ fn main() {
     // is passed (a bit janky...)
     let target = parse_value_from_args(&args, "--target");
 
-    let mut dylib_path = dylib_path();
-    dylib_path.insert(0, PathBuf::from(libdir.clone()));
-
     let mut cmd = Command::new(rustdoc);
 
     if target.is_some() {
@@ -43,7 +39,7 @@ fn main() {
     }
 
     cmd.args(&args);
-    cmd.env(dylib_path_var(), env::join_paths(&dylib_path).unwrap());
+    cmd.env(dylib_path_var(), PathBuf::from(libdir.clone()));
 
     // Force all crates compiled by this compiler to (a) be unstable and (b)
     // allow the `rustc_private` feature to link to other unstable crates
@@ -66,7 +62,7 @@ fn main() {
         eprintln!(
             "rustdoc command: {:?}={:?} {:?}",
             dylib_path_var(),
-            env::join_paths(&dylib_path).unwrap(),
+            PathBuf::from(libdir.clone()),
             cmd,
         );
         eprintln!("sysroot: {sysroot:?}");
-- 
2.51.2

