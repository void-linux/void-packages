# Template file for 'unity-settings-daemon'
pkgname=unity-settings-daemon
version=15.04.1+21.10.20220802
revision=1
_ubuntu_rel=0ubuntu5
build_style=gnu-configure
configure_args="--prefix=/usr --sysconfdir=/etc --localstatedir=/var \
 --libexecdir=/usr/lib/unity-settings-daemon --disable-static --enable-fcitx"
hostmakedepends="automake docbook-xsl gettext-devel intltool libxslt
 pkg-config python wget xf86-input-wacom-devel"
makedepends="alsa-lib-devel fcitx-devel gnome-desktop-devel gperf
 gsettings-ubuntu-schemas-devel ibus-devel libcanberra-devel libnotify-devel
 librsvg-devel libwacom-devel libxkbfile-devel NetworkManager-devel
 pulseaudio-devel upower-devel"
depends="gnome-settings-daemon gperf gsettings-desktop-schemas
 gsettings-ubuntu-schemas hicolor-icon-theme libayatana-appindicator"
short_desc="Unity Settings Daemon"
maintainer="Earldridge Jazzed Pineda <earldridgejazzedpineda@gmail.com>"
license="GPL-2.0-only"
homepage="https://launchpad.net/unity-settings-daemon"
distfiles="https://launchpad.net/ubuntu/+archive/primary/+files/unity-settings-daemon_${version}.orig.tar.gz"
checksum=d02929707f36814c2847992d7d4ca0a5115943474a168fadd9ec1e7240d68c6a
make_check=ci-skip # "gnome-settings-daemon" folder not included when running tests

pre_patch() {
	wget https://launchpad.net/ubuntu/+archive/primary/+files/unity-settings-daemon_${version}-${_ubuntu_rel}.diff.gz
	gunzip unity-settings-daemon_${version}-${_ubuntu_rel}.diff.gz
	patch -p1 -i unity-settings-daemon_${version}-${_ubuntu_rel}.diff
}

pre_configure() {
	autoreconf -vfi
	intltoolize -f
}

post_configure() {
	sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool
}

post_install() {
	vmkdir usr/bin 755
	ln -s usr/lib/unity-settings-daemon/unity-settings-daemon \
	"${DESTDIR}/usr/bin/unity-settings-daemon"

	rm -r "${DESTDIR}/usr/share/locale/"

	rm -f "${DESTDIR}"/usr/lib/udev/rules.d/61-gnome-settings-daemon-rfkill.rules

	vsv unity-settings-daemon
}

unity-settings-daemon-devel_package() {
	short_desc+=" - development files"
	depends="${sourcepkg}>=${version}_${revision} gtk+3-devel
	 libglib-devel"
	pkg_install() {
		vmove usr/include
		vmove "usr/lib/*.so"
		vmove usr/lib/pkgconfig
	}
}
