#
# This script establishes a default config and builds the font cache
#
case "${ACTION}" in
pre)
	;;
post)
	if [ ! -e etc/fonts/conf.d/.autoconfig ]; then
		echo "Setting default font configuration"
		: > etc/fonts/conf.d/.autoconfig

		_defconfigs="
		 10-hinting-slight.conf
		 10-scale-bitmap-fonts.conf
		 20-unhint-small-vera.conf
		 30-metric-aliases.conf
		 40-nonlatin.conf
		 45-generic.conf
		 45-latin.conf
		 49-sansserif.conf
		 50-user.conf
		 51-local.conf
		 60-generic.conf
		 60-latin.conf
		 65-fonts-persian.conf
		 65-nonlatin.conf
		 69-unifont.conf
		 80-delicious.conf
		 90-synthetic.conf
		"

		for _f in $_defconfigs; do
			_fsrc="usr/share/fontconfig/conf.avail/$_f"
			[ -e "$_fsrc" ] || continue

			ln -s "/$_fsrc" etc/fonts/conf.d
			echo "$_f" >> etc/fonts/conf.d/.autoconfig
		done

		unset _f _fsrc _defconfigs
	fi

	echo "Building fonts cache... "
	fc-cache -f >/dev/null
	echo "done."
	;;
esac
