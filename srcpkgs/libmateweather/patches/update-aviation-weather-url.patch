From 0e881958caf4679dcd79e99e4f1a6f8464624e10 Mon Sep 17 00:00:00 2001
From: Victor Kareh <vkareh@redhat.com>
Date: Thu, 18 Sep 2025 07:31:12 -0400
Subject: [PATCH] metar: Update AviationWeather URL

According to their website: "The AviationWeather Data API has been
redeveloped in 2025."

Also they put 'METAR' (or 'SPECI') onto the beginning of data to make it
ICAO compliant, so we add code to parse that.

Fixes #135
---
 libmateweather/weather-metar.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/libmateweather/weather-metar.c b/libmateweather/weather-metar.c
index d470822e..dabca3a2 100644
--- a/libmateweather/weather-metar.c
+++ b/libmateweather/weather-metar.c
@@ -523,7 +523,7 @@ metar_finish (GObject *source, GAsyncResult *result, gpointer data)
 
     loc = info->location;
 
-    searchkey = g_strdup_printf ("<raw_text>%s", loc->code);
+    searchkey = g_strdup_printf ("<raw_text>METAR %s", loc->code);
 
     response_body = g_bytes_get_data (bytes, &len);
     end = response_body + len;
@@ -578,7 +578,7 @@ metar_start_open (WeatherInfo *info)
         "stationString", loc->code,
         NULL);
     msg = soup_message_new_from_encoded_form (
-        "GET", "https://aviationweather.gov/cgi-bin/data/dataserver.php",
+        "GET", "https://aviationweather.gov/api/data/dataserver",
         query);
     soup_session_send_and_read_async (info->session, msg, G_PRIORITY_DEFAULT,
                                       NULL, metar_finish, info);
