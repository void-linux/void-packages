# Template file for 'guile'
pkgname=guile
version=2.2.4
revision=1
build_style=gnu-configure
configure_args="--disable-static --disable-error-on-warning"
hostmakedepends="pkg-config"
makedepends="gc-devel gmp-devel libatomic_ops-devel libffi-devel libltdl-devel
 libunistring-devel readline-devel"
short_desc="A portable, embeddable Scheme implementation written in C"
maintainer="Juan RP <xtraeme@voidlinux.org>"
license="GPL-3.0-or-later, LGPL-3.0-or-later"
homepage="http://www.gnu.org/software/${pkgname}"
distfiles="${GNU_SITE}/${pkgname}/${pkgname}-${version}.tar.gz"
checksum=33b904c0bf4e48e156f3fb1d0e6b0392033bd610c6c9d9a0410c6e0ea96a3e5c
subpackages="libguile guile-devel"

if [ "$CROSS_BUILD" ]; then
	# Need host guile to cross compile
	hostmakedepends+=" guile"
fi

libguile_package() {
	short_desc+=" - runtime library"
	pkg_install() {
		vmove "usr/lib/*.so.*"
		vmove "usr/lib/guile/2.2/extensions/*.so"
	}
}

guile-devel_package() {
	short_desc+=" - development files"
	depends="gmp-devel gc-devel guile>=${version}_${revision}"
	pkg_install() {
		vmove usr/bin/guile-config
		vmove usr/include
		vmove usr/share/aclocal
		vmove usr/lib/pkgconfig
		vmove "usr/lib/*.so"
	}
}

nostrip_files="statprof.go
top-repl.go
safe-r5rs.go
ftw.go
getopt-long.go
fdes-finalizers.go
match.go
simplify-tree.go
string-peg.go
using-parsers.go
codegen.go
cache.go
poe.go
readline.go
and-let-star.go
null.go
binary-ports.go
occam-channel.go
history.go
calling.go
popen.go
atomic.go
stack-catch.go
save-stack.go
local-eval.go
boot-9.go
time.go
safe.go
poll.go
q.go
sandbox.go
futures.go
threads.go
format.go
channel.go
streams.go
hash-table.go
i18n.go
eval-string.go
arrays.go
networking.go
rdelim.go
unicode.go
mapping.go
buffered-input.go
textual-ports.go
eval.go
regex.go
scm-style-repl.go
optargs.go
rw.go
gap-buffer.go
pretty-print.go
string-fun.go
posix.go
iconv.go
hcons.go
curried-definitions.go
list.go
debug.go
runq.go
psyntax-pp.go
syncase.go
suspendable-ports.go
documentation.go
ls.go
expect.go
vlist.go
serialize.go
peg.go
receive.go
command-line.go
r5rs.go
lineio.go
slib.go
deprecated.go
session.go
weak-vector.go
control.go
common-list.go
ports.go
indexing.go
plain-text.go
string-utils.go
docbook.go
html.go
reflection.go
serialize.go
scan-api.go
punify.go
frisk.go
compile.go
autofrisk.go
snarf-check-and-output-texi.go
generate-autoload.go
disassemble.go
display-commentary.go
read-rfc822.go
list.go
read-scheme-source.go
use2dot.go
api-diff.go
help.go
lint.go
summarize-guile-TODO.go
snarf-guile-m4-docs.go
doc-snarf.go
read-text-outline.go
simple.go
ports.go
mutable-strings.go
hashtables.go
programs.go
unicode.go
syntax-case.go
eval.go
exceptions.go
base.go
conditions.go
mutable-pairs.go
flonums.go
fixnums.go
bitwise.go
enums.go
lists.go
files.go
bytevectors.go
r5rs.go
sorting.go
inspection.go
procedural.go
syntactic.go
control.go
xref.go
elf.go
trap-state.go
program.go
dwarf.go
linker.go
coverage.go
vm.go
traps.go
inspect.go
debug.go
frame.go
loader.go
trace.go
assembler.go
disassembler.go
types.go
ck.go
target.go
compile.go
lalr.go
language.go
message.go
pmatch.go
syntax.go
foreign.go
coop-server.go
repl.go
command.go
server.go
common.go
error-handling.go
debug.go
syntax.go
foreign-object.go
srfi-69.go
srfi-28.go
srfi-34.go
srfi-13.go
srfi-38.go
srfi-111.go
srfi-43.go
srfi-67.go
gnu.go
srfi-31.go
srfi-11.go
srfi-17.go
srfi-8.go
srfi-41.go
srfi-88.go
srfi-37.go
srfi-42.go
srfi-35.go
srfi-60.go
srfi-39.go
srfi-18.go
srfi-2.go
srfi-98.go
srfi-71.go
srfi-45.go
srfi-14.go
srfi-9.go
srfi-26.go
srfi-19.go
srfi-1.go
srfi-27.go
srfi-4.go
srfi-64.go
srfi-10.go
srfi-6.go
gnu.go
srfi-16.go
request.go
http.go
server.go
uri.go
response.go
client.go
http.go
match.go
input-parse.go
transform.go
xpath.go
simple.go
fold.go
ssax.go
apply-templates.go
texinfo.go
rnrs.go
cps.go
compile-tree-il.go
parse.go
compile-scheme.go
spec.go
bytecode.go
compile-cps.go
primitives.go
analyze.go
effects.go
canonicalize.go
debug.go
optimize.go
fix-letrec.go
spec.go
peval.go
contification.go
intset.go
types.go
elide-values.go
split-rec.go
utils.go
type-checks.go
rotate-loops.go
effects-analysis.go
type-fold.go
verify.go
closure-conversion.go
compile-bytecode.go
licm.go
prune-top-level-scopes.go
self-references.go
peel-loops.go
primitives.go
dce.go
handle-interrupts.go
specialize-primcalls.go
cse.go
constructors.go
specialize-numbers.go
prune-bailouts.go
renumber.go
optimize.go
with-cps.go
intmap.go
reify-primitives.go
slot-allocation.go
spec.go
simplify.go
tree-il.go
compile-tree-il.go
decompile-tree-il.go
spec.go
spec.go
spec.go
impl.go
tokenize.go
compile-tree-il.go
parse.go
base.go
array.go
function.go
spec.go
falias.go
compile-tree-il.go
boot.go
lexer.go
bindings.go
parser.go
runtime.go
function-slot.go
value-slot.go
spec.go
goops
accessors.go
internal.go
simple.go
composite-slot.go
save.go
active-slot.go
describe.go
stklos.go
goops.go"
