#!/bin/sh
bn=$(basename $0)
ECHO(){ echo "$bn: $@"; }

RunUser=_firebird
RunGroup=_firebird
databasesconf='/etc/firebird/databases.conf'

# A number of predefined macros (syntax $(name)) is available for use in the configuration files 
# to substitute for a directory name (src: https://firebirdsql.org/file/documentation/release_notes/html/en/3_0/rlsnotes30.html#rnfb30-configparams-macrosubs)
# dir_sampledb='/usr/examples/empbuild' # employee.fdb
dir_secdb='/var/lib/firebird/system'

chkperm(){
[ -e "$1" ] || { ECHO "Warning! No exists: $1" && return; }
chpst -u $RunUser test -w "$1" && ECHO "Ok: $1" || { ECHO "Fix permissions: $1"; chown $RunUser:$RunGroup "$1" && chmod 660 "$1"; }
}

for i in $(grep '^[^#]*=.*\.fdb.*$' "$databasesconf" | 
sed "s|#.*||; s|^\(.*=\s*\)\(.*\)$|\2|; 
# s|\$(dir_sampledb)|$dir_sampledb|i; 
s|\$(dir_secdb)|$dir_secdb|i") # need more testing
do
	chkperm "$i"
done

ECHO 'Done.'
