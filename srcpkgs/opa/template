# Template file for 'opa'
pkgname=opa
version=0.45.0
revision=1
build_style=go
build_helper=qemu
go_import_path=github.com/open-policy-agent/opa
# go_build_tags=opa_wasm
go_ldflags="-X github.com/open-policy-agent/opa/internal/report.ExternalServiceURL=''
 -X github.com/open-policy-agent/opa/version.Version=${version}"
short_desc="General-purpose policy engine"
maintainer="Daniel Lewan <vision360.daniel@gmail.com>"
license="Apache-2.0"
homepage="https://www.openpolicyagent.org/"
changelog="https://raw.githubusercontent.com/open-policy-agent/opa/main/CHANGELOG.md"
distfiles="https://github.com/open-policy-agent/opa/archive/v${version}.tar.gz"
checksum=d3bf43e9061b9fb3c66f23faa91c3eefe4074c4121ad403133303d2bab54bdb6

post_build() {
	CGO_ENABLED=0 GOOS="" GOARCH="" go run -ldflags "$go_ldflags" ./build/generate-man man
	for shell in bash fish zsh
	do
		opa_cli=$(find "$GOPATH"/bin -name opa)
		vtargetrun "$opa_cli" completion $shell >$shell.completion
	done
}

post_install() {
	for f in man/*.1
	do
		vman "$f"
	done
	for shell in bash fish zsh
	do
		vcompletion "$shell.completion" "$shell"
	done
}
