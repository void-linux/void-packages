# Template file for 'util-linux'
pkgname=util-linux
version=2.21.1
distfiles="${KERNEL_SITE}/utils/${pkgname}/v2.21/${pkgname}-${version}.tar.xz"
short_desc="Miscellaneous linux utilities"
maintainer="Juan RP <xtraeme@gmail.com>"
homepage="http://userweb.kernel.org/~kzak/util-linux-ng"
license="GPL-2"
checksum=6ffaffb46bfb1aa403f83f0c8d2700e5ec35ffcb35a0573adb10404ed16c9004
long_desc="
 The ${pkgname} package contains miscellaneous utility programs. Among
 them are utilities for handling file systems, consoles, partitions,
 and messages."

replaces="util-linux-ng>=0 e2fsprogs<=1.41.14_1"
subpackages="libmount libmount-devel libblkid libblkid-devel libuuid libuuid-devel"
make_dirs="/var/lib/hwclock 0755 0 0"

Add_dependency run coreutils
Add_dependency run shadow

Add_dependency build pkg-config
Add_dependency build zlib-devel
Add_dependency build ncurses-devel

do_configure() {
	./configure ${CONFIGURE_SHARED_ARGS} \
		--libdir=/usr/lib --libexecdir=/usr/lib \
		--enable-partx --enable-write \
		--enable-libuuid --disable-makeinstall-chown \
		--enable-libblkid --enable-fsck --disable-rpath \
		--enable-libmount-mount \
		--enable-fs-paths-extra=/usr/sbin:/usr/bin \
		SUID_CFLAGS="-fPIE" SUID_LDFLAGS="-pie"
}

do_build() {
	sed -e 's%etc/adjtime%var/lib/hwclock/adjtime%' -i include/pathnames.h
	make ${makejobs}
}

do_install() {
	make DESTDIR=${DESTDIR} install
}
