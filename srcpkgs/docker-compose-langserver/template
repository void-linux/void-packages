# Template file for 'docker-compose-langserver'
pkgname=docker-compose-langserver
version=0.3.0
revision=1
hostmakedepends="nodejs"
depends="nodejs"
short_desc="Docker Compose Language Server"
maintainer="toomyem <toomyem@gmail.com>"
license="MIT"
homepage="https://github.com/microsoft/compose-language-service"
distfiles="https://github.com/microsoft/compose-language-service/archive/refs/tags/microsoft-compose-language-service-v${version}.tar.gz"
checksum=6522788196bc3b8ec6a24daa21c538287b1994adb9eb907f0d62590fbb6ce179

do_build() {
	npm install
	npm run build
	rm -r node_modules
	npm install --omit=dev --ignore-scripts
	chmod +x bin/docker-compose-langserver
}

do_install() {
	vlicense LICENSE

	vmkdir usr/bin
	vmkdir usr/lib/docker-compose-langserver
	vcopy bin/ usr/lib/docker-compose-langserver
	vcopy lib/ usr/lib/docker-compose-langserver
	vcopy node_modules/ usr/lib/docker-compose-langserver

	ln -sf /usr/lib/docker-compose-langserver/bin/docker-compose-langserver \
		${DESTDIR}/usr/bin/docker-compose-langserver
}
