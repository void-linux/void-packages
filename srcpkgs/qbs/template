# Template file for 'qbs'
pkgname=qbs
version=1.12.0
revision=1
wrksrc=qbs-src-${version}
build_style=qmake
configure_args="-r qbs.pro QBS_INSTALL_PREFIX=/usr"
hostmakedepends="perl pkg-config qt5-host-tools"
makedepends="qt5-devel qt5-script-devel"
short_desc="Qt build suite"
maintainer="Rasmus Thomsen <rasmus.thomsen@protonmail.com>"
license="LGPL-2.1-or-later, LGPL-3.0-only"
homepage="https://doc.qt.io/qbs"
distfiles="https://download.qt.io/official_releases/qbs/${version}/qbs-src-${version}.tar.gz"
checksum=5efeb2492f8ccf0e7a5ea106f748e1c536f964674025aecb22c1ee948e3e35d1

if [ "$CROSS_BUILD" ]; then
	# qt5-script-devel isn't actually required, but
	# if qmake doesn't detect it being installed
	# it tries to use the bundeled qt5-script-devel
	hostmakedepends+=" qbs qt5-qmake qt5-script-devel"

	post_configure() {
		# qmake attemps to run the just built qbs to generate some
		# static resources, which fails for obvious reasons when
		# cross compiling
		sed -e "s:bin/qbs:/usr/bin/qbs:" -i Makefile.static-res
	}
fi

qbs-examples_package() {
	short_desc+=" - example files"
	pkg_install() {
		vmove usr/share/qbs/examples
	}
}
