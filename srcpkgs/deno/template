# Template file for 'deno'
pkgname=deno
version=1.1.1
revision=1
build_helper="rust"
hostmakedepends="cargo pkg-config curl unzip"
short_desc="Secure runtime for JavaScript and TypeScript"
maintainer="Alex Lohr <alex.lohr@logmein.com>"
license="MIT"
homepage="https://deno.land/"
distfiles="https://github.com/denoland/deno/archive/v${version}.tar.gz"
checksum=38cba71957a8e3474659cd98946aabb4e04403ebce01498d26f015db7371885c
// on update, this version needs to be taken from https://github.com/denoland/deno/tree/[version tag]/deno_typescript
_typescript_ref=551f0dd9a1b57ecd527a665b0af7fc98cd107af6

pre_build() {
	pushd deno_typescript/
	rmdir typescript
	curl https://codeload.github.com/microsoft/TypeScript/zip/${_typescript_ref} -o typescript_src.zip
	unzip -qq typescript_src.zip
	mv TypeScript-${_typescript_ref} typescript
	popd
}

do_build() {
	cargo build --release --target ${RUST_TARGET}
}

do_install() {
	vlicense LICENSE

	vbin target/${RUST_TARGET}/release/deno
}
