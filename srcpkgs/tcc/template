# Template file for 'tcc'
pkgname=tcc
version=0.9.27.20250312
revision=1
_gitrev=006174449e1d40b5e7937398e4947d7b13b8e675
build_style=configure
configure_args="--prefix=/usr --libdir=\${prefix}/lib$XBPS_TARGET_WORDSIZE"
make_check_target="test"
hostmakedepends="perl which"
short_desc="Tiny C Compiler"
maintainer="Orphaned <orphan@voidlinux.org>"
license="LGPL-2.1-or-later"
homepage="http://bellard.org/tcc/"
distfiles="http://repo.or.cz/tinycc.git/snapshot/${_gitrev}.tar.gz"
checksum=f09e1e2785532f28e0fd2f99297d0f0071cec6b2f925281082bdd3b404416c30
nopie=yes
nocross=yes

case "$XBPS_TARGET_MACHINE" in
	ppc*) broken="ftbfs";;
	*-musl) configure_args+=" --config-musl" depends+=" musl-devel";;
	*)	 depends+=" glibc-devel";;
esac

do_build() {
	# Can't use (many of) our CFLAGS or LDFLAGS
	# because TCC is bootstrapped with the same flags
	make CFLAGS= LDFLAGS= ${makejobs}
}
