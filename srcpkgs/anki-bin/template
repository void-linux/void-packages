# Template file for 'anki-bin'
pkgname=anki-bin
version=25.09
revision=1
archs="x86_64 aarch64 armv6l"
depends="python3 mpv qt6-base qt6-svg qt6-multimedia python3-pyqt6-webengine libatomic"
short_desc="Spaced repetition flashcard program"
maintainer="JoaoVictor <joaovictorrosmaninho@gmail.com>"
license="GPL-3.0-or-later"
homepage="https://apps.ankiweb.net/"
distfiles="https://github.com/ankitects/anki/releases/download/${version}/anki-launcher-${version}-linux.tar.zst"
checksum=97cbddae74e44944360cac89bbdda06af7cf080a4dc1012dd6dc63952bbbb029

do_install() {
	cd ${wrksrc}

	#define de arch
	ARCH=$(uname -m)
	case "$ARCH" in
		x86_64|amd64)
			LAUNCHER="launcher.amd64"
			;;
		aarch64|arm64)
			LAUNCHER="launcher.arm64"
			;;
		*)
			echo "Error: Unsupported architecture: $ARCH"
			echo "Supported architectures: x86_64, aarch64"
			exit 1
			;;
	esac

	# Install the binary package
	echo "using laucher: $LAUNCHER"
	vinstall "$LAUNCHER" 755 opt/anki anki

	# Instalar dados (se houver arquivos adicionais na raiz)
	for file in *.png *.xml *.xpm .python-version; do
		[ -f "$file" ] && vinstall "$file" 644 opt/anki
	done

	# Symlink no PATH
	vmkdir usr/bin
	ln -sf /opt/anki/anki ${DESTDIR}/usr/bin/anki

	# Desktop entry
	vinstall anki.desktop 644 usr/share/applications
	vinstall anki.png 644 usr/share/pixmaps

	# Man page
	vman anki.1 man/man1/anki.1
}
