# Template file for 'nux'
pkgname=nux
version=4.0.8+18.10.20180623
revision=1
_ubuntu_rel=0ubuntu10
build_style=gnu-configure
configure_args="--prefix=/usr --libexecdir=/usr/lib --disable-static \
 --disable-tests"
hostmakedepends="automake boost-devel doxygen graphviz pkg-config wget
 xorgproto"
makedepends="gdk-pixbuf-devel geis-devel glew-devel glewmx-devel ibus-devel
 libsigc++-devel libXcomposite-devel libXdamage-devel libXinerama-devel
 libXxf86vm-devel pango-devel pciutils-devel pcre-devel"
depends="glew"
short_desc="OpenGL graphical user interface toolkit"
maintainer="Earldridge Jazzed Pineda <earldridgejazzedpineda@gmail.com>"
license="GPL-3.0-only, LGPL-3.0-only"
homepage="https://launchpad.net/nux"
distfiles="https://launchpad.net/ubuntu/+archive/primary/+files/nux_${version}.orig.tar.gz"
checksum=5ec296f8e9d445fc2e2bf2814e4fa6ed36a62068937d0a2e0122fa68492361b3
keep_libtool_archives=yes

do_patch() {
	wget https://launchpad.net/ubuntu/+archive/primary/+files/nux_${version}-${_ubuntu_rel}.diff.gz
	gunzip nux_${version}-${_ubuntu_rel}.diff.gz
	patch -p1 -i nux_${version}-${_ubuntu_rel}.diff

	for i in $(grep -v '#' debian/patches/series); do
		patch -p1 -i "debian/patches/${i}"
	done
}

pre_configure() {
	export CFLAGS+=" -Wno-error"
	export CXXFLAGS+=" -Wno-error -g -O0"

	autoreconf -vfi
}


post_install() {
	vmkdir etc/X11/xinit/xinitrc.d 755
	vinstall ${FILESDIR}/50_check_unity_support 755 \
	 etc/X11/xinit/xinitrc.d/
}

nux-devel_package() {
	short_desc+=" - development files"
	depends="${sourcepkg}>=${version}_${revision} cairo-devel
	 gdk-pixbuf-devel geis-devel glewmx-devel glu-devel libglib-devel
	 libglvnd-devel libpng-devel libsigc++-devel libX11-devel libXext-devel
	 libXinerama-devel libXxf86vm-devel pcre-devel"
	pkg_install() {
		vmove usr/include
		vmove "usr/lib/*.la"
		vmove "usr/lib/*.so"
		vmove usr/lib/pkgconfig
	}
}
