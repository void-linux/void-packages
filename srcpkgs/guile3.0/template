# Template file for 'guile3.0'
pkgname=guile3.0
version=3.0.4
revision=1
wrksrc="${pkgname/3.0/}-${version}"
build_style=gnu-configure
configure_args="--program-suffix=3.0"
hostmakedepends="emacs pkg-config texinfo"
makedepends="gc-devel gmp-devel libatomic_ops-devel libffi-devel libltdl-devel
 libunistring-devel $(vopt_if readline readline-devel)"
short_desc="Portable, embeddable Scheme implementation written in C"
maintainer="Ivan Sokolov <ivan-p-sokolov@ya.ru>"
license="GPL-3.0-or-later, LGPL-3.0-or-later"
homepage="https://www.gnu.org/software/guile"
distfiles="${GNU_SITE}/guile/guile-${version}.tar.gz"
checksum=13f2f61a665469d330e651c8e9f7faecbb87fe474767f9532f2e821701730957

build_options="readline"
build_options_default="readline"

if [ "$CROSS_BUILD" ]; then
	configure_args+=" GUILE_FOR_BUILD=guile3.0"
	hostmakedepends+=" guile3.0 guile3.0-devel"
fi

pre_configure() {
	if [ "$XBPS_TARGET_LIBC" = musl ]; then
		vsed -i test-suite/Makefile.am -e '/i18n.test/d'
	fi
}

libguile3.0_package() {
	short_desc+=" - runtime library"
	pkg_install() {
		vmove "usr/lib/*.so.*"
	}
}

guile3.0-devel_package() {
	depends="${sourcepkg}-${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/share/aclocal
		vmove usr/share/guile
		vmove usr/lib/pkgconfig
		vmove "usr/lib/*.a"
		vmove "usr/lib/*.so"
		vmove usr/include
	}
}
