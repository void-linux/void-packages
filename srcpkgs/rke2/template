# Template file for 'rke2'
pkgname=rke2
version=v1.35.0+rke2r1
revision=1
archs="x86_64* aarch64*"
build_style=gnu-makefile
hostmakedepends="go"
depends="ca-certificates"
short_desc="RKE2 Kubernetes distribution"
maintainer="Chase Dillard <c.dillard@pm.me>"
license="Apache-2.0"
homepage="https://docs.rke2.io"
distfiles="https://github.com/rancher/rke2/archive/refs/tags/${version}.tar.gz"
checksum=1c159baf5992fae8264db3797725c9e200cb71715f141b975f5455fdf0351a69

export TARGET_ARCHITECTURE=${XBPS_TARGET_MACHINE//-musl/}

case "$TARGET_ARCHITECTURE" in
	x86_64)
	export GOARCH=amd64
	;;
	aarch64)
	export GOARCH=arm64
	;;
	*)
	;;
esac

do_build() {
	make RKE_VERSION=${version//+/-} build-binary
}

do_install() {
	vbin bin/rke2
	vbin bundle/bin/rke2-killall.sh
	vbin ${FILESDIR}/rke2-cleanup.sh
	vsv rke2-server
	vsv rke2-agent
}
