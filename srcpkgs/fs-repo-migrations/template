# Template file for 'fs-repo-migrations'
pkgname=fs-repo-migrations
version=2.0.2
revision=1
wrksrc=fs-repo-migrations-fs-repo-11-to-12-v1.0.2
build_style=go
go_import_path="github.com/ipfs/fs-repo-migrations"
short_desc="Tool to upgrade the IPFS filesystem repository"
maintainer="Christopher Brannon <chris@the-brannons.com>"
license="MIT"
homepage="https://github.com/ipfs/fs-repo-migrations"
distfiles="https://github.com/ipfs/fs-repo-migrations/archive/refs/tags/fs-repo-11-to-12/v1.0.2.tar.gz"
checksum=e6d6320e280f3118873dfb194b68681fa2747b7893d99831fa6fa2bbb67ebd71

# fix: collect2: fatal error: cannot find 'ld'
export LDFLAGS="-fuse-ld=bfd"

do_build() {
	for migration in fs-repo-*-to-*; do
		(
			cd $migration
			go install -p "$XBPS_MAKEJOBS" -mod="vendor" -x -tags "${go_build_tags}" -ldflags "${go_ldflags}"
		)
	done
	cd fs-repo-migrations
	go install -p "$XBPS_MAKEJOBS" -x -tags "${go_build_tags}" -ldflags "${go_ldflags}"
}
post_install() {
	vlicense LICENSE
	vdoc README.md
	vdoc run.md
}
