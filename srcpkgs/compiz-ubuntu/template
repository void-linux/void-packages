# Template file for 'compiz-ubuntu'
# Package is called compiz-ubuntu to prevent confusion with compiz-reloaded.
pkgname=compiz-ubuntu
version=0.9.14.2+22.10.20220822
revision=1
_ubuntu_epoch=1
_ubuntu_rel=0ubuntu12
build_style=cmake
configure_args="-DCMAKE_INSTALL_PREFIX=/usr -DCOMPIZ_BUILD_WITH_RPATH=FALSE \
 -DCMAKE_BUILD_TYPE=Debug -DCOMPIZ_PACKAGING_ENABLED=TRUE -DUSE_GSETTINGS=ON \
 -DCOMPIZ_DISABLE_GS_SCHEMAS_INSTALL=OFF -DCOMPIZ_BUILD_TESTING=OFF \
 -DCOMPIZ_DISABLE_PLUGIN_KDE=ON -DUSE_KDE4=OFF -Dlibdir=/usr/lib \
 -Dlibcompizconfig_libdir=/usr/lib"
hostmakedepends="boost-devel coreutils desktop-file-utils intltool patchelf
 pkg-config python3-Cython"
makedepends="dbus-devel glibmm-devel glu-devel libICE-devel librsvg-devel
 libSM-devel libwnck-devel libXcomposite-devel libXdamage-devel
 libXinerama-devel libXrandr-devel libxslt-devel metacity protobuf-devel
 python3-devel startup-notification-devel"
depends="boost fuse gnome-settings-daemon gsettings-desktop-schemas"
short_desc="OpenGL window and compositing manager"
maintainer="Earldridge Jazzed Pineda <earldridgejazzedpineda@gmail.com>"
license="GPL-2.0-only, LGPL-2.1-only, MIT"
homepage="http://www.compiz.org/"
distfiles="https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/compiz/${_ubuntu_epoch}:${version}-${_ubuntu_rel}/compiz_${version}-${_ubuntu_rel}.tar.xz"
checksum=d92cf4cdebba921f258d096e21a8a10d5678470ac44d880aedf87d4011b7f082
keep_libtool_archives=yes
shlib_provides="libcompiz_core.so.ABI-20180221 libcompiztoolbox.so
 libcomposite.so libopengl.so libscale.so"

pre_configure() {
	export CXXFLAGS+=" -lc"

	export LDFLAGS="$(echo ${LDFLAGS} | sed 's/-B[ ]*symbolic-functions//')"

	export COMPIZ_DISABLE_RPATH=1
}

post_install() {
	CMAKE_DIR=$(cmake --system-information | grep '^CMAKE_ROOT' \
	 | awk -F\" '{print $2}')

	desktop-file-install --delete-original \
	 --dir=${DESTDIR}/usr/share/applications \
	 ${DESTDIR}/usr/share/applications/*.desktop

	mv ${DESTDIR}/usr/share/cmake-*/ ${DESTDIR}/usr/share/cmake/

	vlicense COPYING.MIT
}

compiz-ubuntu-devel_package() {
	short_desc+=" - development files"
	depends="${sourcepkg}>=${version}_${revision} cairo-devel glibmm-devel
	 libglib-devel libICE-devel libSM-devel libX11-devel
	 libXcomposite-devel libXcursor-devel libXdamage-devel libXext-devel
	 libXi-devel libXinerama-devel libxml2-devel libXrandr-devel
	 libXrender-devel libxslt-devel pango-devel startup-notification-devel"
	pkg_install() {
		vmove usr/include
		# Do not vmove libcompizconfig_gsettings_backend.so
		vmove usr/lib/libcompiz_core.so
		vmove usr/lib/libcompizconfig.so
		vmove usr/lib/libdecoration.so
		vmove usr/lib/pkgconfig
		vmove usr/share/cmake
	}
}
