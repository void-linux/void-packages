# Template file for 'defold'
pkgname=defold
version=1.2.186
revision=1
_editor_hash=eac4b987a5627d9a198f0806caac811991e5eab5
_engine_hash=1f748d5b0a84e8b5c58bf747e4c48d153ef77a52
archs="x86_64"
hostmakedepends="unzip"
depends="glu"
short_desc="Free to use game engine for desktop, mobile and web games"
maintainer="shizonic <realtiaz@gmail.com>"
license="custom:EULA"
homepage="https://defold.com"
distfiles="http://d.defold.com/archive/editor-alpha/${_editor_hash}/editor-alpha/editor2/Defold-x86_64-linux.zip
 http://d.defold.com/archive/stable/${_engine_hash}/engine/defoldsdk.zip
 http://d.defold.com/archive/stable/${_engine_hash}/bob/bob.jar"
checksum="bdfe6e4c04cc9038abaf16464bb3dd09027818c2acd450bc41f552223bb503da
 e856e15a4621015880a7a2757b20d01ef2027672f8e8f48dfaaf8cac9ea161d0
 14f99d6c05bee159df8284594b1fd24adc8274fd799234e53966d308b0ac1252"
nopie=yes
nostrip=yes
python_version="py3_lib"

do_extract() {
	mkdir -p ${DESTDIR}
	unzip ${XBPS_SRCDISTDIR}/defold-${version}/Defold-x86_64-linux.zip
	unzip ${XBPS_SRCDISTDIR}/defold-${version}/defoldsdk.zip
}


do_install() {
	vinstall ${FILESDIR}/Defold.desktop 644 usr/share/applications
	vinstall ${FILESDIR}/logo/64.png 644 usr/share/icons/hicolor/64x64/apps defold.png
	vinstall ${FILESDIR}/logo/128.png 644 usr/share/icons/hicolor/128x128/apps defold.png
	vinstall ${FILESDIR}/logo/150.png 644 usr/share/icons/hicolor/150x150/apps defold.png
	vinstall ${FILESDIR}/logo/310.png 644 usr/share/icons/hicolor/310x310/apps defold.png
	vinstall ${FILESDIR}/logo/1024.png 644 usr/share/icons/hicolor/1024x1024/apps defold.png
	vmkdir opt
	vcopy Defold opt
	vcopy defoldsdk opt/Defold
	vinstall ${XBPS_SRCDISTDIR}/defold-${version}/bob.jar 644 opt/Defold
	vmkdir usr/include/dmsdk
	ln -s ${DESTDIR}/opt/Defold/defoldsdk/sdk/include/dmsdk ${DESTDIR}/usr/include/dmsdk
	vbin ${FILESDIR}/defold
	vlicense ${FILESDIR}/LICENSE
}

post_install() {
	chmod -R o-w ${DESTDIR}/opt/Defold/defoldsdk
}
