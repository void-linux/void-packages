# Template file for 'qgis'
pkgname=qgis
version=3.44.4
revision=4
build_style=cmake
configure_args="-DENABLE_TESTS=OFF -DWITH_3D=True -DWITH_PDAL=True
 -DBUILD_WITH_QT6=ON -DWITH_PDF4QT=ON -DWITH_QTWEBKIT=NO
 -DPDF4QT_INSTALL_TO_USR=OFF
 -DGRASS_PREFIX8=${XBPS_CROSS_BASE}/usr/lib/grass"
_pyqt="python3-pyqt6 python3-pyqt6-gui python3-pyqt6-serialport
 python3-pyqt6-printsupport python3-pyqt6-multimedia python3-pyqt6-network
 python3-pyqt6-xml python3-pyqt6-declarative python3-pyqt6-sql
 python3-pyqt6-widgets python3-pyqt6-position python3-pyqt6-devel-tools
 python3-pyqt6-svg python3-pyqt6-qsci"
hostmakedepends="bison flex pkg-config protobuf python3 python3-pyqt6-sip sip"
makedepends="exiv2-devel draco-devel expat-devel freexl-devel geos-devel
 gsl-devel grass-devel hdf5-devel libgdal-devel libpdal-devel librttopo-devel
 libspatialindex-devel libspatialite-devel libxml2-devel libzip-devel
 minizip-devel netcdf-devel ocl-icd-devel postgresql-libs-devel
 proj-devel protobuf-devel python3-devel python3-PyQt-builder
 qt6-base-private-devel qt6-svg-devel qt6-position-devel qt6-qt5compat-devel
 qt6-declarative-devel qt6-serialport-devel qt6-3d-devel
 qt6-multimedia-devel
 qt6-plugin-odbc qt6-plugin-pgsql qt6-plugin-sqlite
 qscintilla-qt6-devel qtkeychain-qt6-devel qca-qt6-devel qwt-qt6-devel
 python3-pyqt6-bindings python3-pyqt6-qsci-devel python3-pyqt6-sip ${_pyqt}
 python3-devel sqlite-devel zlib-devel libopenjpeg2-devel"
depends="libgdal-python3 python3-dateutil python3-dateutil python3-yaml
 python3-Jinja2 python3-numpy python3-numpy python3-owslib python3-Pillow
 python3-psycopg2 python3-Pygments python3-pytz python3-requests python3-urllib3
 ${_pyqt} qca-qt6 qt6-plugin-sqlite qt6-plugin-tls-openssl"
short_desc="Open Source Geographic Information System"
maintainer="Arjan Mossel <arjanmossel@gmail.com>"
license="GPL-2.0-only"
homepage="https://qgis.org"
distfiles="https://github.com/qgis/QGIS/archive/final-${version//./_}.tar.gz"
checksum=1396c84dd6c9c89c026de8b564319e0f6206c8bbc1b160bfdc0fdf49adb61748
nocross="due to grass"

post_configure() {
	# No idea why the patch was removed on generated files
	sed -i 's/[.]sip[.]in$/.sip/' ftbfs.patch
	cd build
	patch -Np1 -s -i ../ftbfs.patch
}

post_install() {
	mv ${DESTDIR}/usr/share/qgis/python ${DESTDIR}/usr/lib/qgis/
	ln -s ../../lib/qgis/python ${DESTDIR}/usr/share/qgis/python
	mv ${DESTDIR}/usr/man ${DESTDIR}/usr/share/
}
