# Template file for 'wings'
pkgname=wings
version=2.4.1
revision=1
build_style=gnu-makefile
hostmakedepends="git"
makedepends="erlang-wx erlang-cl"
depends="erlang-wx desktop-file-utils hicolor-icon-theme"
short_desc="Advanced subdivision modeler that is both powerful and easy to use"
maintainer="Mihail Ivanchev <contact@ivanchev.net>"
license="TCL"
homepage="https://github.com/dgud/wings"
distfiles="https://github.com/dgud/wings/archive/refs/tags/v${version}.tar.gz"
checksum=2a1c0dd340a994e81710b739a12db272b6aac2585127a5cc5f9eba2ed225774f
nocross="requires erlang-wx which is unavaiable on cross-built platforms"
create_wrksrc=yes
build_wrksrc=wings

# Wings 3D currently requires that the root directory is called "wings". To fulfill
# this, we enable "create_wrksrc" and copy the contents of the build directory to
# a directory called "wings" after the patching. One day hopefully this will no
# longer be necessary.

post_extract() {
	mv ${pkgname}-${version}/* . && rm -rf ${pkg-name}/${version}
	mkdir "${build_wrksrc}"
}

post_patch() {
	find "${wrksrc}" -maxdepth 1 -not -iname "${build_wrksrc}" -exec mv "{}" "${wrksrc}/${build_wrksrc}/" \;
}

pre_build() {
	CFLAGS+=" -fPIC"
	CXXFLAGS+=" -fPIC"
}

do_install() {
	vmkdir opt/${pkgname}
	vmkdir opt/${pkgname}/ebin
	vmkdir opt/${pkgname}/plugins
	vmkdir opt/${pkgname}/shaders
	vmkdir opt/${pkgname}/textures
	vmkdir opt/${pkgname}/priv
	vcopy ebin/* opt/${pkgname}/ebin
	vcopy plugins/* opt/${pkgname}/plugins
	vcopy shaders/* opt/${pkgname}/shaders
	vcopy textures/* opt/${pkgname}/textures
	vcopy priv/* opt/${pkgname}/priv
	vlicense license.terms
	vinstall ${FILESDIR}/wings.desktop 644 usr/share/applications
	vinstall ebin/wings_icon_256x256.png 644 usr/share/icons/hicolor/256x256/apps wings.png
	vinstall ebin/wings_icon_48x48.png 644 usr/share/icons/hicolor/48x48/apps wings.png
	vbin ${FILESDIR}/wings
	vinstall ${FILESDIR}/wings.rc 644 etc
}
