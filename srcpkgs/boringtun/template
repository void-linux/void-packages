# Template file for 'boringtun'
pkgname=boringtun
version=0.5.2
revision=1
build_style=cargo
short_desc="Implementation of the WireGuard protocol"
maintainer="Zach Nedwich <zach@znedw.com>"
license="BSD-3-Clause"
homepage="https://github.com/cloudflare/boringtun"
distfiles="https://github.com/cloudflare/${pkgname}/archive/refs/tags/${pkgname}-${version}.tar.gz"
checksum=@6209e5d26ddf2cd8921efe7898eb3a16e552f2e9be6ddfcd632c40275d5ab4e6

case "$XBPS_TARGET_MACHINE" in
	x86_64*|i686*|arm*|aarch64*) ;;
	*) broken="ftbfs in ring" ;;
esac

do_install() {
	# Manual install due to an "found a virtual manifest at ... instead of a package manifest"
	# error.
	cargo auditable install --target ${RUST_TARGET} --root="${DESTDIR}/usr" \
		--offline --locked --path boringtun-cli
	rm -f "${DESTDIR}"/usr/.crates.toml
	rm -f "${DESTDIR}"/usr/.crates2.json
}


post_install() {
	vlicense LICENSE.md
}
