# Template file for 'doh-proxy'
pkgname=doh-proxy
version=0.9.10
revision=1
build_style=cargo
short_desc="Fast and secure DoH (DNS-over-HTTPS) and ODoH (Oblivious DoH) server"
maintainer="MeganerdNL <meganerd@meganerd.nl>"
license="MIT"
homepage="https://github.com/DNSCrypt/doh-server"
distfiles="https://github.com/DNSCrypt/doh-server/archive/refs/tags/${version}.tar.gz"
checksum=ed5cc16f10ea1e7c4487c3d7ddb96ca5a3363af7492ccce01cc24dcbfa778fef
system_accounts="_doh_proxy"

post_extract() {
	cargo generate-lockfile
}

if [ "$XBPS_TARGET_NO_ATOMIC8" ]; then
	XBPS_CROSS_RUSTFLAGS+=" -latomic"
fi

post_install() {
	vlicense LICENSE
	vdoc "${FILESDIR}/README.voidlinux"
	vsv doh-proxy
}
