# Template file for 'qt5integration'
pkgname=qt5integration
version=0.3.12
revision=2
build_style=qmake
hostmakedepends="qt5-qmake pkg-config"
makedepends="libqtxdg-devel dtkwm-devel dtkwidget-devel mtdev-devel
 qt5-svg-devel qt5-x11extras-devel qt5-multimedia-devel"
depends="qt5dxcb-plugin qt5-styleplugins qt5>=5.13.0<5.13.1"
short_desc="Qt platform theme integration plugins for Deepin Desktop Environment"
maintainer="John <johnz@posteo.net>"
license="GPL-3.0-or-later"
homepage="https://github.com/linuxdeepin/qt5integration"
changelog="https://github.com/linuxdeepin/qt5integration/blob/${version}/CHANGELOG.md"
distfiles="https://github.com/linuxdeepin/qt5integration/archive/${version}.tar.gz"
checksum=99a49dbe67c9ce11e60856f484c383400642f4ab0d0f46af310271c2c43edcfc

pre_configure() {
	_qt5_dep_ver="${depends#*>=}"
	_qt5_dep_ver="${_qt5_dep_ver%<*}"
	_qt5_version="$(xbps-uhelper version qt5)"

	if [[ "${_qt5_version%_*}" != "${_qt5_dep_ver}" ]]; then
		echo
		msg_red "Qt5 version doesn't match version listed in \$depends\\n"
		msg_red "${_qt5_version%_*} does not match ${_qt5_dep_ver}\\n"
		exit 1
	fi
}

if [ "$CROSS_BUILD" ]; then
	hostmakedepends+=" qt5-devel qt5-x11extras-devel"
	pre_configure() {
		_qtxdg_version=$(PKG_CONFIG_PATH=${XBPS_CROSS_BASE}/usr/lib/pkgconfig\
			pkg-config --modversion Qt5XdgIconLoader)
		echo $_qtxdg_version
		sed -i -e "s%INCLUDEPATH +=.*%INCLUDEPATH += ${XBPS_CROSS_BASE}/usr/include/qt5xdgiconloader/${_qtxdg_version}%g"\
	platformthemeplugin/qt5deepintheme-plugin.pro
	}
fi
