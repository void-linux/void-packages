# Template file for 'Quake3e'
pkgname=Quake3e
version=2021.03.28
revision=1
_version=${version//./-}
wrksrc=Quake3e-$_version

case $XBPS_TARGET_MACHINE in
	i686*) _arch=x86 ;;
	arm*) _arch=arm ;;
	*) _arch=${XBPS_TARGET_MACHINE%-musl} ;;
esac

build_style=gnu-makefile
make_build_args="ARCH=$_arch USE_SDL=0 USE_SYSTEM_JPEG=1 USE_RENDERER_DLOPEN=0
 USE_CURL_DLOPEN=0"
make_use_env=true
makedepends="libcurl-devel libglvnd-devel libXxf86dga-devel alsa-lib-devel
 libXrandr-devel libXxf86vm-devel libjpeg-turbo-devel"
depends="libglvnd libXxf86dga alsa-lib libXrandr libXxf86vm"
short_desc="Modern, fast, and secure Quake III Arena engine"
maintainer="Gibson <ypsvlq@gmail.com>"
license="GPL-2.0-only"
homepage="https://quake3e.xyz"
distfiles="https://github.com/ec-/Quake3e/archive/$_version/Quake3e-$_version.tar.gz"
checksum="f3fc9205fa9235bb5e5c54d6e32b72c396dd37fe3eccaec12afec88e488b2c33"

do_install() {
	archext=$(make -E 'print-%:; @echo $($*)' print-ARCHEXT $make_build_args)
	cd build/release-linux-$_arch
	vbin quake3e$archext quake3e
	vbin quake3e.ded$archext quake3e.ded
}
