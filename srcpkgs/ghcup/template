# Template file for 'ghcup'
pkgname=ghcup
version=0.21
revision=1
hostmakedepends='tar git cabal-install pkg-config'
makedepends='zlib-devel ncurses-libtinfo-devel libarchive-devel'
depends='zlib ncurses-libtinfo-libs libarchive gcc gmp make perl'
short_desc='Installer for the general purpose language Haskell'
maintainer='Kye Shi <shi.kye@gmail.com>'
license='LGPL-3.0-only'
homepage='https://www.haskell.org/ghcup/'
distfiles="https://github.com/haskell/ghcup-hs/archive/refs/tags/v$version.tar.gz"
checksum=66bf77b062740eb18053b5b0456d568874b2981f641597e6152a721851900c4e
nopie_files='/usr/bin/ghcup'
nocross='cannot cross compile haskell yet'

post_extract() {
	vsed -i 's/-system-libarchive/+system-libarchive/' cabal.project
}

do_build() {
	cabal update --prefix="$PWD"
	cabal build --prefix="$PWD" --project-file=cabal.project -f'internal-downloader'
}

do_install() {
	cabal install --prefix="$PWD" --install-method='copy' --installdir="$DESTDIR/usr/bin"
	for sh in 'bash' 'fish' 'zsh'; do
		vcompletion "scripts/shell-completions/$sh" "$sh"
	done
}
