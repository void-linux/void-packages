# Template file for 'bun'
pkgname=bun
version=0.5.9
revision=1
archs="aarch64 x86_64"
hostmakedepends="git which llvm15 cmake ccache automake coreutils go libtool wget pkg-config nodejs xz"
short_desc="JavaScript runtime, bundler, transpiler, and package manager"
maintainer="Bnyro <bnyro@tutanota.com>"
license="MIT"
homepage="https://bun.sh"
changelog="https://bun.sh/blog"
distfiles="https://github.com/oven-sh/bun/archive/refs/tags/${pkgname}-v${version}.tar.gz"
checksum=61751480269b6794a18262f974870dee17703b0935436ca2f23ea489ff8d4d74

pre_build() {
	npm install -g esbuild
	_zig_version=$(cat Dockerfile | grep "ZIG_VERSION" | head -n 1 | cut -d "=" -f 2 | tr -d \")
	wget -O zig.tar.xz https://ziglang.org/builds/zig-${_zig_version}.tar.xz
	tar xvf zig.tar.xz
	export ZIG=$(pwd)/zig-${_zig_version}
}

do_build() {
	make devcontainer
	make release-bindings -j12
	make release
}

do_install() {
	vbin packages/bun-linux-${XBPS_TARGET_ARCH}/bun
}
