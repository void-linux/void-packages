# INSTALL for 'brave'
# Fetching github release at install-time

_BUILDDIR="/tmp/brave.build"

if test "$ACTION" = "post"; then
  . /usr/share/brave/pkgdata
  mkdir -p "$_BUILDDIR"
  (
    set -e
    cd "$_BUILDDIR"
    xbps-uhelper fetch "https://github.com/brave/brave-browser/releases/download/v${SVERSION}/brave-v${SVERSION}-linux-${SARCH}.zip"
    echo "${SCHECKSUM}  brave-v${SVERSION}-linux-${SARCH}.zip" >checksum
    sha256sum -c checksum
    unzip "brave-v${SVERSION}-linux-${SARCH}.zip"
    rm "brave-v${SVERSION}-linux-${SARCH}.zip"
  )
  if [ $? -ne 0 ] ; then
    echo "Failed downloading brave"
    rm -r "$_BUILDDIR";
    exit 1;
  fi

  mkdir -p /usr/share/brave
  cp -r ${_BUILDDIR}/* /usr/share/brave/
  ln -sf "/usr/share/brave/brave" /bin/
  cp -r ${FILESDIR}/brave.desktop /usr/share/brave/
  ln -sf "/usr/share/brave/brave.desktop" /usr/share/applications/
  rm -r $_BUILDDIR
fi

