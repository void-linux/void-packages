# Template file for 'haxe'
pkgname=haxe
version=4.3.5
revision=1
build_style=gnu-makefile
hostmakedepends="ocaml opam wget tar pkg-config perl rsync which git m4"
makedepends="pcre2-devel zlib-devel neko-devel mbedtls-devel"
short_desc="High-level cross-platform programming language"
maintainer="ohnonotamoth <dilanjohnson@outlook.com>"
license="MIT"
homepage="https://haxe.org/"
distfiles="https://github.com/HaxeFoundation/haxe/archive/refs/tags/${version}.tar.gz"
checksum=58d79c8c4e01014c00d7e431181f846c42df0324f9d97df752615efa5fcbacbd

pre_build() {
	git clone https://github.com/HaxeFoundation/haxelib.git extra/haxelib_src
	cd extra/haxelib_src
	git submodule update --init --recursive
	cd ../..
	opam init -y --compiler=ocaml-system --disable-sandboxing --shell-setup
	eval $(opam env)
        opam pin add haxe . --kind=path --no-action
	opam install haxe -y --deps-only
	perl -pi -e 's/INSTALL_DIR=\/usr\/local/INSTALL_DIR=\/usr/' Makefile
}
