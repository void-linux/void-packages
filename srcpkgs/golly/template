# Template file for 'golly'
pkgname=golly
version=4.0
revision=1
wrksrc="${pkgname}-${version}-src"
build_wrksrc="gui-wx"
build_style=gnu-makefile
make_build_args="-f makefile-gtk GOLLYDIR=/usr/share/golly LUALIB=-llua5.4
 CXXC=\$(CXX)"
make_install_args="${make_build_args}"
hostmakedepends="python3"
makedepends="MesaLib-devel glu-devel lua54-devel python3-devel wxWidgets-devel
 zlib-devel"
short_desc="Simulator for Conway's Game of Life and other cellular automata"
maintainer="Leah Neukirchen <leah@vuxu.org>"
license="GPL-2.0-or-later"
homepage="http://golly.sourceforge.net/"
distfiles="${SOURCEFORGE_SITE}/${pkgname}/${pkgname}-${version}-src.tar.gz"
checksum=45a8595c9f7064de029f05d339e3fca3776b5a0c36fef95712e697f154d82ae5

CXXFLAGS="-I../gollybase"

post_extract() {
	# POSIX name clash
	vsed -i 's/PAGESIZE/GOLLYPAGESIZE/' $(grep -rlw PAGESIZE gui-wx/*.cpp)
}

pre_configure() {
	if [ "$CROSS_BUILD" ]; then
		vsed -i "s,\(PYTHON_INCLUDE\) =.*,\1=-I${XBPS_CROSS_BASE}/usr/include/python3.9,g" makefile-gtk
	fi
}

do_install() {
	cd "${wrksrc}"
	vbin golly
	vbin bgolly
	vmkdir usr/share/golly
	vcopy Help usr/share/golly
	vcopy Patterns usr/share/golly
	vcopy Rules usr/share/golly
	vcopy Scripts usr/share/golly
}
