From dc7a5b11ed8b8c437796deb83f2f9f84137404c0 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Jan=20Christian=20Gr=C3=BCnhage?=
 <jan.christian@gruenhage.xyz>
Date: Wed, 8 Jun 2022 16:15:55 +0200
Subject: [PATCH] use system libraries

---
 Cargo.lock                                  | 6 +++---
 Cargo.toml                                  | 5 ++++-
 crates/nu-cli/Cargo.toml                    | 2 +-
 crates/nu-command/Cargo.toml                | 4 ++--
 crates/old/nu_plugin_from_sqlite/Cargo.toml | 2 +-
 crates/old/nu_plugin_to_sqlite/Cargo.toml   | 2 +-
 6 files changed, 12 insertions(+), 9 deletions(-)

diff --git a/Cargo.lock b/Cargo.lock
index aaf74b424..8ce23ed77 100644
--- a/Cargo.lock
+++ b/Cargo.lock
@@ -2118,7 +2118,6 @@ version = "0.25.1"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "9f0455f2c1bc9a7caa792907026e469c1d91761fb0ea37cbb16427c77280cf35"
 dependencies = [
- "cc",
  "pkg-config",
  "vcpkg",
 ]
@@ -2614,6 +2613,7 @@ dependencies = [
  "tempfile",
  "time 0.3.13",
  "winres",
+ "zstd",
 ]
 
 [[package]]
@@ -4079,8 +4079,7 @@ dependencies = [
 [[package]]
 name = "reedline"
 version = "0.11.0"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "5559b5ab4817b0da0c6fc6814edfae537209e01d955a2f3e7595606e3d039691"
+source = "git+https://github.com/jcgruenhage/reedline.git?branch=dont-bundle-sqlite-by-default#0968b9d2f74390259ad5f8e867926c0f51c0dabe"
 dependencies = [
  "chrono",
  "crossterm 0.24.0",
@@ -5907,4 +5906,5 @@ checksum = "9fd07cbbc53846d9145dbffdf6dd09a7a0aa52be46741825f5c97bdd4f73f12b"
 dependencies = [
  "cc",
  "libc",
+ "pkg-config",
 ]
diff --git a/Cargo.toml b/Cargo.toml
index 5b358f82b..70db93a1a 100644
--- a/Cargo.toml
+++ b/Cargo.toml
@@ -53,7 +53,7 @@ nu-system = { path = "./crates/nu-system", version = "0.68.1" }
 nu-table = { path = "./crates/nu-table", version = "0.68.1"  }
 nu-term-grid = { path = "./crates/nu-term-grid", version = "0.68.1"  }
 nu-utils = { path = "./crates/nu-utils", version = "0.68.1"  }
-reedline = { version = "0.11.0", features = ["bashisms", "sqlite"]}
+reedline = { git = "https://github.com/jcgruenhage/reedline.git", branch = "dont-bundle-sqlite-by-default", features = ["bashisms", "sqlite"]}
 rayon = "1.5.1"
 is_executable = "1.0.1"
 simplelog = "0.12.0"
@@ -122,3 +122,6 @@ debug = false
 name = "nu"
 path = "src/main.rs"
 
+[dependencies.zstd]
+features = ["pkg-config"]
+version = ">=0.0.0"
diff --git a/crates/nu-cli/Cargo.toml b/crates/nu-cli/Cargo.toml
index a2782b1c1..2a256ce2f 100644
--- a/crates/nu-cli/Cargo.toml
+++ b/crates/nu-cli/Cargo.toml
@@ -20,7 +20,7 @@ nu-protocol = { path = "../nu-protocol", version = "0.68.1"  }
 nu-utils = { path = "../nu-utils", version = "0.68.1"  }
 nu-ansi-term = "0.46.0"
 nu-color-config = { path = "../nu-color-config", version = "0.68.1"  }
-reedline = { version = "0.11.0", features = ["bashisms", "sqlite"]}
+reedline = { git = "https://github.com/jcgruenhage/reedline.git", branch = "dont-bundle-sqlite-by-default", features = ["bashisms", "sqlite"]}
 
 atty = "0.2.14"
 chrono = "0.4.21"
diff --git a/crates/nu-command/Cargo.toml b/crates/nu-command/Cargo.toml
index 7092f58c6..2783282b0 100644
--- a/crates/nu-command/Cargo.toml
+++ b/crates/nu-command/Cargo.toml
@@ -87,9 +87,9 @@ unicode-segmentation = "1.8.0"
 url = "2.2.1"
 uuid = { version = "1.1.2", features = ["v4"] }
 which = { version = "4.3.0", optional = true }
-reedline = { version = "0.11.0", features = ["bashisms", "sqlite"]}
+reedline = { git = "https://github.com/jcgruenhage/reedline.git", branch = "dont-bundle-sqlite-by-default", features = ["bashisms", "sqlite"]}
 wax = { version =  "0.5.0", features = ["diagnostics"] }
-rusqlite = { version = "0.28.0", features = ["bundled"], optional = true }
+rusqlite = { version = "0.28.0", optional = true }
 sqlparser = { version = "0.16.0", features = ["serde"], optional = true }
 
 [target.'cfg(unix)'.dependencies]
diff --git a/crates/old/nu_plugin_from_sqlite/Cargo.toml b/crates/old/nu_plugin_from_sqlite/Cargo.toml
index 35968022a..a09bb591f 100644
--- a/crates/old/nu_plugin_from_sqlite/Cargo.toml
+++ b/crates/old/nu_plugin_from_sqlite/Cargo.toml
@@ -18,7 +18,7 @@ nu-source = { path="../nu-source", version = "0.68.1" }
 tempfile = "3.2.0"
 
 [dependencies.rusqlite]
-features = ["bundled", "blob"]
+features = ["blob"]
 version = "0.26.1"
 
 [build-dependencies]
diff --git a/crates/old/nu_plugin_to_sqlite/Cargo.toml b/crates/old/nu_plugin_to_sqlite/Cargo.toml
index 1ef5cf77f..aedd6fe88 100644
--- a/crates/old/nu_plugin_to_sqlite/Cargo.toml
+++ b/crates/old/nu_plugin_to_sqlite/Cargo.toml
@@ -18,7 +18,7 @@ nu-source = { path="../nu-source", version = "0.68.1" }
 tempfile = "3.2.0"
 
 [dependencies.rusqlite]
-features = ["bundled", "blob"]
+features = ["blob"]
 version = "0.26.1"
 
 [build-dependencies]
-- 
2.37.3

