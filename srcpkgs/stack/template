# Template file for 'stack'
pkgname=stack
version=2.1.3.1
revision=4
_commit=bc503000bd2c2643689c8a38c17e6696a3149aa7
_stackage="lts-15.4"
wrksrc=${pkgname}-${version}
hostmakedepends="cabal-install pkg-config unzip"
makedepends="git zlib-devel pcre-devel"
depends="gmp-devel iana-etc"
short_desc="Cross-platform program for developing Haskell projects"
maintainer="Leah Neukirchen <leah@vuxu.org>"
license="BSD-3-Clause"
homepage="https://haskellstack.org"
skip_extraction="cabal.config-${_stackage}"
nocross=yes
nopie_files="/usr/bin/stack"

# TODO: Switch back to hackage once it has a ghc-8.8 compatible stack version.
do_fetch() {
	git clone https://github.com/commercialhaskell/stack ${wrksrc}
	cd ${wrksrc}
	git reset --hard ${_commit}
	xbps-uhelper fetch https://www.stackage.org/${_stackage}/cabal.config
}

do_build() {
	HOME=$PWD cabal new-update
	HOME=$PWD cabal new-build ${makejobs} --flag disable-git-info
}

do_install() {
	eval vbin dist-newstyle/build/*/*/*/build/stack/stack
	vlicense LICENSE
}
