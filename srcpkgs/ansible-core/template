# Template file for 'ansible-core'
pkgname=ansible-core
version=2.20.0
revision=1
build_style=python3-pep517
hostmakedepends="python3-setuptools python3-wheel python3-docutils
 python3-Jinja2 python3-yaml"
depends="python3-cryptography python3-Jinja2 python3-paramiko python3-yaml
 python3-resolvelib git"
checkdepends="${depends} openssh python3-bcrypt python3-botocore
 python3-passlib python3-pexpect python3-pytest-mock python3-pytest-xdist
 python3-pytest-forked python3-pywinrm python3-voluptuous"
short_desc="Simple deployment, configuration management and execution framework"
maintainer="Orphaned <orphan@voidlinux.org>"
license="GPL-3.0-or-later"
homepage="https://www.ansible.com/"
changelog="https://raw.githubusercontent.com/ansible/ansible/stable-${version%.*}/changelogs/CHANGELOG-v${version%.*}.rst"
distfiles="${PYPI_SITE}/a/ansible_core/ansible_core-${version}.tar.gz"
checksum=cd73faf28a056c933bc1eee8f66ab597e7ec7309d42c8a6e5d6e4294c4a78b54
conflicts="ansible<2.10.1_1"
replaces="ansible-base<2.11.0_1"

do_check() {
	# Test script is missing and exists to be in child of root
	mkdir -p bin
	ln -sf ../test/lib/ansible_test/_util/target/cli/ansible_test_cli_stub.py bin/ansible-test

	# needs mount
	rm test/units/modules/test_mount_facts.py

	bin/ansible-test units
}

post_install() {
	./packaging/cli-doc/build.py man --output-dir man
	for page in man/*.1; do
		vman ${page}
	done
}

ansible-base_package() {
	metapackage=yes
	depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" (transitional dummy package)"
}
