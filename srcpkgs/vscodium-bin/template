# Template file for 'vscodium-bin'
pkgname=vscodium-bin
version=1.107.18627
revision=1
depends="libX11 libxkbfile libsecret nss gtk+3 alsa-lib xdg-utils libnotify libXScrnSaver cups"
short_desc="Binary distribution of VSCodium (Free/Libre Open Source Software Binaries of VSCode)"
maintainer="Luis F. Rosales <Lfssjquantum@murena.io>"
license="MIT"
homepage="https://github.com/VSCodium/vscodium"
repository=nonfree
nostrip=yes

case "$XBPS_TARGET_MACHINE" in
	x86_64)
		_arch="x64"
		checksum="82a07175de96c359c85e8be2c60b2e222bcb5e7d4ba195cde4d84ae1b2e64a78"
		;;
	aarch64)
		_arch="arm64"
		checksum="df658fef820961520aba19ac322d0416a8d395600ee03802db8a6d9b706a4a98"
		;;
	armv7l)
		_arch="armhf"
		checksum="6cd8dcf75ce35579d0efadc61e69554cd0c3e729e5261aed191ed7cdc8aaeed0"
		;;
	*)
		broken="Architecture not supported upstream"
		;;
esac

distfiles="https://github.com/VSCodium/vscodium/releases/download/${version}/VSCodium-linux-${_arch}-${version}.tar.gz"

create_wrksrc=yes

do_install() {
    vmkdir usr/lib/vscodium-bin

    vcopy * usr/lib/vscodium-bin

    vmkdir usr/bin
    ln -sf /usr/lib/vscodium-bin/bin/codium ${DESTDIR}/usr/bin/vscodium

    vinstall resources/app/resources/linux/code.png 644 usr/share/pixmaps/vscodium.png

    vmkdir usr/share/applications
    cat > ${DESTDIR}/usr/share/applications/vscodium.desktop <<EOF
[Desktop Entry]
Name=VSCodium
Comment=Code Editing. Redefined.
GenericName=Text Editor
Exec=/usr/bin/vscodium %F
Icon=vscodium
Type=Application
StartupNotify=true
StartupWMClass=VSCodium
Categories=Utility;TextEditor;Development;IDE;
MimeType=text/plain;inode/directory;application/x-code-workspace;
Actions=new-empty-window;
Keywords=vscode;codium;

[Desktop Action new-empty-window]
Name=New Empty Window
Exec=/usr/bin/vscodium --new-window %F
Icon=vscodium
EOF
}
