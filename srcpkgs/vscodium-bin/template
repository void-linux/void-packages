# Template file for 'vscodium-bin'
# based on https://aur.archlinux.org/packages/vscodium-bin

pkgname=vscodium-bin
_pkgname=VSCodium
version=1.79.2.23166
license="MIT"
revision=1
archs="x86_64 aarch64"
depends="fontconfig libXtst gtk+3 python cairo alsa-lib nss libgcc libnotify libXScrnSaver glibc>=2.28_4 bash"
maintainer="mincx <mincx@disroot.org>"
homepage="https://github.com/${_pkgname}/vscodium"
short_desc="Binary releases of VS Code without MS branding/telemetry/licensing."
conflicts="vscodium"

if [ "$XBPS_TARGET_MACHINE" =  "x86_64" ]; then
    distfiles="${homepage}/releases/download/${version}/${_pkgname}-linux-x64-${version}.tar.gz"
    checksum="fd6c9b37ae6004fc9e6c459b4d667c9d75105c75ddf5d693eb6e4d8ef56e8fe3"
else
    distfiles="${homepage}/releases/download/${version}/${_pkgname}-linux-arm64-${version}.tar.gz"
    checksum="26dc36e3a96575256ed21b3b52837330990c802e074803dfd547808dc75fb5bb"
fi

do_install() {
    vmkdir /opt/$pkgname

    vcopy * /opt/$pkgname

    vbin "$FILESDIR/$pkgname.sh" codium
    ln -sf /usr/bin/codium $DESTDIR/usr/bin/vscodium

    vinstall "$FILESDIR/$pkgname.desktop" 644 /usr/share/applications
    vinstall "$FILESDIR/$pkgname-wayland.desktop" 644 /usr/share/applications
    vinstall "$FILESDIR/$pkgname-uri-handler.desktop" 644 /usr/share/applications

    vinstall "$wrksrc/resources/app/resources/linux/code.png" 644 /usr/share/pixmaps/ vscodium.png

    for shell_path in $(ls -d ${wrksrc}/resources/completions/*/) ; do
        shell=$(basename $shell_path)
        completion=$(ls -1 ${shell_path} | head -n 1)
        vcompletion "$shell_path/$completion" $shell codium
    done
    
    vlicense "resources/app/LICENSE.txt"
}