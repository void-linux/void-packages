# Template file for 'sequoia-octopus-librnp'
pkgname=sequoia-octopus-librnp
version=1.11.1
revision=1
archs="~arm*" # no thunderbird
build_style=cargo
configure_args="--no-default-features --features crypto-openssl"
hostmakedepends="pkg-config libgit2-1.8-devel"
makedepends="openssl-devel libgit2-1.8-devel sqlite-devel"
short_desc="Drop-in replacement for the RNP library in Thunderbird"
maintainer="classabbyamp <void@placeviolette.net>"
license="LGPL-2.0-or-later"
homepage="https://sequoia-pgp.org/projects/#octopus"
changelog="https://gitlab.com/sequoia-pgp/sequoia-octopus-librnp/-/raw/main/NEWS"
distfiles="https://gitlab.com/sequoia-pgp/sequoia-octopus-librnp/-/archive/v${version}/sequoia-octopus-librnp-v${version}.tar.gz"
checksum=fae46cddf0fc4962c3547b65d6388ea19f475960d65d2bb0e1c3e8a7978b2f40

alternatives="librnp:/usr/lib/thunderbird/librnp.so:/usr/lib/thunderbird/libsequoia_octopus_librnp.so"

post_patch() {
	# https://github.com/rust-lang/cc-rs/issues/1469
	cargo update --package cc:1.2.16 --precise 1.2.14
}

do_install() {
	vinstall "target/${RUST_TARGET}/release/libsequoia_octopus_librnp.so" 0755 /usr/lib/thunderbird
}
