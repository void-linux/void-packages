# Template file for 'vesktop'
pkgname=vesktop
version=1.6.1
revision=1
hostmakedepends="git nodejs pnpm pkg-config python3 tar"
makedepends="glib-devel libnotify-devel"
depends="electron35 libnotify glib"
short_desc="Custom Discord client with Vencord integration"
maintainer="Splayer <mynamesplayer@gmail.com>"
license="GPL-3.0-only"
homepage="https://github.com/Vencord/Vesktop"
distfiles="https://github.com/Vencord/Vesktop/archive/refs/tags/v${version}.tar.gz"
checksum=ba103cf8a9edef31eb78c1bc3d76e40151f84ff02b2da8fd2bc21a954841b523

do_build() {
    # prevent pnpm from trying to write to read only system dirs
	export PNPM_HOME="${wrksrc}/.pnpm"

	pnpm install --frozen-lockfile
	pnpm buildLibVesktop
	pnpm build
	pnpm package --linux dir
}

do_install() {
	vmkdir usr/lib/vesktop
	vcopy dist/linux-unpacked/resources/* usr/lib/vesktop/
	vmkdir usr/share/applications
	vinstall "${FILESDIR}/vesktop.desktop" 644 "/usr/share/applications"
	vinstall build/icon.svg 644 usr/share/pixmaps vesktop.svg

    #startup
	vbin ${FILESDIR}/vesktop
}
