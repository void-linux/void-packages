pkgname=xray-core
version=25.9.11
revision=1
short_desc="A platform for building proxies to bypass network restrictions"
maintainer="RohamN0 <roham@rohamnodoust.ir>"
license="MPL-2.0"
homepage="https://github.com/XTLS/Xray-core"
distfiles="https://github.com/XTLS/Xray-core/archive/refs/tags/v${version}.zip"
checksum="ed6d6f7c065342367ece8a9899647866e856026f5e6a2837779a04c1ae50d804"

hostmakedepends="unzip go"
noextract="v${version}.zip"

do_extract() {
    mkdir -p ${wrksrc}
    unzip ${XBPS_SRCDISTDIR}/${pkgname}-${version}/v${version}.zip -d ${wrksrc}
}

do_build() {
	export CGO_ENABLED=0
	cd ${wrksrc}/Xray-core-${version}/main

	go build -o xray -trimpath -buildvcs=false -ldflags="-s -w -buildid=" .
}

do_install() {
	install -Dm755 ${wrksrc}/Xray-core-${version}/main/xray ${DESTDIR}/usr/bin/xray
	install -Dm644 ${wrksrc}/Xray-core-${version}/LICENSE ${DISTDIR}/usr/share/licenses/${pkgname}/LICENSE
}

post_install() {
	vlicense ${DISTDIR}/usr/share/licenses/${pkgname}/LICENSE
}
