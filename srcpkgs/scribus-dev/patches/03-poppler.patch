Source: https://github.com/scribusproject/scribus/commit/8e05d26c19097ac2ad5b4ebbf40a3771ee6faf9c.patch
Upstream: Yes
Reason: FTBFS

From 8e05d26c19097ac2ad5b4ebbf40a3771ee6faf9c Mon Sep 17 00:00:00 2001
From: Jean Ghali <jghali@libertysurf.fr>
Date: Sat, 22 Sep 2018 23:11:15 +0000
Subject: [PATCH] Fix failure to build PDF import plugin with poppler 0.69

git-svn-id: svn://scribus.net/trunk/Scribus@22703 11d20701-8431-0410-a711-e3c959e3b870
---
 scribus/plugins/import/pdf/importpdf.cpp | 40 +++++++++++++++++++-----
 1 file changed, 32 insertions(+), 8 deletions(-)

diff --git a/scribus/plugins/import/pdf/importpdf.cpp b/scribus/plugins/import/pdf/importpdf.cpp
index a5ce57fdfc..e3690cca8b 100644
--- a/scribus/plugins/import/pdf/importpdf.cpp
+++ b/scribus/plugins/import/pdf/importpdf.cpp
@@ -548,10 +548,21 @@ bool PdfPlug::convert(const QString& fn)
 									}
 									else
 									{
-										GooList *ocgs;
-										int i;
-										ocgs = ocg->getOCGs ();
-										for (i = 0; i < ocgs->getLength (); ++i)
+#if POPPLER_ENCODED_VERSION >= POPPLER_VERSION_ENCODE(0, 69, 0)
+										const auto& ocgs = ocg->getOCGs ();
+										for (const auto& ocg : ocgs)
+										{
+											OptionalContentGroup *oc = ocg.second.get();
+											QString ocgName = UnicodeParsedString(oc->getName());
+											if (!ocgNames.contains(ocgName))
+											{
+												ocgGroups.prepend(oc);
+												ocgNames.append(ocgName);
+											}
+										}
+#else
+										GooList *ocgs = ocg->getOCGs ();
+										for (int i = 0; i < ocgs->getLength (); ++i)
 										{
 											OptionalContentGroup *oc = (OptionalContentGroup *)ocgs->get(i);
 											QString ocgName = UnicodeParsedString(oc->getName());
@@ -561,15 +572,27 @@ bool PdfPlug::convert(const QString& fn)
 												ocgNames.append(ocgName);
 											}
 										}
+#endif
 									}
 								}
 							}
 							else
 							{
-								GooList *ocgs;
-								int i;
-								ocgs = ocg->getOCGs ();
-								for (i = 0; i < ocgs->getLength (); ++i)
+#if POPPLER_ENCODED_VERSION >= POPPLER_VERSION_ENCODE(0, 69, 0)
+								const auto& ocgs = ocg->getOCGs ();
+								for (const auto& ocg : ocgs)
+								{
+									OptionalContentGroup *oc = ocg.second.get();
+									QString ocgName = UnicodeParsedString(oc->getName());
+									if (!ocgNames.contains(ocgName))
+									{
+										ocgGroups.prepend(oc);
+										ocgNames.append(ocgName);
+									}
+								}
+#else
+								GooList *ocgs = ocg->getOCGs ();
+								for (int i = 0; i < ocgs->getLength (); ++i)
 								{
 									OptionalContentGroup *oc = (OptionalContentGroup *)ocgs->get(i);
 									QString ocgName = UnicodeParsedString(oc->getName());
@@ -579,6 +602,7 @@ bool PdfPlug::convert(const QString& fn)
 										ocgNames.append(ocgName);
 									}
 								}
+#endif
 							}
 						}
 					}
