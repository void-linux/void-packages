# Template file for 'libircclient'
pkgname=libircclient
version=1.10
revision=1
build_style=gnu-configure
configure_args="--enable-openssl --enable-ipv6 --enable-shared"
makedepends="libressl-devel"
short_desc="IRC client library"
maintainer="maciozo@maciozo.com <maciozo@maciozo.com>"
license="LGPL-3.0-or-later"
homepage="https://www.ulduzsoft.com/linux/libircclient/"
distfiles="https://netix.dl.sourceforge.net/project/libircclient/libircclient/${version}/libircclient-${version}.tar.gz"
checksum=bbb26f3af348b252c5204917a7f91cfdf172f1b6afbf4df1e561b03e20503c2d

case "$XBPS_TARGET_MACHINE" in
	*-musl)	depends+=" musl-devel";;
	*) depends+=" glibc-devel";;
esac

do_install() {
	vmkdir usr/lib
	vcopy src/*.so /usr/lib
	vcopy src/*.a /usr/lib
	
	# Generate versioned shlib link (libircclient.so.x -> libircclient.so)
	
	for _sharedlib in ${PKGDESTDIR}/usr/lib/*.so; do
		echo $(basename ${_sharedlib})
		_soname=$(objdump -p ${_sharedlib} | awk '/SONAME/ {print $2}')
		ln -s $(basename ${_sharedlib}) ${PKGDESTDIR}/usr/lib/${_soname}
	done
	
	vmkdir usr/include
	vcopy include/* /usr/include
	
	vmkdir usr/share/doc/${pkgname}
	vcopy doc/*.rst /usr/share/doc/${pkgname}
	
	vmkdir usr/share/doc/${pkgname}/sources
	vcopy doc/sources/*.rst /usr/share/doc/${pkgname}/sources
}

libircclient-devel_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" - development files"

	pkg_install() {
		vmkdir usr/share/doc/${pkgname}
		vmove usr/share/doc/${sourcepkg}/*

		vmkdir usr/lib/pkgconfig
		vcopy ${FILESDIR}/libircclient.pc /usr/lib/pkgconfig/

		vmkdir usr/include
		vmove usr/include
		
		vmkdir usr/lib
		vmove "usr/lib/*.a"
		
		vman man/libircclient.1
	}
}
