# Template file for 'CPU-X'
pkgname=CPU-X
version=4.4.0
revision=1
archs="x86_64* i686*"
build_style=cmake
hostmakedepends="pkg-config nasm"
makedepends="ncurses-devel gettext-devel libcpuid-devel pciutils-devel
 glfw-devel ocl-icd-devel procps-ng-devel libstatgrab Vulkan-Headers
 $(vopt_if gtk3 gtk+3-devel)"
checkdepends="mawk nawk grep"
short_desc="Free software that gathers information on CPU, motherboard and more"
maintainer="Subhaditya Nath <sn03.general@gmail.com>"
license="GPL-3.0-or-later"
homepage="https://x0rg.github.io/CPU-X/"
changelog="https://raw.githubusercontent.com/X0rg/CPU-X/master/ChangeLog.md"
distfiles="https://github.com/X0rg/CPU-X/archive/v${version}.tar.gz"
checksum=5d895ffa80c344cb6887d3fef7d833d20f367a74e35b79dc3f291c2496f060d9
build_options="gtk3"
build_options_default="gtk3"

if [ "$XBPS_TARGET_LIBC" = musl ]; then
	makedepends+=" libexecinfo-devel"
	LDFLAGS="-lexecinfo"
fi

# Tests depend on the -P flag of grep, which is not available in chroot-grep
# and installing grep as checkdepends breaks base-chroot.
# So, only run tests in CI, where the masterdir is ephemeral anyway.
if [ "$XBPS_BUILD_ENVIRONMENT" != "void-packages-ci" ]; then
	make_check=no	# breaks base-chroot
fi
