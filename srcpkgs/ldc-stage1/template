# Template file for 'ldc-stage1'
pkgname=ldc-stage1
version=1.30.0
revision=1
build_style=cmake
configure_args="
 -DINCLUDE_INSTALL_DIR=/usr/include/dlang/ldc
 -DBUILD_SHARED_LIBS=ON
 -DCMAKE_BUILD_TYPE=RelWithDebInfo
 -DBASH_COMPLETION_COMPLETIONSDIR=/usr/share/bash-completion
 -DCOMPILE_D_MODULES_SEPARATELY=ON
 -DC_SYSTEM_LIBS='unwind;m;pthread;rt;dl'"
hostmakedepends="dmd llvm perl pkg-config"
makedepends="libcurl-devel libffi-devel ncurses-devel zlib-devel
 llvm-libunwind-devel"
depends="llvm-libunwind-devel"
checkdepends="python3"
short_desc="LLVM D Compiler - stage 1"
maintainer="Đoàn Trần Công Danh <congdanhqx@gmail.com>"
license="BSD-3-Clause, BSL-1.0"
homepage="https://wiki.dlang.org/LDC"
changelog="https://raw.githubusercontent.com/ldc-developers/ldc/master/CHANGELOG.md"
distfiles="https://github.com/ldc-developers/ldc/releases/download/v${version}/ldc-${version}-src.tar.gz"
checksum=fdbb376f08242d917922a6a22a773980217fafa310046fc5d6459490af23dacd
nopie=yes
nocross="dmd compilation fails on cross"
make_check=no
make_build_args=-v
conflicts="ldc>=0 ldc-runtime>=0 ldc-runtime-debug>=0"
provides="ldc-${version}_1
 ldc-runtime-${version}_1
 ldc-runtime-debug-${version}_1"
shlib_provides="
 libdruntime-ldc-debug-shared.so.100
 libphobos2-ldc-debug-shared.so.100
 libdruntime-ldc-shared.so.100
 libphobos2-ldc-shared.so.100"

post_patch() {
	if [ "$XBPS_TARGET_LIBC" = musl ]; then
		patch -Np1 -i "$FILESDIR/musl.patch"
	fi
}

post_install() {
	vlicense LICENSE
}
