# Template file for 'chroot-cmake'
pkgname=chroot-cmake
version=3.18.2
revision=1
wrksrc="${pkgname#chroot-}-${version}"
bootstrap=yes
build_style=configure
configure_args="--prefix=/usr
 --mandir=/share/man
 --docdir=/share/doc/cmake
 --no-system-curl
 --system-expat
 --no-system-jsoncpp
 --system-zlib
 --system-bzip2
 --system-liblzma
 --no-system-nghttp2
 --system-zstd
 --system-libarchive
 --no-system-librhash
 --no-system-libuv
 ${XBPS_MAKEJOBS:+--parallel=$XBPS_MAKEJOBS}"
makedepends="libarchive-devel expat-devel"
short_desc="Cross-platform, open-source build system (chroot version)"
maintainer="Jürgen Buchmüller <pullmoll@t-online.de>"
license="LGPL-2.1-or-later, BSD-3-Clause"
homepage="https://www.cmake.org"
distfiles="https://www.cmake.org/files/v${version%.*}/${pkgname#chroot-}-${version}.tar.gz"
checksum=5d4e40fc775d3d828c72e5c45906b4d9b59003c9433ff1b36a1cb552bbd51d7e
conflicts="cmake>=0"

if [ "$CROSS_BUILD" ]; then
	build_style=cmake
	hostmakedepends="gcc-fortran"
fi

post_install() {
	rm -rf ${DESTDIR}/usr/share/doc
	rm -rf ${DESTDIR}/usr/share/cmake-${version%.*}/Help
	# TODO: strip usr/share/cmake-${version%.*}/Modules/Compiler we don't need
	vlicense Copyright.txt
	vlicense Utilities/KWIML/Copyright.txt KWIML-Copyright.txt
	vlicense Utilities/cmzlib/Copyright.txt cmzlib-Copyright.txt
}
