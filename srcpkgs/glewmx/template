# Template file for 'glewmx'
pkgname=glewmx
version=1.13.0
revision=1
_ubuntu_rel=5build1
build_style=gnu-makefile
configure_args=GLEW_DEST="${DESTDIR}/usr"
make_install_target="install.all"
hostmakedepends="wget"
makedepends="libglvnd-devel libX11-devel"
depends="glu libXi libXmu"
short_desc="OpenGL Extension Wrangler MX"
maintainer="Earldridge Jazzed Pineda <earldridgejazzedpineda@gmail.com>"
license="BSD-3-Clause, MIT, GPL-2.0-or-later"
homepage="http://launchpad.net/ubuntu/+source/glewmx"
distfiles="https://launchpad.net/ubuntu/+archive/primary/+files/glewmx_${version}.orig.tar.gz"
checksum=aa25dc48ed84b0b64b8d41cdd42c8f40f149c37fa2ffa39cd97f42c78d128bc7

post_extract() {
	wget "https://launchpad.net/ubuntu/+archive/primary/+files/glewmx_${version}-${_ubuntu_rel}.debian.tar.xz"
	vextract --no-strip-components \
	glewmx_${version}-${_ubuntu_rel}.debian.tar.xz
}

do_patch() {
	for i in $(grep -v '#' debian/patches/series); do
		patch -p1 -i "debian/patches/${i}"
	done

	sed -i 's|lib64|lib|' config/Makefile.linux
	sed -i '/^.PHONY: .*\.pc$/d' Makefile
}

do_build() {
	make CC=$CC AR=$AR AS=$AS LD=$CC RANLIB=$RANLIB \
		CFLAGS.EXTRA="-fPIC $CFLAGS $CPPFLAGS" \
		LDFLAGS.EXTRA="$LDFLAGS" ${makejobs}
}

post_install() {
	mv "${DESTDIR}/usr/include/GL/glew.h" \
	"${DESTDIR}/usr/include/GL/glewmx.h"
	mv "${DESTDIR}/usr/include/GL/glxew.h" \
	"${DESTDIR}/usr/include/GL/glxewmx.h"
	mv "${DESTDIR}/usr/include/GL/wglew.h" \
	"${DESTDIR}/usr/include/GL/wglewmx.h"

	rm -R ${DESTDIR}/usr/bin
	rm ${DESTDIR}/usr/lib/libGLEW.so
	rm ${DESTDIR}/usr/lib/libGLEW.a
	rm ${DESTDIR}/usr/lib/pkgconfig/glew.pc

	chmod 0755 "${DESTDIR}"/usr/lib/libGLEW*.so.${version}

	vlicense LICENSE.txt
}

glewmx-devel_package() {
	short_desc+=" - development files"
	depends="${sourcepkg}>=${version}_${revision} glu-devel"
	pkg_install() {
		vmove usr/include
		vmove "usr/lib/*.a"
		vmove "usr/lib/*.so"
		vmove usr/lib/pkgconfig
	}
}
