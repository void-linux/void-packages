# Template file for 'nextcloud-client'
pkgname=nextcloud-client
version=2.5.1
revision=1
wrksrc=desktop-${version}
build_style=cmake
configure_args="-Wno-dev -DNO_SHIBBOLETH=TRUE"
hostmakedepends="pkg-config extra-cmake-modules doxygen python3-Sphinx qt5-tools"
makedepends="qtkeychain-qt5-devel qt5-webengine-devel qtkeychain-qt5-devel qt5-location-devel sqlite-devel qt5-declarative-devel
 qt5-webchannel-devel qt5-tools-devel qt5-plugin-odbc qt5-plugin-tds qt5-plugin-pgsql qt5-plugin-mysql
 qt5-plugin-sqlite qt5-svg-devel libzip-devel libressl-devel libcrypto44"
depends="xdg-utils qt5-webkit"
short_desc="Desktop Syncing Client for Nextcloud"
maintainer="Nick Hahn <nick.hahn@hotmail.de>"
license="GPL-2.0-only"
homepage="https://nextcloud.com/"
distfiles="https://github.com/nextcloud/desktop/archive/v${version}.tar.gz"
checksum=48be2556f4fddb956ad31e954be5f9c73482e936a80ec0efaeb30549dcd81f19

post_extraction() {
	# Compilation fails, because libressl does not implement the replaced function
	sed -i 's/EVP_PKEY_CTX_set_rsa_mgf1_md/EVP_PKEY_CTX_set_rsa_oaep_md/' src/libsync/clientsideencryption.cpp
	# Compilation fails because of this unknown argument
	sed -i 's/-Wno-gnu-zero-variadic-macro-arguments//' cmake/modules/Warnings.cmake

}

post_install() {
	vsv nextcloud-client
}
