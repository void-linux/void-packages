# Template file for 'forticlient'
pkgname=forticlient
version=7.2.1.0700
revision=1
archs="x86_64"
depends="libffi"
short_desc="FortiClient VPN"
maintainer="Eloi Torrents <eloitor@disroot.org>"
license="custom:Proprietary"
homepage="https://www.fortinet.com"
distfiles="https://repo.fortinet.com/repo/forticlient/7.2/debian/pool/non-free/f/forticlient/forticlient_${version}_amd64.deb"
checksum=e2197329afc7305e558da2c69dccaaf0b526e787095578d917ed78cea0a18260
alternatives="forticlient:/usr/bin/FortiClient:/opt/forticlient/gui/FortiClient-linux-x64/FortiClient"
make_dirs="/etc/forticlient 0755 root root
 /var/log/forticlient/ 0755 root root"
repository=nonfree
nopie=yes

do_install() {
	vmkdir usr/share/applications
	vinstall usr/share/applications/forticlient.desktop 644 /usr/share/applications
	vinstall usr/share/applications/forticlient-register.desktop 644 /usr/share/applications
	vinstall opt/forticlient/Fortitray.desktop 644 /usr/share/applications

	vmkdir usr/share/doc/forticlient
	vinstall usr/share/doc/forticlient/changelog 644 /usr/share/doc/forticlient
	vinstall usr/share/doc/forticlient/copyright 644 /usr/share/doc/forticlient

	for size in 16 22 24 32 48 64 128 256; do
		vinstall usr/share/icons/hicolor/${size}x${size}/apps/forticlient.png 644 \
			/usr/share/icons/hicolor/${size}x${size}/apps
	done

	vinstall usr/share/polkit-1/actions/org.fortinet.forticlient.policy 644 \
		/usr/share/polkit-1/actions
	vinstall usr/share/polkit-1/actions/org.fortinet.fortitray.policy 644 \
		/usr/share/polkit-1/actions

	cd opt/forticlient
	vinstall FortiGuardAgent 744 /opt/forticlient
	vinstall confighandler 744 /opt/forticlient
	vinstall epctrl 744 /opt/forticlient
	vinstall fazlogupload 744 /opt/forticlient
	vinstall fchelper 744 /opt/forticlient
	vinstall fctsched 744 /opt/forticlient
	vinstall firewall 744 /opt/forticlient
	vinstall fmon 744 /opt/forticlient
	vinstall forticlient-cli 744 /opt/forticlient
	vinstall fortitray 744 /opt/forticlient
	vinstall fortitraylauncher 744 /opt/forticlient
	vinstall fortivpn 744 /opt/forticlient
	vinstall scanunit 744 /opt/forticlient
	vinstall update 744 /opt/forticlient
	vinstall vpn 744 /opt/forticlient
	vinstall vulscan 744 /opt/forticlient
	vinstall webfilter 744 /opt/forticlient
	vinstall ztproxy 744 /opt/forticlient

	vinstall FGD_category_list.json 644 /opt/forticlient
	vinstall TLS_whitelist.json 644 /opt/forticlient
	vinstall icdb 644 /opt/forticlient
	vinstall isdb_app.txt 644 /opt/forticlient
	vinstall isdb_map.dat 644 /opt/forticlient
	vinstall libav.so 644 /opt/forticlient
	vinstall libvcm.so 644 /opt/forticlient
	vinstall wf_intercepted_apps.json 644 /opt/forticlient
	vinstall vcm_sig/vulns.dat 644 /opt/forticlient/vcm_sig
	vinstall vir_sig/vir_high 644 /opt/forticlient/vir_sig/vir_high

	for name in Forticlient Virus_Alert alert avatar_b notification_error notification_info notification_warning; do
		vinstall images/${name}.png 644 /opt/forticlient/images
	done

	cd gui/FortiClient-linux-x64
	vmkdir /opt/forticlient/gui/FortiClient-linux-x64
	vinstall FortiClient 744 /opt/forticlient/gui/FortiClient-linux-x64
	vinstall chrome-sandbox 744 /opt/forticlient/gui/FortiClient-linux-x64
	vinstall chrome_100_percent.pak 644 /opt/forticlient/gui/FortiClient-linux-x64
	vinstall chrome_200_percent.pak 644 /opt/forticlient/gui/FortiClient-linux-x64
	vinstall icudtl.dat 644 /opt/forticlient/gui/FortiClient-linux-x64
	vinstall libEGL.so 644 /opt/forticlient/gui/FortiClient-linux-x64
	vinstall libGLESv2.so 644 /opt/forticlient/gui/FortiClient-linux-x64
	vinstall libffmpeg.so 644 /opt/forticlient/gui/FortiClient-linux-x64
	vinstall libvk_swiftshader.so 644 /opt/forticlient/gui/FortiClient-linux-x64
	vinstall libvulkan.so 644 /opt/forticlient/gui/FortiClient-linux-x64
	vinstall resources.pak 644 /opt/forticlient/gui/FortiClient-linux-x64
	vinstall snapshot_blob.bin 644 /opt/forticlient/gui/FortiClient-linux-x64
	vinstall v8_context_snapshot.bin 644 /opt/forticlient/gui/FortiClient-linux-x64
	vinstall version 644 /opt/forticlient/gui/FortiClient-linux-x64
	vinstall vk_swiftshader_icd.json 644 /opt/forticlient/gui/FortiClient-linux-x64

	vmkdir opt/forticlient/gui/FortiClient-linux-x64/locales
	vcopy "locales/*.pak" opt/forticlient/gui/FortiClient-linux-x64/locales

	vinstall resources/app.asar 644 /opt/forticlient/gui/FortiClient-linux-x64/resources

	vinstall swiftshader/libEGL.so 644 /opt/forticlient/gui/FortiClient-linux-x64/swiftshader
	vinstall swiftshader/libGLESv2.so 644 /opt/forticlient/gui/FortiClient-linux-x64/swiftshader
}

post_install() {
	vsv forticlient
	vlicense usr/share/doc/forticlient/copyright
	vlicense opt/forticlient/gui/FortiClient-linux-x64/LICENSE
	vlicense opt/forticlient/gui/FortiClient-linux-x64/LICENSES.chromium.html
}
