# Template file for 'rocksndiamonds'
pkgname=rocksndiamonds
version=4.4.1.1
revision=1
build_style=gnu-makefile
hostmakedepends="pkg-config"
makedepends="SDL2_image-devel SDL2_mixer-devel SDL2_net-devel"
short_desc="Arcade style game"
maintainer="Clyhtsuriva <void-packages@adjutor.xyz>"
license="GPL-2.0-only"
homepage="http://www.artsoft.org/rocksndiamonds"
changelog="https://www.artsoft.org/rocksndiamonds/news"
distfiles="https://www.artsoft.org/RELEASES/linux/${pkgname}/${pkgname}-${version}-linux.tar.gz"
checksum=40d506f8da02bc168e19dc81ec3ea775b746631f4c8ce8912f83e15c3eab4ce4
replaces="rocksndiamonds-data>=0"
disable_parallel_build=yes

do_build() {
	vsed -i Makefile -e "s;^\(MAKE_CMD = \$(MAKE)\);& ${makejobs};"
	CFLAGS+=" -DTARGET_SDL2"
	CFLAGS+=" -DBASE_PATH='\"/usr/share/${pkgname}\"'"
	CFLAGS+=" $(sdl2-config --cflags)"
	LDFLAGS+=" $(sdl2-config --libs) -lSDL2_image -lSDL2_mixer -lSDL2_net -lm -lz"
	make CC="${CC}" CFLAGS="${CFLAGS}" LDFLAGS="${LDFLAGS}"
}

do_install() {
	vmkdir usr/share/${pkgname}
	cp -aR graphics levels music sounds ${DESTDIR}/usr/share/${pkgname}
	vbin rocksndiamonds
	vinstall ${FILESDIR}/${pkgname}.desktop 644 usr/share/applications
	vinstall ${FILESDIR}/${pkgname}.png 644 usr/share/pixmaps
}
