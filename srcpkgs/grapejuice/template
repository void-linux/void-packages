# Template file for 'grapejuice'
pkgname=grapejuice
version=5.1.1
revision=1
wrksrc=${pkgname}-v${version}
build_style=python3-module
hostmakedepends="python3-setuptools python3-devel python3-pip python3-wheel
 gobject-introspection pkg-config cairo-devel gettext"
depends="python3-setuptools python3-psutil python3-pip python3-gobject python3-packaging
 python3-wheel python3-click python3-requests python3-Unidecode
 gtk-update-icon-cache xdg-utils shared-mime-info gtk+3"
short_desc="Wine wrapper for Roblox"
maintainer="wael <40663@protonmail.com>"
license="GPL-3.0-only"
homepage="https://brinkervii.gitlab.io/grapejuice/"
distfiles="https://gitlab.com/brinkervii/${pkgname}/-/archive/v${version}/${pkgname}-v${version}.tar.gz"
checksum=70e4a0d279e134718124761f5f1d00b89d5275d67c69ed811beea21fc6bd212b

pre_patch() {
	vsed -i src/grapejuice_common/assets/desktop/roblox-app.desktop \
		-e 's|$PLAYER_ICON|grapejuice-roblox-player|g' -e 's|$GRAPEJUICE_EXECUTABLE|/usr/bin/grapejuice|g'
	vsed -i src/grapejuice_common/assets/desktop/roblox-player.desktop \
		-e 's|$PLAYER_ICON|grapejuice-roblox-player|g' -e 's|$GRAPEJUICE_EXECUTABLE|/usr/bin/grapejuice|g'
	vsed -i src/grapejuice_common/assets/desktop/roblox-studio.desktop \
		-e 's|$STUDIO_ICON|grapejuice-roblox-studio|g' -e 's|$GRAPEJUICE_EXECUTABLE|/usr/bin/grapejuice|g'
}

post_install() {
	vmkdir usr/share/applications
	vmkdir usr/share/icons/hicolor
	vmkdir usr/share/mime/packages/

	vcopy src/grapejuice_common/assets/desktop/* usr/share/applications
	vcopy src/grapejuice_common/assets/icons/hicolor/* usr/share/icons/hicolor
	vcopy src/grapejuice_common/assets/mime_xml/x-grapejuice-roblox.xml usr/share/mime/packages

	for lang in src/grapejuice_common/assets/po/*.po; do out=${lang##*/}; out=${out%.po}
		vmkdir usr/share/locale/${out}/LC_MESSAGES
		msgfmt $lang -o "${DESTDIR}"/usr/share/locale/${out}/LC_MESSAGES/${pkgname}.mo
	done
}
