# Template file for 'grapejuice'
pkgname=grapejuice
version=4.8.2
revision=1
_commit=13b50a946844715f6806f762aaa3aea536c07007
wrksrc=${pkgname}-${_commit}
build_style=python3-module
hostmakedepends="python3-setuptools python3-pip python3-wheel
 pkg-config cairo-devel gobject-introspection"

depends="gtk+3 python3-pip python3-cairo python3-gobject desktop-file-utils xdg-utils cairo-devel
 xdg-user-dirs gtk-update-icon-cache shared-mime-info pkg-config
 gobject-introspection libgcc-32bit freetype-32bit gnutls-32bit"

short_desc="Wine+Roblox management tool"
maintainer="wael <40663@protonmail.com>"
license="GPL-3.0-only"
homepage="https://brinkervii.gitlab.io/grapejuice/"
distfiles="https://gitlab.com/brinkervii/${pkgname}/-/archive/${_commit}/${pkgname}-${_commit}.tar.gz"
checksum=d0ef19d227ccc01af07044e06ab2f2ec32d9186d2cfcf1f3c819723baeec1827

pre_patch() {
	vsed -i src/grapejuice_common/assets/desktop/roblox-app.desktop \
		-e 's|$PLAYER_ICON|grapejuice-roblox-player|g' -e 's|$GRAPEJUICE_EXECUTABLE|/usr/bin/grapejuice|g'
	vsed -i src/grapejuice_common/assets/desktop/roblox-player.desktop \
		-e 's|$PLAYER_ICON|grapejuice-roblox-player|g' -e 's|$GRAPEJUICE_EXECUTABLE|/usr/bin/grapejuice|g'
	vsed -i src/grapejuice_common/assets/desktop/roblox-studio.desktop \
		-e 's|$STUDIO_ICON|grapejuice-roblox-studio|g' -e 's|$GRAPEJUICE_EXECUTABLE|/usr/bin/grapejuice|g'
}

post_install() {
	vmkdir usr/share/applications
	vmkdir usr/share/icons/hicolor
	vmkdir usr/share/mime/packages/
	vcopy src/grapejuice_common/assets/desktop/* usr/share/applications
	vcopy src/grapejuice_common/assets/icons/hicolor/* usr/share/icons/hicolor
	vcopy src/grapejuice_common/assets/mime_xml/x-grapejuice-roblox.xml usr/share/mime/packages
}
