# Template file for 'Criterion'
pkgname=Criterion
_debugbreakcommit=83bf7e933311b88613cbaadeced9c2e2c811054a
_klibcommit=cdb7e9236dc47abf8da7ebd702cc6f7f21f0c502
_nanopbver=0.4.9.1
_BoxFortcommit=c91d7181734ab2fd6d1299e8aa927297f0ddb754
version=2.4.2
revision=1
build_style=meson
configure_args="-Dsamples=false"
hostmakedepends="pkg-config cmake"
makedepends="libffi-devel libgit2-devel nanomsg-devel gettext-devel"
short_desc="Cross-platform C and C++ unit testing framework for the 21st century"
maintainer="Mihail Ivanchev <contact@ivanchev.net>"
license="MIT"
homepage="https://github.com/Snaipe/Criterion"
distfiles="https://github.com/Snaipe/Criterion/archive/refs/tags/v${version}.tar.gz
	https://github.com/MrAnno/debugbreak/archive/${_debugbreakcommit}.tar.gz>debugbreak.tar.gz
	https://github.com/attractivechaos/klib/archive/${_klibcommit}.tar.gz>klib.tar.gz
	https://github.com/nanopb/nanopb/archive/refs/tags/${_nanopbver}.tar.gz>nanopb.tar.gz
	https://github.com/Snaipe/BoxFort/archive/${_BoxFortcommit}.tar.gz>BoxFort.tar.gz"
checksum="83e1a39c8c519fbef0d64057dc61c8100b3a5741595788c9f094bba2eeeef0df
 9de3bb0d23f43a6f019f186261a21f3f709c5717c61539ab655b7051ae58ee51
 1291ba5df7badf7f68188b4a622a7e694de61f8a01adbed9099da01df81f9c9a
 4575944a468718ef25f05eb01d994364650b581563089a9841986bb1e460eac3
 e48cdc4973a20d5efd68c6a00b42df4d664953bb8778ca5d9b7e9e2b1a3cd527"
skip_extraction="debugbreak klib nanopb BoxFort"
build_wrksrc=${pkgname}-${version}
patch_args="-Np1 --directory=${build_wrksrc}"

CFLAGS+=" -D_LARGEFILE64_SOURCE"

post_extract() {
	subprojs=${build_wrksrc}/subprojects
	vsrcextract -C ${subprojs}/debugbreak debugbreak.tar.gz
	cp -R ${subprojs}/packagefiles/debugbreak ${subprojs}/
	vsrcextract -C ${subprojs}/klib klib.tar.gz
	cp -R ${subprojs}/packagefiles/klib ${subprojs}/
	vsrcextract -C ${subprojs}/nanopb nanopb.tar.gz
	vsrcextract -C ${subprojs}/boxfort BoxFort.tar.gz
}

post_install() {
	vlicense LICENSE
}

Criterion-devel_package() {
	depends="Criterion>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/pkgconfig
		vmove "usr/lib/*.so"
		vmove "usr/lib/*.a"
		vmove usr/share
	}
}
