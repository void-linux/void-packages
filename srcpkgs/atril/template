# Template file for 'atril'
pkgname=atril
version=1.28.2
revision=1
_msub=4074560e3642a53ace07b31baaf3f04c060dcd0b
build_style=meson
build_helper="gir"
configure_args="-Dcomics=true -Ddjvu=true -Ddvi=true -Dt1lib=true
 -Depub=true -Dpdf=true -Dpixbuf=true -Dps=true -Dtiff=true -Dxps=true
 -Dgtk_unix_print=true -Dkeyring=true -Dpreviewer=true
 -Dmathjax-directory=/usr/share/mathjax $(vopt_bool gir introspection)"
hostmakedepends="glib-devel gettext itstool pkg-config libxml2
 perl-XML-Parser yelp-tools $(vopt_if gir 'gobject-introspection')"
makedepends="djvulibre-devel libSM-devel libcaja-devel libgxps-devel
 libnotify-devel libsecret-devel libspectre-devel texlive-devel cairo-devel
 libglib-devel gtk+3-devel libxml2-devel zlib-devel tiff-devel libarchive-devel
 mate-desktop-devel mate-icon-theme poppler-glib-devel libwebkit2gtk41-devel"
depends="dbus mate-desktop mate-icon-theme mathjax2"
short_desc="Simply a document viewer for MATE"
maintainer="skmpz <dem.procopiou@gmail.com>"
license="GPL-2.0-or-later"
homepage="https://mate-desktop.org"
changelog="https://raw.githubusercontent.com/mate-desktop/atril/master/NEWS"
distfiles="https://pub.mate-desktop.org/releases/${version%.*}/atril-${version}.tar.xz"
distfiles="https://github.com/mate-desktop/atril/releases/download/v${version}/atril-${version}.tar.xz"
distfiles="https://github.com/mate-desktop/atril/archive/refs/tags/v${version}.tar.gz
 https://github.com/mate-desktop/mate-submodules/archive/${_msub}.tar.gz"
checksum="48c0d7ac45781a9c3384b00ed22ab6eca49c6ee6d772c3d0724be3954a0d8efc
 1d811385c2bad7b057c0d14d79f6c7bc880100957ad85f189e91a55b462d8345"
make_check=no # dogtail

build_options="gir"
build_options_default="gir"

skip_extraction="${_msub}.tar.gz"
CFLAGS=-DSTDC_HEADERS=1

post_extract() {
	rm -rf subprojects/mate-submodules subprojects/mate-submodules.wrap
	mkdir -p subprojects/mate-submodules
	vsrcextract -C subprojects/mate-submodules ${_msub}.tar.gz
}

libatril_package() {
	short_desc+=" - runtime library"
	pkg_install() {
		vmove "usr/lib/*.so.*"
	}
}

libatril-devel_package() {
	short_desc+=" - development files"
	depends="libatril>=${version}_${revision}"
	pkg_install() {
		vmove usr/include
		vmove "usr/lib/*.so"
		vmove usr/lib/pkgconfig
	}
}

atril-dvi_package() {
	short_desc+=" - DVI format support"
	pkg_install() {
		vmove usr/lib/atril/3/backends/dvidocument.atril-backend
		vmove usr/lib/atril/3/backends/libdvidocument.so
	}
}
