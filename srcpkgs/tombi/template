# Template file for 'tombi'
pkgname=tombi
version=0.7.14
revision=1
build_style=cargo
build_wrksrc="rust/tombi-cli"
build_helper="qemu"
short_desc="TOML Formatter, Linter and Language Server"
maintainer="Bnyro <bnyro@tutanota.com>"
license="MIT"
homepage="https://tombi-toml.github.io/tombi/"
changelog="https://github.com/tombi-toml/tombi/releases"
distfiles="https://github.com/tombi-toml/tombi/archive/refs/tags/v${version}.tar.gz"
checksum=7a919d149d7cdf3e38f5e96b95e9c0e250bb98720a5066972114586a0338362d

export __TOMBI_VERSION=${version}

post_patch() {
	# build.rs only tries to set the version to the commit hash
	# we set it directly via __TOMBI_VERSION instead
	rm build.rs
}

post_install() {
	vlicense ../../LICENSE

	for _shell in bash fish zsh; do
		vtargetrun ${DESTDIR}/usr/bin/tombi completion ${_shell} > tombi.${_shell}
		vcompletion tombi.${_shell} ${_shell}
	done
}
