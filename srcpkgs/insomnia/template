# Template file for 'insomnia'
pkgname=insomnia
version=2020.5.2
revision=1
archs="x86_64"
wrksrc="insomnia-core-${version}"
hostmakedepends="git nodejs-lts curl tar"
makedepends="python3 libcurl-devel make fontconfig-devel"
depends="ffmpeg"
short_desc="Desktop API client for REST and GraphQL"
maintainer="Kenneth Dodrill <kmdodrill@protonmail.com>"
license="MIT"
homepage="https://insomnia.rest"
distfiles="https://github.com/Kong/insomnia/archive/core@${version}.tar.gz"
checksum=90cf54bb75af7863bcd8ebb3e0dc693476d9dc9f2af2a8e3327feb552d1796b1
nostrip_files="insomnia"

pre_build() {
	npm run bootstrap
	npm run test
}

do_build() {
	GIT_TAG="core@${version}" npm run app-package
}

do_install() {
	vmkdir usr/lib/insomnia
	vcopy packages/insomnia-app/dist/com.insomnia.app/linux-unpacked/* usr/lib/insomnia

	vmkdir usr/bin
	ln -s /usr/lib/insomnia/insomnia ${DESTDIR}/usr/bin/

	vinstall "${FILESDIR}/insomnia.desktop" 644 usr/share/applications

	for size in 16 32 48 128; do
		vinstall packages/insomnia-app/dist/com.insomnia.app/.icon-set/icon_${size}x${size}.png 644 usr/share/icons/hicolor/${size}x${size}/apps/ insomnia.png
	done

	for size in 256 512; do
		vinstall packages/insomnia-app/dist/com.insomnia.app/.icon-set/icon_${size}.png 644 usr/share/icons/hicolor/${size}x${size}/apps/ insomnia.png
	done

	vlicense LICENSE
}
