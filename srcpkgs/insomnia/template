# Template file for 'insomnia'
pkgname=insomnia
version=2021.7.2
revision=1
archs="x86_64"
wrksrc="insomnia-core-${version}"
hostmakedepends="git nodejs-lts curl tar"
makedepends="python3 libcurl-devel make fontconfig-devel"
depends="ffmpeg electron9"
short_desc="Desktop API client for REST and GraphQL"
maintainer="Lauren Liberda <lauren@selfisekai.rocks>"
license="MIT"
homepage="https://insomnia.rest"
distfiles="https://github.com/Kong/insomnia/archive/core@${version}.tar.gz"
checksum=ba4bce09c908678565a79f5439b4ae9662b7d8c41897567311c940e747bab233
nostrip_files="insomnia"

pre_build() {
	npm run bootstrap
	npm run test
}

do_build() {
	GIT_TAG="core@${version}" npm run app-package
}

do_install() {
	vmkdir usr/lib/insomnia
	vcopy packages/insomnia-app/dist/linux-unpacked/* usr/lib/insomnia

	vmkdir usr/bin
	ln -s /usr/lib/insomnia/insomnia ${DESTDIR}/usr/bin/

	vinstall "${FILESDIR}/insomnia.desktop" 644 usr/share/applications

	for size in 16 32 48 128; do
		vinstall packages/insomnia-app/dist/.icon-set/icon_${size}x${size}.png 644 usr/share/icons/hicolor/${size}x${size}/apps/ insomnia.png
	done

	for size in 256 512; do
		vinstall packages/insomnia-app/dist/.icon-set/icon_${size}.png 644 usr/share/icons/hicolor/${size}x${size}/apps/ insomnia.png
	done

	vlicense LICENSE
}
