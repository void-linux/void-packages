# Template file for 'python3-adblock'
pkgname=python3-adblock
version=0.4.1
revision=1
wrksrc=python-adblock-${version}
build_style=cargo
hostmakedepends="python3-setuptools python3-dephell python3-pip maturin pkg-config"
makedepends="libressl-devel"
depends="python3"
short_desc="Python wrapper for Brave's Rust adblocking library"
maintainer="FollieHiyuki <folliekazetani@protonmail.com>"
license="Apache-2.0, MIT"
homepage="https://github.com/ArniDagur/python-adblock"
distfiles="https://github.com/ArniDagur/python-adblock/archive/${version}.tar.gz"
checksum=3a4250421890dc330ea6bfc05469a761f76f471dc690e69884acc33121685dd0

pre_build() {
	if [ "$XBPS_TARGET_LIBC" = musl ]
	then
		RUSTFLAGS="-C target-feature=-crt-static" maturin build --release --strip --manylinux off --target ${RUST_TARGET}
	else
		maturin build --release --strip --target ${RUST_TARGET}
	fi
}

do_check() {
	:
}

do_install() {
	vinstall target/${RUST_TARGET}/release/libadblock.so 755 /usr/lib/ libadblock.so
	PIP_CONFIG_FILE='/dev/null' pip install --isolated \
		--root=${DESTDIR} \
		--ignore-installed \
		--no-deps target/wheels/*.whl
}

post_install() {
	vlicense LICENSE-MIT
}
