#!/bin/sh
exec 2>&1
[ -r conf ] && . ./conf

# automigrate
chown root:_dhcpcd /etc/dhcpcd.conf
chmod 640 /etc/dhcpcd.conf

! [ -d /run/dhcpcd ] && install -m 700 -g _dhcpcd -o _dhcpcd -d /run/dhcpcd
chown -R _dhcpcd:_dhcpcd /run/dhcpcd

exec setpriv --reuid _dhcpcd --regid _dhcpcd --clear-groups \
  --ambient-caps -all,+net_admin,+net_raw,+net_bind_service \
  --inh-caps -all,+net_admin,+net_raw,+net_bind_service \
  --bounding-set -all,+net_admin,+net_raw,+net_bind_service \
  --no-new-privs -- dhcpcd -B ${OPTS:=-M}
