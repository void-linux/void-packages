# Template file for 'openttd'
pkgname=openttd
version=13.0
revision=1
_gfxver=7.1
_sfxver=1.0.3
create_wrksrc=yes
build_wrksrc=openttd-$version
build_style=cmake
hostmakedepends="pkg-config unzip tar"
makedepends="SDL-devel icu-devel fontconfig-devel libpng-devel lzo-devel liblzma-devel
 libxdg-basedir-devel"
depends="hicolor-icon-theme"
short_desc="Open Source version of Transport Tycoon Deluxe"
maintainer="Orphaned <orphan@voidlinux.org>"
license="GPL-2.0-only, Zlib"
homepage="https://www.openttd.org/"
distfiles="https://proxy.binaries.openttd.org/openttd-releases/${version}/openttd-${version}-source.tar.xz
 https://cdn.openttd.org/opengfx-releases/${_gfxver}/opengfx-${_gfxver}-all.zip
 https://cdn.openttd.org/opensfx-releases/${_sfxver}/opensfx-${_sfxver}-all.zip"
checksum="339df8e0e0827087c83afe78f8efc6a73b0a3d8a950a0b53137ce6e8aad7ab67
 928fcf34efd0719a3560cbab6821d71ce686b6315e8825360fba87a7a94d7846
 e0a218b7dd9438e701503b0f84c25a97c1c11b7c2f025323fb19d6db16ef3759"
configure_args="
 -DCMAKE_INSTALL_DATADIR=/usr/share
 -DCMAKE_INSTALL_BINDIR=/usr/bin
"

CXXFLAGS=' -DU_USING_ICU_NAMESPACE=1'

post_extract() {
	cd $wrksrc
	bsdtar xf opengfx-${_gfxver}.tar
	rm opengfx-${_gfxver}.tar
	bsdtar xf opensfx-${_sfxver}.tar
	rm opensfx-${_sfxver}.tar
}

post_install() {
	vmkdir usr/share/openttd/data
	vcopy ../opengfx-${_gfxver}/*.grf usr/share/openttd/data
	vcopy ../opengfx-${_gfxver}/*.obg usr/share/openttd/data
	vcopy ../opensfx-${_sfxver}/opensfx.* usr/share/openttd/data
	vlicense ../opengfx-${_gfxver}/license.txt LICENSE-gfx
	vlicense ../opensfx-${_sfxver}/license.txt LICENSE-sfx
	vdoc ../opengfx-${_gfxver}/readme.txt README-gfx
	vdoc ../opensfx-${_sfxver}/readme.txt README-sfx
}
