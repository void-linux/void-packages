# Template file for 'openttd'
pkgname=openttd
version=12.0
revision=3
_gfxver=7.1
_sfxver=1.0.2
create_wrksrc=yes
build_wrksrc=openttd-$version
build_style=cmake
configure_args="-DCMAKE_INSTALL_PREFIX=/usr
 -DCMAKE_INSTALL_BINDIR=bin
 -DCMAKE_INSTALL_DATADIR=share
 -DCMAKE_INSTALL_DOCDIR=share/doc/openttd"

hostmakedepends="pkg-config unzip tar"
makedepends="SDL-devel icu-devel fontconfig-devel libpng-devel lzo-devel liblzma-devel
 libxdg-basedir-devel"
depends="hicolor-icon-theme"
short_desc="Open Source version of Transport Tycoon Deluxe"
maintainer="Emil Tomczyk <emil.tomczyk@skni.umcs.pl>"
license="GPL-2.0-only, Zlib"
homepage="https://www.openttd.org/"
distfiles="https://cdn.openttd.org/openttd-releases/${version}/openttd-${version}-source.tar.xz
 https://cdn.openttd.org/opengfx-releases/${_gfxver}/opengfx-${_gfxver}-all.zip
 https://cdn.openttd.org/opensfx-releases/${_sfxver}/opensfx-${_sfxver}-all.zip"
checksum="bba0fd3800df0370259e642d251f362c7c00b478a2e3531f6ba7f84c1c2b32dc
 928fcf34efd0719a3560cbab6821d71ce686b6315e8825360fba87a7a94d7846
 4814f5374eb8da0df888a4e38c3edbff3e6e3ddbb4ab13aae6933a0df3c0d333"


CXXFLAGS=' -DU_USING_ICU_NAMESPACE=1'

post_extract() {
    cd $wrksrc
    bsdtar xf opengfx-${_gfxver}.tar
    bsdtar xf opensfx-${_sfxver}.tar
    rm opengfx-${_gfxver}.tar
    rm opensfx-${_sfxver}.tar
    cp opengfx-${_gfxver}/*.grf openttd-${version}/media/baseset
    cp opengfx-${_gfxver}/*.obg openttd-${version}/media/baseset
    cp opensfx-${_sfxver}/opensfx.* openttd-${version}/media/baseset
}

post_install() {
    vlicense ../opengfx-${_gfxver}/license.txt LICENSE-gfx
    vlicense ../opensfx-${_sfxver}/license.txt LICENSE-sfx
    vdoc ../opengfx-${_gfxver}/readme.txt README-gfx
    vdoc ../opensfx-${_sfxver}/readme.txt README-sfx
}
