# Template file for 'wireshark'
pkgname=wireshark
version=2.6.1
revision=1
build_style=gnu-configure
configure_args="--with-ssl --with-pcap --with-libcap --with-zlib --with-lua
 --with-krb5 --with-gtk=3 --with-qt=5 --without-portaudio CC_FOR_BUILD=cc"
hostmakedepends="automake flex glib-devel libtool mit-krb5-devel pkg-config python-devel
 qt5-host-tools qt5-tools"
makedepends="c-ares-devel geoip-devel gnutls-devel gtk+3-devel libcap-devel
 libpcap-devel lua52-devel mit-krb5-devel qt5-devel sbc-devel"
depends="libcap-progs"
short_desc="A network protocol analyzer"
maintainer="Enno Boland <gottox@voidlinux.eu>"
homepage="https://www.wireshark.org"
license="GPL-2.0-or-later"
distfiles="https://www.wireshark.org/download/src/${pkgname}-${version}.tar.xz"
checksum=ab6e5bbc3464c956347b8671ce8397950ad5daff3bf9964c967d495f4ddbcd88
system_groups="wireshark"

CFLAGS="-I${XBPS_CROSS_BASE}/usr/include/lua5.2"
CXXFLAGS="-I${XBPS_CROSS_BASE}/usr/include/lua5.2"

pre_configure() {
	autoreconf -fi
	find -type f -name Makefile.in -exec sed -i "s/^LIBS = .*/\0 -ldl/" {} \;
}
post_install() {
	local _includeDir=usr/include/wireshark

	# Headers
	vmkdir $_includeDir
	vcopy config.h $_includeDir

	chmod 0750 $DESTDIR/usr/bin/dumpcap
}

libwireshark_package() {
	short_desc+=" - library"
	pkg_install() {
		vmove usr/lib/*.so.*
		vmove usr/lib/wireshark
	}
}
libwireshark-devel_package() {
	short_desc+=" - development files"
	depends="libwireshark>=${version}_${revision}"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/pkgconfig
		vmove usr/lib/*.so
	}
}
wireshark-gtk_package() {
	depends="${sourcepkg}>=${version}_${revision} hicolor-icon-theme desktop-file-utils"
	short_desc+=" - GTK+ frontend"
	pkg_install() {
		vmove usr/bin/wireshark-gtk
		vmove usr/share/icons
		vmove usr/share/applications/wireshark-gtk.desktop
	}
}
wireshark-qt_package() {
	depends="${sourcepkg}>=${version}_${revision} desktop-file-utils"
	short_desc+=" - Qt frontend"
	pkg_install() {
		vmove usr/bin/wireshark
		vmove usr/share/man/man1/wireshark.1
		vmove usr/share/applications/wireshark.desktop
	}
}
