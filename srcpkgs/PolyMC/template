# Template file for 'PolyMC'
pkgname=PolyMC
version=1.4.2
revision=3
build_style=cmake
configure_args="-DLauncher_BUILD_PLATFORM=Void -DLauncher_VERSION_BUILD=${revision}"
hostmakedepends="extra-cmake-modules openjdk8 pkg-config qt5-host-tools
 qt5-qmake scdoc"
makedepends="qt5-devel"
depends="virtual?java-runtime qt5-svg qt5-imageformats xrandr"
short_desc="Custom launcher for Minecraft"
maintainer="Philipp David <pd@3b.pm>"
license="GPL-3.0-only"
homepage="https://polymc.org/"
distfiles="https://github.com/PolyMC/PolyMC/releases/download/${version}/PolyMC-${version}.tar.gz"
checksum=a66f25e0389815d2419a5b3aa1b85a390f14bbf3997c55c7da1ce4507b5aa511

if [ -z "$XBPS_CHECK_PKGS" ]; then
	configure_args+=" -DBUILD_TESTING=0"
fi

case "$XBPS_TARGET_MACHINE" in
	armv*) broken="https://github.com/MultiMC/MultiMC5/issues/2895";;
esac

# XXX: remove these and update file when doing PrismLauncher migration
configure_args+=" -DLauncher_META_URL=https://meta.scrumplex.rocks/v1/
 -DLauncher_NEWS_RSS_URL=https://prismlauncher.org/feed/feed.xml
 -DLauncher_NEWS_OPEN_URL=https://prismlauncher.org/news
 -DLauncher_HELP_URL=https://prismlauncher.org/wiki/help-pages/%1
 -DLauncher_BUG_TRACKER_URL=https://github.com/PrismLauncher/PrismLauncher/issues
 -DLauncher_TRANSLATIONS_URL=https://hosted.weblate.org/projects/prismlauncher/launcher/
 -DLauncher_MATRIX_URL=https://matrix.to/#/#prismlauncher:matrix.org
 -DLauncher_DISCORD_URL=https://discord.gg/prismlauncher
 -DLauncher_SUBREDDIT_URL=https://www.reddit.com/r/PrismLauncher/
 -DLauncher_MSA_CLIENT_ID=c36a9fb6-4f2a-41ff-90bd-ae7cc92031eb
 -DLauncher_CURSEFORGE_API_KEY=\$2a\$10\$wuAJuNZuted3NORVmpgUC.m8sI.pv1tOPKZyBgLFGjxFp/br0lZCC
 -DLauncher_Git=https://github.com/PrismLauncher/PrismLauncher"

post_patch() {
	vsed -i buildconfig/BuildConfig.cpp.in \
		-e 's/+build\./_/'
	rm -rf .git
}

post_install() {
	vdoc ${FILESDIR}/README.voidlinux
}
