# Template file for 'qtractor'
pkgname=qtractor
version=1.5.11
revision=1
_clap_tag=1.2.7
_minibpm_commit=43de9911eee6ebad20454732223dc141b73a9e6f
_vst3sdk_tag=3.8.0_build_66
create_wrksrc=yes
build_wrksrc="qtractor"
build_style=cmake
hostmakedepends="pkg-config qt6-base qt6-tools"
makedepends="aubio-devel dssi-devel jack-devel ladspa-sdk liblo-devel
 libmad-devel libsamplerate-devel libsndfile-devel libvorbis-devel lilv-devel
 qt6-base-devel qt6-svg-devel rubberband-devel sratom-devel"
depends="desktop-file-utils dssi hicolor-icon-theme lv2"
short_desc="Audio/MIDI multi-track sequencer application written in C++/Qt"
maintainer="Matthias von Faber <mvf@gmx.eu>"
# qtractor is GPL-2.0-or-later. VST3SDK is MIT (since 3.8.0).
license="GPL-2.0-or-later, MIT"
homepage="https://qtractor.org"
changelog="https://raw.githubusercontent.com/rncbc/qtractor/master/ChangeLog"
distfiles="https://github.com/rncbc/qtractor/archive/refs/tags/v${version}.tar.gz
 https://github.com/free-audio/clap/archive/refs/tags/${_clap_tag}.tar.gz
 https://github.com/breakfastquay/minibpm/archive/${_minibpm_commit}.tar.gz
 https://github.com/steinbergmedia/vst3sdk/archive/refs/tags/v${_vst3sdk_tag}.tar.gz>vst3sdk-v${_vst3sdk_tag}.tar.gz
 https://github.com/steinbergmedia/vst3_base/archive/refs/tags/v${_vst3sdk_tag}.tar.gz>vst3_base-v${_vst3sdk_tag}.tar.gz
 https://github.com/steinbergmedia/vst3_pluginterfaces/archive/refs/tags/v${_vst3sdk_tag}.tar.gz>vst3_pluginterfaces-v${_vst3sdk_tag}.tar.gz
 https://github.com/steinbergmedia/vst3_public_sdk/archive/refs/tags/v${_vst3sdk_tag}.tar.gz>vst3_public_sdk-v${_vst3sdk_tag}.tar.gz"
checksum="05da967ea1be686331f7fcbcd2f8d91aa3c5fc312b56e81474b485fd87744761
 77fe893cbe6973afa85c736bc50f2a96888ba238b29b6aec8ecb60f81e2e899d
 ec25686e11932e7ad5a92b6bd21eaed50cf73aa5c2f7b2bfad285470e4493dcf
 d93c12077d848977d4d397c8ab6721c4b4966223a7707bfe6519aa419c396af4
 001ef3dccf89505ee624766c8140c6c845fbd214460e02ea16145db29f1e2ed6
 c922f0a35f2c093dfcb24ccd95282e70d00cc2de42fc0c8ac1577398ffe7b6d4
 83b64e6666a54a35a2292a73ef35048b6d0dadd5e50a22cb437ac4cfb69ba81f"

post_extract() {
	cd $wrksrc
	mv qtractor-* qtractor
	mv vst3sdk-$_vst3sdk_tag vst3sdk
	for src_dest in \
	 clap-$_clap_tag:$build_wrksrc/src/clap \
	 minibpm-$_minibpm_commit:$build_wrksrc/src/minibpm \
	 vst3_base-$_vst3sdk_tag:vst3sdk/base \
	 vst3_pluginterfaces-$_vst3sdk_tag:vst3sdk/pluginterfaces \
	 vst3_public_sdk-$_vst3sdk_tag:vst3sdk/public.sdk
	do
		_src=${src_dest%:*}
		_dst=${src_dest#*:}
		rmdir $_dst
		mv $wrksrc/$_src $_dst
	done
}

pre_configure() {
	configure_args+="-DCONFIG_VST3SDK=$wrksrc/vst3sdk"
}

post_install() {
	vlicense ../vst3sdk/base/LICENSE.txt VST3SDK-LICENSE.txt
}
