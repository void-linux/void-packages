# Template file for 'libkrun'
pkgname=libkrun
version=1.14.0
revision=1
build_style=gnu-makefile
build_helper=rust
make_build_args="BLK=1 GPU=1 NET=1 SND=1 BUILD_INIT=1"
hostmakedepends="patchelf cargo pkg-config llvm19-devel"
makedepends="libkrunfw cargo libepoxy-devel libdrm-devel virglrenderer-devel
 pipewire-devel libzstd-devel"
short_desc="Library providing Virtualization-based process isolation capabilities"
maintainer="Daniel Martinez <danielmartinez@cock.li>"
license="Apache-2.0"
homepage="https://github.com/containers/libkrun"
distfiles="https://github.com/containers/libkrun/archive/refs/tags/v${version}.tar.gz"
checksum=6e568ce7371f554653eff591506250741e1ffad0fb19abd26202b89d7eefcd17

export XBPS_CROSS_RUST_TARGET

libkrun-devel_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/pkgconfig
		vmove "usr/lib/*.so"
	}
}

libkrun-init_package() {
	short_desc+=" - init binary"
	pkg_install() {
		vbin init/init libkrun-init
	}
}
