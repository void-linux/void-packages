# Template file for 'lix'
pkgname=lix
version=0.10.30
revision=1
makedepends="ldc dub pkgconf allegro5-devel hicolor-icon-theme"
depends="libenet"
short_desc="Single/Multiplayer puzzle game, inspired by Lemmings"
maintainer="JLMSC <joanlucas314@gmail.com>"
license="CC0-1.0"
homepage="https://www.lixgame.com/"
changelog="https://raw.githubusercontent.com/SimonN/LixD/master/doc/history.txt"
distfiles="https://github.com/SimonN/LixD/archive/refs/tags/v${version}.tar.gz
 https://www.lixgame.com/dow/lix-music.zip"
checksum="5c0eb357e02f9a493b2cc67a0439cf3b7abfee563679bc2180078d90adf12c14
 23ef8c20c5bf1674096e8b20ed9011669a9ad66f1135c64198e00e93aeb1f657"

_GIT_NAME="LixD"

do_build() {
	cd "${_GIT_NAME}-${version}"
	dub build --cache=local -f -b releaseXDG --compiler=ldc2
}

post_build() {
	cd "${_GIT_NAME}-${version}"
	# Remove unecessary files.
	rm -r "doc/build"
}

do_install() {
	cd "${_GIT_NAME}-${version}"
	# Install app's desktop entry.
	vinstall "data/desktop/com.lixgame.Lix.desktop" \
		 644 \
		 "usr/share/applications/" \
		 "${pkgname}.desktop"
	# Install app's logo.
	vinstall "data/images/${pkgname}_logo.svg" \
		 644 \
		 "usr/share/icons/hicolor/scalable/" \
		 "${pkgname}.svg"
	# Install license.
	vlicense "doc/copying.txt"
	# Install man page.
	vman "doc/lix.6"
	# Install binary file.
	vbin "bin/${pkgname}"
	# Make missing doc dir and install documentary files.
	vmkdir "usr/share/doc/${pkgname}"
	vcopy "doc/." "usr/share/doc/${pkgname}"
	# Make missing dir and install game's content alongside music.
	vmkdir "usr/share/${pkgname}"
	for dir in data images levels "${wrksrc}/music"; do
		vcopy "${dir}" "usr/share/${pkgname}"
	done
}
