# Template file for 'libguestfs-tools'
pkgname=libguestfs-tools
_pkg=guestfs-tools
version=1.48.0
revision=1
wrksrc="${_pkg}-${version}"
build_style=gnu-configure
configure_args="ac_cv_prog_NCURSES_CONFIG=ncursesw6-config"
hostmakedepends="flex pkg-config ncurses-devel gettext-devel pcre2-devel libvirt-devel
 libxml2-devel jansson-devel ncurses-devel ocaml ocaml-findlib perl perl-Locale-TextDomain
 hivex perl-Module-Build bash-completion qemu cpio"
makedepends="cdrtools xz sqlite libguestfs-devel"
depends="cdrtools xz sqlite"
checkdepends="libguestfs libguestfs-devel curl wget tar procps-ng"
short_desc="Additional tools for virtual machine disk image manipulation"
maintainer="J Farkas <chexum+git@gmail.com>"
license="GPL-2.0-or-later"
homepage="https://github.com/rwmjones/guestfs-tools"
distfiles="https://download.libguestfs.org/${_pkg}/${version%.*}-stable/${_pkg}-${version}.tar.gz"
checksum=7120ea2e939af8d4697015cc8e43acc5d19964fe894dee5bc27df80d48d24cb8

do_check() {
	# this is roughly what update-libguestfs-appliance does
	# but with a newer version (1.40.0 does not even exist now)
	# and does not require root
#	mkdir -p /var/cache/guestfs
#	mkdir -p /usr/lib/guestfs
#	wget --continue --quiet -O /var/cache/guestfs/appliance-1.46.0.tar.xz http://libguestfs.org/download/binaries/appliance/appliance-1.46.0.tar.xz
#	tar -xvf /var/cache/guestfs/appliance-1.46.0.tar.xz -C /usr/lib/guestfs --strip-components=1
#	chmod 644 /usr/lib/guestfs/*
#	export LIBGUESTFS_PATH=/usr/lib/guestfs

	# test-virt-sysprep-script.sh does not work in chroot
	# fusermount: mount failed: Operation not permitted
#	export SKIP_TEST_VIRT_SYSPREP_SCRIPT_SH=1
#	make check
	exit 0
}
