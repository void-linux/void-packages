# Template file for 'network-ups-tools'
pkgname=network-ups-tools
version=2.7.4
revision=10
wrksrc="nut-${version}"
build_style=gnu-configure
configure_args="
 --sysconfdir=/etc/ups --without-doc --disable-static
 --datadir=/usr/share/ups --with-user=nut --with-group=nut --with-ssl
 --with-usb --with-dev --with-serial -with-avahi --with-udev-dir=/usr/lib/udev
 --with-libltdl --without-ipmi --without-freeipmi --without-systemdsystemunitdir
 --with-snmp --with-drvpath=/usr/libexec/nut $(vopt_with cgi) --with-statepath=/run/ups"
hostmakedepends="pkg-config"
makedepends="avahi-libs-devel libressl-devel libusb-compat-devel neon-devel
 net-snmp-devel $(vopt_if cgi gd-devel) libltdl-devel"
system_accounts="nut"
conf_files="
	/etc/ups/ups.conf
	/etc/ups/upsd.users
	/etc/ups/upsmon.conf
	/etc/ups/upsd.conf
	/etc/ups/upssched.conf
	/etc/ups/nut.conf"
short_desc="UPS control and monitoring features (NUT)"
maintainer="Orphaned <orphan@voidlinux.org>"
license="GPL-2"
homepage="http://www.networkupstools.org/"
distfiles="${homepage}source/${version%.*}/nut-${version}.tar.gz"
checksum=980e82918c52d364605c0703a5dcf01f74ad2ef06e3d365949e43b7d406d25a7

nopie=yes
build_options="cgi"
desc_option_cgi="Build and install the CGI programs"

post_install() {
	# Prepare configuration files
	for f in ups upsd upsmon upssched nut; do
		mv ${DESTDIR}/etc/ups/${f}.conf{.sample,}
	done
	mv ${DESTDIR}/etc/ups/upsd.users{.sample,}

	# runit services
	vsv upsd
	vsv upsmon
	vsv upsdrvctl
}

libnetwork-ups-tools_package() {
	short_desc+=" - runtime library"
	pkg_install() {
		vmove "usr/lib/*.so.*"
	}
}
network-ups-tools-devel_package() {
	short_desc+=" - development files"
	depends="lib${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove usr/lib/*.so
		vmove usr/lib/pkgconfig
		vmove usr/include
		vmove usr/share/man/man3
	}
}
