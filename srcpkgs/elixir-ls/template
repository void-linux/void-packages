# Template file for 'elixir-ls'
pkgname=elixir-ls
version=0.21.3
revision=1
hostmakedepends="elixir rebar3"
depends="elixir"
short_desc="Frontend-independent Language Server Protocol for Elixir"
maintainer="icp <pangolin@vivaldi.net>"
license="Apache-2.0"
homepage="https://elixir-lsp.github.io/elixir-ls/"
changelog="https://raw.githubusercontent.com/elixir-lsp/elixir-ls/master/CHANGELOG.md"
distfiles="https://github.com/elixir-lsp/elixir-ls/archive/refs/tags/v${version}.tar.gz"
checksum=81a97816533910de5b8a4a7d73f597b6429af29001e2f931f1bbb147e8ca6593

do_build() {
	export MIX_ENV=prod
	export MIX_HOME="${wrksrc}/mix-cache"
	export PATH="${PATH}:/usr/libexec/chroot-git"

	mix local.hex --force
	mix local.rebar --force rebar3 /usr/bin/rebar3

	mix deps.get
	mix compile
}

do_install() {
	export MIX_ENV=prod
	export PATH="${PATH}:/usr/libexec/chroot-git"

	mix local.hex --force

	vmkdir usr/lib/elixir-ls
	mix elixir_ls.release2 -o "${DESTDIR}/usr/lib/elixir-ls"

	vbin "${FILESDIR}/elixir-ls"
	vbin "${FILESDIR}/elixir-ls-dbg"
}
