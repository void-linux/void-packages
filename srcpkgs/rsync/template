# Template file for 'rsync'
pkgname=rsync
version=3.2.2
revision=1
build_style=gnu-configure
conf_files="/etc/rsyncd.conf"
hostmakedepends="automake perl python3-commonmark"
makedepends="zlib-devel acl-devel popt-devel libressl-devel liblz4-devel
 libzstd-devel xxHash-devel"
short_desc="Remote fast incremental file transfer tool"
maintainer="Lugubris <lugubris@disroot.org>"
license="GPL-3.0-only"
homepage="http://samba.anu.edu.au/rsync/"
distfiles="https://github.com/WayneD/rsync/archive/v${version}.tar.gz"
checksum=fb9362227e8031a7194ba2c9a98043e33ad26adebc2a8493a920e2bc28fabde0

if [ "$XBPS_TARGET_LIBC" = "musl" ]; then
	configure_args+=" --disable-simd"
fi

pre_configure() {
	rm configure
	autoreconf -vfi
}

pre_build() {
	make reconfigure
}

pre_check() {
	# chgrp tests fail inside chroot
	rm -f testsuite/chgrp.test
}

post_install() {
	vconf ${FILESDIR}/rsyncd.conf
	vsv rsyncd
}
