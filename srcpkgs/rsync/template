# Template file for 'rsync'
pkgname=rsync
version=3.2.1
revision=1
build_style=gnu-configure
conf_files="/etc/rsyncd.conf"
hostmakedepends="perl"
makedepends="zlib-devel acl-devel popt-devel libressl-devel
 xxHash-devel libzstd-devel liblz4-devel"
short_desc="Remote fast incremental file transfer tool"
maintainer="Lugubris <lugubris@disroot.org>"
license="GPL-3.0-only"
homepage="http://samba.anu.edu.au/rsync/"
distfiles="http://www.samba.org/ftp/rsync/src/rsync-$version.tar.gz"
checksum=95f2dd62979b500a99b34c1a6453a0787ada0330e4bec7fcffad37b9062d58d3

# SIMD acceleration requires GNU IFUNC, not available on musl
if [ "$XBPS_TARGET_LIBC" = "musl" ]; then
	configure_args="--disable-simd"
fi

pre_check() {
	# chgrp tests fail inside chroot
	rm -f testsuite/chgrp.test
}

post_install() {
	vconf ${FILESDIR}/rsyncd.conf
	vsv rsyncd
}
