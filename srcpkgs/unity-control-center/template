# Template file for 'unity-control-center'
pkgname=unity-control-center
version=15.04.0+23.04.20230220
revision=1
build_style=gnu-configure
configure_args="--prefix=/usr --sysconfdir=/etc --localstatedir=/var \
 --libexecdir=/usr/lib/${pkgname} --disable-static --enable-fcitx \
 --disable-onlineaccounts"
hostmakedepends="automake docbook-xsl gettext-devel intltool libtool
 ModemManager-devel pkg-config ttf-ubuntu-font-family vala wget"
makedepends="accountsservice-devel cups-pk-helper fcitx-devel
 gnome-desktop-devel gnome-menus-devel gtk+3-devel ibus-devel libcanberra-devel
 libgeonames-devel libgtop-devel libnma-devel libnotify-devel
 libpwquality-devel libtimezonemap-devel libwacom-devel mit-krb5-devel
 NetworkManager-devel polkit-devel pulseaudio-devel unity-settings-daemon-devel
 upower-devel"
depends="clutter-gtk fcitx gnome-color-manager gnome-control-center grilo
 gsettings-desktop-schemas libgnomekbd network-manager-applet NetworkManager
 openrc-settingsd smbclient sound-theme-freedesktop system-config-printer
 webkit2gtk yaru"
short_desc="Control Center for Unity"
maintainer="Earldridge Jazzed Pineda <earldridgejazzedpineda@gmail.com>"
license="GPL-2.0-only"
homepage="https://launchpad.net/unity-control-center"
distfiles="https://launchpad.net/ubuntu/+archive/primary/+files/unity-control-center_${version}.orig.tar.gz"
checksum=b066a844d54f5c8dac9639a429f4e3d313f1828d265ec39e691c5dcea7d06c0e
make_check=ci-skip # po/POTFILES.in file doesn't have everything

pre_configure() {
	autoreconf -vfi
	intltoolize -f
}

post_configure() {
	sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0 /g' -e 's/    if test "$export_dynamic" = yes && test -n "$export_dynamic_flag_spec"; then/      func_append compile_command " -Wl,-O1,--as-needed"\n      func_append finalize_command " -Wl,-O1,--as-needed"\n\0/' libtool
}

post_install() {
	chmod 750 "${DESTDIR}/usr/share/polkit-1/rules.d/"

	rm -r "${DESTDIR}/usr/share/locale/"

	panels/info/logo-generator \
	--logo panels/info/UbuntuLogoBlank.png \
	--text "Unity for Void" \
	--output "${DESTDIR}/usr/share/unity-control-center/ui/UbuntuLogo.png"

	vinstall "${FILESDIR}/system-config-printer-unity.desktop" 644 \
	usr/share/applications
	vinstall "${FILESDIR}/unity-online-accounts-panel.desktop" 644 \
	usr/share/applications
	vinstall "${FILESDIR}/unity-region-panel.desktop" 644 \
	usr/share/applications
}

unity-control-center-devel_package() {
	short_desc+=" - development files"
	depends="${sourcepkg}>=${version}_${revision} gtk+3-devel
	 libglib-devel"
	pkg_install() {
		vmove usr/include
		vmove "usr/lib/*.so"
		vmove usr/lib/pkgconfig
		vmove usr/share/pkgconfig
	}
}
