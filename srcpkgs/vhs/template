# Template file for 'vhs'
pkgname=vhs
version=0.1.1
revision=1
build_style=go
build_helper=qemu
go_import_path="github.com/charmbracelet/vhs"
go_ldflags="-X main.Version=v${version}"
depends="ffmpeg ttyd"
short_desc="Your CLI home video recorder"
maintainer="Marcin Puc <tranzystorek.io@protonmail.com>"
license="MIT"
homepage="https://github.com/charmbracelet/vhs"
distfiles="https://github.com/charmbracelet/vhs/archive/refs/tags/v${version}.tar.gz"
checksum=d5d6dddd8f9fd2beb6d1ea232efaa1c9dbfa4e53011d2aebdbe830d952665776

# on platforms where chromium is not available, fall back to the go-rod auto downloader
if [ "${CROSS_BUILD}" ]; then
	case "${XBPS_TARGET_MACHINE}" in
		aarch64*) depends+=" chromium" ;;
		*) ;;
	esac
else
	depends+=" chromium"
fi

post_install() {
	vlicense LICENSE

	# install tape examples
	for dir in commands fixtures settings; do
		vmkdir usr/share/examples/vhs/${dir}
		vcopy "examples/${dir}/*.tape" usr/share/examples/vhs/${dir}
	done
	vcopy "examples/*.tape" usr/share/examples/vhs

	VHS="${DESTDIR}/usr/bin/vhs"
	for shell in bash fish zsh; do
		vtargetrun ${VHS} completion ${shell} > vhs.${shell}
		vcompletion vhs.${shell} ${shell}
	done

	vtargetrun ${VHS} manual > vhs.1
	vman vhs.1
}
