# Template file for 'yaml-language-server'
pkgname=yaml-language-server
version=1.15.0
revision=1
hostmakedepends="nodejs yarn"
depends="nodejs"
short_desc="Yaml Language Server"
maintainer="toomyem <toomyem@gmail.com>"
license="MIT"
homepage="https://github.com/redhat-developer/yaml-language-server"
distfiles="https://github.com/redhat-developer/yaml-language-server/archive/refs/tags/${version}.tar.gz"
checksum=80ff94d0461a98ad304b2306899157daa88e46045e7c747702cafa46645677d3

do_build() {
	npm install
	npm run build
	rm -r node_modules
	npm install --omit=dev --ignore-scripts
	chmod +x bin/yaml-language-server
}

do_install() {
	vlicense LICENSE

	vmkdir usr/bin
	vmkdir usr/lib/yaml-language-server
	vcopy bin/ usr/lib/yaml-language-server
	vcopy lib/ usr/lib/yaml-language-server
	vcopy node_modules/ usr/lib/yaml-language-server

	ln -sf /usr/lib/yaml-language-server/bin/yaml-language-server \
		${DESTDIR}/usr/bin/yaml-language-server
}
