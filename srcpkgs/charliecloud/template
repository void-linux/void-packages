# Template file for 'charliecloud'
pkgname=charliecloud
version=0.41
revision=1
build_style=gnu-configure
configure_args="--disable-bundled-lark --disable-html
 --with-gc --with-json --with-squashfuse"
hostmakedepends="automake python3-Sphinx python3-sphinx_rtd_theme pkg-config"
makedepends="cJSON-devel fuse-devel gc-devel python3 python3-lark
 squashfuse-devel"
depends="python3 python3-lark python3-requests"
checkdepends="wget"
short_desc="Lightweight, fully unprivileged container implementation"
maintainer="Leah Neukirchen <leah@vuxu.org>"
license="Apache-2.0"
homepage="https://charliecloud.io/"
distfiles="https://gitlab.com/charliecloud/charliecloud/-/archive/v${version}/charliecloud-v${version}.tar.gz"
checksum=b8a998d77ca86ff1d955a4f13cddc5391e281f083e95deabd8cc7b789764c16f
nocross="not supported"

CFLAGS="-D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64"

if [ "$XBPS_TARGET_LIBC" = "musl" ]; then
	makedepends+=" argp-standalone"
fi

pre_configure() {
	autoreconf -fi
}

post_install() {
	# don't remove examples, ch-test needs them

	rm -f ${DESTDIR}/usr/share/man/man7/ch-completion.bash.7
	vcompletion bin/ch-completion.bash bash
	vlicense NOTICE
}
