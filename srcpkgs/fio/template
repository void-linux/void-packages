# Template file for 'fio'
pkgname=fio
version=3.32
revision=1
build_style=configure
make_build_args="T_TEST_PROGS="
make_install_args="mandir=/usr/share/man"
makedepends="zlib-devel libaio-devel"
depends="python3"
short_desc="Flexible I/O tester"
maintainer="Leah Neukirchen <leah@vuxu.org>"
license="GPL-2.0-only"
homepage="https://github.com/axboe/fio"
distfiles="https://github.com/axboe/${pkgname}/archive/${pkgname}-${version}.tar.gz"
checksum=409e459840912e68be487dbbda9a7a1b3f6ddf1478e3f456f278f957ce4f7b66
python_version=3

case "$XBPS_TARGET_MACHINE" in
	i686*|x86_64*|ppc64*) makedepends+=" libnuma-devel"
esac

if [ "$XBPS_TARGET_NO_ATOMIC8" ]; then
	makedepends+=" libatomic-devel"
	export LIBS=-latomic
fi

do_configure() {
	./configure --prefix=/usr --extra-cflags="$CFLAGS" --disable-native
}

post_install() {
	vdoc HOWTO.rst
	for f in examples/*; do
		vsconf "$f"
	done
}
