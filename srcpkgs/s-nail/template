# Template file for 's-nail'
pkgname=s-nail
version=14.9.19
revision=1
makedepends="libressl-devel libidn2-devel ncurses-devel"
conf_files="/etc/s-nail.rc"
short_desc="Mail processing system with a command syntax reminiscent of ed"
maintainer="Orphaned <orphan@voidlinux.org>"
license="ISC, BSD-3-Clause, BSD-4-Clause"
homepage="https://git.sdaoden.eu/cgit/s-nail.git"
distfiles="https://www.sdaoden.eu/downloads/s-nail-${version}.tar.xz"
checksum=84f249a233a4592cf0c0bda9644c5b2d12e63a4807c0e292c13ef5068d3ca2bd

provides="mail-${version}_${revision}"

alternatives="
 mail:mail.rc:/etc/s-nail.rc
 mail:mail:/usr/bin/s-nail
 mail:mail.1:/usr/share/man/man1/s-nail.1
"

do_configure() {
	make CC=${CC} OPT_CROSS_BUILD=yes VAL_PREFIX=/usr VAL_SYSCONFDIR=/etc VAL_SID= VAL_MAILX=mail \
		VAL_MAIL=/var/spool/mail VAL_PAGER=less VAL_MTA=/usr/bin/sendmail OPT_IDNA=yes OPT_AUTOCC=no \
		VAL_RANDOM="tls,libgetrandom,sysgetrandom,urandom,builtin" OPT_FILTER_HTML_TAGSOUP=yes OPT_GSSAPI=no config
}

do_build() {
	make ${makejobs} build
}

do_check() {
	make ${makejobs} test
}

do_install() {
	make DESTDIR=${DESTDIR} install
	mv ${DESTDIR}/etc/{mail,$pkgname}.rc
	mv ${DESTDIR}/usr/bin/{mail,$pkgname}
	mv ${DESTDIR}/usr/share/man/man1/{mail,$pkgname}.1
	vlicense COPYING
}
