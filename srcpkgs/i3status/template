# Template file for 'i3status'
pkgname=i3status
version=2.13
revision=1
build_style=gnu-configure
hostmakedepends="asciidoc pkg-config autoconf automake xmlto"
makedepends="alsa-lib-devel confuse-devel libcap-devel libnl3-devel
 pulseaudio-devel yajl-devel"
depends="libcap-progs"
short_desc="Status bar generator for i3bar, dzen2, xmobar or similar programs"
maintainer="Juan RP <xtraeme@voidlinux.org>"
license="BSD-3-Clause"
homepage="https://www.i3wm.org/i3status/"
#changelog="https://raw.githubusercontent.com/i3/i3status/master/CHANGELOG"
distfiles="${homepage}/${pkgname}-${version}.tar.bz2"
checksum=ce89c9ff8565f62e88299f1a611229afdfc356b4e97368a5f8c4f06ad2fa1466
conf_files="/etc/i3status.conf"

case "$XBPS_TARGET_MACHINE" in
	*-musl) makedepends+=" libglob-devel";;
esac

do_configure() {
	autoreconf -fi
	mkdir -p build
	cd build
	../configure ${configure_args}
}

do_build() {
	case "$XBPS_TARGET_MACHINE" in
	*-musl)
		sed -i '/include/s,glob.h,libglob/glob.h,g' src/process_runs.c src/print_cpu_temperature.c i3status.c
		sed -i '/GLOB_TILDE/s/glob(/g_glob(/g' src/process_runs.c src/print_cpu_temperature.c i3status.c
		sed -i 's/globfree(/g_globfree(/g' src/process_runs.c src/print_cpu_temperature.c i3status.c
		export LIBS="$XBPS_CROSS_BASE/usr/lib/libglob.a"
		;;
	esac
	cd build
	make CC=$CC ${makejobs}
}

do_install() {
	cd build
	make PREFIX=/usr DESTDIR=${DESTDIR} install
	# detect dhcpcd.
	sed -i -e "s#dhclient#dhcpcd#g" ${DESTDIR}/etc/i3status.conf
	vlicense ${wrksrc}/LICENSE
}
