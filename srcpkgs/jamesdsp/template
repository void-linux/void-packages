# Template file for 'jamesdsp'
pkgname=jamesdsp
version=2.6.1
revision=1
_geqw_commit="739a016aa54ed8465133d3b70b687d67b326e1e1"
_ftw_commit="e98f51f46fe8322914d184d6d80264fe9a14496a"
_lew_commit="4cf30acf164026915e08ee0067ffe4753be3ace6"
_lide_commit="e2c7202d1f496e435e27443d320d5213d14112ab"
build_style=qmake
hostmakedepends="pkg-config qt5-qmake qt5-host-tools"
makedepends="libarchive-devel qt5-devel qt5-svg-devel glibmm-devel glib-devel pipewire-devel"
short_desc="Open-source sound effects for PipeWire and PulseAudio"
maintainer="Robert David <<robert.david@posteo.net>>"
license="GPL-3.0-or-later"
homepage="https://github.com/Audio4Linux/JDSP4Linux"
distfiles="https://github.com/Audio4Linux/JDSP4Linux/archive/refs/tags/${version}.tar.gz"
checksum="0e22e54fca8b9b34f3616c861b345747437e725a1e1f8c50babc626e35fb99c8"
# GraphicEQWidget submodule
distfiles+=" https://github.com/ThePBone/GraphicEQWidget/archive/${_geqw_commit}.tar.gz"
checksum+=" 6c218e8095a67d7eddd8c40fdae5d17e6f4f28765d1456e64a09d29c0512c7d0"
# FlatTabWidget submodule
distfiles+=" https://github.com/ThePBone/FlatTabWidget/archive/${_ftw_commit}.tar.gz"
checksum+=" 23ab4167986f76c09cb6f767115f3188f4e95ba8a6350dd6d5ce4a0d7151c55d"
# LiquidEqualizerWidget submodule
distfiles+=" https://github.com/ThePBone/LiquidEqualizerWidget/archive/${_lew_commit}.tar.gz"
checksum+=" 2edbc0b13bbc17caa4a6c37026a61d33ea176f04863998f9d340ab3a279b30dc"
# LiveprogIDE submodule
distfiles+=" https://github.com/ThePBone/LiveprogIDE/archive/${_lide_commit}.tar.gz"
checksum+=" 5a728a0157796998aee2012449687efece4cd484a400da845268bd8a819c06d4"

case "$XBPS_TARGET_MACHINE" in
	arm*|aarch64*|*-musl) configure_args="CONFIG+=NO_CRASH_HANDLER";;
esac

post_extract() {
	mv JDSP4Linux-${version}/* .

	# move submodules to proper location

	rmdir src/subprojects/EELEditor
	mv LiveprogIDE-${_lide_commit} src/subprojects/EELEditor

	rmdir src/subprojects/FlatTabWidget
	mv FlatTabWidget-${_ftw_commit} src/subprojects/FlatTabWidget

	rmdir src/subprojects/GraphicEQWidget
	mv GraphicEQWidget-${_geqw_commit} src/subprojects/GraphicEQWidget

	rmdir src/subprojects/LiquidEqualizerWidget
	mv LiquidEqualizerWidget-${_lew_commit} src/subprojects/LiquidEqualizerWidget
}

do_install() {
	vbin src/jamesdsp

	vinstall resources/icons/icon.png 644 usr/share/pixmaps jamesdsp.png
	vinstall ${FILESDIR}/jamesdsp.desktop 644 usr/share/applications
}
