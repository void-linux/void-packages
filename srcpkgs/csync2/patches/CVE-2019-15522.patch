From 416f1de878ef97e27e27508914f7ba8599a0be22 Mon Sep 17 00:00:00 2001
From: Malte Kraus <malte.kraus@suse.com>
Date: Tue, 13 Aug 2019 11:25:57 +0200
Subject: [PATCH] fail HELLO command when SSL is required

---
 daemon.c | 1 +
 1 file changed, 1 insertion(+)

diff --git daemon.c daemon.c
index 2d8407d..2a1a8af 100644
--- a/daemon.c
+++ b/daemon.c
@@ -747,6 +747,7 @@ void csync_daemon_session()
 						goto conn_without_ssl_ok;
 				}
 				cmd_error = conn_response(CR_ERR_SSL_EXPECTED);
+				peer = NULL;
 			}
 conn_without_ssl_ok:;
 #endif
