# Template file for 'mumble'
pkgname=mumble
version=1.4.230
revision=3
wrksrc=mumble-${version}.src
build_style=cmake
make_cmd=make
configure_args="-Doverlay-xcompile=OFF -Dbundled-opus=OFF
 -Dbundled-speex=OFF -Djackaudio=$(vopt_if jack ON OFF) -Dportaudio=$(vopt_if portaudio ON OFF)
 -Dupdate=OFF -Dbundle-qt-translations=OFF -Dwarnings-as-errors=OFF"
hostmakedepends="Ice pkg-config protobuf qt5-host-tools qt5-qmake python3 which"
makedepends="Ice-devel MesaLib-devel avahi-compat-libs-devel boost-devel
 libcap-devel openssl-devel libsndfile-devel protobuf-devel opus-devel
 pulseaudio-devel $(vopt_if jack jack-devel) qt5-devel qt5-svg-devel
 speech-dispatcher-devel speex-devel $(vopt_if portaudio portaudio-devel)
 qt5-plugin-mysql qt5-plugin-odbc qt5-plugin-pgsql qt5-plugin-sqlite
 qt5-plugin-tds poco-devel qt5-tools-devel"
depends="desktop-file-utils qt5-plugin-sqlite"
short_desc="Open source, low-latency, high quality voice chat"
maintainer="Helmut Pozimski <helmut@pozimski.eu>"
license="BSD-3-Clause"
homepage="https://mumble.info"
distfiles="https://github.com/mumble-voip/${pkgname}/releases/download/v${version}/${pkgname}-${version}.tar.gz"
checksum=b67d82b4e6cc5834b965c5bc25339e456534bbd5b9dda6c8c95cf9cb80e434b0

build_options="jack portaudio"
build_options_default="jack portaudio"

export CMAKE_GENERATOR="Unix Makefiles"

post_install() {
	vbin ${wrksrc}/scripts/murmur-user-wrapper
	vsconf scripts/murmur.ini
	vlicense LICENSE
}

murmur_package() {
	short_desc+=" - Server software (mumble-server)"
	pkg_install() {
		vmove usr/bin/mumble-server
		vmove usr/bin/murmur-user-wrapper
		vmove usr/share/man/man1/murmur-user-wrapper.1
		vmove usr/share/man/man1/murmurd.1
		vmove usr/share/examples/mumble/murmur.ini
	}
}
