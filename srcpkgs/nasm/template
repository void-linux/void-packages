# Template file for 'nasm'
pkgname=nasm
version=3.01
revision=1
build_style=gnu-configure
make_build_target="all"
make_check_target="golden test"
checkdepends="perl"
short_desc="80x86 assembler designed for portability and modularity"
maintainer="Rutpiv <roger_freitas@live.com>"
license="BSD-2-Clause"
homepage="https://www.nasm.us"
changelog="https://nasm.us/doc/nasmdocc.html"
distfiles="https://www.nasm.us/pub/nasm/releasebuilds/${version}/nasm-${version}.tar.xz"
checksum=b7324cbe86e767b65f26f467ed8b12ad80e124e3ccb89076855c98e43a9eddd4

build_options="doc"
desc_option_doc="Enable building documentation"
build_options_default="doc"

disable_parallel_check=yes

subpackages=" "

if [ "$build_option_doc" ]; then
	subpackages="nasm-doc"
	hostmakedepends="groff perl perl-Font-TTF perl-IO-String perl-Sort-Versions
		ghostscript fonts-roboto-ttf"
fi

post_build() {
	if [ "$build_option_doc" ]; then
		make doc
	fi
}

post_install() {
	if [ "$build_option_doc" ]; then
		make -C doc DESTDIR="${DESTDIR}" docdir=/usr/share/doc/nasm install
	fi
	vlicense LICENSE
}

nasm-doc_package() {
	short_desc+=" - documentation"
	depends="${sourcepkg}-${version}_${revision}"
	pkg_install() {
		vmove usr/share/doc/nasm
		vlicense LICENSE
	}
}
