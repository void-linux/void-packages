# Template file for 'onionshare-desktop'
pkgname=onionshare-desktop
#TO BE UPDATED TOGETHER WITH onionshare-cli
version=2.4
revision=1
wrksrc="onionshare-${version}"
build_style=python3-module
pycompile_dirs="/usr/share/nautilus-python/extensions"
hostmakedepends="python3-setuptools"
depends="python3-Flask-HTTPAuth python3-Flask-SocketIO python3-pycryptodome python3-PyQt5
 python3-pysocks python3-requests onionshare-cli python3-pyside2 python3-cepa python3-qrcode tor"
checkdepends="python3-pytest python3-pytest-qt iana-etc xvfb-run ${depends}"
short_desc="Share files anonymously and securely"
maintainer="DragonGhost7 <darkiridiumghost@gmail.com>"
license="GPL-3.0-or-later"
homepage="https://onionshare.org/"
changelog="https://raw.githubusercontent.com/micahflee/onionshare/develop/CHANGELOG.md"
distfiles="https://github.com/micahflee/onionshare/archive/v${version}.tar.gz"
checksum=9d82744ec930a280cf036e5e7dfab817a37866e927e5a72bdd3e13bd9b9c7b4a

build_wrksrc=desktop/src

do_check() {
	ln -s ../tests .
	xvfb-run tests/run.sh
	rm -r tests
}

post_install() {
	vmkdir usr/share/applications
	vinstall org.onionshare.OnionShare.desktop 644 usr/share/applications/

	vmkdir usr/share/icons/hicolor/scalable/apps
	vinstall org.onionshare.OnionShare.svg 644 usr/share/icons/hicolor/scalable/apps/
}
