# Template file for 'mediainfo'
pkgname=mediainfo
version=22.12
revision=2
configure_args="--with-wx-config=wx-config-gtk3"
hostmakedepends="automake libtool pkg-config"
makedepends="libmediainfo-devel zlib-devel wxWidgets-gtk3-devel"
depends="desktop-file-utils hicolor-icon-theme mediainfo-cli"
short_desc="Display technical and tag data for video and audio files"
maintainer="John <me@johnnynator.dev>"
license="BSD-2-Clause"
homepage="https://mediaarea.net/MediaInfo"
distfiles="https://mediaarea.net/download/source/${pkgname}/${version}/${pkgname}_${version}.tar.xz"
checksum=932b82739f738e7db603cf5bb170720731a9e7c61d145c2a54aabb3cd0b753bc
replaces="mediainfo-gui>=0"

CXXFLAGS="-D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64"

do_configure() {
	for d in CLI GUI; do
		cd $wrksrc/Project/GNU/$d
		autoreconf -fi
		./configure ${configure_args}
	done
}

do_build() {
	for d in CLI GUI; do
		cd $wrksrc/Project/GNU/$d
		make ${makejobs}
	done
}

do_install() {
	cd $wrksrc/Project/GNU/GUI
	make DESTDIR="${DESTDIR}" install

	vinstall ${wrksrc}/Source/Resource/Image/MediaInfo.svg 644 \
		usr/share/icons/hicolor/scalable/apps mediainfo.svg
	vinstall ${wrksrc}/Source/Resource/Image/MediaInfo.png 644 \
		usr/share/pixmaps mediainfo-gui.png
	vinstall ${wrksrc}/Project/GNU/GUI/mediainfo-gui.desktop 644 \
		usr/share/applications
}

mediainfo-cli_package() {
	short_desc+=" - CLI"
	pkg_install() {
		cd ${wrksrc}/Project/GNU/CLI
		make DESTDIR="${PKGDESTDIR}" install
		vlicense ${wrksrc}/License.html
	}
}
