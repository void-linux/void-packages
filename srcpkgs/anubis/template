# Template file for 'anubis'
pkgname=anubis
version=1.23.1
revision=1
build_style=go
go_import_path="github.com/TecharoHQ/anubis"
go_ldflags="-X ${go_import_path}.Version=${version}"
go_package=./cmd/anubis
make_check_args="-skip=TestPlaywrightBrowser"
hostmakedepends="nodejs esbuild zstd"
short_desc="Weighs the soul of requests using proof-of-work to stop crawlers"
maintainer="Luca Matei Pintilie <luca@lucamatei.com>"
license="MIT"
homepage="https://anubis.techaro.lol/"
changelog="https://github.com/TecharoHQ/anubis/releases"
distfiles="https://github.com/TecharoHQ/anubis/archive/refs/tags/v${version}.tar.gz"
checksum=55bf6d6ee6a1372604816b2bac08e7d6850f747a0c86bcdf9eca1be281feffab

system_accounts="_anubis"

pre_build() {
	npm install --ignore-scripts
	CGO_ENABLED=0 GOARCH= npm run assets
}

do_check() {
	go test -p "$XBPS_MAKEJOBS" ${make_check_args} ./...
}

post_install() {
	vsv anubis
	vlicense LICENSE
}
