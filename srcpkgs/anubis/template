# Template file for 'anubis'
pkgname=anubis
version=1.22.0
revision=1
build_style=go
go_import_path="github.com/TecharoHQ/anubis"
go_ldflags="-X ${go_import_path}.Version=${version}"
go_package=./cmd/anubis
make_check_args="-skip=TestPlaywrightBrowser"
hostmakedepends="nodejs esbuild zstd"
short_desc="Weighs the soul of requests using proof-of-work to stop crawlers"
maintainer="Luca Matei Pintilie <luca@lucamatei.com>"
license="MIT"
homepage="https://anubis.techaro.lol/"
changelog="https://github.com/TecharoHQ/anubis/releases"
distfiles="https://github.com/TecharoHQ/anubis/archive/refs/tags/v${version}.tar.gz"
checksum=81b45cf8d210927c6bdf81b4d925734b623e0c0c3f04f48c2034a85eea3bcd32

system_accounts="_anubis"

pre_build() {
	npm install --ignore-scripts
	CGO_ENABLED=0 GOARCH= npm run assets
}

do_check() {
	go test -p "$XBPS_MAKEJOBS" ${make_check_args} ./...
}

post_install() {
	vsv anubis
	vlicense LICENSE
}
