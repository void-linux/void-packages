# Template file for 'libteam'
pkgname=libteam
version=1.31.git20210222
revision=1
archs="~*-musl" # always-enabled tipc needs non-musl sys/queue.h
_githash=69a7494bb77dc10bb27076add07b380dbd778592
wrksrc=libteam-${_githash}
build_style=gnu-configure
configure_args="--with-user=_teamd --with-group=_teamd"
conf_files="/etc/teamd.conf"
hostmakedepends="automake pkg-config libtool"
makedepends="glib-devel libnl3-devel libdaemon-devel jansson-devel dbus-devel libcap-devel"
short_desc="Ethernet teaming/bonding/aggregation service"
maintainer="J Farkas <chexum+git@gmail.com>"
license="LGPL-2.1-or-later"
homepage="http://libteam.org/"
distfiles="https://github.com/jpirko/libteam/archive/${_githash}.tar.gz"
checksum=600005b5233d21914e0e93c8f548b95219ff37eda8e768b69c4e9be32347bf5b

system_groups="_teamd"
system_accounts="_teamd"
_teamd_descr="teamd runtime user"
_teamd_pgroup="_teamd"

pre_configure() {
	./autogen.sh
}

do_install() {
	make ${makejobs} DESTDIR=${DESTDIR} install
	vinstall teamd/dbus/teamd.conf 644 etc/dbus-1/system.d

	vmkdir usr/share/examples/${pkgname}
	for f in teamd/example_configs/*conf; do
		vsconf "${f}"
	done

	vconf ${FILESDIR}/teamd.conf

	vsv teamd
}
