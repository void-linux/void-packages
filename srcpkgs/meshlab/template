# Template file for 'meshlab'
pkgname=meshlab
version=2025.07
revision=1
build_style=cmake
hostmakedepends="pkg-config wget tar qt5-qmake qt5-host-tools"
makedepends="MesaLib-devel glew-devel glu-devel qt5-devel tbb-devel
eigen boost-devel libgltf-devel libxerces-c-devel muparser-devel"

# The following are disabled, because they're optional, and:
# - There's a problem with the automatically downloaded lib3mf, nexus & corto archives handling
# - Enabling CGAL makes the cmake configuration tries to run something which is not crossbuild-compatible
# - Disabling CGAL breaks embree filter compilation
# The latter two are the linux defaults anyways (see https://github.com/cnr-isti-vclab/meshlab/blob/main/scripts/Linux/0_setup_env.sh)
configure_args="-DMESHLAB_ALLOW_DOWNLOAD_SOURCE_NEXUS=OFF -DMESHLAB_ALLOW_DOWNLOAD_SOURCE_LIB3MF=OFF -DMESHLAB_ALLOW_SYSTEM_LIB3MF=OFF -DMESHLAB_ALLOW_DOWNLOAD_SOURCE_CGAL=OFF -DMESHLAB_ALLOW_SYSTEM_CGAL=OFF -DMESHLAB_ALLOW_DOWNLOAD_SOURCE_EMBREE=OFF -DMESHLAB_ALLOW_SYSTEM_EMBREE=OFF -DMESHLAB_ALLOW_DOWNLOAD_SOURCE_LIB3DS=OFF -DMESHLAB_ALLOW_SYSTEM_LIB3DS=OFF"

short_desc="3D mesh editor"
maintainer="Vincent Legoll <vincent.legoll@gmail.com>"
license="GPL-3.0-only"
homepage="https://www.meshlab.net/"
distfiles="https://github.com/cnr-isti-vclab/meshlab/archive/refs/tags/MeshLab-${version}.tar.gz"
checksum="c05dd022b42af69c3de5ae88d35a1445d879630a2496f440cd3e7edad40e71b9"

post_extract() {
	# This subdirectory is mandatory, and vcglib is not easily packaged
	# See https://github.com/cnr-isti-vclab/vcglib/issues/230
	# WARNING: for now this uses the same version number as meshlab...
	wget https://github.com/cnr-isti-vclab/vcglib/archive/refs/tags/${version}.tar.gz -O- | tar -C ./src/vcglib --strip-components=1 -zxf -
	# Change to https, as http fails
	#sed -i 's,http://storage.googleapis.com/,https://storage.googleapis.com/,' src/external/lib3ds.cmake
}
