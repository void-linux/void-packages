# Template file for 'xone'
pkgname=xone
version=0.5.2
revision=1
depends="curl bsdtar dkms"
short_desc="Modern Linux driver for Xbox One and Xbox Series X|S controllers"
maintainer="Orphaned <orphan@voidlinux.org>"
license="GPL-2.0-only"
homepage="https://github.com/dlundqvist/xone"
distfiles="https://github.com/dlundqvist/xone/archive/refs/tags/v${version}.tar.gz"
checksum="b7aec8f2ff475f9892a10b6dceb681785c9b548b77f85a71d55fbe05759dae63"

dkms_modules="${pkgname} ${version}"

do_install() {
	vinstall install/modprobe.conf 644 /usr/lib/modprobe.d xone.conf
	vbin install/firmware.sh xone-update-firmware
	vdoc "${FILESDIR}/README.voidlinux"
	find . -type f \( -name dkms.conf -o -name '*.c' \) -exec sed -i "s/#VERSION#/$version/" {} +
	vmkdir /usr/src/${pkgname}-${version}
	for file in auth bus driver transport Kbuild dkms.conf; do
		vcopy $file /usr/src/${pkgname}-${version}/
	done
}
