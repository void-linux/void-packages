# Template file for 'indicator-sound'
pkgname=indicator-sound
version=12.10.2+18.10.20180612
revision=1
_ubuntu_rel=0ubuntu7
build_style=cmake
configure_args="-DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_INSTALL_LIBEXECDIR=lib"
hostmakedepends="cmake-extras gobject-introspection intltool pkg-config vala
 wget"
makedepends="accountsservice-devel libgee-devel libnotify-devel
 pulseaudio-devel unity-api-devel"
depends="dconf gsettings-ubuntu-schemas libxml2 qt5 unity-api
 unity-control-center"
short_desc="Unified sound menu"
maintainer="Earldridge Jazzed Pineda <earldridgejazzedpineda@gmail.com>"
license="GPL-3.0-only"
homepage="https://launchpad.net/indicator-sound"
distfiles="https://launchpad.net/ubuntu/+archive/primary/+files/indicator-sound_${version}.orig.tar.gz"
checksum=d37f5db1a683be45a6f6e515603745183867edb984ca06905e121c7d3432dfc2

do_patch() {
	wget https://launchpad.net/ubuntu/+archive/primary/+files/indicator-sound_${version}-${_ubuntu_rel}.diff.gz
	gunzip indicator-sound_${version}-${_ubuntu_rel}.diff.gz
	patch -p1 -i indicator-sound_${version}-${_ubuntu_rel}.diff

	sed -i \
	-e "s/TEST REQUIRED/TEST QUIET/" \
	-e "/enable_testing()/d" \
	-e "/add_subdirectory(tests)/d" \
	-e '/url-dispatcher-1>=${URL_DISPATCHER_1_REQUIRED_VERSION}/d' \
	CMakeLists.txt
	sed -i \
	-e "/add_definitions(/a -DVALA_EXTERN=extern" \
	-e "/--pkg=url-dispatcher/d" \
	src/CMakeLists.txt
	rm vapi/url-dispatcher.vapi
}

post_install() {
	rm -v "${DESTDIR}"/usr/var/lib/polkit-1/localauthority/10-vendor.d/50-com.canonical.indicator.sound.AccountsService.pkla
	vsv indicator-sound
}
