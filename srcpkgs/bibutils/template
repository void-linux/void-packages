# Template file for 'bibutils'
pkgname=bibutils
version=7.2
revision=1
wrksrc="${pkgname}_${version}"
hostmakedepends="docbook-xsl libxslt"
short_desc="Bibliography format interconversion"
maintainer="classabbyamp <void@placeviolette.net>"
license="GPL-2.0-only"
homepage="https://sourceforge.net/projects/bibutils"
changelog="https://sourceforge.net/p/bibutils/home/history_version${version%%.*}/"
distfiles="${SOURCEFORGE_SITE}/bibutils/bibutils_${version}_src.tgz"
checksum=6e028aef1e8a6b3e5acef098584a7bb68708f35cfe74011b341c11fea5e4b5c3

post_patch() {
	# remove unnecessary backslashes in pc file
	vsed -e 's/\\//g' -i packageconfig_start
}

do_configure() {
	./configure --dynamic --install-dir ${DESTDIR}/usr/bin --install-lib ${DESTDIR}/usr/lib
}

do_build() {
	make CC="${CC}" DISTRO_CFLAGS="${CFLAGS}" LDFLAGSIN="${LDFLAGS}"
}

do_check() {
	make CC="${CC}" DISTRO_CFLAGS="${CFLAGS}" LDFLAGSIN="${LDFLAGS}" test
}

do_install() {
	make install
	vdoc ChangeLog
	xsltproc --output bibutils.1 --nonet /usr/share/xsl/docbook/manpages/docbook.xsl bibutils.dbk
	for page in $(find ${wrksrc} -name '*.1'); do
		vman $page
	done
}

bibutils-devel_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove "usr/lib/*.so"
		vinstall lib/bibutils.pc 644 usr/lib/pkgconfig
		vmkdir usr/include/${sourcepkg}
		vcopy "lib/*.h" usr/include/${sourcepkg}
	}
}
