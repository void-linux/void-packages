# Template file for 'gmic'
pkgname=gmic
version=2.3.3
revision=1
build_style=gnu-makefile
hostmakedepends="pkg-config gimp"
makedepends="MesaLib-devel fftw-devel gimp-devel gtk+-devel libcurl-devel
 libgomp-devel libjpeg-turbo-devel libopencv-devel libopenexr-devel
 libpng-devel qt5-devel tiff-devel"
short_desc="GREYC's Magic for Image Computing (image processing framework)"
maintainer="Jakub Skrzypnik <jot.skrzyp@gmail.com>"
license="CECILL-2.1"
homepage="https://gmic.eu/"
distfiles="https://gmic.eu/files/source/gmic_${version}.tar.gz"
checksum=46417d48d9dd87a155ba979667834a7d6899652f097cc25652e0680ee0b13c6a
## nocross="https://build.voidlinux.eu/builders/armv7l_builder/builds/8869/steps/shell_3/logs/stdio"

CXXFLAGS="-Wno-strict-overflow -Wno-deprecated -fkeep-inline-functions"

pre_build() {
	sed -i src/Makefile -e 's;\( *\)ar\( *\);\1$(AR)\2;'

	# Create a toplevel Makefile
	cat > Makefile <<EOF
CC	= $CC
CXX	= $CXX
LD	= $CXX
AR	= $AR
CFLAGS	= $CFLAGS
CXXFLAGS= $CXXFLAGS
LDFLAGS = $LDFLAGS

all:
	make -C src

install:
	make -C src DESTDIR="$DESTDIR" install
EOF
}

post_install() {
	vlicense COPYING
}

gmic-gimp_package() {
	short_desc+=" - GIMP plugin"
	depends="gimp ${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove usr/lib/gimp
	}
}
gmic-zart_package() {
	short_desc+=" - ZArt tool"
	depends="${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove usr/bin/zart
	}
}
gmic-devel_package() {
	short_desc+=" - development files"
	depends="${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/*.so
	}
}
