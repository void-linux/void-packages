# Template file for 'lapce'
pkgname=lapce
version=0.3.1
revision=1
archs="aarch64* x86_64*" # wasmer-vm crate fails to build (unsupported platform)
build_style=cargo
hostmakedepends="pkg-config python3"
makedepends="fontconfig-devel gtk+3-devel openssl-devel libxkbcommon-devel \
 vulkan-loader wayland-devel"
short_desc="Lightning-fast and powerful code editor"
maintainer="Alex Lohr <alexthkloss@web.de>"
license="Apache-2.0"
homepage="https://lapce.dev/"
changelog="https://github.com/lapce/lapce/releases"
distfiles="https://github.com/lapce/lapce/archive/refs/tags/v${version}.tar.gz"
checksum=82407a0b0ae8a5660ff2192ca336c9b0e361424f0fd509e0a0a73ad55071f13d
make_check=no # no tests

export RELEASE_TAG_NAME="v$version"

# do not compile twice
do_install() {
	vbin target/${RUST_TARGET}/release/lapce
}

post_install() {
	vinstall extra/linux/dev.lapce.lapce.desktop 644 usr/share/applications/
	vinstall extra/linux/dev.lapce.lapce.metainfo.xml 644 usr/share/metainfo/
	vinstall extra/images/logo_color.svg 644 usr/share/icons/hicolor/scalable/apps/ dev.lapce.lapce.svg
}

lapce-proxy_package() {
	short_desc+=" - proxy"
	pkg_install() {
		vbin target/${RUST_TARGET}/release/lapce-proxy
	}
}
