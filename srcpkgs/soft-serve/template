# Template file for 'soft-serve'
pkgname=soft-serve
version=0.8.5
revision=1
build_style=go
build_helper=qemu
go_import_path="github.com/charmbracelet/soft-serve"
go_ldflags="-X main.Version=${version}"
go_package="github.com/charmbracelet/soft-serve/cmd/soft"
depends="git"
checkdepends="git git-lfs openssh"
short_desc="Tasty, self-hostable Git server for the command line"
maintainer="zenobit <zenobit@disroot.org>"
license="MIT"
homepage="https://github.com/charmbracelet/soft-serve"
changelog="https://github.com/charmbracelet/soft-serve/releases"
distfiles="https://github.com/charmbracelet/soft-serve/archive/refs/tags/v${version}.tar.gz"
checksum=e8a432e8d1a891d7ca6f8b16fa4455db57b3484b7728fdb1ae9a77d4fa0d7045

system_accounts="_softserve"
_softserve_homedir="/var/lib/soft-serve"
make_dirs="/var/lib/soft-serve 0755 _softserve _softserve"

post_install() {
	local _soft="${DESTDIR}/usr/bin/soft"
	for shell in bash fish zsh; do
		vtargetrun ${_soft} completion ${shell} > soft.${shell}
		vcompletion soft.${shell} ${shell} soft
	done

	vtargetrun ${_soft} man > soft.1
	vman soft.1

	vlicense LICENSE
	vsv soft-serve
}
