# Template file for 'soft-serve'
pkgname=soft-serve
version=0.11.1
revision=1
build_style=go
build_helper=qemu
go_import_path="github.com/charmbracelet/soft-serve"
go_ldflags="-X main.Version=${version}"
go_package="github.com/charmbracelet/soft-serve/cmd/soft"
depends="git git-lfs openssh"
checkdepends="${depends}"
short_desc="Tasty, self-hostable Git server for the command line"
maintainer="zenobit <zenobit@disroot.org>"
license="MIT"
homepage="https://github.com/charmbracelet/soft-serve"
changelog="https://github.com/charmbracelet/soft-serve/releases"
distfiles="https://github.com/charmbracelet/soft-serve/archive/refs/tags/v${version}.tar.gz"
checksum=c0d9b4e7f1b2cbe3d2abc161b61846ce03743f365d961619fb43b4fa35da11b7

system_accounts="_softserve"
_softserve_homedir="/var/lib/soft-serve"
make_dirs="/var/lib/soft-serve 0755 _softserve _softserve"

post_install() {
	local _soft="${DESTDIR}/usr/bin/soft"
	for shell in bash fish zsh; do
		vtargetrun ${_soft} completion ${shell} > soft.${shell}
		vcompletion soft.${shell} ${shell} soft
	done

	vtargetrun ${_soft} man > soft.1
	vman soft.1

	vlicense LICENSE
	vsv soft-serve
}
