# Template file for 'infisical'
pkgname=infisical
version=0.14.2
revision=1
build_style=go
build_helper="qemu"
build_wrksrc="cli"
go_import_path="github.com/Infisical/infisical-merge"
go_ldflags="-X github.com/Infisical/infisical-merge/packages/util.CLI_VERSION=${version}"
checkdepends="git"
short_desc="Open-source secret management platform (CLI)"
maintainer="Matheus Garcias <matheus.dasilva.garcias@gmail.com>"
license="MIT"
homepage="https://infisical.com"
distfiles="https://github.com/Infisical/infisical/archive/refs/tags/infisical-cli/v${version}.tar.gz"
checksum=313caf8d4e6ca5fd88d4f2adf72c721958d602404b6f80611a78a2f757d993f1

do_check() {
	go test ./...
}

post_install() {
	mv "${DESTDIR}"/usr/bin/infisical-merge "${DESTDIR}"/usr/bin/infisical

	vtargetrun "${DESTDIR}"/usr/bin/infisical man > infisical.1
	vman infisical.1

	for sh in bash zsh fish; do
		vtargetrun "${DESTDIR}"/usr/bin/infisical completion "$sh" > "infisical.$sh"
		vcompletion "infisical.$sh" "$sh"
	done

	vlicense "${wrksrc}"/LICENSE
}
