# Template file for 'bazel'
pkgname=bazel
version=4.1.0
revision=3
create_wrksrc=yes
makedepends="which zip unzip openjdk11 python3"
depends="openjdk11"
short_desc="Fast, scalable, multi-language and extensible build system"
maintainer="TobTobXX <filiuspatrisapps@gmail.com>"
license="Apache-2.0"
homepage="https://bazel.build/"
distfiles="https://github.com/bazelbuild/bazel/releases/download/${version}/bazel-${version}-dist.zip"
checksum=f377d755c96a50f6bd2f423562598d822f43356783330a0b780ad442864d6eeb

patch_args=-Np1

# Stripping breaks the binary:
# https://github.com/bazelbuild/bazel/issues/600#issuecomment-156456154
nostrip=yes

# Instructions for bootstrapping bazel are here:
# https://docs.bazel.build/versions/4.1.0/install-compile-source.html#bootstrap-bazel
do_build() {
	env EXTRA_BAZEL_ARGS="--host_javabase=@local_jdk//:jdk" bash ./compile.sh
}
do_install() {
	vbin output/bazel
}
