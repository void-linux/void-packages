# Template file for 'rnote'
pkgname=rnote
version=0.11.0
revision=1
build_style=meson
build_helper=rust
configure_args="-Dcli=true"
hostmakedepends="cargo clang cmake desktop-file-utils gettext glib-devel
 gtk4-update-icon-cache pkg-config shared-mime-info"
makedepends="alsa-lib-devel libadwaita-devel poppler-glib-devel rust-std"
checkdepends="appstream-glib"
short_desc="Sketch and take handwritten notes"
maintainer="chrysos349 <chrysostom349@gmail.com>"
license="GPL-3.0-or-later"
homepage="https://github.com/flxzt/rnote"
changelog="https://github.com/flxzt/rnote/releases"
distfiles="https://github.com/flxzt/rnote/archive/v${version}.tar.gz"
checksum=b133d4331963d3c09d3a7477f60fc4c5072471dcbf459379a593ca1724164af4
disable_parallel_build=yes

export CARGO_PROFILE_RELEASE_LTO=thin

if [ "$XBPS_TARGET_NO_ATOMIC8" ]; then
	XBPS_CROSS_RUSTFLAGS+=" -latomic"
fi

post_patch() {
	if [ "$CROSS_BUILD" ]; then
		vsed -i meson.build \
			-e "s%rust_target_folder /%'${RUST_TARGET}' / &%"
	fi
}
