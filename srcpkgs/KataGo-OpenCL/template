# Template file for 'KataGo-OpenCL'
pkgname=KataGo-OpenCL
version=1.14.0
revision=1
build_wrksrc=cpp
build_style=cmake
configure_args="-DUSE_BACKEND=OPENCL -DNO_GIT_REVISION=1"
makedepends="ocl-icd-devel zlib-devel libzip-devel"
short_desc="KataGo Go/Weiqi/Baduk analysis engine (OpenCL backend)"
maintainer="Jason Elswick <jason@jasondavid.tv>"
license="MIT"
homepage="https://github.com/lightvector/KataGo/"
distfiles="https://github.com/lightvector/KataGo/archive/refs/tags/v${version}.tar.gz"
checksum=d0cb8dbd89aa8c49d5477a2d7dede1981812b709dd49bfd089e1db56200c9ede

alternatives="katago:katago:/usr/bin/katago-opencl"

case "$XBPS_TARGET_MACHINE" in
	i686*) broken="size_t assert fails" ;;
esac

if [ "$XBPS_TARGET_NO_ATOMIC8" ]; then
	configure_args+=" -DCMAKE_CXX_STANDARD_LIBRARIES=-latomic"
	makedepends+=" libatomic-devel"
fi

do_check() {
	build/katago runtests
}

do_install() {
	vbin build/katago katago-opencl
	vlicense "${wrksrc}"/LICENSE
}
