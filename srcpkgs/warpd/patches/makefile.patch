diff --git a/Makefile b/Makefile
index 064ac65..891f791 100644
--- a/Makefile
+++ b/Makefile
@@ -11,7 +11,9 @@ ifeq ($(PLATFORM), macos)
 endif
 
 %.o: %.c Makefile mk/*.mk
-	$(CC) -c $< -o $@ $(CFLAGS)
+	$(CC) -c $< -o $@ $(DEFS) $(INCLUDES) $(CFLAGS)
+
+DEFS=-DVERSION='"v$(VERSION)$(COMMITSTR)"'
 
 CFLAGS:=-g\
        -Wall\
@@ -20,7 +22,6 @@ CFLAGS:=-g\
        -Wno-deprecated-declarations\
        -Wno-unused-parameter\
        -std=c99\
-       -DVERSION='"v$(VERSION)$(COMMITSTR)"'\
        -D_DEFAULT_SOURCE \
        -D_FORTIFY_SOURCE=2  $(CFLAGS)
 
diff --git a/mk/linux.mk b/mk/linux.mk
index bdfc558..8611cf0 100644
--- a/mk/linux.mk
+++ b/mk/linux.mk
@@ -1,25 +1,29 @@
 CFILES=$(shell find src/platform/linux/*.c src/*.c)
+LIBS=
 
 ifndef DISABLE_WAYLAND
-	CFLAGS+=-lwayland-client\
+	LIBS+=-lwayland-client\
 		-lxkbcommon\
 		-lcairo\
 		-lrt\
-		-DWARPD_WAYLAND=1
+
+	DEFS+=-DWARPD_WAYLAND=1
 
 	CFILES+=$(shell find src/platform/linux/wayland/ -name '*.c')
 endif
 
 ifndef DISABLE_X
-	CFLAGS+=-I/usr/include/freetype2/\
-		-lXfixes\
+  INCLUDES+=-I$(XBPS_CROSS_BASE)/usr/include/freetype2
+
+	LIBS+=-lXfixes\
 		-lXext\
 		-lXinerama\
 		-lXi\
 		-lXtst\
 		-lX11\
-		-lXft\
-		-DWARPD_X=1
+		-lXft
+
+	DEFS+=-DWARPD_X=1
 
 	CFILES+=$(shell find src/platform/linux/X/*.c)
 endif
@@ -27,8 +31,8 @@ endif
 OBJECTS=$(CFILES:.c=.o)
 
 all: $(OBJECTS)
-	-mkdir bin
-	$(CC)  -o bin/warpd $(OBJECTS) $(CFLAGS)
+	-mkdir -p bin
+	$(CC) -o bin/warpd $(OBJECTS) $(CFLAGS) $(LDFLAGS) $(LIBS)
 clean:
 	-rm $(OBJECTS)
 	-rm -r bin
