# Template file for 'autofirma'
pkgname=autofirma
version=1.7.2
revision=1
_jmulticard_version=1.7

hostmakedepends="apache-maven openjdk11"
depends="virtual?java-environment"
short_desc="Cliente de firma electrónica ofrecido por la Administración Pública"
maintainer="Eloi Torrents <eloitor@disroot.org>"
license="GPL-3.0-or-later"
homepage="https://firmaelectronica.gob.es/"
distfiles="https://github.com/ctt-gob-es/clienteafirma/archive/v${version}.tar.gz
	https://github.com/ctt-gob-es/jmulticard/archive/refs/tags/v${_jmulticard_version}.tar.gz"
checksum="f3d135f80c5e18e204110f9077f6be708280866600a68e71d9e13af09a1963d5
eedc93e36ae79b2c36f276ad575bca0d84d3883487439e3f71622cfd4a4b58ac"

# maven-surefire-plugin needed
make_check=no

do_build() {
	export JAVA_HOME=/usr/lib/jvm/openjdk11
	cd "jmulticard-${_jmulticard_version}"
	mvn clean install -Dmaven.test.skip=true
	cd "../clienteafirma-${version}"
	mvn clean install -Denv=install -Dmaven.test.skip=true
}

do_check() {
	cd "jmulticard-${_jmulticard_version}"
	mvn test
	cd "../clienteafirma-${version}"
	mvn test
}

do_install() {
	vmkdir usr/share/java
	vmkdir usr/share/java/${pkgname}
	vinstall clienteafirma-${version}/afirma-simple/target/AutoFirma.jar 644 usr/share/java/autofirma
	vbin "${FILESDIR}/autofirma"
}
