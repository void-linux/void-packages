# Template file for 'phosh'
pkgname=phosh
version=0.17.0
revision=1
_gvc_commit="ae1a34aafce7026b8c0f65a43c9192d756fe1057"
_libcall_ui_commit="acfbb136bbf74514e0b9801ce6c1e8acf36350b6"
wrksrc="${pkgname}-v${version}"
build_style=meson
hostmakedepends="phoc glib-devel gettext pkg-config wayland-devel"
makedepends="libfeedback-devel gcr-devel gnome-desktop-devel pam-devel
 polkit-devel pulseaudio-devel libsecret-devel libhandy1-devel
 NetworkManager-devel upower-devel elogind-devel libgudev-devel
 libcallaudio-devel"
depends="phoc squeekboard gnome-session gnome-settings-daemon elogind
 xorg-server-xwayland cantarell-fonts font-adobe-source-code-pro"
short_desc="Wayland shell for GNOME on mobile devices"
maintainer="Jan Christian Gr√ºnhage <jan.christian@gruenhage.xyz>"
license="GPL-3.0-or-later"
homepage="https://gitlab.gnome.org/World/Phosh/phosh"
distfiles="${homepage}/-/archive/v${version}/${pkgname}-v${version}.tar.gz
 https://gitlab.gnome.org/GNOME/libgnome-volume-control/-/archive/${_gvc_commit}/gvc-${_gvc_commit}.tar.gz
 https://gitlab.gnome.org/World/Phosh/libcall-ui/-/archive/${_libcall_ui_commit}/libcall-ui-${_libcall_ui_commit}.tar.gz"
checksum="dd6c5be5cda532cf33c602e55a087959d10510367e511c86576e91b0f24c7d6d
 afc9a7c7fd6de8252430878a753b4dbfd09033a54055e4020ced3d26609143ee
 2dacd4c16b1e9afe30cacdbbbbb1d5f1c1079cb391083191ab647f142365d66e"
# Checking requires running a wayland session
make_check=no

post_extract() {
	rm -rf subprojects/gvc
	rm -rf subprojects/libcall-ui
	mv ../libgnome-volume-control-${_gvc_commit} subprojects/gvc
	mv ../libcall-ui-${_libcall_ui_commit} subprojects/libcall-ui
}

post_install() {
	vcopy ${FILESDIR}/sm.puri.OSK0.desktop usr/share/applications
	vcopy ${FILESDIR}/phosh.desktop usr/share/wayland-sessions
}
