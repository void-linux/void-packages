# Template file for 'vscode-official'
pkgname=vscode-official
version=1.81.1
revision=1
makedepends="tar"
short_desc="Microsoft Visual Studio Code for Linux"
maintainer="endigma <endigma@mailcat.ca>"
license="custom:Proprietary"
homepage="https://code.visualstudio.com/"
distfiles="https://update.code.visualstudio.com/${version}/linux-x64/stable>vscode-${version}.tar.gz"
repository=nonfree
restricted=yes
nopie=yes
nostrip=yes

checksum=4ea6b0aaed22474027dc2678c774461b4bc3df1fcfbd0c918554e173a4af7448

do_install() {
	vmkdir opt/code

	vcopy * opt/code/

	vmkdir usr/bin

	vmkdir usr/share/applications

	vinstall ${FILESDIR}/code.desktop 755 usr/share/applications/
	vinstall ${FILESDIR}/code-url-handler.desktop 755 usr/share/applications/

	# No plaintext licenses in tarball
	# vlicense ${FILESDIR}/LICENSE

	chmod -R o-w ${DESTDIR}/opt/code/resources/app/
}

post_install() {
	ln -sf /opt/code/bin/code $DESTDIR/usr/bin/code
}
