# Template file for 'msp430-toolchain'
pkgname=msp430-toolchain
version=9.3.1.2
revision=1
archs="x86_64* i686*"
create_wrksrc=yes
hostmakedepends="make gcc binutils bzip2 tar curl flex bison texinfo"
short_desc="Toolchain for the TI MSP430 microprocessor"
maintainer="Benjamin Calderon <benj.calderon@gmail.com>"
license="GPL-2.0-only"
homepage="http://www.ti.com/tool/msp430-gcc-opensource"
distfiles="https://dr-download.ti.com/software-development/ide-configuration-compiler-or-debugger/MD-LlCjWuAbzH/9.3.1.2/msp430-gcc-9.3.1.11-source-full.tar.bz2
 https://dr-download.ti.com/software-development/ide-configuration-compiler-or-debugger/MD-LlCjWuAbzH/9.3.1.2/msp430-gcc-support-files-1.212.zip"
checksum="095197fcd4a81d0df1ea03d62c3c3030f6024ca96df65d828c043bddde634fdd
 3b1a39f10a344dfefb767e60ac35becef4c065013be86993195b138a5fb0b8d6"
nocross=yes
nostrip=yes

_prefix=/usr/msp430

do_configure() {
	cd ${wrksrc}/msp430-gcc-9.3.1.11-source-full
	chmod +x README-build.sh
}

do_build() {
	cd ${wrksrc}/msp430-gcc-9.3.1.11-source-full
	./README-build.sh
}

do_install() {
	vmkdir ${_prefix}

	vcopy ${wrksrc}/msp430-gcc-9.3.1.11-source-full/install/usr /

	# man pages
	vmkdir /usr/share/man
	vcopy ${wrksrc}/msp430-gcc-9.3.1.11-source-full/install/usr/msp430/share/man/man1 /usr/share/man
	vcopy ${wrksrc}/msp430-gcc-9.3.1.11-source-full/install/usr/msp430/share/man/man5 /usr/share/man
	rm -rf ${DESTDIR}/${_prefix}/share/man

	# link bin
	vmkdir /usr/bin
	cd ${DESTDIR}/${_prefix}/bin
	for i in *
		do ln -s ${_prefix}/bin/$i ${DESTDIR}/usr/bin/$i
	done

	# copy support files
	vcopy ${wrksrc}/msp430-gcc-support-files/include/* ${_prefix}/include
}
