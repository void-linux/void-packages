# Template file for 'lwt'
pkgname=lwt
version=4.0.1
revision=1
hostmakedepends="ocaml cppo dune ppx_tools_versioned ocaml-react pkg-config"
makedepends="libev-devel ncurses-devel"
depends="ppx_tools_versioned ocaml-react ocaml-result"
short_desc="OCaml promises and concurrent I/O"
maintainer="John Zimmermann <johnz@posteo.net>"
license="LGPL-2.1-or-later"
homepage="http://ocsigen.org/lwt/"
distfiles="https://github.com/ocsigen/lwt/archive/${version}.tar.gz"
checksum=97ff4892eea38b2cc3cb9bc764afa31948d7c345a2caf6c60848d5ce60b2de25
nocross=yes

do_configure() {
	ocaml src/util/configure.ml -use-libev true
}

do_build() {
	jbuilder build
}

do_install() {
	vmkdir usr/share
	vmkdir $(ocamlfind printconf destdir)
	jbuilder install --prefix "${DESTDIR}/usr" --libdir "${DESTDIR}$(ocamlfind printconf destdir)"
	mv ${DESTDIR}/usr/{doc,share/}
}
