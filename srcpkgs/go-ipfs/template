# Template file for 'go-ipfs'
pkgname=go-ipfs
version=0.4.16
revision=1
create_wrksrc=yes
build_wrksrc="${pkgname}-${version}"
build_style=go
hostmakedepends="gx-go"
go_import_path="github.com/ipfs/${pkgname}"
go_package="${go_import_path}/cmd/ipfs"
depends="fs-repo-migrations>=1.3.0"
short_desc="Global versioned P2P merkle DAG file system"
maintainer="Christopher Brannon <chris@the-brannons.com>"
license="MIT"
homepage="https://ipfs.io"
distfiles="https://${go_import_path}/archive/v${version}.tar.gz"
checksum=588f84b707150622abb7e31602af3a85a2dd617b8bb2df42ca2623153bf245b4

pre_build() {
	# Disable the dynamic plugin loader for now; breaks cross.
	if [ "$CROSS_BUILD" ]; then
		rm plugin/loader/load_linux.go
	fi

	echo "ipldgit github.com/ipfs/go-ipfs/plugin/plugins/git 0" >> plugin/loader/preload_list

	gx install
}

post_install() {
	vinstall misc/completion/ipfs-completion.bash 644 usr/share/bash-completion/completions ipfs
	vlicense LICENSE
	vdoc README.md
	vdoc CHANGELOG.md
}
