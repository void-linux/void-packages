# Template file for 'libunity'
pkgname=libunity
version=7.1.4+19.04.20190319
revision=1
build_style=gnu-configure
configure_args="--prefix=/usr --disable-static --enable-headless-tests \
 PYTHON=python2"
hostmakedepends="automake gettext-devel glib-devel gobject-introspection
 intltool pkg-config python vala"
makedepends="dee-devel gtk+3-devel libdbusmenu-glib-devel"
short_desc="Library for integrating with all aspects of the Unity shell"
maintainer="Earldridge Jazzed Pineda <earldridgejazzedpineda@gmail.com>"
license="LGPL-3.0-only"
homepage="https://launchpad.net/libunity"
distfiles="https://launchpad.net/ubuntu/+archive/primary/+files/libunity_${version}.orig.tar.gz"
checksum=56ecb380d74bf74caba193d9e8ad6b0c85ccf9eeb461bc9731c2b8636e1f1492
make_check=ci-skip # "undefined reference" errors

pre_patch() {
	find -type f -name '*.py' -exec sed -i 's|^\(#!.*python$\)|\12|g' {} \+
}

post_patch() {
	for i in $(grep -v '#' debian/patches/series); do
		msg "Applying ${i} ..."
		patch -p1 -i "debian/patches/${i}"
	done
}

pre_configure() {
	intltoolize -f
	autoreconf -vfi
}

libunity-devel_package() {
	short_desc+=" - development files"
	depends="${sourcepkg}>=${version}_${revision} dee-devel
	 libdbusmenu-glib-devel libglib-devel"
	pkg_install() {
		vmove usr/include
		vmove "usr/lib/*.so"
		vmove "usr/lib/libunity/*.so"
		vmove usr/lib/pkgconfig
		vmove usr/share/gir-1.0
		vmove usr/share/vala
	}
}
