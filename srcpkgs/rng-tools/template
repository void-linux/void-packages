# Template file for 'rng-tools'
pkgname=rng-tools
version=6.6
revision=2
wrksrc=${pkgname}-${version}
build_style=gnu-configure
makedepends="libgcrypt-devel libsysfs-devel libcurl-devel libxml2-devel"
hostmakedepends="automake pkg-config"
short_desc="Random number generator related utilities"
maintainer="Andrea Brancaleoni <abc@pompel.me>"
license="GPL-2.0-or-later"
homepage="https://github.com/nhorman/rng-tools/releases"
distfiles="https://github.com/nhorman/rng-tools/archive/v${version}.tar.gz"
checksum=8a5b8b262b4fb430fcb2d12c9d3d3af83c1fe855a8db700b3de34744f5ccb300

case "$XBPS_TARGET_MACHINE" in
	*-musl)	makedepends+=" argp-standalone"
		;;
esac

pre_configure() {
	sh autogen.sh
}

do_build() {
	case "$XBPS_TARGET_MACHINE" in
		*-musl)
			LIBS="-largp -lgcrypt"
			;;
		*)
			LIBS="-lgcrypt"
			;;
	esac

	make CC="$CC" LIBS="$LIBS" CFLAGS="$CFLAGS" LDFLAGS="$LDFLAGS"
}

post_install() {
	vsv rngd
}
