# Template file for 'dropbear'
pkgname=dropbear
version=2025.88
revision=1
build_style=gnu-configure
configure_args="--enable-zlib --disable-bundled-libtom"
makedepends="zlib-devel libtommath-devel libtomcrypt-devel"
checkdepends="python3-pytest python3-parsing python3-psutil openssh"
short_desc="Small SSH server and client"
maintainer="Orphaned <orphan@voidlinux.org>"
license="MIT"
homepage="https://matt.ucc.asn.au/dropbear/dropbear.html"
changelog="https://matt.ucc.asn.au/dropbear/CHANGES"
distfiles="https://matt.ucc.asn.au/${pkgname}/releases/${pkgname}-${version}.tar.bz2"
checksum=783f50ea27b17c16da89578fafdb6decfa44bb8f6590e5698a4e4d3672dc53d4
make_dirs="/etc/dropbear 0755 root root"

if [ "$XBPS_TARGET_LIBC" = "glibc" ]; then
	makedepends+=" libxcrypt-devel"
fi

pre_check() {
	# These tests don't work from within xbps-src
	# and probably should not be run from there
	rm test/test_aslr.py
	rm test/test_channels.py
	# Required asyncssh not packaged for Void Linux
	rm test/test_concurrent.py
}

post_install() {
	vsv dropbear
	vlicense LICENSE
}
