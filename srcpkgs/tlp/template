# Template file for 'tlp'
pkgname=tlp
# Remember to update 'tlpui' asap.
version=1.9.1
revision=1
depends="hdparm bash iw util-linux ethtool perl"
short_desc="Advanced power management tool for Linux"
maintainer="Orphaned <orphan@voidlinux.org>"
license="GPL-2.0-or-later"
homepage="https://linrunner.de/en/tlp/docs/tlp-linux-advanced-power-management.html"
changelog="https://raw.githubusercontent.com/linrunner/TLP/main/changelog"
distfiles="https://github.com/linrunner/TLP/archive/${version}.tar.gz"
checksum=6f7c69a8c56706f83bc3566377caf846c2ccbd8f2621fe8e56c6d1e684d15156

conflicts="laptop-mode>=0 perl-Unicode-Tussle>=0"
conf_files="/etc/tlp.conf /etc/tlp.d/*.conf"
make_dirs="/var/lib/tlp 0755 root root"

do_install() {
	make DESTDIR=${DESTDIR} \
		TLP_SBIN=/usr/bin \
		TLP_ULIB=/usr/lib/udev \
		TLP_ELOD=/usr/libexec/elogind/system-sleep \
		TLP_POLKIT=/usr/share/polkit-1/actions \
		TLP_WITH_SYSTEMD=0 \
		install

	vmkdir usr/share/man/man1
	install -m644 man/*.1 ${DESTDIR}/usr/share/man/man1
	vmkdir usr/share/man/man8
	install -m644 man/*.8 ${DESTDIR}/usr/share/man/man8
	install -m644 man-pd/*.1 ${DESTDIR}/usr/share/man/man1
	install -m644 man-pd/*.8 ${DESTDIR}/usr/share/man/man8
	install -m644 man-rdw/*.8 ${DESTDIR}/usr/share/man/man8
	rm -f ${DESTDIR}/usr/share/man/man8/*.service.8

	vsv tlp
	vinstall ${FILESDIR}/tlp.resume 755 etc/zzz.d/resume 50-tlp.sh
	vinstall ${FILESDIR}/tlp.suspend 755 etc/zzz.d/suspend 50-tlp.sh

	rm -rf ${DESTDIR}/etc/init.d
	rm -rf ${DESTDIR}/usr/lib/systemd
}

tlp-pd_package() {
	short_desc="TLP Profiles Daemon"
	conf_files="/etc/tlp-pd.dbus.conf"
	depends="tlp python3-dbus python3-gobject polkit"

	conflicts="power-profiles-daemon>=0"

	pkg_install() {
		vconf tlp-pd.dbus.conf
		vmove usr/bin/tlp-pd
		vmove usr/bin/tlpctl
		vmove usr/share/man/man1/tlpctl.1
		vmove usr/share/man/man8/tlp-pd.8
		vmove "usr/share//dbus-1/system.d/*.conf"
		vmove "usr/share//dbus-1/system-services/*.service"
		vmove usr/share/polkit-1/actions/tlp-pd.policy
		vsv tlp-pd
	}
}

tlp-rdw_package() {
	short_desc="Control the radio device wizard"
	depends="tlp NetworkManager"

	pkg_install() {
		vmove usr/bin/tlp-rdw
		vmove usr/lib/udev/rules.d/85-tlp-rdw.rules
		vmove usr/lib/udev/tlp-rdw-udev
		vmove usr/lib/NetworkManager/dispatcher.d/99tlp-rdw-nm
		vmove usr/share/man/man8/tlp-rdw.8
	}
}
