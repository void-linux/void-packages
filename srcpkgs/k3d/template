# Template file for 'k3d'
pkgname=k3d
version=5.6.0
revision=1
build_style=go
build_helper=qemu
go_import_path="github.com/k3d-io/k3d/v5"
go_ldflags="-X ${go_import_path}/version.Version=v$version"
go_mod_mode=default
hostmakedepends="go1.20"
depends="docker"
short_desc="Creates containerized k3s clusters"
maintainer="Daniel Lewan <daniel@teddydd.me>"
license="MIT"
homepage="https://k3d.io/"
changelog="https://raw.githubusercontent.com/k3d-io/k3d/main/CHANGELOG.md"
distfiles="https://github.com/k3d-io/k3d/archive/v${version}.tar.gz"
checksum=b9eb05c5fa213c8ec6d34a25e00ae07abeb23d70c94f55c1f32fbc16ea4e480e
_completions="bash zsh fish"
export GOTOOLCHAIN=go1.20

post_build() {
	local cli=$(find $GOPATH/bin -name k3d)
	for shell in $_completions
	do
		vtargetrun "$cli" completion "$shell" >"completion.$shell"
	done
}

post_install() {
	for shell in $_completions
	do
		vcompletion "completion.$shell" "$shell"
	done
	vlicense LICENSE
}
