# Template file for 'pandoc'
pkgname=pandoc
# Keep in sync with http://www.stackage.org/lts
version=3.6
revision=1
_sidenote_version=0.23.0.0
_crossref_version=0.3.18.1
create_wrksrc=yes
build_style=haskell-stack
stackage="lts-23.26"
make_build_args="
 --flag pandoc:embed_data_files
 --flag lua:pkg-config"
hostmakedepends="pkg-config unzip wget"
makedepends="zlib-devel lua54-devel tar"
short_desc="Universal converter between markup formats"
maintainer="Orphaned <orphan@voidlinux.org>"
license="GPL-2.0-or-later, BSD-3-Clause"
homepage="http://johnmacfarlane.net/pandoc/"
distfiles="https://hackage.haskell.org/package/pandoc-${version}/pandoc-${version}.tar.gz
 https://hackage.haskell.org/package/pandoc-cli-${version}/pandoc-cli-${version}.tar.gz
 https://hackage.haskell.org/package/pandoc-sidenote-${_sidenote_version}/pandoc-sidenote-${_sidenote_version}.tar.gz
 https://hackage.haskell.org/package/pandoc-crossref-${_crossref_version}/pandoc-crossref-${_crossref_version}.tar.gz
 https://hackage.haskell.org/package/basement-0.0.16/basement-0.0.16.tar.gz
 https://hackage.haskell.org/package/memory-0.18.0/memory-0.18.0.tar.gz
 https://hackage.haskell.org/package/cborg-0.2.10.0/cborg-0.2.10.0.tar.gz"
checksum="da963bfd49852fd1364604f616f71168fd4558606f265159bf1f42da1f97f9b8
 07dccd028aff2e5d8c4e4a970a9d0ec33ee941d574e3b84e29af249a81a83833
 2722ca9cf7bed62658f669a3ec2026de0e0e80941b499a25e660adcf977eec2d
 e4353c29af9db8c2b898254c5146aa922c221d9b2ec2becbbc9e58294fbbfaaf
 7fb77e249aef76ba5aed3059d556800ce02b614597c488ba01f0a16449146300
 fd4eb6f638e24b81b4e6cdd68772a531726f2f67686c8969d3407d82f7862e3e
 17fe070c38fc498cab49bcb9d6215b7747d53bedf96502e9bcce9cad73b9c797"
nocross=yes
nopie_files="
 /usr/bin/pandoc
 /usr/bin/pandoc-sidenote
 /usr/bin/pandoc-crossref"
skip_extraction="basement-0.0.16.tar.gz memory-0.18.0.tar.gz cborg-0.2.10.0.tar.gz"

post_extract() {
	vsrcextract -C basement basement-0.0.16.tar.gz
	vsrcextract -C memory memory-0.18.0.tar.gz
	vsrcextract -C cborg cborg-0.2.10.0.tar.gz
}

post_install() {
	vman pandoc-cli-${version}/man/pandoc.1
	vlicense pandoc-${version}/COPYRIGHT LICENSE
}

# pandoc filters should be built with pandoc to ensure compatibility and speed up compiliation
pandoc-sidenote_package() {
	depends="pandoc-${version}_${revision}"
	short_desc="Pandoc filter to convert Markdown-style footnotes into sidenotes"
	short_desc+=" - version ${_sidenote_version}"
	license="MIT"
	pkg_install() {
		vmove usr/bin/pandoc-sidenote
		vlicense pandoc-sidenote-${_sidenote_version}/LICENSE
	}
}

pandoc-crossref_package() {
	depends="pandoc-${version}_${revision}"
	short_desc="Pandoc filter for cross-references"
	short_desc+=" - version ${_crossref_version}"
	license="GPL-2.0-or-later"
	pkg_install() {
		vmove usr/bin/pandoc-crossref
		$DESTDIR/usr/bin/pandoc -s -t man pandoc-crossref-${_crossref_version}/docs/index.md -o pandoc-crossref-${_crossref_version}/docs/pandoc-crossref.1
		vman pandoc-crossref-${_crossref_version}/docs/pandoc-crossref.1
	}
}
