# Template file for 'libpdal'
pkgname=libpdal
version=2.9.0
revision=1
build_style=cmake
build_helper="qemu"
hostmakedepends="pkg-config"
makedepends="libcurl-devel libgdal-devel libgeotiff-devel libunwind-devel
 libxml2-devel proj-devel python3-devel tiff-devel zlib-devel"
checkdepends="libgdal-tools gtest-devel"
short_desc="Point Data Abstraction Library"
maintainer="Arjan Mossel <arjanmossel@gmail.com>"
license="BSD-3-Clause"
homepage="https://pdal.io/"
distfiles="https://github.com/PDAL/PDAL/releases/download/${version}/PDAL-${version}-src.tar.gz"
checksum=9fd3cffd9cf84b36f83e599ea2c41147032832f91d1efdf01fd8142d5bfe6b8e

if [ -z "$XBPS_CHECK_PKGS" ]; then
	configure_args+=" -DWITH_TESTS=OFF"
fi

do_check() {
	cd build
	case "$XBPS_TARGET_MACHINE" in
		i686*) ctest -E \
			"pdal_(app_plugin|file_utils|filters_colorinterp|filters_stats|io_optech|utils)_test" ;;
		x86_64*) ctest -E 'pdal_app_plugin_test' ;;
		*) ctest ;;
	esac
}

post_install() {
	vlicense LICENSE.txt
}

libpdal-devel_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/bin/pdal-config
		vmove usr/include
		vmove usr/lib/pkgconfig
		vmove usr/lib/cmake
		vmove "usr/lib/*.so"
	}
}
