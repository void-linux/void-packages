# Template file for 'qtile'
pkgname=qtile
version=0.34.1
revision=1
build_style=python3-pep517
_wlroots=0.19
make_build_args="--config-setting backend=wayland"
hostmakedepends="python3-setuptools_scm python3-cairocffi python3-xcffib python3-wheel
 pkg-config wayland-devel"
makedepends="python3-devel libffi-devel pulseaudio-devel wlroots${_wlroots}-devel
 cairo-devel libdrm-devel pixman-devel"
depends="python3-cairocffi python3-xcffib python3-cffi pango gdk-pixbuf"
short_desc="Full-featured tiling window manager written and configured in Python"
maintainer="Kai Stian Olstad <void@olstad.com>"
license="MIT"
homepage="http://www.qtile.org/"
changelog="https://raw.githubusercontent.com/qtile/qtile/master/CHANGELOG"
distfiles="${PYPI_SITE}/q/qtile/qtile-${version}.tar.gz"
checksum=8000a29dd25908cc6d320987995f38ee5c5ef360e7f6e3b041f310de1a7c2b18

pre_build() {
	# CFLAGS+=" $($PKG_CONFIG --cflags cairo pixman-1 libdrm wlroots-${_wlroots})"
	if [ "$CROSS_BUILD" ]; then
		export QTILE_CAIRO_PATH=$XBPS_CROSS_BASE/usr/include/cairo
		export QTILE_PIXMAN_PATH=$XBPS_CROSS_BASE/usr/include/pixman-1
		export QTILE_LIBDRM_PATH=$XBPS_CROSS_BASE/usr/include/libdrm
		export QTILE_WLROOTS_PATH=$XBPS_CROSS_BASE/usr/include/wlroots-${_wlroots}
	fi
}

post_install() {
	vinstall resources/qtile.desktop 644 usr/share/xsessions
	vinstall resources/qtile-wayland.desktop 644 usr/share/wayland-sessions
	vlicense LICENSE
}

qtile-wayland_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove ${py3_sitelib}/libqtile/backend/wayland
		vmove usr/share/wayland-sessions
	}
}
