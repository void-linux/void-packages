# Template file for 'dispcalGUI'
pkgname=dispcalGUI
version=3.9.8
revision=1
build_style=python3-pep517
hostmakedepends="python3-setuptools python3-wheel"
makedepends="python3-devel libXxf86vm-devel libXinerama-devel libXrandr-devel"
depends="python3-distro python3-dbus python3-numpy python3-Pillow
 python3-chromecast python3-send2trash wxPython4 python3-zeroconf
 python3-certifi argyllcms"
short_desc="Display Calibration and Characterization"
maintainer="lemmi <lemmi@nerd2nerd.org>"
license="GPL-3.0-or-later"
homepage="https://github.com/eoyilmaz/displaycal-py3"
changelog="https://github.com/eoyilmaz/displaycal-py3/releases/tag/${version}"
distfiles="https://github.com/eoyilmaz/displaycal-py3/archive/${version}.tar.gz"
checksum=a9e8bba02f9bdf8df506f0dcbbea4eae48795001cb81ea5968fbfc41f4b72e1d
# requires a running system dbus service
make_check=no

post_patch() {
	# set the hardcoded version of python 3 to the latest one
	vsed -i "s|^\(py_maxversion =\).*|\1 (${py3_ver%.*}, ${py3_ver#*.})|" DisplayCAL/meta.py

	vsed -i "s|@PY_VER@|${py3_ver/./}|g" DisplayCAL/RealDisplaySizeMM.py
}

pre_configure() {
	vsed -i 's|MimeType=model/vrml;x-world/x-vrml;|MimeType=model/vrml;|' misc/displaycal-vrml-to-x3d-converter.desktop
}

do_install() {
	python3 -m installer --destdir ${DESTDIR} dist/*.whl
}
