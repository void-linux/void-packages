# INSTALL for 'enpass'
# Fetching proprietary binaries at install-time

_BUILDDIR="/tmp/enpass.build"

if test "$ACTION" = "post"; then
	. opt/enpass/pkgdata
	mkdir -p "$_BUILDDIR"
	(
		set -e
		cd "$_BUILDDIR"
		xbps-uhelper fetch "https://apt.enpass.io/pool/main/e/enpass/enpass_${SVERSION}.deb"
		echo "${SCHECKSUM}  enpass_${SVERSION}.deb" >checksum
		sha256sum -c checksum
		ar x "enpass_${SVERSION}.deb"
		tar -xf data.tar.gz
	)
	if [ $? -ne 0 ] ; then
		echo "Failed downloading enpass"
		rm -r "$_BUILDDIR";
		exit 1;
	fi
	
	mkdir -p opt/enpass
	cp -r "${_BUILDDIR}/opt/enpass" opt/
	mkdir -p usr/share/applications
	cp -r "${_BUILDDIR}/usr/share/applications" /usr/share/
	mkdir -p usr/share/doc
	cp -r "${_BUILDDIR}/usr/share/doc" /usr/share/
	mkdir -p usr/share/icons
	cp -r "${_BUILDDIR}/usr/share/icons" /usr/share/
	mkdir -p usr/share/mime
	cp -r "${_BUILDDIR}/usr/share/mime" /usr/share/
	rm -r "$_BUILDDIR"
	update-desktop-database
	update-mime-database /usr/share/mime
fi
