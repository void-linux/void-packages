# Template file for 'optimus-manager'
# Originally created by Askannz, ported to Void by Hyper-KVM
pkgname=optimus-manager
version=1.2.3
revision=1
archs="noarch"
build_style=python3-module
hostmakedepends="python3 python3-setuptools"
makedepends="git"
depends="python3 python3-setuptools elogind mesa-demos xrandr python3-dbus"
short_desc="Utility to handle GPU switching for Optimus laptops"
maintainer="Hyper-KVM <hyperkvmx86@gmail.com>"
license="MIT"
homepage="https://github.com/Askannz/optimus-manager"
distfiles="https://github.com/Hyper-KVM/optimus-manager/archive/v${version}.tar.gz"
checksum="fd1dcdefd16a127c0eb46938480879172f7af99bb6891e4cc099db144b55c5b1"
tags="python"

do_build() {
	cd "${wrksrc}"
	python3 setup.py install
}

post_install() {
	cd "${wrksrc}"
	vinstall modules/optimus-manager.conf 644 usr/lib/modprobe.d/
	vinstall runit/optimus-manager/run 755 etc/sv/optimus-manager
	vinstall runit/prime-switch-boot/run 755 etc/sv/prime-switch-boot
	vinstall optimus-manager.conf 644 usr/share/
	vinstall var/startup_mode 644 var/lib/optimus-manager/
	vinstall var/requested_mode 644 var/lib/optimus-manager/
	vbin scripts/prime-switch-boot
	vbin scripts/prime-switch
	vbin scripts/prime-offload
	vinstall login_managers/sddm/20-optimus-manager.conf 644 etc/sddm.conf.d/
	vinstall login_managers/lightdm/20-optimus-manager.conf 644 etc/lightdm/lightdm.conf.d/
	vinstall config/xorg-intel.conf 644 etc/optimus-manager/
	vinstall config/xorg-nvidia.conf 644 etc/optimus-manager/
	vinstall config/xsetup-intel.sh 755 etc/optimus-manager/
	vinstall config/xsetup-nvidia.sh 755 etc/optimus-manager/
	vinstall config/xsetup-hybrid.sh 755 etc/optimus-manager/
	vinstall config/nvidia-enable.sh 755 etc/optimus-manager/
	vinstall config/nvidia-disable.sh 755 etc/optimus-manager/
	vlicense LICENSE
}
