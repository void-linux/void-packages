# Template file for 'nufraw'
pkgname=nufraw
version=0.43.3
revision=1
_ver="${version%.*}-${version##*.}"
build_style=gnu-configure
configure_args="--enable-contrast --enable-mime --enable-openmp --with-gimp
 --enable-extras"
hostmakedepends="pkg-config automake libtool glib-devel"
# libgexiv2-devel is only here to fix build order, remove on next template
# change
makedepends="exiv2-devel gimp-devel glib-devel gtkimageview-devel lcms2-devel
 lensfun-devel jasper-devel libgexiv2-devel"
depends="desktop-file-utils"
short_desc="Utility to read and manipulate raw images from digital cameras"
maintainer="John <me@johnnynator.dev>"
license="GPL-2.0-or-later"
homepage="https://sourceforge.net/projects/nufraw/"
distfiles="${SOURCEFORGE_SITE}/nufraw/nufraw-${_ver}.tar.gz"
checksum=2c7dcc1590993ec267b3112562b2433010d6f94f6acc6506c76aa29cf8c6c32c

case "$XBPS_TARGET_MACHINE" in
	armv[67]l* | aarch64* | riscv64*)
		makedepends+=" libgomp-devel"
		make_build_args="CXXFLAGS+=-fsigned-char LDFLAGS+=-fopenmp"
		;;
esac

pre_configure() {
	autoreconf -fi
}

pre_build() {
	mv nufraw.desktop{.desktop,}
	chmod +x generate_schemas.sh
}

nufraw-gimp_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" - gimp plugin"
	pkg_install() {
		vmove usr/lib/gimp
	}
}

ufraw_package() {
	depends="${sourcepkg}>=${version}_${revision}"
	build_style=meta
	short_desc+=" (transitional dummy package)"
}

ufraw-gimp_package() {
	depends="nufraw-gimp>=${version}_${revision}"
	build_style=meta
	short_desc+=" - gimp plugin (transitional dummy package)"
}
