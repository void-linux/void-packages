# Template file for 'odin'
pkgname=odin
version=2025.07
revision=1
_ver=${version//./-}
hostmakedepends="make which"
makedepends="clang17-devel llvm17-devel python3-devel"
depends="clang compiler-rt"
short_desc="Data-Oriented Language for Sane Software Development"
maintainer="elbachir-one <bachiralfa@gmail.com>"
license="BSD-2-Clause"
homepage="https://odin-lang.org/"
distfiles="https://github.com/odin-lang/Odin/archive/refs/tags/dev-${_ver}.tar.gz"
checksum="b1f547917d8bbd525f5119d74cd5ffc280e9daa8309481f96608f62858eec9eb"
nostrip=yes

do_build() {
	export LLVM_CONFIG=llvm-config
	export CXX=/usr/bin/clang++
	make release_native

	make -C vendor/stb/src
	make -C vendor/cgltf/src
	make -C vendor/miniaudio/src
}

do_install() {
	vmkdir usr/lib/odin
	cp odin ${DESTDIR}/usr/lib/${pkgname}/
	cp -r base core shared vendor ${DESTDIR}/usr/lib/${pkgname}/

	vmkdir /usr/bin
	ln -s /usr/lib/${pkgname}/odin ${DESTDIR}/usr/bin/odin
}

post_install() {
	vlicense LICENSE
	vdoc README.md
}
