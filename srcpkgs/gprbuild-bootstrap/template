# Template file for 'gprbuild-bootstrap'
pkgname=gprbuild-bootstrap
version=25.0.0
revision=1
short_desc="Advanced build system for multi-language programs - bootstrap package"
maintainer="Estevan Castilho <tevo@riajuu.net>"
license=GPL-3.0-or-later
homepage="https://github.com/AdaCore/gprbuild"
distfiles="
	https://github.com/AdaCore/gprbuild/archive/refs/tags/v${version}.tar.gz>gprbuild-${version}.tar.gz
	https://github.com/AdaCore/xmlada/archive/refs/tags/v${version}.tar.gz>xmlada-${version}.tar.gz"
checksum="
	d12f94c1ec0b6e219f6b162f71f57129d22426e7798092f5f85b9ec2cc818bf1
	dbb5984a0931311c7a787a679ef4cfaeeedd357474a585dc170140ef2251dcca"

nocross="This is only used by the bootstrap process to build the real gprbuild - it doesn't make much sense to cross-compile."

hostmakedepends="gprconfig_kb gcc-ada"
depends="gprconfig_kb"

do_configure() {
	# kludge to get the bootstrap to use our packaged gprconfig
	# knowledge base - it expects the kb to be under db/, as on the
	# source package
	mkdir -p gprconfig_kb
	ln -sf /usr/share/gprconfig gprconfig_kb/db
}

do_build() {
	cd "gprbuild-${version}"
	./bootstrap.sh \
		--with-xmlada="../xmlada-${version}" \
		--build
}

do_install() {
	cd "gprbuild-${version}"
	./bootstrap.sh \
		--prefix="$DESTDIR/usr" \
		--install
	rm -rf "$DESTDIR/usr/share/gprconfig"
}
