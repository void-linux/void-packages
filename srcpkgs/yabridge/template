# Template file for 'yabridge'
pkgname=yabridge
version=4.0.2
revision=1
archs="x86_64"
build_style=meson
## grep added due to void chroot grep being v3.7 which doesnt support 
## perl regex. grep package is v3.8 which supports the software maintainers
## scripts.
hostmakedepends="ninja pkg-config cmake grep git gcc-multilib"
makedepends="wine-tools wine-devel wine-devel-32bit libxcb-devel libxcb-devel-32bit"
short_desc="Use Windows 32bit and 64bit VST2 and VST3 plugins in Linux 64bit host"
maintainer="Anthony Thompson <athompson@posteo.net>"
license="GPL-3.0-or-later"
homepage="https://github.com/robbert-vdh/yabridge"
distfiles="https://github.com/robbert-vdh/yabridge/archive/refs/tags/${version}.tar.gz"
checksum=86fcd65b6f3dd5cf60c2afa476f63959a2cc4ef4d4629810916739d7af645f01


do_configure() {
	cd ${wrksrc}
	meson setup build --buildtype=release --cross-file=cross-wine.conf --unity=on --unity-size=1000 -Dbitbridge=true
}

do_build() {
	ninja -C build/
}

do_install() {
	cd ${wrksrc}/build
	vbin yabridge-host.exe
	vbin yabridge-host.exe.so
	vbin yabridge-host-32.exe.so
	vbin yabridge-host-32.exe
	vmkdir usr/lib
	vcopy libyabridge-chainloader-vst2.so /usr/lib
	vcopy libyabridge-vst2.so /usr/lib
	vcopy libyabridge-chainloader-vst3.so /usr/lib
	vcopy libyabridge-vst3.so /usr/lib
}
