# Template file for 'sdkmanager'
pkgname=sdkmanager
version=0.6.11
revision=1
build_style=python3-module
hostmakedepends="pkg-config gnupg openjdk17 python3-argcomplete python3-defusedxml
 python3-packaging python3-requests python3-setuptools"
depends="python3-argcomplete python3-looseversion python3-requests python3-urllib3"
short_desc="Drop-in replacement for Android sdkmanager written in Python"
maintainer="zenobit <zenobit@disroot.org>"
license="GPL-3.0-or-later"
homepage="https://gitlab.com/fdroid/sdkmanager"
distfiles="https://gitlab.com/fdroid/sdkmanager/-/archive/${version}/sdkmanager-${version}.tar.gz"
checksum=a92d43014010e5b7e604e48fa20933df896dffa4d3358593bde70751c57cf056
export ANDROID_SDK_ROOT=/tmp/android-sdk
export JAVA_HOME=/usr/lib/jvm/openjdk17
export ver=9.0

do_build() {
	#./sdkmanager.py --list
	./sdkmanager.py 'build-tools;29.0.3' 'cmake;3.18.1'
	echo y | ./sdkmanager.py --licenses
	#timeout 20 ./sdkmanager.py --licenses
	./sdkmanager.py "cmdline-tools;${ver}"
	export sdkmanager="$ANDROID_SDK_ROOT/cmdline-tools/${ver}/bin/sdkmanager"
	$sdkmanager 'build-tools;29.0.3' 'cmake;3.18.1'
	#timeout 20 $sdkmanager --licenses
}

do_check() {
	python3 -m unittest --verbose
}
