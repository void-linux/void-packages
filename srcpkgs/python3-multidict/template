# Template file for 'python3-multidict'
pkgname=python3-multidict
version=6.7.0
revision=1
build_style=python3-pep517
hostmakedepends="python3-setuptools"
makedepends="python3-devel"
depends="python3"
checkdepends="python3-pytest python3-psutil python3-objgraph"
short_desc="Multidict implementation from aiohttp"
maintainer="Michael Aldridge <maldridge@voidlinux.org>"
license="Apache-2.0"
homepage="https://github.com/aio-libs/multidict"
changelog="https://raw.githubusercontent.com/aio-libs/multidict/master/CHANGES.rst"
distfiles="${PYPI_SITE}/m/multidict/multidict-${version}.tar.gz"
checksum=c6e99d9a65ca282e578dfea819cfa9c0a62b2499d8677392e09feaf305e9e6f5

do_check() {
	vsed -e '/cov/d' -i pytest.ini

	local testdir="${wrksrc}/.xbps-testdir/$(date +%s)"
	python3 -m venv --system-site-packages --without-pip "${testdir}"

	local testpy="${testdir}/bin/python3"
	"${testpy}" -m installer dist/*.whl

	cd .xbps-testdir
	"${testpy}" -m pytest --ignore-glob="../tests/test_*_benchmarks.py" ../tests
}
