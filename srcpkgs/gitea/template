# Template file for 'gitea'
pkgname=gitea
version=1.24.6
revision=1
build_style=go
go_import_path=code.gitea.io/gitea
go_ldflags=" -X main.Version=${version}"
# This could be done with build options, but these are built in with the
# following justification.
#   * bindata: running with things not all in the binary is not a
#     supported distribution format by the gitea upstream developers.
#     That mode is only supported for development of gitea within the
#     source tree
#   * sqlite sqlite_unlock_notify: this is likely the database that everyone
#   	will use.  Only particularly large installations will want to go through
#   	the effort of setting up a real database server.
#   * pam: PAM allows for authentication to varied external sources.
#     Internal authentication supports the local database, OpenID, and
#     LDAP, but basic other auth sources such as Kerberos and more
#     exotic authenticators require PAM support to be useable.
go_build_tags="bindata sqlite sqlite_unlock_notify pam"
hostmakedepends="go-bindata"
makedepends="sqlite-devel pam-devel"
depends="git bash"
checkdepends="git nodejs"
short_desc="Git with a cup of Tea"
maintainer="fosslinux <fosslinux@aussies.space>"
license="MIT"
homepage="https://gitea.io"
changelog="https://raw.githubusercontent.com/go-gitea/gitea/main/CHANGELOG.md"
distfiles="https://dl.gitea.io/gitea/${version}/gitea-src-${version}.tar.gz"
checksum=92ed113cb30687d734a0cc93a29e95227fdab7977020cfda0a5db72b6ca6c12b

system_accounts="_gitea"
_gitea_homedir="/var/lib/gitea"
_gitea_shell="/bin/bash" # Proper shell needed for ssh support
make_dirs="/var/lib/gitea 0755 _gitea _gitea
 /var/log/gitea 0755 _gitea root"
conf_files="/etc/gitea.conf"

do_check() {
	make test-backend
}

post_install() {
	vlicense LICENSE
	vsv gitea
	vinstall custom/conf/app.example.ini 0640 /etc gitea.conf
}
