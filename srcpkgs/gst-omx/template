# Template file for 'gst-omx'
pkgname=gst-omx
version=1.15.1
revision=1
build_style=gnu-configure
hostmakedepends="glib-devel pkg-config python"
makedepends="gst-plugins-base1-devel"
short_desc="GStreamer OpenMAX IL wrapper plugin (1.x)"
maintainer="Juan RP <xtraeme@voidlinux.org>"
license="LGPL-2.1-only"
homepage="https://gstreamer.freedesktop.org"
distfiles="${homepage}/src/${pkgname}/${pkgname}-${version}.tar.xz"
checksum=b4313731939b23359201177770c694cfb64556583453d7bf9f28453aa95c2d6f

pre_configure() {
        sed -e 's,-Werror,-Wno-error,g' -i configure
}

case "$XBPS_TARGET_MACHINE" in
	i686*|x86_64*|aarch64*|ppc64*)
		# XXX bellagio target
		configure_args=" --with-omx-target=generic"
		;;
	armv[67]*)
		configure_args=" --with-omx-target=rpi --disable-examples"
		makedepends+=" rpi-firmware rpi-userland-devel"
		CFLAGS+=" -I${XBPS_CROSS_BASE}/opt/vc/include/IL"
		CFLAGS+=" -I${XBPS_CROSS_BASE}/opt/vc/include/interface/vcos/pthreads"
		CFLAGS+=" -I${XBPS_CROSS_BASE}/opt/vc/include/interface/vmcs_host/linux"
		;;
esac
