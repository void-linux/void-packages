--- a/src/vtbackend/Line.h
+++ b/src/vtbackend/Line.h
@@ -447,7 +447,7 @@ inline typename Line<Cell>::InflatedBuff
 template <>
 struct fmt::formatter<vtbackend::LineFlags>: formatter<std::string>
 {
-    auto format(const vtbackend::LineFlags flags, format_context& ctx) -> format_context::iterator
+    auto format(const vtbackend::LineFlags flags, format_context& ctx) const -> format_context::iterator
     {
         static const std::array<std::pair<vtbackend::LineFlags, std::string_view>, 3> nameMap = {
             std::pair { vtbackend::LineFlag::Wrappable, std::string_view("Wrappable") },
--- a/src/contour/Actions.h
+++ b/src/contour/Actions.h
@@ -141,7 +141,7 @@ std::optional<Action> fromString(std::st
     template <>                                                                                  \
     struct fmt::formatter<contour::actions::T>: fmt::formatter<std::string_view>                 \
     {                                                                                            \
-        auto format(contour::actions::T const&, format_context& ctx) -> format_context::iterator \
+        auto format(contour::actions::T const&, format_context& ctx) const -> format_context::iterator \
         {                                                                                        \
             return formatter<string_view>::format(#T, ctx);                                      \
         }                                                                                        \
@@ -208,7 +208,7 @@ DECLARE_ACTION_FMT(WriteScreen)
 template <>
 struct fmt::formatter<contour::actions::Action>: fmt::formatter<std::string>
 {
-    auto format(contour::actions::Action const& _action, format_context& ctx) -> format_context::iterator
+    auto format(contour::actions::Action const& _action, format_context& ctx) const -> format_context::iterator
     {
         std::string name = "Unknown action";
         // {{{ handle
@@ -274,7 +274,7 @@ struct fmt::formatter<contour::actions::
         return ctx.begin();
     }
     template <typename FormatContext>
-    auto format(contour::actions::CopyFormat value, FormatContext& ctx)
+    auto format(contour::actions::CopyFormat value, FormatContext& ctx) const
     {
         switch (value)
         {
--- a/src/contour/Config.h
+++ b/src/contour/Config.h
@@ -361,7 +361,7 @@ struct fmt::formatter<contour::config::P
         return ctx.begin();
     }
     template <typename FormatContext>
-    auto format(contour::config::Permission const& perm, FormatContext& ctx)
+    auto format(contour::config::Permission const& perm, FormatContext& ctx) const
     {
         switch (perm)
         {
@@ -383,7 +383,7 @@ struct fmt::formatter<contour::config::S
     }
     using SelectionAction = contour::config::SelectionAction;
     template <typename FormatContext>
-    auto format(SelectionAction value, FormatContext& ctx)
+    auto format(SelectionAction value, FormatContext& ctx) const
     {
         switch (value)
         {
@@ -406,7 +406,7 @@ struct fmt::formatter<contour::config::S
     }
     using ScrollBarPosition = contour::config::ScrollBarPosition;
     template <typename FormatContext>
-    auto format(ScrollBarPosition value, FormatContext& ctx)
+    auto format(ScrollBarPosition value, FormatContext& ctx) const
     {
         switch (value)
         {
@@ -422,7 +422,7 @@ template <>
 struct fmt::formatter<contour::config::TerminalProfile::WindowMargins>: public fmt::formatter<std::string>
 {
     using WindowMargins = contour::config::TerminalProfile::WindowMargins;
-    auto format(WindowMargins margins, format_context& ctx) -> format_context::iterator
+    auto format(WindowMargins margins, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("{}x+{}y", margins.horizontal, margins.vertical),
                                               ctx);
--- a/src/contour/TerminalSession.h
+++ b/src/contour/TerminalSession.h
@@ -461,7 +461,7 @@ struct formatter<contour::GuardedRole>
     }
 
     template <typename FormatContext>
-    auto format(contour::GuardedRole value, FormatContext& ctx)
+    auto format(contour::GuardedRole value, FormatContext& ctx) const
     {
         switch (value)
         {
--- a/src/crispy/StrongHash.h
+++ b/src/crispy/StrongHash.h
@@ -308,7 +308,7 @@ struct fmt::formatter<crispy::strong_has
         return ctx.begin();
     }
     template <typename FormatContext>
-    auto format(crispy::strong_hash const& hash, FormatContext& ctx)
+    auto format(crispy::strong_hash const& hash, FormatContext& ctx) const
     {
         return fmt::format_to(ctx.out(), "{}", to_structured_string(hash));
     }
--- a/src/crispy/StrongLRUHashtable.h
+++ b/src/crispy/StrongLRUHashtable.h
@@ -42,7 +42,7 @@ struct lru_hashtable_stats
 template <>
 struct fmt::formatter<crispy::lru_hashtable_stats>: fmt::formatter<std::string>
 {
-    auto format(crispy::lru_hashtable_stats stats, format_context& ctx) -> format_context::iterator
+    auto format(crispy::lru_hashtable_stats stats, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(
             fmt::format(
--- a/src/crispy/file_descriptor.h
+++ b/src/crispy/file_descriptor.h
@@ -121,7 +121,7 @@ using file_descriptor = native_handle<in
 template <>
 struct fmt::formatter<HANDLE>: fmt::formatter<std::string>
 {
-    auto format(HANDLE value, format_context& ctx) -> format_context::iterator
+    auto format(HANDLE value, format_context& ctx) const -> format_context::iterator
     {
         auto str = fmt::format("0x{:X}", (unsigned long long) (value));
         return fmt::formatter<std::string>::format(str, ctx);
@@ -132,7 +132,7 @@ struct fmt::formatter<HANDLE>: fmt::form
 template <>
 struct fmt::formatter<crispy::file_descriptor>: fmt::formatter<crispy::file_descriptor::native_handle_type>
 {
-    auto format(crispy::file_descriptor const& fd, format_context& ctx) -> format_context::iterator
+    auto format(crispy::file_descriptor const& fd, format_context& ctx) const -> format_context::iterator
     {
         return fmt::formatter<crispy::file_descriptor::native_handle_type>::format(fd.get(), ctx);
     }
--- a/src/crispy/flags.h
+++ b/src/crispy/flags.h
@@ -135,7 +135,7 @@ class flags
 template <typename Enum>
 struct fmt::formatter<crispy::flags<Enum>>: public fmt::formatter<std::string>
 {
-    auto format(crispy::flags<Enum> const& flags, format_context& ctx) -> format_context::iterator
+    auto format(crispy::flags<Enum> const& flags, format_context& ctx) const -> format_context::iterator
     {
         std::string result;
         for (auto i = 0u; i < sizeof(Enum) * 8; ++i)
--- a/src/crispy/point.h
+++ b/src/crispy/point.h
@@ -89,7 +89,7 @@ constexpr inline bool operator!=(point c
 template <>
 struct fmt::formatter<crispy::point>: formatter<std::string>
 {
-    auto format(crispy::point coord, format_context& ctx) -> format_context::iterator
+    auto format(crispy::point coord, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("({}, {})", coord.x, coord.y), ctx);
     }
--- a/src/text_shaper/font.h
+++ b/src/text_shaper/font.h
@@ -330,7 +330,7 @@ struct hash<text::font_description>
 template <>
 struct fmt::formatter<text::DPI>: fmt::formatter<std::string>
 {
-    auto format(text::DPI dpi, format_context& ctx) -> format_context::iterator
+    auto format(text::DPI dpi, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("{}x{}", dpi.x, dpi.y), ctx);
     }
@@ -339,7 +339,7 @@ struct fmt::formatter<text::DPI>: fmt::f
 template <>
 struct fmt::formatter<text::font_weight>: formatter<string_view>
 {
-    auto format(text::font_weight value, format_context& ctx) -> format_context::iterator
+    auto format(text::font_weight value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -364,7 +364,7 @@ struct fmt::formatter<text::font_weight>
 template <>
 struct fmt::formatter<text::font_slant>: formatter<string_view>
 {
-    auto format(text::font_slant value, format_context& ctx) -> format_context::iterator
+    auto format(text::font_slant value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -380,7 +380,7 @@ struct fmt::formatter<text::font_slant>:
 template <>
 struct fmt::formatter<text::font_spacing>: formatter<string_view>
 {
-    auto format(text::font_spacing value, format_context& ctx) -> format_context::iterator
+    auto format(text::font_spacing value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -395,7 +395,7 @@ struct fmt::formatter<text::font_spacing
 template <>
 struct fmt::formatter<text::font_description>: fmt::formatter<std::string>
 {
-    auto format(text::font_description const& desc, format_context& ctx) -> format_context::iterator
+    auto format(text::font_description const& desc, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(
             fmt::format("(family={} weight={} slant={} spacing={}, strict_spacing={})",
@@ -411,7 +411,7 @@ struct fmt::formatter<text::font_descrip
 template <>
 struct fmt::formatter<text::font_metrics>: fmt::formatter<std::string>
 {
-    auto format(text::font_metrics const& metrics, format_context& ctx) -> format_context::iterator
+    auto format(text::font_metrics const& metrics, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("({}, {}, {}, {}, {}, {})",
                                                           metrics.lineHeight,
@@ -427,7 +427,7 @@ struct fmt::formatter<text::font_metrics
 template <>
 struct fmt::formatter<text::font_size>: fmt::formatter<std::string>
 {
-    auto format(text::font_size size, format_context& ctx) -> format_context::iterator
+    auto format(text::font_size size, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("{}pt", size.pt), ctx);
     }
@@ -436,7 +436,7 @@ struct fmt::formatter<text::font_size>:
 template <>
 struct fmt::formatter<text::font_key>: fmt::formatter<std::string>
 {
-    auto format(text::font_key key, format_context& ctx) -> format_context::iterator
+    auto format(text::font_key key, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("{}", key.value), ctx);
     }
@@ -445,7 +445,7 @@ struct fmt::formatter<text::font_key>: f
 template <>
 struct fmt::formatter<text::glyph_index>: fmt::formatter<std::string>
 {
-    auto format(text::glyph_index value, format_context& ctx) -> format_context::iterator
+    auto format(text::glyph_index value, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("{}", value.value), ctx);
     }
@@ -454,7 +454,7 @@ struct fmt::formatter<text::glyph_index>
 template <>
 struct fmt::formatter<text::glyph_key>: fmt::formatter<std::string>
 {
-    auto format(text::glyph_key const& key, format_context& ctx) -> format_context::iterator
+    auto format(text::glyph_key const& key, format_context& ctx) const -> format_context::iterator
     {
 #if defined(GLYPH_KEY_DEBUG)
         return formatter<std::string>::format(
@@ -474,7 +474,7 @@ struct fmt::formatter<text::glyph_key>:
 template <>
 struct fmt::formatter<text::font_feature>: fmt::formatter<std::string>
 {
-    auto format(text::font_feature value, format_context& ctx) -> format_context::iterator
+    auto format(text::font_feature value, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("{}{}{}{}{}",
                                                           value.enabled ? '+' : '-',
@@ -489,7 +489,7 @@ struct fmt::formatter<text::font_feature
 template <>
 struct fmt::formatter<text::render_mode>: fmt::formatter<std::string_view>
 {
-    auto format(text::render_mode value, format_context& ctx) -> format_context::iterator
+    auto format(text::render_mode value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
--- a/src/text_shaper/font_locator.h
+++ b/src/text_shaper/font_locator.h
@@ -76,7 +76,7 @@ class font_locator
 template <>
 struct fmt::formatter<text::font_path>: fmt::formatter<std::string>
 {
-    auto format(text::font_path spec, format_context& ctx) -> format_context::iterator
+    auto format(text::font_path spec, format_context& ctx) const -> format_context::iterator
     {
         auto weightMod = spec.weight ? fmt::format(" {}", spec.weight.value()) : "";
         auto slantMod = spec.slant ? fmt::format(" {}", spec.slant.value()) : "";
@@ -88,7 +88,7 @@ struct fmt::formatter<text::font_path>:
 template <>
 struct fmt::formatter<text::font_memory_ref>: fmt::formatter<std::string>
 {
-    auto format(text::font_memory_ref ref, format_context& ctx) -> format_context::iterator
+    auto format(text::font_memory_ref ref, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("in-memory: {}", ref.identifier), ctx);
     }
@@ -97,7 +97,7 @@ struct fmt::formatter<text::font_memory_
 template <>
 struct fmt::formatter<text::font_source>: fmt::formatter<std::string>
 {
-    auto format(text::font_source source, format_context& ctx) -> format_context::iterator
+    auto format(text::font_source source, format_context& ctx) const -> format_context::iterator
     {
         std::string text;
         if (std::holds_alternative<text::font_path>(source))
--- a/src/text_shaper/shaper.h
+++ b/src/text_shaper/shaper.h
@@ -159,7 +159,7 @@ class shaper
 template <>
 struct fmt::formatter<text::bitmap_format>: fmt::formatter<std::string_view>
 {
-    auto format(text::bitmap_format value, format_context& ctx) -> format_context::iterator
+    auto format(text::bitmap_format value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -175,7 +175,7 @@ struct fmt::formatter<text::bitmap_forma
 template <>
 struct fmt::formatter<text::glyph_position>: fmt::formatter<std::string>
 {
-    auto format(text::glyph_position const& gpos, format_context& ctx) -> format_context::iterator
+    auto format(text::glyph_position const& gpos, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("({}+{}+{}|{}+{})",
                                                           gpos.glyph.index.value,
@@ -190,7 +190,7 @@ struct fmt::formatter<text::glyph_positi
 template <>
 struct fmt::formatter<text::rasterized_glyph>: fmt::formatter<std::string>
 {
-    auto format(text::rasterized_glyph const& glyph, format_context& ctx) -> format_context::iterator
+    auto format(text::rasterized_glyph const& glyph, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("rasterized_glyph({}, {}+{}, {})",
                                                           glyph.index.value,
--- a/src/vtbackend/Capabilities.h
+++ b/src/vtbackend/Capabilities.h
@@ -107,7 +107,7 @@ class StaticDatabase: public Database
 template <>
 struct fmt::formatter<vtbackend::capabilities::Code>: fmt::formatter<std::string>
 {
-    auto format(vtbackend::capabilities::Code value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::capabilities::Code value, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(value.hex(), ctx);
     }
--- a/src/vtbackend/CellFlags.h
+++ b/src/vtbackend/CellFlags.h
@@ -42,7 +42,7 @@ using CellFlags = crispy::flags<CellFlag
 template <>
 struct fmt::formatter<vtbackend::CellFlag>: fmt::formatter<std::string_view>
 {
-    auto format(const vtbackend::CellFlag value, format_context& ctx) -> format_context::iterator
+    auto format(const vtbackend::CellFlag value, format_context& ctx) const -> format_context::iterator
     {
         string_view s;
 
--- a/src/vtbackend/Color.h
+++ b/src/vtbackend/Color.h
@@ -401,7 +401,7 @@ constexpr Opacity& operator--(Opacity& v
 template <>
 struct fmt::formatter<vtbackend::Color>: fmt::formatter<std::string>
 {
-    auto format(vtbackend::Color value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::Color value, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(to_string(value), ctx);
     }
@@ -410,7 +410,7 @@ struct fmt::formatter<vtbackend::Color>:
 template <>
 struct fmt::formatter<vtbackend::RGBColor>: fmt::formatter<std::string>
 {
-    auto format(vtbackend::RGBColor value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::RGBColor value, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(to_string(value), ctx);
     }
@@ -420,7 +420,7 @@ template <>
 struct fmt::formatter<vtbackend::RGBAColor>: fmt::formatter<std::string>
 {
     template <typename FormatContext>
-    auto format(vtbackend::RGBAColor value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::RGBAColor value, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(to_string(value), ctx);
     }
@@ -429,7 +429,7 @@ struct fmt::formatter<vtbackend::RGBACol
 template <>
 struct fmt::formatter<vtbackend::CellRGBColor>: fmt::formatter<std::string>
 {
-    auto format(vtbackend::CellRGBColor value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::CellRGBColor value, format_context& ctx) const -> format_context::iterator
     {
         if (std::holds_alternative<vtbackend::CellForegroundColor>(value))
             return formatter<std::string>::format("CellForeground", ctx);
@@ -443,7 +443,7 @@ struct fmt::formatter<vtbackend::CellRGB
 template <>
 struct fmt::formatter<vtbackend::RGBColorPair>: fmt::formatter<std::string>
 {
-    auto format(vtbackend::RGBColorPair value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::RGBColorPair value, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("{}/{}", value.foreground, value.background), ctx);
     }
--- a/src/vtbackend/ColorPalette.h
+++ b/src/vtbackend/ColorPalette.h
@@ -151,7 +151,7 @@ RGBColor apply(ColorPalette const& color
 template <>
 struct fmt::formatter<vtbackend::ColorPreference>: fmt::formatter<std::string_view>
 {
-    auto format(vtbackend::ColorPreference value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::ColorPreference value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -166,7 +166,7 @@ struct fmt::formatter<vtbackend::ColorPr
 template <>
 struct fmt::formatter<vtbackend::ColorMode>: fmt::formatter<std::string_view>
 {
-    auto format(vtbackend::ColorMode value, fmt::format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::ColorMode value, fmt::format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -182,7 +182,7 @@ struct fmt::formatter<vtbackend::ColorMo
 template <>
 struct fmt::formatter<vtbackend::ColorTarget>: fmt::formatter<std::string_view>
 {
-    auto format(vtbackend::ColorTarget value, fmt::format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::ColorTarget value, fmt::format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
--- a/src/vtbackend/Functions.h
+++ b/src/vtbackend/Functions.h
@@ -932,7 +932,7 @@ struct std::hash<vtbackend::FunctionDefi
 template <>
 struct fmt::formatter<vtbackend::FunctionCategory>: fmt::formatter<std::string_view>
 {
-    auto format(const vtbackend::FunctionCategory value, format_context& ctx) -> format_context::iterator
+    auto format(const vtbackend::FunctionCategory value, format_context& ctx) const -> format_context::iterator
     {
         using vtbackend::FunctionCategory;
         string_view name;
@@ -966,7 +966,7 @@ struct fmt::formatter<vtbackend::Functio
 template <>
 struct fmt::formatter<vtbackend::FunctionDefinition>: fmt::formatter<std::string>
 {
-    auto format(const vtbackend::FunctionDefinition f, format_context& ctx) -> format_context::iterator
+    auto format(const vtbackend::FunctionDefinition f, format_context& ctx) const -> format_context::iterator
     {
         std::string value;
         switch (f.category)
@@ -1016,7 +1016,7 @@ struct fmt::formatter<vtbackend::Functio
 template <>
 struct fmt::formatter<vtbackend::FunctionSelector>: fmt::formatter<std::string>
 {
-    auto format(const vtbackend::FunctionSelector f, format_context& ctx) -> format_context::iterator
+    auto format(const vtbackend::FunctionSelector f, format_context& ctx) const -> format_context::iterator
     {
         std::string value;
         // clang-format off
--- a/src/vtbackend/Grid.h
+++ b/src/vtbackend/Grid.h
@@ -907,7 +907,7 @@ template <typename RendererT>
 template <>
 struct fmt::formatter<vtbackend::Margin::Horizontal>: fmt::formatter<std::string>
 {
-    auto format(const vtbackend::Margin::Horizontal range, format_context& ctx) -> format_context::iterator
+    auto format(const vtbackend::Margin::Horizontal range, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("{}..{}", range.from, range.to), ctx);
     }
@@ -916,7 +916,7 @@ struct fmt::formatter<vtbackend::Margin:
 template <>
 struct fmt::formatter<vtbackend::Margin::Vertical>: fmt::formatter<std::string>
 {
-    auto format(const vtbackend::Margin::Vertical range, format_context& ctx) -> format_context::iterator
+    auto format(const vtbackend::Margin::Vertical range, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("{}..{}", range.from, range.to), ctx);
     }
--- a/src/vtbackend/Image.h
+++ b/src/vtbackend/Image.h
@@ -263,7 +263,7 @@ class ImagePool
 template <>
 struct fmt::formatter<vtbackend::ImageFormat>: formatter<std::string_view>
 {
-    auto format(vtbackend::ImageFormat value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::ImageFormat value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -278,7 +278,7 @@ struct fmt::formatter<vtbackend::ImageFo
 template <>
 struct fmt::formatter<vtbackend::ImageStats>: formatter<std::string>
 {
-    auto format(vtbackend::ImageStats stats, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::ImageStats stats, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(
             fmt::format(
@@ -290,7 +290,7 @@ struct fmt::formatter<vtbackend::ImageSt
 template <>
 struct fmt::formatter<std::shared_ptr<vtbackend::Image const>>: fmt::formatter<std::string>
 {
-    auto format(std::shared_ptr<vtbackend::Image const> const& image, format_context& ctx)
+    auto format(std::shared_ptr<vtbackend::Image const> const& image, format_context& ctx) const
         -> format_context::iterator
     {
         std::string text;
@@ -311,7 +311,7 @@ struct fmt::formatter<std::shared_ptr<vt
 template <>
 struct fmt::formatter<vtbackend::ImageResize>: formatter<std::string_view>
 {
-    auto format(vtbackend::ImageResize value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::ImageResize value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -328,7 +328,7 @@ struct fmt::formatter<vtbackend::ImageRe
 template <>
 struct fmt::formatter<vtbackend::ImageAlignment>: formatter<std::string_view>
 {
-    auto format(vtbackend::ImageAlignment value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::ImageAlignment value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -350,7 +350,7 @@ struct fmt::formatter<vtbackend::ImageAl
 template <>
 struct fmt::formatter<vtbackend::RasterizedImage>: formatter<std::string>
 {
-    auto format(vtbackend::RasterizedImage const& image, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::RasterizedImage const& image, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("RasterizedImage<{}, {}, {}, {}, {}>",
                                                           image.weak_from_this().use_count(),
@@ -365,7 +365,7 @@ struct fmt::formatter<vtbackend::Rasteri
 template <>
 struct fmt::formatter<vtbackend::ImageFragment>: fmt::formatter<std::string>
 {
-    auto format(const vtbackend::ImageFragment& fragment, format_context& ctx) -> format_context::iterator
+    auto format(const vtbackend::ImageFragment& fragment, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(
             fmt::format("ImageFragment<offset={}, {}>", fragment.offset(), fragment.rasterizedImage()), ctx);
--- a/src/vtbackend/InputGenerator.h
+++ b/src/vtbackend/InputGenerator.h
@@ -554,7 +554,7 @@ inline std::string to_string(InputGenera
 template <>
 struct fmt::formatter<vtbackend::KeyboardEventType>: formatter<std::string_view>
 {
-    auto format(vtbackend::KeyboardEventType value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::KeyboardEventType value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -570,7 +570,7 @@ struct fmt::formatter<vtbackend::Keyboar
 template <>
 struct fmt::formatter<vtbackend::KeyboardEventFlag>: formatter<std::string_view>
 {
-    auto format(vtbackend::KeyboardEventFlag value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::KeyboardEventFlag value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -591,7 +591,7 @@ struct fmt::formatter<vtbackend::Keyboar
 template <>
 struct fmt::formatter<vtbackend::MouseProtocol>: formatter<std::string_view>
 {
-    auto format(vtbackend::MouseProtocol value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::MouseProtocol value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -609,7 +609,7 @@ struct fmt::formatter<vtbackend::MousePr
 template <>
 struct fmt::formatter<vtbackend::Modifier>: formatter<std::string_view>
 {
-    auto format(vtbackend::Modifier value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::Modifier value, format_context& ctx) const -> format_context::iterator
     {
         std::string_view name;
         switch (value)
@@ -631,7 +631,7 @@ struct fmt::formatter<vtbackend::Modifie
 template <>
 struct fmt::formatter<vtbackend::InputGenerator::MouseWheelMode>: formatter<std::string_view>
 {
-    auto format(vtbackend::InputGenerator::MouseWheelMode value, format_context& ctx)
+    auto format(vtbackend::InputGenerator::MouseWheelMode value, format_context& ctx) const
         -> format_context::iterator
     {
         string_view name;
@@ -652,7 +652,7 @@ struct fmt::formatter<vtbackend::InputGe
 template <>
 struct fmt::formatter<vtbackend::KeyMode>: public formatter<std::string_view>
 {
-    auto format(vtbackend::KeyMode value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::KeyMode value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -667,7 +667,7 @@ struct fmt::formatter<vtbackend::KeyMode
 template <>
 struct fmt::formatter<vtbackend::MouseButton>: formatter<std::string_view>
 {
-    auto format(vtbackend::MouseButton value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::MouseButton value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -688,7 +688,7 @@ struct fmt::formatter<vtbackend::MouseBu
 template <>
 struct fmt::formatter<vtbackend::MouseTransport>: formatter<std::string_view>
 {
-    auto format(vtbackend::MouseTransport value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::MouseTransport value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -706,7 +706,7 @@ struct fmt::formatter<vtbackend::MouseTr
 template <>
 struct fmt::formatter<vtbackend::Key>: formatter<std::string_view>
 {
-    auto format(vtbackend::Key value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::Key value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
--- a/src/vtbackend/Logger.h
+++ b/src/vtbackend/Logger.h
@@ -63,7 +63,7 @@ template <>
 struct fmt::formatter<vtbackend::LogEvent>
 {
     static auto parse(format_parse_context& ctx) -> format_parse_context::iterator { return ctx.begin(); }
-    static auto format(const vtbackend::LogEvent& ev, format_context& ctx) -> format_context::iterator
+    static auto format(const vtbackend::LogEvent& ev, format_context& ctx) const -> format_context::iterator
     {
         using namespace vtbackend;
         return std::visit(
--- a/src/vtbackend/MatchModes.h
+++ b/src/vtbackend/MatchModes.h
@@ -110,7 +110,7 @@ constexpr bool operator!=(MatchModes a,
 template <>
 struct fmt::formatter<vtbackend::MatchModes>: formatter<std::string>
 {
-    auto format(vtbackend::MatchModes m, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::MatchModes m, format_context& ctx) const -> format_context::iterator
     {
         std::string s;
         auto const advance = [&](vtbackend::MatchModes::Flag cond, std::string_view text) {
--- a/src/vtbackend/Selector.h
+++ b/src/vtbackend/Selector.h
@@ -186,7 +186,7 @@ template <>
 struct fmt::formatter<vtbackend::Selection::State>: formatter<std::string_view>
 {
     using State = vtbackend::Selection::State;
-    auto format(State state, format_context& ctx) -> format_context::iterator
+    auto format(State state, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (state)
@@ -202,7 +202,7 @@ struct fmt::formatter<vtbackend::Selecti
 template <>
 struct fmt::formatter<vtbackend::Selection>: formatter<std::string>
 {
-    auto format(const vtbackend::Selection& selector, format_context& ctx) -> format_context::iterator
+    auto format(const vtbackend::Selection& selector, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(
             fmt::format("{}({} from {} to {})",
--- a/src/vtbackend/Sequencer.h
+++ b/src/vtbackend/Sequencer.h
@@ -202,7 +202,7 @@ inline void Sequencer::paramSubSeparator
 template <>
 struct fmt::formatter<vtbackend::RequestStatusString>: formatter<std::string_view>
 {
-    auto format(vtbackend::RequestStatusString value, format_context& ctx) noexcept
+    auto format(vtbackend::RequestStatusString value, format_context& ctx) const noexcept
         -> format_context::iterator
     {
         string_view name;
@@ -233,7 +233,7 @@ struct fmt::formatter<vtbackend::Sequenc
         return ctx.begin();
     }
     template <typename FormatContext>
-    auto format(vtbackend::Sequence const& seq, FormatContext& ctx)
+    auto format(vtbackend::Sequence const& seq, FormatContext& ctx) const
     {
         return fmt::format_to(ctx.out(), "{}", seq.text());
     }
--- a/src/vtbackend/Terminal.h
+++ b/src/vtbackend/Terminal.h
@@ -885,7 +885,7 @@ class Terminal
 template <>
 struct fmt::formatter<vtbackend::TraceHandler::PendingSequence>: fmt::formatter<std::string>
 {
-    auto format(vtbackend::TraceHandler::PendingSequence const& pendingSequence, format_context& ctx)
+    auto format(vtbackend::TraceHandler::PendingSequence const& pendingSequence, format_context& ctx) const
         -> format_context::iterator
     {
         std::string value;
--- a/src/vtbackend/TerminalState.h
+++ b/src/vtbackend/TerminalState.h
@@ -254,7 +254,7 @@ struct TerminalState
 template <>
 struct fmt::formatter<vtbackend::AnsiMode>: fmt::formatter<std::string>
 {
-    auto format(vtbackend::AnsiMode mode, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::AnsiMode mode, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(to_string(mode), ctx);
     }
@@ -263,7 +263,7 @@ struct fmt::formatter<vtbackend::AnsiMod
 template <>
 struct fmt::formatter<vtbackend::DECMode>: fmt::formatter<std::string>
 {
-    auto format(vtbackend::DECMode mode, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::DECMode mode, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(to_string(mode), ctx);
     }
@@ -272,7 +272,7 @@ struct fmt::formatter<vtbackend::DECMode
 template <>
 struct fmt::formatter<vtbackend::Cursor>: fmt::formatter<vtbackend::CellLocation>
 {
-    auto format(const vtbackend::Cursor cursor, format_context& ctx) -> format_context::iterator
+    auto format(const vtbackend::Cursor cursor, format_context& ctx) const -> format_context::iterator
     {
         return formatter<vtbackend::CellLocation>::format(cursor.position, ctx);
     }
@@ -282,7 +282,7 @@ template <>
 struct fmt::formatter<vtbackend::DynamicColorName>: formatter<std::string_view>
 {
     template <typename FormatContext>
-    auto format(vtbackend::DynamicColorName value, FormatContext& ctx)
+    auto format(vtbackend::DynamicColorName value, FormatContext& ctx) const
     {
         using vtbackend::DynamicColorName;
         string_view name;
@@ -303,7 +303,7 @@ struct fmt::formatter<vtbackend::Dynamic
 template <>
 struct fmt::formatter<vtbackend::ExecutionMode>: formatter<std::string_view>
 {
-    auto format(vtbackend::ExecutionMode value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::ExecutionMode value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
--- a/src/vtbackend/VTType.h
+++ b/src/vtbackend/VTType.h
@@ -82,7 +82,7 @@ std::string to_params(DeviceAttributes v
 template <>
 struct fmt::formatter<vtbackend::VTType>: fmt::formatter<std::string_view>
 {
-    auto format(const vtbackend::VTType id, format_context& ctx) -> format_context::iterator
+    auto format(const vtbackend::VTType id, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (id)
@@ -104,7 +104,7 @@ struct fmt::formatter<vtbackend::VTType>
 template <>
 struct fmt::formatter<vtbackend::VTExtension>: fmt::formatter<std::string_view>
 {
-    auto format(const vtbackend::VTExtension id, format_context& ctx) -> format_context::iterator
+    auto format(const vtbackend::VTExtension id, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (id)
--- a/src/vtbackend/ViInputHandler.h
+++ b/src/vtbackend/ViInputHandler.h
@@ -260,7 +260,7 @@ class ViInputHandler: public InputHandle
 template <>
 struct fmt::formatter<vtbackend::TextObjectScope>: formatter<std::string_view>
 {
-    auto format(vtbackend::TextObjectScope scope, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::TextObjectScope scope, format_context& ctx) const -> format_context::iterator
     {
         using TextObjectScope = vtbackend::TextObjectScope;
         string_view name;
@@ -276,7 +276,7 @@ struct fmt::formatter<vtbackend::TextObj
 template <>
 struct fmt::formatter<vtbackend::TextObject>: formatter<std::string_view>
 {
-    auto format(vtbackend::TextObject textObject, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::TextObject textObject, format_context& ctx) const -> format_context::iterator
     {
         using TextObject = vtbackend::TextObject;
         string_view name;
@@ -301,7 +301,7 @@ struct fmt::formatter<vtbackend::TextObj
 template <>
 struct fmt::formatter<vtbackend::ViOperator>: formatter<std::string_view>
 {
-    auto format(vtbackend::ViOperator op, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::ViOperator op, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         using vtbackend::ViOperator;
@@ -321,7 +321,7 @@ struct fmt::formatter<vtbackend::ViOpera
 template <>
 struct fmt::formatter<vtbackend::ViMotion>: formatter<std::string_view>
 {
-    auto format(vtbackend::ViMotion motion, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::ViMotion motion, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         using vtbackend::ViMotion;
--- a/src/vtbackend/cell/CompactCell.h
+++ b/src/vtbackend/cell/CompactCell.h
@@ -480,7 +480,7 @@ inline bool beginsWith(std::u32string_vi
 template <>
 struct fmt::formatter<vtbackend::CompactCell>: fmt::formatter<std::string>
 {
-    auto format(vtbackend::CompactCell const& cell, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::CompactCell const& cell, format_context& ctx) const -> format_context::iterator
     {
         std::string codepoints;
         for (auto const i: crispy::times(cell.codepointCount()))
--- a/src/vtbackend/primitives.h
+++ b/src/vtbackend/primitives.h
@@ -873,7 +873,7 @@ struct numeric_limits<vtbackend::CursorS
 template <>
 struct fmt::formatter<vtbackend::CursorShape>: formatter<std::string_view>
 {
-    auto format(vtbackend::CursorShape value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::CursorShape value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -890,7 +890,7 @@ struct fmt::formatter<vtbackend::CursorS
 template <>
 struct fmt::formatter<vtbackend::CellLocation>: formatter<std::string>
 {
-    auto format(vtbackend::CellLocation coord, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::CellLocation coord, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("({}, {})", coord.line, coord.column), ctx);
     }
@@ -899,7 +899,7 @@ struct fmt::formatter<vtbackend::CellLoc
 template <>
 struct fmt::formatter<vtbackend::PageSize>: formatter<std::string>
 {
-    auto format(vtbackend::PageSize value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::PageSize value, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("{}x{}", value.columns, value.lines), ctx);
     }
@@ -908,7 +908,7 @@ struct fmt::formatter<vtbackend::PageSiz
 template <>
 struct fmt::formatter<vtbackend::GridSize>: formatter<std::string>
 {
-    auto format(vtbackend::GridSize value, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::GridSize value, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("{}x{}", value.columns, value.lines), ctx);
     }
@@ -917,7 +917,7 @@ struct fmt::formatter<vtbackend::GridSiz
 template <>
 struct fmt::formatter<vtbackend::ScreenType>: formatter<std::string_view>
 {
-    auto format(const vtbackend::ScreenType value, format_context& ctx) -> format_context::iterator
+    auto format(const vtbackend::ScreenType value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -932,7 +932,7 @@ struct fmt::formatter<vtbackend::ScreenT
 template <>
 struct fmt::formatter<vtbackend::PixelCoordinate>: formatter<std::string>
 {
-    auto format(const vtbackend::PixelCoordinate coord, format_context& ctx) -> format_context::iterator
+    auto format(const vtbackend::PixelCoordinate coord, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("{}:{}", coord.x.value, coord.y.value), ctx);
     }
@@ -941,7 +941,7 @@ struct fmt::formatter<vtbackend::PixelCo
 template <>
 struct fmt::formatter<vtbackend::ViMode>: formatter<std::string_view>
 {
-    auto format(vtbackend::ViMode mode, format_context& ctx) -> format_context::iterator
+    auto format(vtbackend::ViMode mode, format_context& ctx) const -> format_context::iterator
     {
         using vtbackend::ViMode;
         string_view name;
--- a/src/vtparser/Parser.h
+++ b/src/vtparser/Parser.h
@@ -467,7 +467,7 @@ struct numeric_limits<vtparser::Action>
 template <>
 struct fmt::formatter<vtparser::State>: formatter<std::string_view>
 {
-    auto format(vtparser::State state, format_context& ctx) -> format_context::iterator
+    auto format(vtparser::State state, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string_view>::format(vtparser::to_string(state), ctx);
     }
@@ -476,7 +476,7 @@ struct fmt::formatter<vtparser::State>:
 template <>
 struct fmt::formatter<vtparser::ActionClass>: formatter<std::string_view>
 {
-    auto format(vtparser::ActionClass value, format_context& ctx) -> format_context::iterator
+    auto format(vtparser::ActionClass value, format_context& ctx) const -> format_context::iterator
     {
         auto constexpr Mappings = std::array<std::string_view, 4> { "Enter", "Event", "Leave", "Transition" };
         return formatter<std::string_view>::format(Mappings.at(static_cast<unsigned>(value)), ctx);
@@ -486,7 +486,7 @@ struct fmt::formatter<vtparser::ActionCl
 template <>
 struct fmt::formatter<vtparser::Action>: formatter<std::string_view>
 {
-    auto format(vtparser::Action value, format_context& ctx) -> format_context::iterator
+    auto format(vtparser::Action value, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string_view>::format(vtparser::to_string(value), ctx);
     }
--- a/src/vtpty/ImageSize.h
+++ b/src/vtpty/ImageSize.h
@@ -81,7 +81,7 @@ inline ImageSize operator*(ImageSize a,
 template <>
 struct fmt::formatter<vtpty::ImageSize>: fmt::formatter<std::string>
 {
-    auto format(vtpty::ImageSize value, format_context& ctx) -> format_context::iterator
+    auto format(vtpty::ImageSize value, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("{}x{}", value.width, value.height), ctx);
     }
--- a/src/vtpty/Process.h
+++ b/src/vtpty/Process.h
@@ -112,7 +112,7 @@ class [[nodiscard]] Process: public Pty
 template <>
 struct fmt::formatter<vtpty::Process::ExitStatus>: fmt::formatter<std::string>
 {
-    auto format(vtpty::Process::ExitStatus const& status, format_context& ctx) -> format_context::iterator
+    auto format(vtpty::Process::ExitStatus const& status, format_context& ctx) const -> format_context::iterator
     {
         auto const text =
             std::visit(overloaded { [&](vtpty::Process::NormalExit exit) {
--- a/src/vtpty/SshSession.h
+++ b/src/vtpty/SshSession.h
@@ -161,7 +161,7 @@ class SshSession final: public Pty
 template <>
 struct fmt::formatter<vtpty::SshSession::State>: fmt::formatter<std::string_view>
 {
-    auto format(vtpty::SshSession::State const& state, format_context& ctx) -> format_context::iterator
+    auto format(vtpty::SshSession::State const& state, format_context& ctx) const -> format_context::iterator
     {
         std::string_view name;
         // clang-format off
@@ -198,7 +198,7 @@ struct fmt::formatter<vtpty::SshSession:
 template <>
 struct fmt::formatter<vtpty::SshSession::ExitStatus>: fmt::formatter<std::string>
 {
-    auto format(vtpty::SshSession::ExitStatus const& status, format_context& ctx) -> format_context::iterator
+    auto format(vtpty::SshSession::ExitStatus const& status, format_context& ctx) const -> format_context::iterator
     {
         return std::visit(overloaded { [&](vtpty::SshSession::NormalExit exit) {
                                           return fmt::formatter<std::string>::format(
--- a/src/vtrasterizer/Decorator.h
+++ b/src/vtrasterizer/Decorator.h
@@ -82,7 +82,7 @@ struct std::numeric_limits<vtrasterizer:
 template <>
 struct fmt::formatter<vtrasterizer::Decorator>: formatter<std::string_view>
 {
-    auto format(vtrasterizer::Decorator value, format_context& ctx) -> format_context::iterator
+    auto format(vtrasterizer::Decorator value, format_context& ctx) const -> format_context::iterator
     {
         auto constexpr Mappings = std::array {
             "underline", "double-underline", "curly-underline", "dotted-underline", "dashed-underline",
--- a/src/vtrasterizer/FontDescriptions.h
+++ b/src/vtrasterizer/FontDescriptions.h
@@ -83,7 +83,7 @@ constexpr bool operator<(TextStyle a, Te
 template <>
 struct fmt::formatter<vtrasterizer::TextStyle>: fmt::formatter<std::string_view>
 {
-    auto format(vtrasterizer::TextStyle value, format_context& ctx) -> format_context::iterator
+    auto format(vtrasterizer::TextStyle value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -101,7 +101,7 @@ struct fmt::formatter<vtrasterizer::Text
 template <>
 struct fmt::formatter<vtrasterizer::FontLocatorEngine>: fmt::formatter<std::string_view>
 {
-    auto format(vtrasterizer::FontLocatorEngine value, format_context& ctx) -> format_context::iterator
+    auto format(vtrasterizer::FontLocatorEngine value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -118,7 +118,7 @@ struct fmt::formatter<vtrasterizer::Font
 template <>
 struct fmt::formatter<vtrasterizer::TextShapingEngine>: fmt::formatter<std::string_view>
 {
-    auto format(vtrasterizer::TextShapingEngine value, format_context& ctx) -> format_context::iterator
+    auto format(vtrasterizer::TextShapingEngine value, format_context& ctx) const -> format_context::iterator
     {
         string_view name;
         switch (value)
@@ -134,7 +134,7 @@ struct fmt::formatter<vtrasterizer::Text
 template <>
 struct fmt::formatter<vtrasterizer::FontDescriptions>: fmt::formatter<std::string>
 {
-    auto format(vtrasterizer::FontDescriptions const& fd, format_context& ctx) -> format_context::iterator
+    auto format(vtrasterizer::FontDescriptions const& fd, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("({}, {}, {}, {}, {}, {}, {}, {})",
                                                           fd.size,
--- a/src/vtrasterizer/GridMetrics.h
+++ b/src/vtrasterizer/GridMetrics.h
@@ -97,7 +97,7 @@ struct GridMetrics
 template <>
 struct fmt::formatter<vtrasterizer::GridMetrics>: formatter<std::string>
 {
-    auto format(vtrasterizer::GridMetrics const& v, fmt::format_context& ctx) -> format_context::iterator
+    auto format(vtrasterizer::GridMetrics const& v, fmt::format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(
             fmt::format(
--- a/src/vtrasterizer/Pixmap.h
+++ b/src/vtrasterizer/Pixmap.h
@@ -301,7 +301,7 @@ Pixmap& Pixmap::segment_bar(int which, M
 template <>
 struct fmt::formatter<vtrasterizer::Arc>: fmt::formatter<string_view>
 {
-    auto format(vtrasterizer::Arc value, format_context& ctx) -> format_context::iterator
+    auto format(vtrasterizer::Arc value, format_context& ctx) const -> format_context::iterator
     {
         using vtrasterizer::Arc;
         string_view name;
--- a/src/vtrasterizer/RenderTarget.h
+++ b/src/vtrasterizer/RenderTarget.h
@@ -221,7 +221,7 @@ inline Renderable::TextureAtlas::TileCre
 template <>
 struct fmt::formatter<vtrasterizer::RenderTileAttributes>: fmt::formatter<std::string>
 {
-    auto format(vtrasterizer::RenderTileAttributes value, format_context& ctx) -> format_context::iterator
+    auto format(vtrasterizer::RenderTileAttributes value, format_context& ctx) const -> format_context::iterator
     {
         return fmt::formatter<std::string>::format(
             fmt::format("tile +{}x +{}y", value.x.value, value.y.value), ctx);
--- a/src/vtrasterizer/TextClusterGrouper_test.cpp
+++ b/src/vtrasterizer/TextClusterGrouper_test.cpp
@@ -92,7 +92,7 @@ template <>
 struct fmt::formatter<TextClusterGroup>: formatter<std::string>
 {
     template <typename FormatContext>
-    auto format(TextClusterGroup const& group, FormatContext& ctx)
+    auto format(TextClusterGroup const& group, FormatContext& ctx) const
     {
         return formatter<std::string>::format(
             fmt::format("TextClusterGroup {{ codepoints: \"{}\", @{}, clusters={}, style: {}, color: {} }}",
@@ -109,7 +109,7 @@ template <>
 struct fmt::formatter<BoxDrawingCell>: formatter<std::string>
 {
     template <typename FormatContext>
-    auto format(BoxDrawingCell const& cell, FormatContext& ctx)
+    auto format(BoxDrawingCell const& cell, FormatContext& ctx) const
     {
         return formatter<std::string>::format(
             fmt::format("BoxDrawingCell {{ position: {}, codepoint: U+{:04X}, color: {} }}",
@@ -124,7 +124,7 @@ template <>
 struct fmt::formatter<Event>: formatter<std::string>
 {
     template <typename FormatContext>
-    auto format(Event const& event, FormatContext& ctx)
+    auto format(Event const& event, FormatContext& ctx) const
     {
         if (std::holds_alternative<TextClusterGroup>(event))
             return formatter<std::string>::format(fmt::format("{}", std::get<TextClusterGroup>(event)), ctx);
--- a/src/vtrasterizer/TextureAtlas.h
+++ b/src/vtrasterizer/TextureAtlas.h
@@ -683,7 +683,7 @@ void TextureAtlas<Metadata>::inspect(std
 template <>
 struct fmt::formatter<vtrasterizer::atlas::Format>: formatter<std::string_view>
 {
-    auto format(vtrasterizer::atlas::Format value, format_context& ctx) -> format_context::iterator
+    auto format(vtrasterizer::atlas::Format value, format_context& ctx) const -> format_context::iterator
     {
         std::string_view name;
         switch (value)
@@ -699,7 +699,7 @@ struct fmt::formatter<vtrasterizer::atla
 template <>
 struct fmt::formatter<vtrasterizer::atlas::TileLocation>: fmt::formatter<std::string>
 {
-    auto format(vtrasterizer::atlas::TileLocation value, format_context& ctx) -> format_context::iterator
+    auto format(vtrasterizer::atlas::TileLocation value, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("Tile {}x+{}y", value.x.value, value.y.value), ctx);
     }
@@ -708,7 +708,7 @@ struct fmt::formatter<vtrasterizer::atla
 template <>
 struct fmt::formatter<vtrasterizer::atlas::RenderTile>: fmt::formatter<std::string>
 {
-    auto format(vtrasterizer::atlas::RenderTile const& value, format_context& ctx) -> format_context::iterator
+    auto format(vtrasterizer::atlas::RenderTile const& value, format_context& ctx) const -> format_context::iterator
     {
         return formatter<std::string>::format(
             fmt::format("RenderTile({}x + {}y, {})", value.x.value, value.y.value, value.tileLocation), ctx);
@@ -718,7 +718,7 @@ struct fmt::formatter<vtrasterizer::atla
 template <>
 struct fmt::formatter<vtrasterizer::atlas::AtlasProperties>: fmt::formatter<std::string>
 {
-    auto format(vtrasterizer::atlas::AtlasProperties const& value, format_context& ctx)
+    auto format(vtrasterizer::atlas::AtlasProperties const& value, format_context& ctx) const
         -> format_context::iterator
     {
         return formatter<std::string>::format(fmt::format("tile size {}, format {}, direct-mapped {}",
--- a/src/vtbackend/Terminal.cpp
+++ b/src/vtbackend/Terminal.cpp
@@ -625,7 +625,9 @@ void Terminal::updateIndicatorStatusLine
         rightString += "  ";
 
     // NB: Cannot use std::chrono::system_clock::now() here, because MSVC can't handle it.
-    rightString += fmt::format("{:%H:%M} ", fmt::localtime(std::time(nullptr)));
+    time_t _time = std::time(nullptr);
+    struct tm _tm = { 0 };
+    rightString += fmt::format("{:%H:%M} ", *localtime_r(&_time, &_tm));
 
     auto const columnsAvailable = _indicatorStatusScreen.pageSize().columns.as<int>()
                                   - _indicatorStatusScreen.cursor().position.column.as<int>();
