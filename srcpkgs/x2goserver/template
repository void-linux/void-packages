# Template file for 'x2goserver'
pkgname=x2goserver
version=4.1.0.3
revision=1
build_style=gnu-makefile
make_build_args="PERL_INSTALLDIRS=vendor"
makedepends="perl perl-ExtUtils-Helpers"
depends="perl-DBI perl-DBD-SQLite perl-Config-Simple perl-Capture-Tiny
 perl-File-BaseDir perl-File-Which perl-Try-Tiny xwininfo setxkbmap dbus
 lsof psmisc pwgen fuse-sshfs xauth desktop-file-utils shared-mime-info
 perl-Switch"
short_desc="OS graphical RD and terminal server based on NX technology"
maintainer="Anachron <gith@cron.world>"
license="GPL-2.0-or-later"
homepage="https://wiki.x2go.org/doku.php/wiki:advanced:x2goserver-in-detail"
distfiles="http://code.x2go.org/releases/source/x2goserver/${pkgname}-${version}.tar.gz"
checksum=6776aaa354f5a44e349f0b3c176d4988c88a618c2edf46c98a37ae89c069dcd0
system_accounts="x2gouser:111 x2goprint:112"
x2gouser_homedir="/var/lib/x2go"
x2goprint_homedir="/var/spool/x2go"
make_dirs="
 ${x2gouser_homedir} 0750 x2gouser
 ${x2goprint_homedir} 0750 x2goprint"

pre_build() {
	for mf in $(find . -type f -name Makefile); do
		sed -i -e 's/^MAN2HTML_BIN.*/MAN2HTML_BIN =/g' $mf
		sed -i -e 's/^SBINDIR.*/SBINDIR=$(PREFIX)\/bin/g' $mf
		sed -i -e 's/^PREFIX.*/PREFIX ?= \/usr/g' $mf
		sed -i "s:-o root -g root ::g" $mf
	done

	sed -i -e '/xsession/s/^/#/' Makefile
}

post_install() {
	vsv "${pkgname}"
}
