# Template file for 'dnsdist'
pkgname=dnsdist
version=2.0.0
revision=1
build_style=meson
build_helper="meson"
configure_args="-Ddnscrypt=enabled -Dreproducible=true -Dsnmp=enabled
 -Dyaml=disabled --sysconfdir=/etc/dnsdist"
conf_files="/etc/dnsdist/dnsdist.conf"
hostmakedepends="cmake pkgconf python3 tar"
makedepends="boost-devel fstrm-devel libcap-devel libedit-devel libsodium-devel
 lmdb-devel lua54-devel net-snmp-devel nghttp2-devel openssl-devel re2-devel"
short_desc="Dynamic DNS loadbalancer"
maintainer="JailBird <jailbird@fdf.net>"
license="GPL-2.0-only"
homepage="https://dnsdist.org/"
changelog="https://dnsdist.org/changelog.html"
distfiles="https://downloads.powerdns.com/releases/${pkgname}-${version}.tar.xz"
checksum=da30742f51aac8be7e116677cb07bc49fbea979fc5443e7e1fa8fa7bd0a63fe5

system_accounts="_dnsdist"

# (y2k38) This can be removed once musl is updated to 1.2.x
if [ "$XBPS_TARGET_LIBC" = "musl" ] && [ "$XBPS_TARGET_WORDSIZE" = "32" ]; then
	broken="no y2038 support"
fi

post_install() {
	vinstall dnsdist.conf-dist 644 etc/dnsdist dnsdist.conf
	vsv dnsdist
}
