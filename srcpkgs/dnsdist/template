# Template file for 'dnsdist'
pkgname=dnsdist
version=2.0.2
revision=1
build_style=meson
build_helper="meson"
configure_args="-Ddnscrypt=enabled -Dreproducible=true -Dsnmp=enabled
 -Dyaml=disabled --sysconfdir=/etc/dnsdist"
conf_files="/etc/dnsdist/dnsdist.conf"
hostmakedepends="cmake pkg-config python3 python3-yaml tar"
makedepends="boost-devel fstrm-devel libcap-devel libedit-devel
 libsodium-devel lua54-devel net-snmp-devel nghttp2-devel openssl-devel
 re2-devel"
short_desc="Dynamic DNS loadbalancer"
maintainer="JailBird <jailbird@fdf.net>"
license="GPL-2.0-only"
homepage="https://dnsdist.org/"
changelog="https://dnsdist.org/changelog.html"
distfiles="https://downloads.powerdns.com/releases/${pkgname}-${version}.tar.xz"
checksum=3374eba65a5ca3cfb9fc59791c47e5035149fe521ccbbced5f834a17f45641bf

system_accounts="_dnsdist"

# (y2k38) This can be removed once musl is updated to 1.2.x
if [ "$XBPS_TARGET_LIBC" = "musl" ] && [ "$XBPS_TARGET_WORDSIZE" = "32" ]; then
	broken="no y2038 support"
fi

post_install() {
	vinstall dnsdist.conf-dist 644 etc/dnsdist dnsdist.conf
	vsv dnsdist
}
