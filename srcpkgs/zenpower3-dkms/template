# Template file for 'zenpower3-dkms'
pkgname=zenpower3-dkms
_pkgname=${pkgname%-*}
version=0.2.0
revision=1
archs="x86_64*"
wrksrc="${_pkgname}-${version}"
depends="dkms"
short_desc="Linux kernel driver for reading sensors for AMD Zen family CPUs (DKMS)"
maintainer="Anton Afanasyev <anton@doubleasoftware.com>"
license="GPL-2.0-only"
homepage="https://github.com/Ta180m/zenpower3"
distfiles="https://github.com/Ta180m/zenpower3/archive/v${version}.tar.gz"
checksum=b206c1dfd8ea742a802126d012404d31ae62f2a23ae4723ea1c0f9f54581f6a3
dkms_modules="${_pkgname} ${version}"

do_install() {
	vmkdir /usr/src/${_pkgname}-${version}
	vcopy "./*" usr/src/${_pkgname}-${version}
	vsed -i -e 's/@CFLGS@//' \
		-e 's/@VERSION@/${version}-${revision}/' \
		"${PKGDESTDIR}/usr/src/${_pkgname}-${version}/dkms.conf"

	# modules-load.d(5) file.
	vmkdir usr/lib/modules-load.d
	echo "${_pkgname}" > ${DESTDIR}/usr/lib/modules-load.d/${_pkgname}.conf
	chmod 644 ${DESTDIR}/usr/lib/modules-load.d/${_pkgname}.conf
}
