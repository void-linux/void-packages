#!/bin/sh -e
. /etc/default/k0s-worker
case ${K0S_CRI_SOCKET} in
	remote:*)
		sv check containerd
		;;
	docker:*)
		sv check docker
		;;
esac

exec k0s -c "/etc/k0s/k0s.conf" worker \
	${K0S_CRI_SOCKET:+--cri-socket="$K0S_CRI_SOCKET"} \
	${K0S_ENABLE_CLOUD_PROVIDER:+--enable-cloud-provider} \
	${K0S_PROFILE:+--profile="$K0S_PROFILE"} \
	--token-file=${K0S_TOKEN_FILE:-/etc/k0s/worker.token}
