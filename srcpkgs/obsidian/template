pkgname=obsidian
version=1.11.5
revision=1
archs="x86_64"
short_desc="Powerful knowledge base that works on top of a local folder of Markdown files"
maintainer="OverLessArtem <artemover@duck.com>"
license="custom: Proprietary license"
repository=nonfree
restricted=yes
homepage="https://obsidian.md/"
distfiles="https://github.com/obsidianmd/obsidian-releases/releases/download/v${version}/obsidian_${version}_amd64.deb"
checksum=1842b343f33c1dfebd05397d54c0c55bf1c7b6a54ef72663b100df3eb67e67e9
hostmakedepends="binutils tar xz"
depends="gtk+3 nss libXScrnSaver libXtst xdg-utils alsa-lib libgbm libnotify libsecret at-spi2-core"

do_extract() {
	ar x ${XBPS_SRCDISTDIR}/${pkgname}-${version}/obsidian_${version}_amd64.deb
	mkdir -p ${wrksrc}
	tar xf data.tar.xz -C ${wrksrc}
}

do_install() {
	vmkdir opt
	vcopy opt/Obsidian opt
	vcopy usr/share /usr
	vmkdir usr/bin
	ln -sf /opt/Obsidian/obsidian ${DESTDIR}/usr/bin/obsidian
	if [ -f ${DESTDIR}/opt/Obsidian/chrome-sandbox ]; then
		chmod 4755 ${DESTDIR}/opt/Obsidian/chrome-sandbox
	fi
	vlicense opt/Obsidian/LICENSE.electron.txt
	vlicense opt/Obsidian/LICENSES.chromium.html
}
