# Template file for 'obsidian'
pkgname=obsidian
version=0.11.13
revision=1
archs="x86_64"
wrksrc="obsidian-${version}"
short_desc="Chat and VOIP application"
maintainer="Hugo Melder <contact@nuntius.dev>"
license="custom:Proprietary"
homepage="https://obsidian.md"
distfiles="https://github.com/obsidianmd/obsidian-releases/releases/download/v${version}/obsidian-${version}.tar.gz"
checksum=d102f5acfdfba6674874633d7876bb3df5b5195aef9f67d7e1b40fa90f053a92
repository=nonfree
restricted=yes
nopie=yes

do_install() {
	local package_location="usr/lib/$pkgname" item
	vmkdir usr/share
	vcopy $FILESDIR/icons /usr/share
	vmkdir usr/share/applications
	vcopy $FILESDIR/obsidian.desktop /usr/share/applications/
	vmkdir ${package_location}
	chmod +x obsidian
	for item in locales resources obsidian libffmpeg.so snapshot_blob.bin \
	icudtl.dat libEGL.so libGLESv2.so chrome_100_percent.pak chrome_200_percent.pak \
	chrome-sandbox resources.pak swiftshader v8_context_snapshot.bin \
	libvk_swiftshader.so libvulkan.so; do
		vcopy "${item}" "${package_location}"
	done
	vmkdir usr/bin
	ln -sfr $DESTDIR/${package_location}/obsidian $DESTDIR/usr/bin/obsidian
}
post_install() {
	vlicense $FILESDIR/LICENSE
}
