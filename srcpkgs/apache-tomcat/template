# Template file for 'apache-tomcat'
pkgname=apache-tomcat
version=9.0.10
revision=1
wrksrc=${pkgname}-${version}-src
hostmakedepends="openjdk apache-ant"
depends="virtual?java-runtime"
make_dirs="/usr/share/${pkgname}/webapps 0755 tomcat tomcat \
 /usr/share/${pkgname}/conf 0755 tomcat tomcat \
 /usr/share/${pkgname}/logs 0755 tomcat tomcat \
 /usr/share/${pkgname}/temp 0755 tomcat tomcat"
system_accounts="tomcat"
short_desc="An open source implementation of the Java Servlet"
maintainer="Michael Aldridge <maldridge@VoidLinux.eu>"
license="Apache-2.0"
homepage="https://tomcat.apache.org"
distfiles="http://mirrors.gigenet.com/apache/tomcat/tomcat-9/v$version/src/$pkgname-$version-src.tar.gz"
checksum=5d6a2ff9715c1624d9e99e0b02e1811d2772a3291c8641269cfc0884d5942c34

do_build() {
	ant
}

post_build() {
	rm output/build/bin/*.bat
	rm output/build/bin/{startup.sh,shutdown.sh}
}

do_install() {
	vlicense LICENSE
	mkdir -p ${DESTDIR}/usr/share/${pkgname}
	cp -r output/build/* ${DESTDIR}/usr/share/${pkgname}

	vsv apache-tomcat
}

post_install() {
	rm -r ${DESTDIR}/usr/share/${pkgname}/webapps/ROOT
}

apache-tomcat-doc_package() {
	short_desc+=" - Documentation"
	depends="${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove usr/share/${sourcepkg}/webapps/docs
	}
}

apache-tomcat-examples_package() {
	short_desc+=" - Examples"
	depends="${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove usr/share/${sourcepkg}/webapps/examples
	}
}

apache-tomcat-manager_package() {
	short_desc+=" - Manager"
	depends="${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove usr/share/${sourcepkg}/webapps/manager
	}
}

apache-tomcat-host-manager_package() {
	short_desc+=" - Host Manager"
	depends="${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove usr/share/${sourcepkg}/webapps/host-manager
	}
}
