# Template file for 'libndi'
pkgname=libndi
version=6.2.1.0
revision=1
archs="x86_64 i686 aarch64"
short_desc="NDI SDK"
maintainer="Michael Aldridge <maldridge@voidlinux.org>"
license="custom:proprietary"
homepage="https://ndi.video"
distfiles="https://downloads.ndi.tv/SDK/NDI_SDK_Linux/Install_NDI_SDK_v6_Linux.tar.gz"
checksum=0bdf66264527f8be37fa22eddd2b8514b9868a58a4d83f80a07dbeb479ee14d4
nopie_files="/usr/bin/ndi-benchmark
 /usr/bin/ndi-discovery-server
 /usr/bin/ndi-free-audio
 /usr/bin/ndi-record"

post_extract() {
	ARCHIVE=$(awk '/^__NDI_ARCHIVE_BEGIN__/ { print NR+1; exit 0; }' Install_NDI_SDK_v6_Linux.sh)
	tail -n+$ARCHIVE Install_NDI_SDK_v6_Linux.sh | bsdtar -xvzC $wrksrc --strip-components=1
	rm -f Install_NDI_SDK_v6_Linux.sh
}

do_install() {
	vlicense 'NDI SDK License Agreement.txt'
	vlicense licenses/libndi_licenses.txt

	vmkdir usr/share/examples/libndi
	vcopy examples/* usr/share/examples/libndi/

	vmkdir usr/include/libndi
	vcopy include/* usr/include/libndi/

	vmkdir usr/share/libndi
	vcopy documentation/* usr/share/libndi/

	case $XBPS_TARGET_MACHINE in
		x86_64)
			_bundle=x86_64-linux-gnu
			;;
		i686)
			_bundle=i686-linux-gnu
			;;
		aarch64)
			_bundle=aarch64-rpi4-linux-gnueabi
			;;
	esac

	for f in bin/$_bundle/* ; do
		vbin $f
	done

	vmkdir usr/lib
	for f in lib/$_bundle/* ; do
		vinstall $f 0644 usr/lib/
	done
}
