#!/bin/sh
exec 2>&1

DAEMON=/usr/sbin/iceccd
CONFIGFILE=/etc/icecc/icecc.conf

# Read configuration files
[ -r $CONFIGFILE ] && . $CONFIGFILE

test -x $DAEMON || exit 0

netname=
if test -n "$ICECC_NETNAME"; then
	netname="-n $ICECC_NETNAME"
fi

logfile=""
if test -n "$ICECC_LOG_FILE"; then
	logfile="-l $ICECC_LOG_FILE"
fi

nice=
if test -n "$ICECC_NICE_LEVEL"; then
	nice="--nice $ICECC_NICE_LEVEL"
fi

scheduler=
if test -n "$ICECC_SCHEDULER_HOST"; then
	scheduler="-s $ICECC_SCHEDULER_HOST"
fi

basedir=
if test -n "$ICECC_BASEDIR"; then
	basedir="-b $ICECC_BASEDIR"
fi

noremote=
if test "$ICECC_ALLOW_REMOTE" = "no"; then
	noremote="--no-remote"
fi

maxjobs=
if test -n "$ICECC_MAX_JOBS"; then
	if test "$ICECC_MAX_JOBS" -eq 0; then
		maxjobs="-m 1"
		noremote="--no-remote"
	else
		maxjobs="-m $ICECC_MAX_JOBS"
	fi
fi

cachelimit=
if test -n "$ICECC_CACHE_LIMIT"; then
	cachelimit="--cache-limit $ICECC_CACHE_LIMIT"
fi

exec $DAEMON -d $logfile $nice $scheduler $netname -u icecc $basedir $maxjobs $noremote $cachelimit 2>&1

