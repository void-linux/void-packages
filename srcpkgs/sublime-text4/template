# Template file for 'sublime-text4'
pkgname=sublime-text4
version=4113
revision=1
archs="x86_64 i686 aarch64"
wrksrc="sublime_text"
depends="libpng gtk+ gtk+3 hicolor-icon-theme desktop-file-utils"
short_desc="Sophisticated text editor for code, markup and prose"
maintainer="shizonic <realtiaz@gmail.com>"
license="custom:EULA" #no vlicense check
homepage="http://www.sublimetext.com"
repository="nonfree"
conflicts="sublime-text3"
nostrip=yes
nopie=yes
restricted=yes
repository=nonfree

case "$XBPS_TARGET_MACHINE" in
	x86_64|i686)
		distfiles="https://download.sublimetext.com/sublime_text_build_${version}_x64.tar.xz"
		checksum=900ef90fc6453efc4c2b36132a5f16a4db67a226fa9732e4d3c1bf586d4dc78c
	;;
	aarch64)
		distfiles="https://download.sublimetext.com/sublime_text_build_${version}_arm64.tar.xz"
		checksum=63d536e4c1ff8ca13bbf19fdfacbdeedd6af783f759824500faa4216d978e641
	;;
esac

do_install() {
	vmkdir "usr/bin"
	vmkdir "usr/lib/sublime_text"
	cp --preserve=mode -r ./* "${DESTDIR}/usr/lib/sublime_text"
	vinstall "sublime_text.desktop" 644 "usr/share/applications/"
	for size in 128 16 256 32 48; do
		vinstall "Icon/${size}x${size}/sublime-text.png" 644 \
			"usr/share/icons/hicolor/${size}x${size}/apps/"
	done
	ln -s /usr/lib/sublime_text/sublime_text ${DESTDIR}/usr/bin/subl
	vsed -e 's:Exec=/opt/sublime_text/:Exec=/usr/lib/sublime_text/:' \
		-i ${DESTDIR}/usr/share/applications/sublime_text.desktop
}
