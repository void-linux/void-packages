# Template file for 'textadept'
pkgname=textadept
version=12.6
revision=1
# as per https://github.com/orbitalquark/textadept/blob/default/CMakeLists.txt
_scintilla_version=554
_scinterm_version=5.3
_scintillua_version=6.4
_lua_version=5.4.7
_lpeg_version=1.1.0
_luafilesystem_version=1_8_0
_luastdregex_version=1.0
_cdksnapshots_version=t20240619
_libtermkey_version=0.22
_reproc_version=14.2.5
build_style=cmake
hostmakedepends="tar unzip pkg-config"
makedepends="gtk+3-devel ncurses-devel"
short_desc="Fast, minimalist, and extensible text editor for programmers"
maintainer="Anachron <gith@cron.world>"
license="MIT"
homepage="https://orbitalquark.github.io/textadept/"
# Note: The dependency urls and filenames must be checked and updated manually
# for distfiles and skip_extraction variables on every new release (and
# checksums updated accordingly). This is so that XBPS can cache them. Details:
# https://github.com/void-linux/void-packages/pull/15627#issuecomment-549018252
distfiles="https://github.com/orbitalquark/textadept/archive/textadept_${version}.tar.gz
 https://www.scintilla.org/scintilla${_scintilla_version}.tgz
 https://github.com/orbitalquark/scinterm/archive/scinterm_${_scinterm_version}.zip
 https://github.com/orbitalquark/scintillua/archive/scintillua_${_scintillua_version}.zip
 https://www.lua.org/ftp/lua-${_lua_version}.tar.gz
 https://www.inf.puc-rio.br/~roberto/lpeg/lpeg-${_lpeg_version}.tar.gz
 https://github.com/keplerproject/luafilesystem/archive/v${_luafilesystem_version}.zip
 https://github.com/orbitalquark/lua-std-regex/archive/${_luastdregex_version}.zip
 https://github.com/ThomasDickey/cdk-snapshots/archive/refs/tags/${_cdksnapshots_version}.tar.gz
 https://www.leonerd.org.uk/code/libtermkey/libtermkey-${_libtermkey_version}.tar.gz
 https://github.com/DaanDeMeyer/reproc/archive/refs/tags/v${_reproc_version}.zip"
checksum="2e45cbd492f88328cb9a91495af2885a1e7d72b9c33ddd1eeb43c1f23f7b7bb2
 7994a854a3012269f35ecc2cb725b8f7e209e410dc96fe141c9a15ccfebd41fc
 1a78abc9e1377c28d323af62fe7c4376f1eb3007adbbfa6d3e1e3eaece703666
 fa69920c9b8413a25a75f6661db3de2e4ed3f7306143367137fbbd1e3bc480e2
 9fbf5e28ef86c69858f6d3d34eccc32e911c1a28b4120ff3e84aaa70cfbf1e30
 4b155d67d2246c1ffa7ad7bc466c1ea899bbc40fef0257cc9c03cecbaed4352a
 e3a6beca7a8a90522eed31db6ccdc5ed65a433826500c6862784e27671b9e18a
 5b684a1ce7ea632a37aa4f98bcf265cd97d9d70c5998c56985295c6aa97e74e1
 69a2c96ce23b3137929ecc011c67b030554cc532ab00a011cbbccf01dacaa611
 6945bd3c4aaa83da83d80a045c5563da4edd7d0374c62c0d35aec09eb3014600
 21b168c38adb22f4b48391d8193dbc3927f1f2e678c2058d6944a29b64acc6c9"
skip_extraction="scintilla${_scintilla_version}.tgz
 scinterm_${_scinterm_version}.zip
 scintillua_${_scintillua_version}.zip
 lua-${_lua_version}.tar.gz
 lpeg-${_lpeg_version}.tar.gz
 v${_luafilesystem_version}.zip
 ${_luastdregex_version}.zip
 ${_cdksnapshots_version}.tar.gz
 libtermkey-${_libtermkey_version}.tar.gz
 v${_reproc_version}.zip"

post_extract() {
	# We copy the downloaded dep files to src directory so that they are found
	# and not downloaded again by the build process. This helps to utilize caching.
	for archive in ${skip_extraction}; do
		vsrccopy "${archive}" "build/_deps"
	done
}

post_install() {
	# Binaries in /usr/share/textadept are not allowed
	# So we relocate to /usr/bin/textadept
	vmkdir "usr/bin"
	mv "${DESTDIR}/usr/share/textadept/textadept-gtk" "${DESTDIR}/usr/bin/textadept"
	mv "${DESTDIR}/usr/share/textadept/textadept-curses" "${DESTDIR}/usr/bin/textadept-curses"

	# For icons
	mkdir -p "${DESTDIR}/usr/share/pixmaps"
	ln -s "/usr/lib/textadept/core/images/textadept.svg" \
		"${DESTDIR}/usr/share/pixmaps/textadept.svg"
	ln -s "/usr/lib/textadept/core/images/ta_48x48.png" \
		"${DESTDIR}/usr/share/pixmaps/textadept.png"

	vlicense LICENSE
	vinstall src/textadept.desktop 644 /usr/share/applications/ textadept.desktop
	vinstall src/textadept-curses.desktop 644 /usr/share/applications/ textadept-curses.desktop
	vinstall src/textadept-gtk.desktop 644 /usr/share/applications/ textadept-gtk.desktop
}
