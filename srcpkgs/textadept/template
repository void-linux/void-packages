# Template file for 'textadept'
pkgname=textadept
version=12.1
revision=1
build_style=cmake
configure_args="
 -DCMAKE_BUILD_TYPE=None
 -DGTK3=ON
 -DCMAKE_INSTALL_PREFIX=/usr
 -DCMAKE_INSTALL_DATADIR=/usr/lib
 -DCURSES=ON"
hostmakedepends="tar unzip pkg-config cmake"
makedepends="gtk+3-devel ncurses-devel"
short_desc="Fast, minimalist, and extensible text editor for programmers"
maintainer="Valter Nazianzeno <manipuladordedados@gmail.com>"
license="MIT"
homepage="https://orbitalquark.github.io/textadept/"
# Note: The dependency urls and filenames must be checked and updated manually
# for distfiles and skip_extraction variables on every new release (and
# checksums updated accordingly). This is so that XBPS can cache them. Details:
# https://github.com/void-linux/void-packages/pull/15627#issuecomment-549018252
distfiles="https://github.com/orbitalquark/textadept/archive/textadept_${version}.tar.gz
 https://www.scintilla.org/scintilla536.tgz
 https://www.scintilla.org/lexilla510.tgz
 https://github.com/orbitalquark/scinterm/archive/scinterm_5.0.zip
 https://github.com/orbitalquark/scintillua/archive/scintillua_6.2.zip
 https://www.lua.org/ftp/lua-5.4.6.tar.gz
 http://www.inf.puc-rio.br/~roberto/lpeg/lpeg-1.1.0.tar.gz
 https://github.com/keplerproject/luafilesystem/archive/v1_8_0.zip
 https://invisible-mirror.net/archives/cdk/cdk-5.0-20200923.tgz
 http://www.leonerd.org.uk/code/libtermkey/libtermkey-0.22.tar.gz
 https://github.com/orbitalquark/lua-std-regex/archive/1.0.zip"
checksum="7d71d7b9aa43d6d7a751cd01c0bc76e5c57e967265149871edf761767e2b05ce
 89be8278a83e7813925aafe2977daab87d2bd6bebd17b0179fe72afdd548cb24
 6b3595274005498671b854cf57bdeec2254966f371712fcf3a716d97aa7f3fd8
 975a9e2cc0ab872a1903f19f997151db4ad8e44b14a0ee5efb5bd926d61d6f6e
 be394de8c073d318c1c1677c769c7f92cdfb5af757b76bc4d40ef560cdee0e29
 7d5ea1b9cb6aa0b59ca3dde1c6adcb57ef83a1ba8e5432c0ecd06bf439b3ad88
 4b155d67d2246c1ffa7ad7bc466c1ea899bbc40fef0257cc9c03cecbaed4352a
 e3a6beca7a8a90522eed31db6ccdc5ed65a433826500c6862784e27671b9e18a
 007f5de880cb2eebd8556df7e4cd8673d5e64c9970147eee6923a814c29faaed
 6945bd3c4aaa83da83d80a045c5563da4edd7d0374c62c0d35aec09eb3014600
 5b684a1ce7ea632a37aa4f98bcf265cd97d9d70c5998c56985295c6aa97e74e1"
skip_extraction="scintilla536.tgz
 scinterm_5.0.zip
 lexilla510.tgz
 scintillua_6.2.zip
 lua-5.4.6.tar.gz
 lpeg-1.1.0.tar.gz
 v1_8_0.zip
 cdk-5.0-20200923.tgz
 libtermkey-0.22.tar.gz
 1.0.zip"

post_extract() {
	# We copy the downloaded dep files to _deps directory so that they are found
	# and not downloaded again by the build process. This helps to utilize caching.
	mkdir -p ${wrksrc}/${build_wrksrc}/build/_deps
	echo "${skip_extraction}" | while read archive; do
		if [ -f "${XBPS_SRCDISTDIR}/${sourcepkg}-${version}/${archive}" ]; then
			cp "${XBPS_SRCDISTDIR}/${sourcepkg}-${version}/${archive}" \
				"${wrksrc}/${build_wrksrc}/build/_deps/"
		fi
	done
}

post_install() {
	# Prepare directories 
	mkdir -p "${DESTDIR}"/usr/{bin,share/{icons,pixmaps,applications}}

	ln -sf "/usr/lib/textadept/textadept-gtk" "${DESTDIR}/usr/bin/textadept-gtk"
	ln -sf "/usr/lib/textadept/textadept-curses" \
		"${DESTDIR}/usr/bin/textadept-curses"

	# Desktop files
	mv "${DESTDIR}/usr/lib/textadept"/*.desktop "${DESTDIR}/usr/share/applications"

	# For icons
	ln -s "/usr/lib/textadept/core/images/textadept.svg" \
		"${DESTDIR}/usr/share/pixmaps/textadept.svg"
	ln -s "/usr/lib/textadept/core/images/ta_48x48.png" \
		"${DESTDIR}/usr/share/pixmaps/textadept.png"
	mv "${DESTDIR}/usr/lib/icons" "${DESTDIR}/usr/share/"

	vlicense ./LICENSE
}
