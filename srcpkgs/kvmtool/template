# Template file for 'kvmtool'
pkgname=kvmtool
version=3.18.0
revision=1
_githash=41d773e2070aabd3c4ff20c059f45c3e9a0f9d20
wrksrc="${_githash}"
build_style=gnu-makefile
make_use_env=no
short_desc="Native Linux KVM tool"
maintainer="auser509 <auser509@gmail.com>"
license="GPL-2.0-or-later"
homepage="https://git.kernel.org/pub/scm/linux/kernel/git/will/kvmtool.git/"
distfiles="${homepage}/snapshot/${_githash}.tar.gz"
checksum=85eacf05d731d7b9261d0b1a41a9b7eb87d6c91c1058a111d910a6138b8a4514

if [ -n "$CROSS_BUILD" ]; then
	case "${XBPS_CROSS_TRIPLET}" in
	aarch64-linux-*)
		makedepends="dtc-devel"
		export ARCH=arm64
		;;
	arm*-linux-*)
		makedepends="dtc-devel"
		ARCH=arm
		;;
	"i686-pc-linux-gnu")
		ARCH=x86
		;;
	"mips-linux-musl")
		ARCH=mips
		;;
	"x86_64-linux-musl")
		ARCH=x86
		;;
	esac

	make_build_args="ARCH=${ARCH}"
fi

do_build() {
	if [ "$CROSS_BUILD" ]; then
		make CROSS_COMPILE=${XBPS_CROSS_TRIPLET}- ${make_build_args} ${makejobs}
	else
		make ${makejobs}
	fi
}

do_install() {
	vbin lkvm
}
