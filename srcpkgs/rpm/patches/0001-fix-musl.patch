From 22c4e45abf41b1e0dcd157bbbbcd877c2153590e Mon Sep 17 00:00:00 2001
From: mobinmob <mobinmob@disroot.org>
Date: Tue, 23 Nov 2021 21:10:32 +0200
Subject: [PATCH] fix-musl

# Rebased - original patch by @maxice8
---
 configure.ac | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/configure.ac b/configure.ac
index 6b161dc..d48c0fb 100644
--- a/configure.ac
+++ b/configure.ac
@@ -250,6 +250,7 @@ AC_SEARCH_LIBS(dlopen, [dl])
 # Check for libelf library. Prefer external, otherwise none.
 WITH_LIBELF_LIB=
 AC_CHECK_HEADER([libelf.h])
+AC_CHECK_HEADERS([error.h], [WITH_ERROR_H=yes])
 AC_CHECK_HEADERS([gelf.h], [
 	AC_CHECK_LIB(elf, gelf_getvernaux, [
 	    AC_DEFINE(HAVE_LIBELF, 1, [Define to 1 if you have the 'elf' library (-lelf).])
@@ -258,7 +259,7 @@ AC_CHECK_HEADERS([gelf.h], [
 	])
 ])
 AC_SUBST(WITH_LIBELF_LIB)
-AM_CONDITIONAL(LIBELF,[test "$WITH_LIBELF" = yes])
+AM_CONDITIONAL(LIBELF,[test "$WITH_LIBELF" = yes && test "$WITH_ERROR_H" = yes])
 
 #=================
 # Select crypto library
-- 
2.34.0

