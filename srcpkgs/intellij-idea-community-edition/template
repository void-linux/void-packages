# Template file for 'intellij-idea-community-edition'
pkgname=intellij-idea-community-edition
version=2018.3.1
revision=1
only_for_archs="i686 x86_64"
depends="virtual?java-environment giflib libXtst"
short_desc="Java integrated development environment by JetBrains"
maintainer="John <johnz@posteo.net>"
license="Apache-2.0"
homepage="https://www.jetbrains.org/"
distfiles="https://download.jetbrains.com/idea/ideaIC-${version}-no-jdk.tar.gz"
checksum=c6bd74e4280c3cf850fd6953a47e0e91ffb882b3b0ca25de12ac745f65a5d3e3
repository=nonfree
nopie=yes

post_extract() {
	mv $XBPS_BUILDDIR/idea-IC-* ${wrksrc}
}

do_install() {
	vmkdir usr/bin
	vmkdir usr/share/doc/intellij-idea
	vmkdir usr/share/intellij-idea

	mv bin lib plugins redist ${DESTDIR}/usr/share/intellij-idea
	mv LICENSE.txt NOTICE.txt build.txt license ${DESTDIR}/usr/share/doc/intellij-idea
	rm ${DESTDIR}/usr/share/intellij-idea/bin/fsnotifier-arm
	if [ "$XBPS_TARGET_MACHINE" = "x86_64" ]; then
		rm ${DESTDIR}/usr/share/intellij-idea/bin/fsnotifier
		rm ${DESTDIR}/usr/share/intellij-idea/bin/idea.vmoptions
		rm ${DESTDIR}/usr/share/intellij-idea/plugins/android/lib/libwebp/linux/libwebp_jni.so
	else
		rm ${DESTDIR}/usr/share/intellij-idea/bin/fsnotifier64
		rm ${DESTDIR}/usr/share/intellij-idea/bin/idea64.vmoptions
		rm ${DESTDIR}/usr/share/intellij-idea/plugins/android/lib/libwebp/linux/libwebp_jni64.so
		rm ${DESTDIR}/usr/share/intellij-idea/bin/libdbm64.so
	fi

	ln -sf /usr/share/intellij-idea/bin/idea.sh ${DESTDIR}/usr/bin/idea
}
