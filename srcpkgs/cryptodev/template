# Template file for 'cryptodev-dkms'
pkgname=cryptodev-dkms
version=1.12
revision=1
wrksrc="cryptodev-linux-cryptodev-linux-${version}"
checkdepends="openssl-devel"
short_desc="Interface for kernel crypto drivers."
maintainer="Wiktor Ciurej <wiktor.ciurej@gmail.com>"
license="GPL-2.0-only"
homepage="https://github.com/cryptodev-linux/cryptodev-linux"
distfiles="https://github.com/cryptodev-linux/cryptodev-linux/archive/refs/tags/cryptodev-linux-${version}.tar.gz"
checksum=f51c2254749233b1b1d7ec9445158bd709f124f88e1c650fe2faac83c3a81938
subpackages="cryptodev-dkms cryptodev-headers"

pre_install() {
	cp -f ${FILESDIR}/dkms.conf dkms.conf
}

do_install() {
	vmkdir usr/src/cryptodev-${version}
	vcopy "*" usr/src/cryptodev-${version}

	vdoc AUTHORS
	vdoc INSTALL
	vdoc NEWS
	vdoc README
}

cryptodev-dkms_package() {
	short_desc="${_desc} - DKMS kernel module"
	depends="dkms"
	dkms_modules="cryptodev ${version}"

	pkg_install() {
		vmove usr/src
	}
}

cryptodev-headers_package() {
	short_desc="${_desc} - headers"

	pkg_install() {
		vmkdir usr/include/crypto/
		vinstall crypto/cryptodev.h 0644 usr/include/crypto/
	}
}

do_check() {
	make check
}
