# Template file for 'imgbrd-grabber'
pkgname=imgbrd-grabber
version=7.13.0
revision=1
build_style=cmake
configure_args="-DXBPS_CROSS_BASE=${XBPS_CROSS_BASE}"
build_wrksrc=src
cmake_builddir=../build
hostmakedepends="nodejs qt6-tools qt6-shadertools"
makedepends="qt6-declarative-devel qt6-multimedia-devel qt6-plugin-mysql
qt6-plugin-odbc qt6-plugin-pgsql qt6-plugin-sqlite catch2 qt6-networkauth-devel
qt6-webengine-devel lexbor-devel qt6-shadertools-devel"
short_desc="Powerful imageboard/booru downloader"
maintainer="SolitudeSF <solitudesf@protonmail.com>"
license="Apache-2.0"
homepage="https://bionus.github.io/imgbrd-grabber"
changelog="https://github.com/Bionus/imgbrd-grabber/releases"
distfiles="https://github.com/Bionus/imgbrd-grabber/archive/v${version}.tar.gz"
checksum=9d64a8790d9865498e17670b9db175372978fe60c1b70eef1a9b2cfbb53d3d2f

if [ "$CROSS_BUILD" ]; then
	hostmakedepends+=" qt6-declarative-host-tools qt5-qmake"
fi

case "$XBPS_TARGET_MACHINE" in
	armv5* | armv6* | armv7* | ppc* | riscv64* | i686*) broken="qt6-webengine missing" ;;
esac

pre_build() {
	vsed -i tests/src/catch.h -e 's/vendor\/catch\/src\/catch2\///'
	vsed -i tests/src/main.cpp -e 's/vendor\/catch\/src\/catch2\///'
}

do_check() {
	cd lib
	QT_QPA_PLATFORM=offscreen ../../build/lib/tests/lib-tests
	QT_QPA_PLATFORM=offscreen ../../build/cli/tests/cli-tests
	QT_QPA_PLATFORM=offscreen ../../build/gui/tests/gui-tests
}
