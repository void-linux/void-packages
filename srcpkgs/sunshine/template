# Template file for 'sunshine'
pkgname=sunshine
version=2025.924.154138
revision=1
archs="x86_64 aarch64"
build_style=cmake
configure_args="-Wno-dev -DBUILD_TESTS=OFF -DBUILD_DOCS=0 -DSUNSHINE_ENABLE_TRAY=0 -DCUDA_FAIL_ON_MISSING=OFF -DSUNSHINE_EXECUTABLE_PATH=/usr/bin/sunshine
 -DSUNSHINE_ASSETS_DIR=/usr/share/sunshine"
hostmakedepends="boost cmake git make nodejs pkg-config wayland-devel"
makedepends="boost-devel doxygen ffmpeg-devel graphviz libayatana-appindicator-devel libboost_filesystem
 libboost_locale libboost_program_options libcap-devel libcurl-devel libdrm-devel libevdev-devel
 libnuma-devel libnotify-devel libopusenc-devel libsvt-av1-devel libva-devel libvdpau-devel libX11-devel
 libxcb-devel libXcursor-devel libXfixes-devel libXi-devel libXinerama-devel libXrandr-devel
 libXtst-devel MesaLib-devel miniupnpc-devel nv-codec-headers opus-devel openssl-devel
 pulseaudio-devel x264-devel x265-devel wayland-protocols"
short_desc="Self-hosted GameStream host for Moonlight"
maintainer="myothk <myoothkyaw@gmail.com>"
license="GPL-3.0-only"
homepage="https://app.lizardbyte.dev/Sunshine"

# sub modules
_tpc_ver="cc520397504bb72bc6df79ff03eb72988a6dc50d"
_vgec_ver="8d71f6740ffff4671cdadbca255ce528e3cd3fef"
_build_deps_ver="c38829d6b8c35b64b3ff7a569f51978ed72c4292"
_googletest_ver="1.17.0"
_moonlight_commonc_ver="5f2280183cb62cba1052894d76e64e5f4153377d"
_nanors_ver="19f07b513e924e471cadd141943c1ec4adc8d0e0"
_nvcodec_headers_ver="22441b505d9d9afc1e3002290820909846c24bdc"
_nvapi_opensdk_ver="R555"
_tray_ver="0309a7cb84aad25079b60c40d1eae0bacd05b26d"
_wayland_protocols_ver="1.45"
_wlr_protocols_ver="a741f0ac5d655338a5100fc34bc8cec87d237346"
_simplewebserver_ver="187f798d54a9c6cee742f2eb2c54e9ba26f5a385"
_enet_ver="115a10baa1d7f291ff5b870765610fd3b4a6e43c"
_inputtino_ver="504f0abc7da8ebc351f8300fb2ed98db5438ee48"
_doxyconfig_ver="1188ef2b96efb3e003a591ee01714339c2d9161c"
_libdisplaydevice_ver="f31e46d8736fa6932d34c1417111e60ca507b29f"
_doxygen_awesome_css_ver="2.4.0"
distfiles="https://github.com/LizardByte/Sunshine/archive/refs/tags/v${version}.tar.gz
 https://api.github.com/repos/michaeltyson/TPCircularBuffer/tarball/${_tpc_ver}>TPCircularBuffer-${_tpc_ver}.tar.gz
 https://github.com/LizardByte/Virtual-Gamepad-Emulation-Client/archive/${_vgec_ver}.tar.gz>ViGEmClient-${_vgec_ver}.tar.gz
 https://api.github.com/repos/LizardByte/build-deps/tarball/${_build_deps_ver}>build-deps-${_build_deps_ver}.tar.gz
 https://github.com/google/googletest/archive/refs/tags/v${_googletest_ver}.tar.gz>googletest-${_googletest_ver}.tar.gz
 https://github.com/moonlight-stream/moonlight-common-c/archive/${_moonlight_commonc_ver}.tar.gz>moonlight-common-c-${_moonlight_commonc_ver}.tar.gz
 https://github.com/sleepybishop/nanors/archive/${_nanors_ver}.tar.gz>nanors-${_nanors_ver}.tar.gz
 https://github.com/FFmpeg/nv-codec-headers/archive/${_nvcodec_headers_ver}.tar.gz>nv-codec-headers-${_nvcodec_headers_ver}.tar.gz
 https://github.com/LizardByte/nvapi-open-source-sdk/archive/refs/tags/${_nvapi_opensdk_ver}.tar.gz>nvapi-open-source-sdk-${_nvapi_opensdk_ver}.tar.gz
 https://github.com/LizardByte/tray/archive/${_tray_ver}.tar.gz>tray-${_tray_ver}.tar.gz
 https://gitlab.freedesktop.org/wayland/wayland-protocols/-/archive/${_wayland_protocols_ver}/wayland-protocols-${_wayland_protocols_ver}.tar.gz>wayland-protocols-${_wayland_protocols_ver}.tar.gz
 https://gitlab.freedesktop.org/wlroots/wlr-protocols/-/archive/${_wlr_protocols_ver}/wlr-protocols-${_wlr_protocols_ver}.tar.gz>wlr-protocols-${_wlr_protocols_ver}.tar.gz
 https://gitlab.com/eidheim/Simple-Web-Server/-/archive/${_simplewebserver_ver}/Simple-Web-Server-${_simplewebserver_ver}.tar.gz>Simple-Web-Server-${_simplewebserver_ver}.tar.gz
 https://github.com/cgutman/enet/archive/${_enet_ver}.zip>enet-${_enet_ver}.tar.gz
 https://api.github.com/repos/games-on-whales/inputtino/tarball/${_inputtino_ver}>inputtino-${_inputtino_ver}.tar.gz
 https://api.github.com/repos/LizardByte/doxyconfig/tarball/${_doxyconfig_ver}>doxyconfig-${_doxyconfig_ver}.tar.gz
 https://api.github.com/repos/LizardByte/libdisplaydevice/tarball/${_libdisplaydevice_ver}>libdisplaydevice-${_libdisplaydevice_ver}.tar.gz
 https://github.com/jothepro/doxygen-awesome-css/archive/refs/tags/v${_doxygen_awesome_css_ver}.tar.gz>doxygen-awesome-css-${_doxygen_awesome_css_ver}.tar.gz"
checksum="109f68c8c01f50c0df2214790a307b7f2589c2b575d8961d9a5ed3ef42660b54
 633af6b8c8dec14bc02e21b10634fd6cff567488361d4d803486e9f71bc7e288
 27907cba8c017de220b66e036ed04a39f5eacb9182846700047420aef2f5cd0e
 c0b73c8585e75dc9ba924007de70f01138a2e26a1c4db94597ec0a0d99df6067
 65fab701d9829d38cb77c14acdc431d2108bfdbf8979e40eb8ae567edf10b27c
 e2f5001b49ad0fad6575e807c002cddfe6be56e38c691d80b8723c73167be8eb
 2ece5782cd6ff87f74ebd0ffaf28b9256b498b6b3f5344aeb75b873c15eeb2dc
 dc28f764fbc72f6ac2a96fcace252e6ecc84b308b8d4400820203cc901bae596
 cd6317e9599f589a9dccaf8c3acdb114fa5b6c61e537ec689664fb050abb7ba1
 02cc842c201ddf8f1e641f5c57859fade29bde61dabdc56be17aa6e03bbd37ba
 460dad72a6c84b2a7d80745bee43d96ba117f4e3dfc4d7c45f83f66469ea27df
 7e445e4c1c34de1bfde10018bc782f16cbb92cc942061aab27710cd29ab8b3b0
 941212c35e0aedd45f486df2b32b6bf766cc3eca2fe8c908d86ed7315e441739
 f3db0194c3f5867b60f74674bfe9d492ff48200197b6ca66c32f96b713a7ac92
 cc3180a243590adb1083d8a88ad69ebea40c3bb7f7662847b803bab36575cec9
 425ccdbf2f7785b65aacad3ada6f223fcb3927f06187b855f73f4e7895a930e3
 9383d9b69b060dac84dae3c60f36319efda2dac8f27f81048be693f494c0a012
 ec12b06f6ffe6e5048dc95596cc4f1c10130542180934f6ed17af0afd4fe1313
"
skip_extraction="
 Simple-Web-Server-${_simplewebserver_ver}.tar.gz
 TPCircularBuffer-${_tpc_ver}.tar.gz
 ViGEmClient-${_vgec_ver}.tar.gz
 build-deps-${_build_deps_ver}.tar.gz
 googletest-${_googletest_ver}.tar.gz
 moonlight-common-c-${_moonlight_commonc_ver}.tar.gz
 nanors-${_nanors_ver}.tar.gz
 nv-codec-headers-${_nvcodec_headers_ver}.tar.gz
 nvapi-open-source-sdk-${_nvapi_opensdk_ver}.tar.gz
 tray-${_tray_ver}.tar.gz
 wayland-protocols-${_wayland_protocols_ver}.tar.gz
 wlr-protocols-${_wlr_protocols_ver}.tar.gz
 enet-${_enet_ver}.tar.gz
 inputtino-${_inputtino_ver}.tar.gz
 doxyconfig-${_doxyconfig_ver}.tar.gz
 libdisplaydevice-${_libdisplaydevice_ver}.tar.gz
 doxygen-awesome-css-${_doxygen_awesome_css_ver}.tar.gz"

post_extract() {
	vsrcextract -C third-party/Simple-Web-Server Simple-Web-Server-${_simplewebserver_ver}.tar.gz
	vsrcextract -C third-party/TPCircularBuffer TPCircularBuffer-${_tpc_ver}.tar.gz
	vsrcextract -C third-party/ViGEmClient ViGEmClient-${_vgec_ver}.tar.gz
	vsrcextract -C third-party/build-deps build-deps-${_build_deps_ver}.tar.gz
	vsrcextract -C third-party/googletest googletest-${_googletest_ver}.tar.gz
	vsrcextract -C third-party/moonlight-common-c moonlight-common-c-${_moonlight_commonc_ver}.tar.gz
	vsrcextract -C third-party/moonlight-common-c/enet enet-${_enet_ver}.tar.gz
	vsrcextract -C third-party/nanors nanors-${_nanors_ver}.tar.gz
	vsrcextract -C third-party/nv-codec-headers nv-codec-headers-${_nvcodec_headers_ver}.tar.gz
	vsrcextract -C third-party/nvapi-open-source-sdk nvapi-open-source-sdk-${_nvapi_opensdk_ver}.tar.gz
	vsrcextract -C third-party/tray tray-${_tray_ver}.tar.gz
	vsrcextract -C third-party/wayland-protocols wayland-protocols-${_wayland_protocols_ver}.tar.gz
	vsrcextract -C third-party/wlr-protocols wlr-protocols-${_wlr_protocols_ver}.tar.gz
	vsrcextract -C third-party/inputtino inputtino-${_inputtino_ver}.tar.gz
	vsrcextract -C third-party/doxyconfig doxyconfig-${_doxyconfig_ver}.tar.gz
	vsrcextract -C third-party/doxyconfig/doxygen-awesome-css doxygen-awesome-css-${_doxygen_awesome_css_ver}.tar.gz
	vsrcextract -C third-party/libdisplaydevice libdisplaydevice-${_libdisplaydevice_ver}.tar.gz
}
pre_configure() {
	export BRANCH=master
	export BUILD_VERSION=${version}
	export COMMIT=v${version}
}
post_install() {
	vsv sunshine
}
