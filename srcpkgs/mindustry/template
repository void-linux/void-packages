# Template file for 'mindustry'
pkgname=mindustry
version=7.0.b146
revision=1
_build=${version##*.b}
hostmakedepends="openjdk17 gradle"
depends="virtual?java-runtime desktop-file-utils hicolor-icon-theme"
short_desc="Automation tower defense RTS"
maintainer="Mihail Ivanchev <contact@ivanchev.net>"
license="GPL-3.0-or-later"
homepage="https://mindustrygame.github.io/"
distfiles="https://github.com/Anuken/Mindustry/archive/refs/tags/v${_build}.tar.gz"
checksum=aa1684d87d9f3e1d1a2da415b5e055ea6493fe31398748447927bd903019adbd
skip_extraction="v${_build}.tar.gz"
build_wrksrc=Mindustry-${_build}

# TODO: Make sure this template doesn't download anything.

# JAVA_HOME needs to be set because otherwise gradle fails to find Java.

export JAVA_HOME=/usr/lib/jvm/openjdk17

post_extract() {
	vsrcextract -C ${build_wrksrc} v${_build}.tar.gz
}

do_build() {
	./gradlew --no-daemon dist -Pbuildversion="${_build}" desktop:dist server:dist
}

do_install() {
	vmkdir usr/share/mindustry
	vinstall desktop/build/libs/Mindustry.jar 644 usr/share/mindustry
	vbin ${FILESDIR}/mindustry
	vinstall ${FILESDIR}/mindustry.desktop 644 usr/share/applications
	vinstall core/assets/icons/icon_64.png usr/share/icons/hicolor/64x64/apps mindustry.png
}

mindustry-server_package() {
	short_desc+=" (server)"
	pkg_install() {
		vmkdir usr/share/mindustry
		vinstall server/build/libs/server-release.jar 644 usr/share/mindustry
		vinstall ${FILESDIR}/mindustry-server.desktop 644 usr/share/applications
		vbin ${FILESDIR}/mindustry-server
	        vinstall core/assets/icons/icon_64.png usr/share/icons/hicolor/64x64/apps mindustry-server.png
	}
}
