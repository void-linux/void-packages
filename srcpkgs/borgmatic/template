# Template file for 'borgmatic'
pkgname=borgmatic
version=1.2.9
revision=1
noarch=yes
build_style=python3-module
pycompile_module="borgmatic"
hostmakedepends="python3-setuptools"
depends="borg python3-setuptools python3-ruamel.yaml python3-pykwalify"
checkdepends="python3-ruamel.yaml python3-pytest python3-flexmock
 python3-pykwalify"
short_desc="Wrapper script for the Borg backup software"
maintainer="Renato Aguiar <renato@renag.me>"
license="GPL-3.0-only"
homepage="https://torsion.org/borgmatic/"
distfiles="${PYPI_SITE}/b/borgmatic/borgmatic-${version}.tar.gz"
checksum=37390bd684eb67a03c54565469153942f4b2e4fd83a250dea80222531960f9c0

do_check() {
	# The tests use the NEWS file to get version and checks against
	# setup.py's version, see: tests/integration/test_version.py
	echo ${version} > ${wrksrc}/NEWS

	# Remove broken test
	rm -rf tests/end-to-end

	python3 -m pytest
}

post_install() {
	# remove tests directory polluting site-packages
	rm -rf ${DESTDIR}/usr/lib/python*/site-packages/tests
}
