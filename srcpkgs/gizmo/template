# Template file for 'gizmo'
pkgname=gizmo
version=0.2.1
revision=1
_commit=7257724e79d62992082ba879007e75d96fe312b7
build_style=go
go_import_path=github.com/gizmo-platform/gizmo
go_ldflags="-X ${go_import_path}/pkg/buildinfo.Version=${version}
 -X ${go_import_path}/pkg/buildinfo.Commit=${_commit}"
short_desc="Software for the Gizmo Mechatronics Platform"
maintainer="Michael Aldridge <maldridge@gizmoplatform.org>"
license="ISC"
homepage="https://gizmoplatform.org"
distfiles="https://github.com/gizmo-platform/gizmo/archive/refs/tags/v${version}.tar.gz"
checksum=9240f724a1e89c94dcee900ffe1b658681b3f39a64d279f7f9b076e5916c2bd8

post_install() {
	vsv gizmo-fms
	vlicense LICENSE
}

gizmo-fms_package() {
	short_desc+=" - FMS"
	depends="${sourcepkg}>=${version}_${revision} apache-htpasswd dialog terraform gizmo-docs"
	make_dirs="/var/lib/gizmo 0755 _gizmo _gizmo"
	system_accounts="_gizmo"
	_gizmo_homedir="/var/lib/gizmo"
	_gizmo_shell="/bin/nologin"
	_gizmo_descr="Unprivileged service account"

	pkg_install() {
		vmove etc/sv/gizmo-fms
	}
}
