From b7dc6bc873aaf8809b511b2110286e5978a888ce Mon Sep 17 00:00:00 2001
From: Estevan Castilho <tevo@riajuu.net>
Date: Sun, 30 Mar 2025 17:17:52 +0000
Subject: [PATCH] Add aarch64-linux-musl, arm(v7l)?-linux-(gnu|musl)eabi(hf)?

---
 db/compilers.xml |  24 +++----
 db/cross.xml     |   4 +-
 db/linker.xml    | 161 +++++++++++++++++++++++++++++++++++++++++++++--
 3 files changed, 169 insertions(+), 20 deletions(-)

diff --git a/db/compilers.xml b/db/compilers.xml
index 185ca031..59e8e407 100644
--- a/db/compilers.xml
+++ b/db/compilers.xml
@@ -20,7 +20,7 @@
   <!--    GCC 3.x & 4.x (not for GNAT Pro)-->
   <compiler_description>
     <name>GCC</name>
-    <executable prefix="1">(.*-wrs-.*|.*-sysgo.*|.*-elf-.*|.*-eabi-.*|.*-eabispe-.*|avr-.*|.*-elinos-linux.*|.*-linux-gnu-|.*mingw32.*|.*-xcoff-.*|.*linux-android.*|arm-linux-gnueabi-|arm-linux-gnueabihf-|e500v2-gnu-linux-|powerpc-.*-linux.*-|.*-darwin.*-|.*-freebsd.*)?gcc(-\d+)?</executable>
+    <executable prefix="1">(.*-wrs-.*|.*-sysgo.*|.*-elf-.*|.*-eabi-.*|.*-eabispe-.*|avr-.*|.*-elinos-linux.*|.*-linux-(gnu|musl)-|.*mingw32.*|.*-xcoff-.*|.*linux-android.*|arm.*-linux-(gnu|musl)eabi-|arm.*-linux-(gnu|musl)eabihf-|e500v2-gnu-linux-|powerpc-.*-linux.*-|.*-darwin.*-|.*-freebsd.*)?gcc(-\d+)?</executable>
     <version>
       <external>$EXEC -v</external>
       <nogrep regexp="for GNAT Pro"></nogrep>
@@ -36,7 +36,7 @@
   <!--    GCC for GNAT Pro 3.x & 4.x -->
   <compiler_description>
     <name>GCC_Pro</name>
-    <executable prefix="1">(.*-wrs-.*|.*-sysgo.*|.*-elf-.*|.*-eabi-.*|.*-eabispe-.*|avr-.*|.*-elinos-linux.*|.*-linux-gnu-|.*mingw32.*|.*-xcoff-.*|.*linux-android.*|arm-linux-gnueabi-|arm-linux-gnueabihf-|e500v2-gnu-linux-|powerpc-.*-linux.*-|.*-darwin.*-|.*-fastos.*|.*-freebsd.*|.*-qnx.*|.*-rtems.*)?gcc</executable>
+    <executable prefix="1">(.*-wrs-.*|.*-sysgo.*|.*-elf-.*|.*-eabi-.*|.*-eabispe-.*|avr-.*|.*-elinos-linux.*|.*-linux-(gnu|musl)-|.*mingw32.*|.*-xcoff-.*|.*linux-android.*|arm.*-linux-(gnu|musl)eabi-|arm.*-linux-(gnu|musl)eabihf-|e500v2-gnu-linux-|powerpc-.*-linux.*-|.*-darwin.*-|.*-fastos.*|.*-freebsd.*|.*-qnx.*|.*-rtems.*)?gcc</executable>
     <version>
       <external>${PREFIX}gcc -v</external>
 
@@ -121,7 +121,7 @@
   <!--  G++ compilers for GNAT Pro  -->
   <compiler_description>
     <name>G++_Pro</name>
-    <executable prefix="1">(.*-elf-.*|.*-eabi-.*|.*-wrs-.*|.*-fastos.*|.*-freebsd.*|.*-linux-gnu.*-|.*-linux-android.*|.*-rtems.*)?g\+\+</executable>
+    <executable prefix="1">(.*-elf-.*|.*-eabi-.*|.*-wrs-.*|.*-fastos.*|.*-freebsd.*|.*-linux-(gnu|musl).*-|.*-linux-android.*|.*-rtems.*)?g\+\+</executable>
     <version>
       <external>${PREFIX}g++ -v</external>
 
@@ -138,7 +138,7 @@
   <!--  Assembler (not for GNAT Pro) -->
   <compiler_description>
     <name>GCC-ASM</name>
-    <executable prefix="1">(.*-wrs-.*|.*-sysgo.*|.*-elf-.*|.*-eabi-.*|.*-eabispe-.*|avr-.*|.*-elinos-linux.*|.*-linux-gnu-|.*mingw32.*|.*-xcoff-.*|.*linux-android.*|arm-linux-gnueabi-|arm-linux-gnueabihf-|e500v2-gnu-linux-|powerpc-.*-linux.*-|.*-darwin.*-|.*-fastos.*|.*-freebsd.*|.*-qnx.*|.*-rtems.*)?gcc(-\d+)?</executable>
+    <executable prefix="1">(.*-wrs-.*|.*-sysgo.*|.*-elf-.*|.*-eabi-.*|.*-eabispe-.*|avr-.*|.*-elinos-linux.*|.*-linux-(gnu|musl)-|.*mingw32.*|.*-xcoff-.*|.*linux-android.*|arm.*-linux-(gnu|musl)eabi-|arm.*-linux-(gnu|musl)eabihf-|e500v2-gnu-linux-|powerpc-.*-linux.*-|.*-darwin.*-|.*-fastos.*|.*-freebsd.*|.*-qnx.*|.*-rtems.*)?gcc(-\d+)?</executable>
     <version>
       <external>$EXEC -v</external>
       <nogrep regexp="for GNAT Pro"></nogrep>
@@ -154,7 +154,7 @@
   <!--  Assembler (for GNAT Pro) -->
   <compiler_description>
     <name>GCC-ASM_Pro</name>
-    <executable prefix="1">(.*-wrs-.*|.*-sysgo.*|.*-elf-.*|.*-eabi-.*|.*-eabispe-.*|avr-.*|.*-elinos-linux.*|.*-linux-gnu-|.*mingw32.*|.*-xcoff-.*|.*linux-android.*|arm-linux-gnueabi-|arm-linux-gnueabihf-|e500v2-gnu-linux-|powerpc-.*-linux.*-|.*-darwin.*-|.*-.*fastos.*|.*-freebsd.*|.*-qnx.*|.*-rtems.*)?gcc</executable>
+    <executable prefix="1">(.*-wrs-.*|.*-sysgo.*|.*-elf-.*|.*-eabi-.*|.*-eabispe-.*|avr-.*|.*-elinos-linux.*|.*-linux-(gnu|musl)-|.*mingw32.*|.*-xcoff-.*|.*linux-android.*|arm.*-linux-(gnu|musl)eabi-|arm.*-linux-(gnu|musl)eabihf-|e500v2-gnu-linux-|powerpc-.*-linux.*-|.*-darwin.*-|.*-.*fastos.*|.*-freebsd.*|.*-qnx.*|.*-rtems.*)?gcc</executable>
     <version>
       <external>${PREFIX}gcc -v</external>
       <grep regexp="^gcc \S+ (\S+) \d+ (\(prerelease\) )?\(?for GNAT Pro" group="1"></grep>
@@ -169,7 +169,7 @@
   <!--  Binary image -->
   <compiler_description>
     <name>LD</name>
-    <executable prefix="1">(.*-wrs.*-|.*-sysgo.*-|.*-elf.*-|.*-eabi.*-|.*-eabispe.*-|avr.*-|.*-elinos-linux.*-|.*-linux-gnu-|.*mingw32.*-|.*-xcoff.*-|.*linux-android.*|arm-linux-gnueabi-|arm-linux-gnueabihf-|e500v2-gnu-linux-|powerpc-.*-linux.*-|.*-darwin.*-|.*-fastos.*|.*-freebsd.*|.*-qnx.*-|.*-rtems.*-)?ld</executable>
+    <executable prefix="1">(.*-wrs.*-|.*-sysgo.*-|.*-elf.*-|.*-eabi.*-|.*-eabispe.*-|avr.*-|.*-elinos-linux.*-|.*-linux-(gnu|musl)-|.*mingw32.*-|.*-xcoff.*-|.*linux-android.*|arm.*-linux-(gnu|musl)eabi-|arm.*-linux-(gnu|musl)eabihf-|e500v2-gnu-linux-|powerpc-.*-linux.*-|.*-darwin.*-|.*-fastos.*|.*-freebsd.*|.*-qnx.*-|.*-rtems.*-)?ld</executable>
     <version>
       <external>${PREFIX}ld -v</external>
       <grep regexp="^(GNU ld.*|LLD) (\S+)" group="2"></grep>
@@ -189,7 +189,7 @@
    -->
   <compiler_description>
     <name>GNAT</name>
-    <executable prefix="1">(.*-wrs-.*|.*-sysgo.*|.*-elf-.*|.*-eabi-.*|.*-eabispe-.*|avr-.*|.*-elinos-linux.*|.*-linux-gnu-|.*mingw32.*|.*-xcoff-.*|.*linux-android.*|arm-linux-gnueabi-|arm-linux-gnueabihf-|e500v2-gnu-linux-|powerpc-.*-linux.*-|.*-darwin.*-|.*-fastos.*|.*-freebsd.*|.*-qnx.*|.*-rtems.*)?gnatls</executable>
+    <executable prefix="1">(.*-wrs-.*|.*-sysgo.*|.*-elf-.*|.*-eabi-.*|.*-eabispe-.*|avr-.*|.*-elinos-linux.*|.*-linux-(gnu|musl)-|.*mingw32.*|.*-xcoff-.*|.*linux-android.*|arm.*-linux-(gnu|musl)eabi-|arm.*-linux-(gnu|musl)eabihf-|e500v2-gnu-linux-|powerpc-.*-linux.*-|.*-darwin.*-|.*-fastos.*|.*-freebsd.*|.*-qnx.*|.*-rtems.*)?gnatls</executable>
     <version>
       <external>${PREFIX}gnatls -v --version</external>
       <grep regexp="^GNATLS.+?(\d+(\.\d+)?)" group="1"></grep>
@@ -262,7 +262,7 @@
 
   <compiler_description>
     <name>GNAT_LLVM</name>
-    <executable prefix="1">((.*-elf-|.*-linux-gnu-)?llvm-)gnatls</executable>
+    <executable prefix="1">((.*-elf-|.*-linux-(gnu|musl)-)?llvm-)gnatls</executable>
     <version>
       <external>${PREFIX}gnatls -v</external>
       <grep regexp="^GNATLS.+?(\d+(\.\d+)?)" group="1"></grep>
@@ -287,7 +287,7 @@
 
   <compiler_description>
     <name>GNAT_LLVM_ASM</name>
-    <executable prefix="1">((.*-elf-|.*-linux-gnu-)?llvm-)gcc</executable>
+    <executable prefix="1">((.*-elf-|.*-linux-(gnu|musl)-)?llvm-)gcc</executable>
     <version>
       <external>$EXEC -v</external>
       <grep regexp="^llvm-.*gcc.+GNAT Pro (\S+)" group="1"></grep>
@@ -532,7 +532,7 @@
   <!-- Clang C compiler -->
   <compiler_description>
     <name>CLANG-C</name>
-    <executable prefix="1">((.*-elf-|.*-linux-gnu-)?)clang</executable>
+    <executable prefix="1">((.*-elf-|.*-linux-(gnu|musl)-)?)clang</executable>
     <version>
       <external>$EXEC -v</external>
       <grep regexp=".*(LLVM|clang) version ([0-9.]*)" group="2"></grep>
@@ -547,7 +547,7 @@
   <!-- Clang++ C++ compiler -->
   <compiler_description>
     <name>CLANG-C++</name>
-    <executable prefix="1">((.*-elf-|.*-linux-gnu-)?)clang\+\+</executable>
+    <executable prefix="1">((.*-elf-|.*-linux-(gnu|musl)-)?)clang\+\+</executable>
     <version>
       <external>$EXEC -v</external>
       <grep regexp=".*(LLVM|clang) version ([0-9.]*)" group="2"></grep>
@@ -562,7 +562,7 @@
   <!-- Clang assembler -->
   <compiler_description>
     <name>CLANG-ASM</name>
-    <executable prefix="1">((.*-elf-|.*-linux-gnu-)?)clang</executable>
+    <executable prefix="1">((.*-elf-|.*-linux-(gnu|musl)-)?)clang</executable>
     <version>
       <external>$EXEC -v</external>
       <grep regexp=".*(LLVM|clang) version ([0-9.]*)" group="2"></grep>
diff --git a/db/cross.xml b/db/cross.xml
index 1c7a5d41..d4165d2a 100644
--- a/db/cross.xml
+++ b/db/cross.xml
@@ -44,8 +44,8 @@
        <target name="^.*-qnx[0-9]*$" />
        <target name="^.*-rtems.*$" />
        <target name="^arm-linux-androideabi" />
-       <target name="^arm-linux-gnueabi" />
-       <target name="^arm-linux-gnueabihf" />
+       <target name="^arm.*-linux-(gnu|musl)eabi" />
+       <target name="^arm.*-linux-(gnu|musl)eabihf" />
        <target name="^aarch64-linux-android" />
        <target name="^aarch64-.*linux-gnu" />
        <target name="^e500v2-gnu-linux" />
diff --git a/db/linker.xml b/db/linker.xml
index c83f3051..acb27a11 100644
--- a/db/linker.xml
+++ b/db/linker.xml
@@ -162,10 +162,10 @@
   <configuration>
     <!-- aarch64-linux - native compiler. -->
     <targets>
-      <target name="^aarch64-linux-gnu$" />
+      <target name="^aarch64-linux-(gnu|musl)$" />
     </targets>
     <hosts>
-      <host name="^aarch64-linux-gnu$" />
+      <host name="^aarch64-linux-(gnu|musl)$" />
     </hosts>
     <config>
    for Object_Lister use ("nm", "-g");
@@ -179,7 +179,7 @@
   </configuration>
 
   <configuration>
-    <!-- aarch64-linux - cross compiler. -->
+    <!-- aarch64-linux-gnu - cross compiler. -->
     <targets>
       <target name="^aarch64-.*linux-gnu$" />
     </targets>
@@ -197,6 +197,25 @@
     </config>
   </configuration>
 
+  <configuration>
+    <!-- aarch64-linux-musl - cross compiler. -->
+    <targets>
+      <target name="^aarch64-.*linux-musl$" />
+    </targets>
+    <hosts negate="true">
+      <host name="^aarch64-linux-musl$" />
+    </hosts>
+    <config>
+      for Object_Lister use ("${PREFIX(C)}nm", "-g");
+      for Object_Lister_Matcher use " [TDRBSG] (.*)";
+
+      package Linker is
+      for Export_File_Format use "GNU";
+      for Export_File_Switch use "-Wl,--version-script=";
+      end Linker;
+    </config>
+  </configuration>
+
   <configuration>
     <targets>
       <target name="^arm-linux-gnueabi$" />
@@ -227,6 +246,96 @@
     </config>
   </configuration>
 
+  <configuration>
+    <targets>
+      <target name="^armv7l-linux-gnueabi$" />
+    </targets>
+    <config>
+   for Object_Lister use ("armv7l-linux-gnueabi-nm", "-g");
+   for Object_Lister_Matcher use " [TDSR] (.*)";
+
+   package Linker is
+      for Export_File_Format use "GNU";
+      for Export_File_Switch use "-Wl,--version-script=";
+   end Linker;
+    </config>
+  </configuration>
+
+  <configuration>
+    <targets>
+      <target name="^armv7l-linux-gnueabihf$" />
+    </targets>
+    <config>
+   for Object_Lister use ("armv7l-linux-gnueabihf-nm", "-g");
+   for Object_Lister_Matcher use " [TDRBSG] (.*)";
+
+   package Linker is
+      for Export_File_Format use "GNU";
+      for Export_File_Switch use "-Wl,--version-script=";
+   end Linker;
+    </config>
+  </configuration>
+
+  <configuration>
+    <targets>
+      <target name="^arm-linux-musleabi$" />
+    </targets>
+    <config>
+   for Object_Lister use ("arm-linux-musleabi-nm", "-g");
+   for Object_Lister_Matcher use " [TDSR] (.*)";
+
+   package Linker is
+      for Export_File_Format use "GNU";
+      for Export_File_Switch use "-Wl,--version-script=";
+   end Linker;
+    </config>
+  </configuration>
+
+  <configuration>
+    <targets>
+      <target name="^arm-linux-musleabihf$" />
+    </targets>
+    <config>
+   for Object_Lister use ("arm-linux-musleabihf-nm", "-g");
+   for Object_Lister_Matcher use " [TDRBSG] (.*)";
+
+   package Linker is
+      for Export_File_Format use "GNU";
+      for Export_File_Switch use "-Wl,--version-script=";
+   end Linker;
+    </config>
+  </configuration>
+
+  <configuration>
+    <targets>
+      <target name="^armv7l-linux-musleabi$" />
+    </targets>
+    <config>
+   for Object_Lister use ("armv7l-linux-musleabi-nm", "-g");
+   for Object_Lister_Matcher use " [TDSR] (.*)";
+
+   package Linker is
+      for Export_File_Format use "GNU";
+      for Export_File_Switch use "-Wl,--version-script=";
+   end Linker;
+    </config>
+  </configuration>
+
+  <configuration>
+    <targets>
+      <target name="^armv7l-linux-musleabihf$" />
+    </targets>
+    <config>
+   for Object_Lister use ("armv7l-linux-musleabihf-nm", "-g");
+   for Object_Lister_Matcher use " [TDRBSG] (.*)";
+
+   package Linker is
+      for Export_File_Format use "GNU";
+      for Export_File_Switch use "-Wl,--version-script=";
+   end Linker;
+    </config>
+  </configuration>
+
   <configuration>
     <targets>
       <target name="^powerpc-.*linux.*$" />
@@ -676,6 +785,30 @@
     </config>
   </configuration>
 
+  <configuration>
+    <targets>
+      <target name="^armv7l-linux-gnueabi$" />
+    </targets>
+    <config>
+   for Archive_Builder  use ("armv7l-linux-gnueabi-ar", "cr");
+   for Archive_Builder_Append_Option use ("q");
+   for Archive_Indexer  use ("armv7l-linux-gnueabi-ranlib");
+   for Archive_Suffix   use ".a";
+    </config>
+  </configuration>
+
+  <configuration>
+    <targets>
+      <target name="^armv7l-linux-gnueabihf$" />
+    </targets>
+    <config>
+   for Archive_Builder  use ("armv7l-linux-gnueabihf-ar", "cr");
+   for Archive_Builder_Append_Option use ("q");
+   for Archive_Indexer  use ("armv7l-linux-gnueabihf-ranlib");
+   for Archive_Suffix   use ".a";
+    </config>
+  </configuration>
+
   <configuration>
     <!-- aarch64-android - cross compiler. -->
     <targets>
@@ -692,10 +825,10 @@
   <configuration>
     <!-- aarch64-linux - native compiler. -->
     <targets>
-      <target name="^aarch64-linux-gnu$" />
+      <target name="^aarch64-linux-(gnu|musl)$" />
     </targets>
     <hosts>
-      <host name="^aarch64-linux-gnu$" />
+      <host name="^aarch64-linux-(gnu|musl)$" />
     </hosts>
     <config>
    for Archive_Builder  use ("ar", "cr");
@@ -706,7 +839,7 @@
   </configuration>
 
   <configuration>
-    <!-- aarch64-linux - cross compiler. -->
+    <!-- aarch64-linux-gnu - cross compiler. -->
     <targets>
       <target name="^aarch64-.*linux-gnu$" />
     </targets>
@@ -721,6 +854,22 @@
     </config>
   </configuration>
 
+  <configuration>
+    <!-- aarch64-linux-musl - cross compiler. -->
+    <targets>
+      <target name="^aarch64-.*linux-musl$" />
+    </targets>
+    <hosts negate="true">
+      <host name="^aarch64-linux-musl$" />
+    </hosts>
+    <config>
+   for Archive_Builder  use ("aarch64-linux-musl-ar", "cr");
+   for Archive_Builder_Append_Option use ("q");
+   for Archive_Indexer  use ("aarch64-linux-musl-ranlib");
+   for Archive_Suffix   use ".a";
+    </config>
+  </configuration>
+
   <configuration>
     <targets>
       <target name="^aarch64-thales-fastos$" />
-- 
2.48.1

