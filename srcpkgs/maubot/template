# Template file for 'maubot'
pkgname=maubot
version=0.3.1
revision=1
wrksrc="maubot-${version}"
build_style=python3-module
hostmakedepends="python3-setuptools"
depends="python3-mautrix python3-aiohttp python3-yarl python3-SQLAlchemy
 python3-asyncpg python3-aiosqlite python3-commonmark python3-ruamel.yaml
 python3-attrs python3-bcrypt python3-packaging python3-click python3-colorama
 python3-questionary python3-Jinja2"
short_desc="Plugin-based Matrix bot system"
maintainer="Joel Beckmeyer <joel@beckmeyer.us>"
license="AGPL-3.0-or-later"
homepage="https://github.com/maubot/maubot"
distfiles="${PYPI_SITE}/m/maubot/maubot-${version}.tar.gz"
checksum=f2026d1f040e47506a2db59648572bddc5c36c8bc36701b4312b280b3fcbae75
make_check=no # no tests specified

conf_files="/etc/maubot/config.yaml"

system_accounts="_maubot"
_maubot_homedir="/var/lib/maubot"

make_dirs="
	/var/lib/maubot 0700 _maubot _maubot
	/var/lib/maubot/plugins 0700 _maubot _maubot
	/var/lib/maubot/trash 0700 _maubot _maubot
	/var/lib/maubot/crypto 0700 _maubot _maubot
	/var/log/maubot 0700 _maubot _maubot
"

post_install() {
	vsv maubot

	vmkdir usr/lib/maubot

	vinstall maubot/example-config.yaml 644 etc/maubot config.yaml

	vmkdir usr/share/maubot
	mv ${DESTDIR}/usr/example-config.yaml ${DESTDIR}/usr/share/maubot

	vlicense LICENSE
}
