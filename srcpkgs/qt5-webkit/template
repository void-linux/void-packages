# Template file for 'qt5-webkit'
pkgname=qt5-webkit
version=5.212.0
revision=1
wrksrc=qtwebkit-everywhere-src-${version%.0}
build_style=cmake
configure_args="-DPORT=Qt -DUSE_LD_GOLD=OFF"
hostmakedepends="bison flex gperf perl python ruby pkg-config"
makedepends="libwebp-devel libxslt-devel libXcomposite-devel sqlite-devel
 libjpeg-turbo-devel gst-plugins-base1-devel qt5-declarative-devel
 qt5-location-devel qt5-sensors-devel qt5-webchannel-devel hyphen-devel"
short_desc="Cross-platform application and UI framework (Qt5) - WebKit2 component"
maintainer="Juan RP <xtraeme@voidlinux.org>"
license="LGPL-2.1-or-later"
homepage="https://www.qt.io/"
distfiles="http://download.qt.io/snapshots/ci/qtwebkit/${version%.0}/latest/src/submodules/${wrksrc}.tar.xz"
checksum=283b907ea324a2c734e3983c73fc27dbd8b33e2383c583de41842ee84d648a3e
nocross="https://build.voidlinux.org/builders/armv7l-musl_builder/builds/15196/steps/shell_3/logs/stdio"

if [ -n "$CROSS_BUILD" ]; then
	hostmakedepends+=" qt5-host-tools qt5-declarative-devel libjpeg-turbo-devel"
fi

# no JIT on ppc64, also other build workarounds
case "$XBPS_TARGET_MACHINE" in
	ppc64*)
		configure_args+=" -DENABLE_JIT=OFF -DUSE_SYSTEM_MALLOC=ON -DENABLE_ALLINONE_BUILD=OFF"
		;;
	*) ;;
esac

qt5-webkit-devel_package() {
	short_desc+=" - development files"
	depends="qt5-devel ${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/*.so
		vmove usr/lib/pkgconfig
	}
}
