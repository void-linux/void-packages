#!/bin/sh
#
# Trigger to (un)registering Cabal packages.
#
# Packages need to set variable ghc_package to Cabal package name.
#
# ghc_package="foo"
#
#
# Arguments:	$ACTION = [run/targets]
#		$TARGET = [post-install/pre-remove]
#		$PKGNAME
#		$VERSION
#		$UPDATE = [yes/no]
#
ACTION="$1"
TARGET="$2"
PKGNAME="$3"
VERSION="$4"
UPDATE="$5"

export PATH="usr/bin:/usr/sbin:/usr/sbin:/usr/bin:/sbin:/bin"

case "$ACTION" in
targets)
	echo "post-install pre-remove"
	;;
run)
    [ -z "${ghc_package}" ] && exit 0

	case "$TARGET" in
	post-install)
        echo "Registering haskell package ${ghc_package}"
        ghc-pkg update /usr/share/ghc-*/package.conf/${ghc_package}.conf --global --no-user-package-db
		;;
	pre-remove)
        echo "Unregistering haskell package ${ghc_package}"
        ghc-pkg unregister --global "${ghc_package}"
		;;
	*)
		exit 1
		;;
	esac
	;;
*)
	exit 1
	;;
esac

exit 0
# end
