# Template file for 'ghidra'
pkgname=ghidra
version=9.1
revision=1
_gitver=f8994f448826e1946af958980b8481c68b5c5ff2
archs="x86_64"
wrksrc="ghidra-${_gitver}"
hostmakedepends="gradle openjdk11 flex unzip"
depends="openjdk11"
short_desc="Software reverse engineering (SRE) framework"
maintainer="Andrew Benson <abenson+void@gmail.com>"
license="Apache-2.0"
homepage="https://ghidra-sre.org/"
distfiles="https://github.com/NationalSecurityAgency/ghidra/archive/${_gitver}.tar.gz"
checksum=ee087585578ed9600f657b09ca9dda6a34db050815099a7a5ed2fae54a845049
nopie=yes
nostrip=yes

do_configure() {
	gradle --init-script gradle/support/fetchDependencies.gradle init
}

do_build() {
	gradle buildGhidra
}

do_install() {
	vmkdir usr/libexec
	unzip -d ${DESTDIR}/usr/libexec "build/dist/ghidra_${version}_DEV_$(date +%Y%m%d)_linux64.zip"
	mv ${DESTDIR}/usr/libexec/ghidra_${version}_DEV ${DESTDIR}/usr/libexec/ghidra
	vmkdir usr/bin
	ln -sf /usr/libexec/$pkgname/runGhidra ${DESTDIR}/usr/bin/ghidra
}
