# Template file for 'abaddon'
pkgname=abaddon
version=0.2.1
revision=1
_ixwebsocket_commit="bc765e73a31ea5372e36d1b1add036af3218cb17"
_keychain_commit="502312f59fdc44fa1103e67f8f17cec3affb82d9"
_miniaudio_commit="7384bde3725412523871f0fcf60efe5c47fbbfc6"
_qrcodegen_commit="22fac31bdf81da68730c177c0e931c93234d2a30"
build_style=cmake
hostmakedepends="pkg-config"
makedepends="gtkmm-devel libcurl-devel sqlite-devel openssl-devel
 json-c++ libsecret-devel libhandy1-devel opus-devel spdlog
 libsodium-devel rnnoise-devel"
depends="desktop-file-utils"
short_desc="Alternative Discord client with voice support made with C++ and GTK3"
maintainer="Mazin Fadl <mazen@illumed.net>"
license="GPL-3.0-only"
homepage="https://github.com/uowuo/abaddon"
distfiles="https://github.com/uowuo/abaddon/archive/refs/tags/v${version}.tar.gz
 https://github.com/machinezone/IXWebSocket/archive/${_ixwebsocket_commit}.tar.gz
 https://github.com/hrantzsch/keychain/archive/${_keychain_commit}.tar.gz
 https://github.com/mackron/miniaudio/archive/${_miniaudio_commit}.tar.gz
 https://github.com/nayuki/QR-Code-generator/archive/${_qrcodegen_commit}.tar.gz"
checksum="407d14bc7659c65eca1c5266fb96a60b1e169b31c122159ae7f54e69a86e0b45
 9dea909d05e882a540526b15fbdc9764a39deb53810eb86ad797fd8135a02275
 3c57d272a06419ed58068d9fe14c16807041bf9b9b372b80950b9b09d08cf441
 4b3648bf227f2373af773c6769f9c147e38d99edd74cd0736f4df1eff224e6c6
 218e3e96ded7880d05f47c668aad6541a08e63303ac4d783720389087da6f4ed"
skip_extraction="
 ${_ixwebsocket_commit}.tar.gz
 ${_keychain_commit}.tar.gz
 ${_miniaudio_commit}.tar.gz
 ${_qrcodegen_commit}.tar.gz
 "

post_extract() {
	vsrcextract -C subprojects/ixwebsocket ${_ixwebsocket_commit}.tar.gz
	vsrcextract -C subprojects/keychain ${_keychain_commit}.tar.gz
	vsrcextract -C subprojects/miniaudio ${_miniaudio_commit}.tar.gz
	vsrcextract -C subprojects/qrcodegen ${_qrcodegen_commit}.tar.gz
}

do_install() {
	vmkdir usr/bin
	vmkdir usr/share/abaddon
	vmkdir usr/share/applications
	vcopy build/abaddon usr/bin
	vcopy res/css usr/share/abaddon
	vcopy res/res usr/share/abaddon

	vdoc README.md

	vinstall "${FILESDIR}/abaddon.desktop" 644 usr/share/applications
}
