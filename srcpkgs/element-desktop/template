# Template file for 'element-desktop-bin'
pkgname=element-desktop-bin
version=1.12.7
revision=1
hostmakedepends="xz tar binutils zstd"
depends="libX11 libXScrnSaver alsa-lib nss gtk+3 xdg-utils libnotify libayatana-appindicator libsecret"
short_desc="Glossy Matrix collaboration client (Binary repack)"
maintainer="Luis F. Rosales <Lfssjquantum@murena.io>"
license="Apache-2.0"
homepage="https://element.io"

distfiles="https://packages.element.io/debian/pool/main/e/element-desktop/element-desktop_${version}_amd64.deb"
checksum=ec8a0281ee492eeef72f233fece4da4d60cc2a29d909dd60523b9d583090be69

repository=nonfree
nostrip=yes
archs="x86_64"

do_extract() {
	ar x ${XBPS_SRCDISTDIR}/${pkgname}-${version}/element-desktop_${version}_amd64.deb
	tar xf data.tar.*
}

do_install() {
	vmkdir usr/lib/element-desktop-bin
	vcopy opt/Element/* usr/lib/element-desktop-bin

	vmkdir usr/bin
	ln -sf /usr/lib/element-desktop-bin/element-desktop ${DESTDIR}/usr/bin/element-desktop

	vcopy usr/share/icons usr/share

	vmkdir usr/share/applications
	sed 's|Exec=/opt/Element/element-desktop|Exec=/usr/bin/element-desktop|g' \
		usr/share/applications/element-desktop.desktop > ${DESTDIR}/usr/share/applications/element-desktop.desktop

	chmod -R 755 ${DESTDIR}/usr/lib/element-desktop-bin
}
