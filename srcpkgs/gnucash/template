# Template file for 'gnucash'
pkgname=gnucash
version=3.4
revision=2
build_style=cmake
configure_args="-DWITH_SQL=0 -DWITH_PYTHON=1"
hostmakedepends="pkg-config guile python3 libxslt perl"
makedepends="aqbanking-devel boost-devel gc-devel glib-devel gtest-devel guile-devel
 gwenhywfar-devel ktoblzcheck-devel libofx-devel libsecret-devel
 libxslt-devel webkit2gtk-devel python3-devel gwenhywfar-gtk3"
depends="dconf guile perl"
short_desc="Financial-accounting software"
maintainer="Helmut Pozimski <helmut@pozimski.eu>"
license="GPL-2.0-or-later"
homepage="http://www.gnucash.org"
distfiles="${SOURCEFORGE_SITE}/${pkgname}/${pkgname}-${version}.tar.bz2"
checksum=a254883c8f7e34f2e19ebdc6a0185489d9027341d7d62a6f1ef815a8c9e342d7

pycompile_module="gnucash"
pycompile_dirs="usr/share/gnucash/python"
conf_files="/etc/gnucash/environment"
nocross="fails to compile guile code when cross-compiling"

CXXFLAGS="-Wno-error"
CFLAGS="-Wno-error"
export LC_ALL="C"

post_install() {
	case "$XBPS_TARGET_MACHINE" in
		# startup fails in scheme code when the locale is set to anything
		# else on musl
		*-musl) sed -i -e 's/Exec=gnucash/Exec=env LANG=C gnucash/' \
			${DESTDIR}/usr/share/applications/gnucash.desktop
			;;
	esac
}

gnucash-devel_package() {
	short_desc+=" - development files"
	depends="gnucash>=${version}_${revision}"
	pkg_install() {
		vmove usr/include
	}
}

nostrip_files="html-linechart.go
json.go
html-fonts.go
commodity-table.go
fin.go
html-anytag.go
engine-utilities.go
html-piechart.go
options.go
html-style-sheet.go
html-style-info.go
report.go
builder.go
parser.go
syntax.go
engine-interface.go
gnc-menu-extensions.go
test-create-account.go
txf-help.go
hooks.go
c-interface.go
html-scatter.go
date-utilities.go
html-utilities.go
commodity-utilities.go
business-prefs.go
html-document.go
html-acct-table.go
simple-obj.go
migrate-prefs.go
test-split.go
config-var.go
html-barchart.go
test-account.go
prefs.go
txf.go
html-text.go
txf-de_DE.go
test-c-interface.go
qif-to-gnc.go
qif-file.go
qif-dialog-utils.go
qif-import.go
qif-utils.go
qif-guess-map.go
qif-objects.go
qif-merge-groups.go
qif-parse.go
html-table.go
options-utilities.go
report-utilities.go
qif-import.go
string.go
engine.go
baz.go
foo.go
us.go
de_DE.go
srfi64-extras.go
test-extras.go
core-utils.go
price-quotes.go
app-utils.go
test-gnc-module-load-scm.go
test-gnc-module-load-deps.go
test-gnc-module-swigged-c.go
test-gnc-module-scm-dynload.go
test-gnc-module-scm-multi.go
test-gnc-module-scm-init.go
test-gnc-module-scm-module.go
unittest-support.go
gnc-module.go
business-core.go
test-load-gnome-utils-module.go
test-load-app-utils-module.go
test-load-report-gnome-module.go
utilities.go
gnome-utils.go
gettext.go
eguile-utilities.go
test-cash-flow.go
budget-income-statement.go
register.go
price-scatter.go
balance-sheet.go
trial-balance.go
cashflow-barchart.go
average-balance.go
cash-flow.go
income-statement.go
budget-balance-sheet.go
budget-barchart.go
budget-flow.go
transaction.go
net-charts.go
income-gst-statement.go
daily-reports.go
advanced-portfolio.go
sx-summary.go
budget.go
equity-statement.go
account-piecharts.go
general-journal.go
general-ledger.go
account-summary.go
portfolio.go
category-barchart.go
report-system.go
stylesheets.go
receivables.go
payables.go
utility-reports.go
test-load-report-system-module.go
test-extras.go
test-test-extras.go
report-collectors.go
collectors.go
taxtxf-de_DE.go
aging.go
stylesheet-easy.go
eguile-gnc.go
receipt.go
report-gnome.go
stylesheet-fancy.go
view-column.go
invoice.go
stylesheet-plain.go
hello-world.go
business-reports.go
balsheet-eg.go
test-load-report-stylesheets-module.go
us.go
de_DE.go
customer-summary.go
eguile-html-utilities.go
taxtxf.go
welcome-to-gnucash.go
stylesheet-head-or-tail.go
job-report.go
taxinvoice.go
stylesheet-footer.go
standard-reports.go
owner-report.go
business-options.go
gnc-numeric.go
txf-help-de_DE.go"
