# Template file for 'nordvpn-bin'
pkgname=nordvpn-bin
version=3.8.5
revision=1
archs="i686 x86_64 aarch64 armv7l armv6l"
build_style=fetch
hostmakedepends="tar xz"
depends="ipset iproute2"
short_desc="NordVPN CLI tool for Linux"
maintainer="Bj√∂rn Gerdau <bjoerngerdau@gmx.de>"
license="custom"
homepage="https://nordvpn.com"
nopie=true

case "$XBPS_TARGET_MACHINE" in
	x86_64)
		_deb="nordvpn_${version}_amd64.deb"
		distfiles="https://repo.nordvpn.com/deb/nordvpn/debian/pool/main/nordvpn_${version}_amd64.deb"
		checksum=a3f9a0017a3e42e4dbc21372f79bff4eb30615bdd66998415f032e592e6eba4e
		;;
	i686)
		_deb="nordvpn_${version}_i386.deb"
		distfiles="https://repo.nordvpn.com/deb/nordvpn/debian/pool/main/nordvpn_${version}_i386.deb"
		checksum=3c79624fb5b673530a1bf03b18d37a89d1688a5362cd1cf60a7f76e4e2fc8bcb
		;;
	aarch64)
		_deb="nordvpn_${version}_arm64.deb"
		distfiles="https://repo.nordvpn.com/deb/nordvpn/debian/pool/main/nordvpn_${version}_arm64.deb"
		checksum=ae80d7819f15d972445e59282ada00114971d7c0723b02708826536ea3fa3eb3
		;;
	armv7l)
		_deb="nordvpn_${version}_armhf.deb"
		distfiles="https://repo.nordvpn.com/deb/nordvpn/debian/pool/main/nordvpn_${version}_armhf.deb"
		checksum=195ceac769638559771684d6bd1edbb3773b81fb397bf1d5c815e1c90de990b5
		;;
	armv6l)
		_deb="nordvpn_${version}_armel.deb"
		distfiles="https://repo.nordvpn.com/deb/nordvpn/debian/pool/main/nordvpn_${version}_armel.deb"
		checksum=3b3ad1f8310abe745299c78c05ba8d0052b0e7b850fb804992d1663c54e9a4a5
		;;
esac

do_install() {
	ar p "${_deb}" data.tar.xz > data.tar.xz
	tar -xJf data.tar.xz

	# daemon and cli tool
	vbin usr/sbin/nordvpnd
	vbin usr/bin/nordvpn

	# docs
	vdoc usr/share/doc/nordvpn/changelog.gz
	vman usr/share/man/man1/nordvpn.1.gz
	vinstall usr/share/bash-completion/completions/nordvpn 644 usr/share/bash-completion/completions
	vinstall "usr/share/zsh/functions/Completion/Unix/_nordvpn_auto_complete" 644 usr/share/zsh/site-functions

	# runit service
	vsv nordvpnd
}
