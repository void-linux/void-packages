# Template file for 'corosync'
pkgname=corosync
version=3.0.2
revision=1
build_style=gnu-configure
configure_args="--disable-static --enable-monitoring --enable-snmp
 --enable-xmlconf --with-logdir=/var/log/corosync"
make_dirs="/etc/corosync/uidgid.d 0755 root root
 /etc/corosync/service.d 0755 root root
 /var/log/corosync 0755 root root
 /var/lib/corosync 0755 root root"
hostmakedepends="autoconf automake libtool pkg-config"
makedepends="libknet1-devel libqb-devel libstatgrab-devel libtool net-snmp-devel nss-devel"
short_desc="Cluster engine daemon and utilities"
maintainer="Jiří Bělka <jirib79@gmail.com>"
license="BSD-2-Clause"
homepage="http://corosync.github.io/corosync"
distfiles="https://github.com/${pkgname}/${pkgname}/releases/download/v${version}/${pkgname}-${version}.tar.gz"
checksum=f237e3ddac41ec583cac9610a9ba9191592f09d3ed70bc687db7b60e3d2e26f5

pre_configure() {
	autoreconf -vi
}

post_install() {
	rm -f ${DESTDIR}/etc/corosync/corosync.conf.example
	rm -rf ${DESTDIR}/etc/init.d
	rm -rf ${DESTDIR}/usr/lib/corosync/*.la
	vinstall ${FILESDIR}/corosync.conf 644 etc/corosync
	vlicense LICENSE
	vsv corosync
}

corosynclib_package() {
	short_desc="Corosync libraries"
	pkg_install() {
		vmove "usr/lib/*.so*"
		vlicense LICENSE
	}
}

corosynclib-devel_package() {
	depends="corosynclib>=${version}_${revision}"
	short_desc="Corosync libraries (development files)"
	pkg_install() {
		vmove usr/include/corosync
		vmove "usr/lib/*.so"
		vmove "usr/lib/pkgconfig"
		vmove usr/share/man/man3
	}
}
