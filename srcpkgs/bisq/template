# Template file for 'bisq'
pkgname=bisq
version=1.9.19
revision=1
makedepends="openjdk11"
short_desc="Decentralized bitcoin exchange network"
maintainer="Nico <void@flatorange.com>"
license="AGPL-3.0-only"
homepage="https://bisq.network"
distfiles="https://github.com/bisq-network/bisq/archive/v${version}.tar.gz>${pkgname}-${version}.tar.gz"
checksum=73c960c25bb40f7e42256544279f44b7b526895f493c13c7fdd6b593048912d1

do_build() {
	sed -i '/vendor = JvmVendorSpec.AZUL/d' build-logic/commons/src/main/groovy/bisq.java-conventions.gradle
	sed -i '/implementation = JvmImplementation.VENDOR_SPECIFIC/d' build-logic/commons/src/main/groovy/bisq.java-conventions.gradle
	export JAVA_HOME=/usr/lib/jvm/openjdk11
	./gradlew clean :desktop:build -Dorg.gradle.java.home=/usr/lib/jvm/openjdk11 -x test
}

do_install() {
	# Install executable.
	install -d "${DESTDIR}/opt/bisq"
	cp -r "desktop/build/app/"* "${DESTDIR}/opt/bisq"
	cp -r "bisq-desktop" "${DESTDIR}/opt/bisq/"
	install -d "${DESTDIR}/usr/bin"
	ln -s "/opt/bisq/bisq-desktop" "${DESTDIR}/usr/bin/bisq-desktop"
}

post_install() {
	vlicense LICENSE
}
