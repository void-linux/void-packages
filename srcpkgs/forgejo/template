# Template file for 'forgejo'
pkgname=forgejo
version=13.0.4
revision=1
build_style=go
go_import_path="forgejo.org"
go_build_tags="sqlite sqlite_unlock_notify bindata"
go_ldflags=" -X main.Version=${version}"
hostmakedepends="nodejs"
makedepends="sqlite-devel"
depends="git"
checkdepends="git nodejs openssh"
short_desc="Self-hosted lightweight software forge"
maintainer="Radek Olšák <radek@olsak.net>"
license="GPL-3.0-or-later"
homepage="https://forgejo.org"
changelog="https://codeberg.org/forgejo/forgejo/raw/branch/forgejo/release-notes-published/${version}.md"
distfiles="https://codeberg.org/forgejo/forgejo/archive/v${version}.tar.gz"
checksum=c755edfda0fb6bd2478da5ea64cf885be0c982d294610a4c7ae7b4d0f190281e
make_dirs="/var/lib/forgejo 0750 forgejo forgejo"
system_accounts="forgejo"
forgejo_homedir="/var/lib/forgejo"
# For SSH access.
forgejo_shell="/bin/bash"
nopie_files="/usr/bin/forgejo"

do_build() {
	make TAGS="${go_build_tags}" CGO_LDFLAGS="$LDFLAGS" LDFLAGS="$go_ldflags" FORGEJO_VERSION="${version}" build ${makejobs}
}

do_check() {
	make test ${makejobs}
}

do_install() {
	vbin gitea forgejo
}

post_install() {
	vsv forgejo
}
