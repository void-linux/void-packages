# Template file for 'forgejo'
pkgname=forgejo
version=1.18.0
revision=1
_forgejo_revision=1
_forgejo_asset="c829784c-3b85-4996-9dc6-09e12e40a93a"
build_style=go
go_import_path="code.gitea.io/gitea"
go_ldflags="-X main.Version=${version}"
go_build_tags="bindata pam sqlite tidb"
hostmakedepends="go-bindata"
makedepends="pam-devel sqlite-devel"
depends="bash git"
short_desc="Self-hosted lightweight software forge"
maintainer="Marcin Puc <tranzystorek.io@protonmail.com>"
license="MIT"
homepage="https://forgejo.org/"
changelog="https://codeberg.org/forgejo/forgejo/raw/branch/forgejo/RELEASE-NOTES.md"
distfiles="https://codeberg.org/attachments/${_forgejo_asset}>forgejo-src-${version}-${_forgejo_revision}.tar.gz"
checksum=e366d1d7c4f901357284f7a3787a4e4e478fe95c18bb91c57de8bca0c8d1272f

system_accounts="_forgejo"
_forgejo_homedir="/var/lib/forgejo"
_forgejo_descr="Self-hosted lightweight software forge service"
_forgejo_shell="/bin/bash"
make_dirs="/var/lib/forgejo 0755 _forgejo _forgejo
 /var/log/forgejo 0755 _forgejo root"
conf_files="/etc/forgejo.conf"

post_install() {
	vinstall custom/conf/app.example.ini 640 etc forgejo.conf
	vlicense LICENSE
	vsv forgejo

	mv "${DESTDIR}/usr/bin"/{gitea,forgejo}
}
