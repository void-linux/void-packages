# Template file for 'rsyslog'
pkgname=rsyslog
version=8.2010.0
revision=4
build_style=gnu-configure
configure_args="--sbindir=/usr/bin --enable-gnutls --enable-mysql
 --enable-pgsql --enable-imdiag --enable-imfile --enable-mail --enable-imptcp
 --enable-gssapi-krb5 --enable-mmsnmptrapd --enable-impstats --enable-omprog
 --enable-omstdout --enable-pmlastmsg --enable-pmcisconames --enable-pmsnare
 --enable-pmaixforwardedfrom --enable-omuxsock --disable-generate-man-pages
 --enable-elasticsearch --enable-testbench"
hostmakedepends="pkg-config postgresql-libs-devel"
makedepends="gnutls-devel libcurl-devel libestr-devel libfastjson-devel
 liblogging-devel libmariadbclient-devel mit-krb5-devel postgresql-libs-devel"
short_desc="Enhanced multi-threaded syslog daemon"
maintainer="Orphaned <orphan@voidlinux.org>"
license="GPL-3.0-or-later, Apache-2.0"
homepage="https://www.rsyslog.com"
changelog="https://raw.githubusercontent.com/rsyslog/rsyslog/master/ChangeLog"
distfiles="${homepage}/files/download/rsyslog/${pkgname}-${version}.tar.gz"
checksum=19b232f765c4ba7a35b91ef1f5f9af775f6ff78ef56bb7737a2ce79ccbb32b98
conf_files="/etc/rsyslog.conf"
make_dirs="/etc/rsyslog.d 0755 root root"
lib32disabled=yes
disable_parallel_build=yes

if [ "$XBPS_TARGET_LIBC" = "musl" ]; then
	makedepends+=" musl-legacy-compat"
fi

pre_configure() {
	if [ "$CROSS_BUILD" ]; then
		vsed -e "s,\`\$PG_CONFIG --libdir\`,\"$XBPS_CROSS_BASE/usr/lib\",g" -i configure
		vsed -e "s,\`\$PG_CONFIG --includedir\`,\"$XBPS_CROSS_BASE/usr/include\",g" -i configure
	fi
}

post_install() {
	vsv rsyslogd
	vconf ${FILESDIR}/rsyslog.conf
}

rsyslog-gssapi_package() {
	lib32disabled=yes
	depends="rsyslog"
	short_desc+=" - Kerberos5 GSSAPI add-on"
	pkg_install() {
		vmove "usr/lib/rsyslog/*gss*.so"
	}
}

rsyslog-gnutls_package() {
	lib32disabled=yes
	depends="rsyslog"
	short_desc+=" - GnuTLS add-on"
	pkg_install() {
		vmove "usr/lib/rsyslog/*gtls*"
	}
}

rsyslog-mysql_package() {
	lib32disabled=yes
	depends="rsyslog"
	short_desc+=" - MySQL add-on"
	pkg_install() {
		vmove usr/lib/rsyslog/ommysql.so
	}
}

rsyslog-postgresql_package() {
	lib32disabled=yes
	depends="rsyslog"
	short_desc+=" - PostgreSQL add-on"
	pkg_install() {
		vmove usr/lib/rsyslog/ompgsql.so
	}
}

rsyslog-elasticsearch_package() {
	lib32disabled=yes
	depends="rsyslog"
	short_desc+=" - Elasticsearch add-on"
	pkg_install() {
		vmove usr/lib/rsyslog/omelasticsearch.so
	}
}
