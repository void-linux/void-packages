# Template file for 'MediaElch'
pkgname=MediaElch
version=2.12.0
revision=1
build_style=cmake
configure_args="-DDISABLE_UPDATER=ON -DMEDIAELCH_FORCE_QT6=ON -DENABLE_TESTS=ON -DUSE_EXTERN_QUAZIP=ON"
hostmakedepends="qt6-tools qt6-base"
makedepends="qt6-svg-devel qt6-multimedia-devel qt6-qt5compat-devel libmediainfo-devel quazip-qt6-devel"
short_desc="Media manager for organizing and scraping movies, TV shows and music"
maintainer="Mateusz Sylwestrzak <slymattz@gmail.com>"
license="LGPL-3.0-only"
homepage="https://mediaelch.github.io"
changelog="https://raw.githubusercontent.com/Komet/MediaElch/refs/heads/master/CHANGELOG.md"
distfiles="https://github.com/Komet/MediaElch/archive/refs/tags/v${version}.tar.gz"
checksum=ffa6f19dbc7760cb3762d02c24392d5e2015dfa8890fc3c69d172b0930dbbb89

pre_build() {
	if [ "$CROSS_BUILD" ]; then
		# build translation files with host lrelease and delete relevant cmake instructions
		# otherwise cross-compilation fails
		for ts in data/i18n/*.ts; do
			name="${ts##*/}"
			qm="build/i18n/${name%.ts}.qm"
			/usr/lib/qt6/bin/lrelease "$ts" -qm "$qm"
		done

		vsed -i '/^if(Qt6_FOUND)$/,/^endif()$/ {
			H
			/qt[56]_add_translation/ {
				g
				d
			}
		}' CMakeLists.txt
	fi
}
