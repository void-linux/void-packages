# Template file for 'mailspring'
pkgname=mailspring
version=1.9.2
revision=1
archs="x86_64"
depends="glibc glib libgcc libstdc++ libX11 libxkbfile libsecret mit-krb5-libs libsasl libdb libXcomposite
	libXcursor libXdamage libXext libXfixes libXi libXrender libXtst nss nspr dbus-libs gdk-pixbuf gtk+3 pango
	atk cairo expat libXrandr libXScrnSaver alsa-lib at-spi2-atk at-spi2-core libcups libcrypto1.1"
short_desc="Standalone Mail client with advanced feature set"
maintainer="fanyx <fanyx@pm.me>"
license="custom:GPL-3.0-or-later"
homepage="https://getmailspring.com/"
distfiles="https://github.com/Foundry376/Mailspring/releases/download/${version}/mailspring-${version}-amd64.deb"
checksum="a3bc365c77791673d8b7d8fc2081b2e8e80ab5d78d6ffa99f848971849f43544"
noshlibprovides=yes
nopie_files="/usr/lib/mailspring/resources/app.asar.unpacked/mailsync.bin"

do_extract() {
	ar p "${XBPS_SRCDISTDIR}/${pkgname}-${version}/${pkgname}-${version}-amd64.deb" data.tar.xz | bsdtar --extract --xz -f - -C .
}

do_install() {
	vbin ${FILESDIR}/mailspring-wrapper.sh mailspring

	vmkdir usr/lib/mailspring
	vcopy usr/share/mailspring /usr/lib/

	vmkdir usr/share
	vcopy usr/share/applications usr/share/
	vcopy usr/share/pixmaps /usr/share/
	vcopy usr/share/icons /usr/share/
	vcopy usr/share/lintian /usr/share/

	vdoc usr/share/doc/mailspring/copyright

	vlicense usr/share/mailspring/LICENSE
	vlicense usr/share/mailspring/LICENSES.chromium.html
}

post_install() {
	mkdir libsave
	for lib in libffmpeg.so; do
		mv ${DESTDIR}/usr/lib/mailspring/$lib libsave
	done
	find ${DESTDIR}/usr/lib/mailspring/ -name '*.so' -delete
	mv libsave/* ${DESTDIR}/usr/lib/mailspring/
}
