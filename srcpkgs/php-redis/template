# Template file for 'php-redis'
pkgname=php-redis
version=5.3.5
revision=1
wrksrc="redis-$version"
build_style=gnu-configure
configure_args="--enable-redis-igbinary \
 --enable-redis-lzf --with-liblzf=${XBPS_CROSS_BASE}/usr/lib"
hostmakedepends="php-devel autoconf pkg-config"
makedepends="liblzf-devel php-igbinary"
depends="php-igbinary"
checkdepends="php php-igbinary redis"
short_desc="PHP extension for interfacing with Redis"
maintainer="Joel Beckmeyer <joel@beckmeyer.us>"
license="PHP-3.01"
homepage="https://pecl.php.net/package/redis"
changelog="https://raw.githubusercontent.com/phpredis/phpredis/develop/Changelog.md"
distfiles="https://pecl.php.net/get/redis-$version.tgz"
checksum=d55fa5cc699198917ba2bdc827da632ad77f009ba2642d2750456a976dbe5989

pre_configure() {
	phpize
}

do_check() {
	export TEST_PHP_ARGS="-d extension=igbinary -d extension=${wrksrc}/modules/redis.so"
	redis-server --daemonize yes
	php $TEST_PHP_ARGS tests/TestRedis.php
	redis-cli shutdown
}

pre_install() {
	make_install_args="INSTALL_ROOT=$DESTDIR"
}
