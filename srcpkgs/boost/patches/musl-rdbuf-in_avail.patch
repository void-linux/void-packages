--- a/libs/regex/example/snippets/regex_grep_example_1.cpp
+++ b/libs/regex/example/snippets/regex_grep_example_1.cpp
@@ -89,7 +89,8 @@ void load_file(std::string& s, std::istr
 {
    s.erase();
    if(is.bad()) return;
-   s.reserve(static_cast<std::string::size_type>(is.rdbuf()->in_avail()));
+   std::streamsize avail = is.rdbuf()->in_avail();
+   s.reserve(avail != -1 ? avail : 4096);
    char c;
    while(is.get(c))
    {
--- a/libs/regex/example/snippets/regex_grep_example_2.cpp
+++ b/libs/regex/example/snippets/regex_grep_example_2.cpp
@@ -85,7 +85,8 @@ void load_file(std::string& s, std::istr
 {
    s.erase();
    if(is.bad()) return;
-   s.reserve(static_cast<std::string::size_type>(is.rdbuf()->in_avail()));
+   std::streamsize avail = is.rdbuf()->in_avail();
+   s.reserve(avail != -1 ? avail : 4096);
    char c;
    while(is.get(c))
    {
--- a/libs/regex/example/snippets/regex_grep_example_3.cpp
+++ b/libs/regex/example/snippets/regex_grep_example_3.cpp
@@ -112,7 +112,8 @@ void load_file(std::string& s, std::istr
 {
    s.erase();
    if(is.bad()) return;
-   s.reserve(static_cast<std::string::size_type>(is.rdbuf()->in_avail()));
+   std::streamsize avail = is.rdbuf()->in_avail();
+   s.reserve(avail != -1 ? avail : 4096);
    char c;
    while(is.get(c))
    {
--- a/libs/regex/example/snippets/regex_grep_example_4.cpp
+++ b/libs/regex/example/snippets/regex_grep_example_4.cpp
@@ -106,7 +106,8 @@ void load_file(std::string& s, std::istr
 {
    s.erase();
    if(is.bad()) return;
-   s.reserve(is.rdbuf()->in_avail());
+   std::streamsize avail = is.rdbuf()->in_avail();
+   s.reserve(avail != -1 ? avail : 4096);
    char c;
    while(is.get(c))
    {
--- a/libs/regex/example/snippets/regex_iterator_example.cpp
+++ b/libs/regex/example/snippets/regex_iterator_example.cpp
@@ -72,7 +72,8 @@ void load_file(std::string& s, std::istr
 {
    s.erase();
    if(is.bad()) return;
-   s.reserve(static_cast<std::string::size_type>(is.rdbuf()->in_avail()));
+   std::streamsize avail = is.rdbuf()->in_avail();
+   s.reserve(avail != -1 ? avail : 4096);
    char c;
    while(is.get(c))
    {
--- a/libs/regex/example/snippets/regex_merge_example.cpp
+++ b/libs/regex/example/snippets/regex_merge_example.cpp
@@ -42,7 +42,8 @@ void load_file(std::string& s, std::istr
 {
    s.erase();
    if(is.bad()) return;
-   s.reserve(static_cast<std::string::size_type>(is.rdbuf()->in_avail()));
+   std::streamsize avail = is.rdbuf()->in_avail();
+   s.reserve(avail != -1 ? avail : 4096);
    char c;
    while(is.get(c))
    {
--- a/libs/regex/example/snippets/regex_replace_example.cpp
+++ b/libs/regex/example/snippets/regex_replace_example.cpp
@@ -42,7 +42,8 @@ void load_file(std::string& s, std::istr
 {
    s.erase();
    if(is.bad()) return;
-   s.reserve(static_cast<std::string::size_type>(is.rdbuf()->in_avail()));
+   std::streamsize avail = is.rdbuf()->in_avail();
+   s.reserve(avail != -1 ? avail : 4096);
    char c;
    while(is.get(c))
    {
--- a/libs/regex/example/snippets/regex_search_example.cpp
+++ b/libs/regex/example/snippets/regex_search_example.cpp
@@ -85,7 +85,8 @@ void load_file(std::string& s, std::istr
 {
    s.erase();
    if(is.bad()) return;
-   s.reserve(static_cast<std::string::size_type>(is.rdbuf()->in_avail()));
+   std::streamsize avail = is.rdbuf()->in_avail();
+   s.reserve(avail != -1 ? avail : 4096);
    char c;
    while(is.get(c))
    {
