# Template file for 'sysprof'
pkgname=sysprof
version=3.28.1
revision=1
build_style=meson
hostmakedepends="pkg-config itstool glib-devel"
makedepends="gtk+3-devel polkit-devel glib-devel elogind-devel"
short_desc="A system-wide profiler for Linux"
maintainer="Juan RP <xtraeme@voidlinux.eu>"
license="GPL-2.0-or-later, GPL-3.0-or-later"
homepage="http://sysprof.com/"
changelog="https://raw.githubusercontent.com/GNOME/sysprof/sysprof-3-28/NEWS"
distfiles="https://download.gnome.org/sources/sysprof/${version%.*}/${pkgname}-${version}.tar.xz"
checksum=e31ea410fe29dba2fb79f25f84b235116580c5d2a10a4f96cf35ffcc7723a314
configure_args="-Denable-gtk=true -Dsystemdunitdir=/DELETEME"

case "$XBPS_TARGET_MACHINE" in
	x64_64-musl|aarch64-musl) CFLAGS="-D__WORDSIZE=64" ;;
	*-musl) CFLAGS="-D__WORDSIZE=32" ;;
esac

CFLAGS+=" -Wno-error -Wno-error=undef"

pre_build() {
	export SHELL=/bin/bash
}

post_install() {
	rm -r $DESTDIR/DELETEME
}

sysprof-devel_package() {
	depends="sysprof>=${version}_${revision}"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/pkgconfig
		vmove "usr/lib/*.a"
		vmove usr/share
	}
}
