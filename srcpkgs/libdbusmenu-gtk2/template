# Template file for 'libdbusmenu-gtk2'
pkgname=libdbusmenu-gtk2
version=16.04.0
revision=1
wrksrc="libdbusmenu-${version}"
build_style=gnu-configure
configure_args="--disable-dumper --disable-static --disable-tests $(vopt_enable gir vala) $(vopt_enable gir introspection)  HAVE_VALGRIND_FALSE='' --with-gtk=2"
hostmakedepends="automake gettext-devel glib-devel intltool libtool pkg-config
 $(vopt_if gir 'gobject-introspection vala-devel')"
makedepends="gtk+-devel"
depends="libdbusmenu-glib"
short_desc="Library for passing menus over DBus (GTK+2)"
maintainer="Piotr Balcerowski <piotr@balcerowski.org>"
license="GPL-3, LGPL-2.1, LGPL-3"
homepage="https://launchpad.net/libdbusmenu"
distfiles="${homepage}/${version%.*}/${version}/+download/libdbusmenu-${version}.tar.gz"
checksum=b9cc4a2acd74509435892823607d966d424bd9ad5d0b00938f27240a1bfa878a

build_options="gir"
if [ -z "$CROSS_BUILD" ]; then
	build_options_default="gir"
fi

pre_configure() {
	autoreconf -fi
}

do_install() {
	make -j1 -C libdbusmenu-glib DESTDIR="$DESTDIR" install
	make -j1 -C libdbusmenu-gtk DESTDIR="$DESTDIR" install
	make -j1 -C libdbusmenu-glib DESTDIR="$DESTDIR" uninstall
	rm -rf "$DESTDIR"/usr/share/gtk-doc
}

libdbusmenu-gtk2-devel_package() {
	depends="gtk+-devel gdk-pixbuf-devel libdbusmenu-glib-devel>=${version} libdbusmenu-gtk2>=${version}_${revision} libdbusmenu-glib-devel"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/include/libdbusmenu-gtk-*
		vmove usr/lib/pkgconfig/dbusmenu-gtk-*.pc
		vmove usr/lib/libdbusmenu-gtk.so
		if [ "$build_option_gir" ]; then
			vmove usr/share/gir-1.0/DbusmenuGtk-*.gir
			vmove usr/share/vala/vapi/DbusmenuGtk-*.vapi
		fi
	}
}
