# Template file for 'gn'
pkgname=gn
version=0.1915
revision=1
_commit=e0c476ffc83dc10897cb90b45c03ae2539352c5c
create_wrksrc=yes
hostmakedepends="ninja python3"
short_desc="GN is a meta-build system that generates build files for Ninja"
maintainer="Orphaned <orphan@voidlinux.org>"
license="BSD-3-Clause-Modification"
homepage="https://gn.googlesource.com/gn"
distfiles="https://gn.googlesource.com/gn/+archive/${_commit}.tar.gz"
checksum="@b1d3bc9b359796a3d020f49c743ed8e4002470be43aad46ebbf52703317315b8"
subpackages="gn-doc"

do_configure() {
	./build/gen.py --no-last-commit-position --no-strip --no-static-libstdc++
	cat >out/last_commit_position.h <<-EOF
	#ifndef OUT_LAST_COMMIT_POSITION_H_
	#define OUT_LAST_COMMIT_POSITION_H_
	#define LAST_COMMIT_POSITION_NUM ${version##0.}
	#define LAST_COMMIT_POSITION "${version} (${_commit:0:8})"
	#endif	// OUT_LAST_COMMIT_POSITION_H_
	EOF
}

do_build() {
	ninja -C out
}

do_check() {
	./out/gn_unittests
}

do_install() {
	vbin out/gn
	vlicense LICENSE
}

gn-doc_package() {
	short_desc+=" - documentation"
	pkg_install() {
		for f in docs/*; do vdoc $f; done
	}
}
