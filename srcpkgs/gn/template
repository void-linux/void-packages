# Template file for 'gn'
pkgname=gn
version=0.0.20201022
revision=1
_githash=f5f465b52e5df6d4de9fbe67cc79f1914ba4dbfc
create_wrksrc=yes
hostmakedepends="python3 ninja"
short_desc="Meta-build system that generates build files for Ninja"
maintainer="shizonic <realtiaz@gmail.com>"
license="BSD-3-Clause"
homepage="https://gn.googlesource.com/gn/"
distfiles="https://gn.googlesource.com/gn/+archive/${_githash}.tar.gz"
checksum=@3ef35abf6ff8530e55cd145c7f9498d6e08169d5fea9d9ce4ece29ff4b7fb14a

post_extract() {
	printf '#define LAST_COMMIT_POSITION "%s"\n' "$version" >src/gn/last_commit_position.h
	printf '#define LAST_COMMIT_POSITION_NUM 0\n' >>src/gn/last_commit_position.h
}

do_build() {
	./build/gen.py --no-last-commit-position
	ninja -C out
}

do_check() {
	./out/gn_unittests
}

do_install() {
	vbin out/gn
	vlicense LICENSE
}
