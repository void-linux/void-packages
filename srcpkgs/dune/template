# Template file for 'dune'
pkgname=dune
version=1.0+beta20
revision=1
wrksrc="dune-${version/+/-}"
build_style=gnu-makefile
make_build_args="release"
make_install_args='INSTALL_ARGS="--prefix=${DESTDIR}/usr --libdir=${OCAMLFIND_DESTDIR}"'
hostmakedepends="ocaml opam ocaml-findlib"
depends="opam ocaml-findlib"
short_desc="Composable build system for OCaml"
maintainer="John Zimmermann <johnz@posteo.net>"
license="MIT"
homepage="https://github.com/ocaml/dune"
changelog="https://github.com/ocaml/dune/blob/${version}/CHANGES.md"
distfiles="https://github.com/ocaml/dune/archive/${version}.tar.gz"
checksum=b7ff6a353cc77c7ca576f65371d15ec63e4c1fddc49053cbba50544a3f0c0833
nocross=yes

do_install() {
	export OPAMROOT="${wkrsrc}"/opam
	opam init -n

	vmkdir $(ocamlfind printconf destdir)
	export OCAMLFIND_DESTDIR="${DESTDIR}$(ocamlfind printconf destdir)"

	make INSTALL_ARGS="--prefix=${DESTDIR}/usr --libdir=${OCAMLFIND_DESTDIR}" install

	vmkdir usr/share
	mv ${DESTDIR}/usr/{doc,share/}
	mv ${DESTDIR}/usr/{man,share/}

	vlicense LICENSE.md
}
