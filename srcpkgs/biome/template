# Template file for 'biome'
pkgname=biome
version=2.2.4
revision=1
archs="~i686*"
build_style=cargo
make_install_args="--path crates/biome_cli"
hostmakedepends="pkg-config"
makedepends="libgit2-1.9-devel"
short_desc="Language server for web projects (HTML, CSS, JavaScript)"
maintainer="Bnyro <bnyro@tutanota.com>"
license="MIT OR Apache-2.0"
homepage="https://github.com/biomejs/biome"
changelog="https://raw.githubusercontent.com/biomejs/biome/refs/heads/main/packages/@biomejs/biome/CHANGELOG.md"
distfiles="https://github.com/biomejs/biome/archive/refs/tags/@biomejs/biome@${version}.tar.gz"
checksum=4239fbcb799717215c8cb204f2f90bc38ef7e118935fb72cddcca51046c1e8fb
make_check=no # tests assume version code 0.0.0, we use $version however

post_patch() {
	# fix output of 'biome --version'
	vsed -i 's@version.*=.*@version="'$version'"@' crates/biome_cli/Cargo.toml
	cargo update --package biome_cli@0.0.0 --precise $version
}

pre_build() {
	# actual value of BIOME_VERSION doesn't matter, see
	# https://github.com/biomejs/biome/blob/main/CONTRIBUTING.md#production-binaries
	export BIOME_VERSION=${version}
}

post_install() {
	vlicense LICENSE-MIT
}
