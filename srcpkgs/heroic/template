# Template file for 'heroic'
pkgname=heroic
version=2.18.1
revision=1
hostmakedepends="wget pnpm nodejs python3 make gcc git pkg-config"
makedepends="gtk+3-devel libsecret-devel nss-devel alsa-lib-devel"
depends="nodejs gtk+3 libX11 libXtst alsa-lib nss libsecret"
short_desc="Open source launcher for Epic, Amazon and GOG Games"
maintainer="Andrea Brancaleoni <abc@pompel.me>"
license="GPL-3.0-only"
homepage="https://github.com/Heroic-Games-Launcher/HeroicGamesLauncher"
distfiles="https://github.com/Heroic-Games-Launcher/HeroicGamesLauncher/archive/v${version}.tar.gz"
checksum=03eee57a2345bab465b6e15546526e5ae82b52106b69bd03663a70cc4e34b06e
nocross=yes
wrksrc="HeroicGamesLauncher-${version}"


do_build() {
	export HOME="${XBPS_BUILDDIR}/home"
	pnpm install --frozen-lockfile	
	pnpm dist:linux --dir
}

do_install() {
	# 1. Programm-Dateien installieren
	vmkdir usr/lib/heroic
	vcopy "dist/linux-unpacked/*" usr/lib/heroic

	# 2. Symlink erstellen (vorher sicherstellen, dass das Ziel sauber ist)
	# Wir nutzen vmkdir, damit der Pfad existiert
	vmkdir usr/bin
	# Falls vbin vorher was kopiert hat, l√∂schen wir es, damit ln -s klappt
	rm -f "${DESTDIR}/usr/bin/heroic"
	ln -s /usr/lib/heroic/heroic "${DESTDIR}/usr/bin/heroic"

	# 3. Desktop-Datei und Icon suchen und installieren
	# Da assets/ fehlt, suchen wir in Unterordnern wie src/assets
	local desktop=$(find . -name "heroic.desktop" | head -1)
	local icon=$(find . -name "512x512.png" | head -1)

	if [ -n "$desktop" ]; then
		vinstall "$desktop" 644 usr/share/applications
	else
		echo "WARNUNG: heroic.desktop nicht gefunden!"
	fi

	if [ -n "$icon" ]; then
		vinstall "$icon" 644 usr/share/pixmaps heroic.png
	else
		echo "WARNUNG: Icon nicht gefunden!"
	fi
}
