# Template file for 'm1n1'
pkgname=m1n1
_commit=9af9e834bf7cdd4cadadf0c821e00e05161c373f
version=1.0.2
revision=1
archs="aarch64*"
wrksrc="m1n1-${_commit}"
hostmakedepends="ImageMagick void-artwork"
depends="asahi-uboot"
short_desc="Asahi Linux bootloader"
maintainer="Will Springer <skirmisher@protonmail.com>"
license="MIT"
homepage="http://asahilinux.org"
distfiles="https://github.com/AsahiLinux/m1n1/archive/${_commit}.tar.gz"
checksum="4102f3af66710e3e7fdb16d6f7f047f7d7e8d00e069ba17e9274f0552fec93a3"
make_dirs="/boot/efi/m1n1 0700 root root"
conf_files="/etc/m1n1.conf"

post_extract() {
	for size in 128 256; do
		ln -fs /usr/share/icons/hicolor/${size}x${size}/apps/void-logo.png \
		  data/bootlogo_${size}.png
	done
}

do_build() {
	unset CFLAGS CXXFLAGS CPPFLAGS LDFLAGS
	make RELEASE=1 ARCH=${CROSS_BUILD:+${XBPS_CROSS_TRIPLET}-} build/m1n1.bin
}

do_install() {
	vinstall build/m1n1.bin 644 usr/lib/asahi-boot
	vbin "${FILESDIR}/update-m1n1"
	vlicense LICENSE
	mkdir $DESTDIR/etc
	touch $DESTDIR/etc/m1n1.conf
}
