# Template file for 'headscale'
pkgname=headscale
version=0.27.0
revision=1
build_style=go
go_import_path="github.com/juanfont/headscale"
go_package="./cmd/headscale"
go_build_tags="ts2019"
go_ldflags="-X github.com/juanfont/headscale/hscontrol/types.Version=${version}"
make_dirs="/var/lib/headscale/ 755 _headscale _headscale"
short_desc="Open source implementation of the Tailscale control server"
maintainer="Akselii <akselii@gmail.com>"
license="BSD-3-Clause"
homepage="https://headscale.net"
changelog="https://raw.githubusercontent.com/juanfont/headscale/refs/tags/v${version}/CHANGELOG.md"
distfiles="https://github.com/juanfont/headscale/archive/refs/tags/v${version}.tar.gz"
checksum=581fa3f150f6cb89025161a314a41bef25e4f2b88161b4625713c1e9a301895e
# Tests fail even when running them as instructed in the github repo
make_check="no"
system_accounts="_headscale"
conf_files="/etc/headscale/config.yaml"

post_install() {
	vmkdir etc/headscale 755
	vinstall config-example.yaml 664 etc/headscale config.yaml
	vsconf derp-example.yaml
	vmkdir usr/share/doc/headscale 755
	vcopy docs/* usr/share/doc/headscale
	vlicense LICENSE
	vsv headscale
}
