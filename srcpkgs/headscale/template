# Template file for 'headscale'
pkgname=headscale
version=0.16.4
revision=1
build_style=go
go_import_path=github.com/juanfont/headscale
go_package="cmd/headscale/headscale.go"
go_ldflags="-X ${go_import_path}/cmd/headscale/cli.Version=${version}"
short_desc="Self-hosted implementation of the Tailscale control server"
maintainer="teldra <teldra@rotce.de>"
license="BSD-3-Clause"
homepage="https://github.com/juanfont/headscale"
changelog="https://raw.githubusercontent.com/juanfont/headscale/main/CHANGELOG.md"
distfiles="https://github.com/juanfont/headscale/archive/refs/tags/v${version}.tar.gz"
checksum=0395478f9dde68aa8ca23be8df6ff636d47166981d0995e4e31a8c7db12df8e8
make_dirs="/var/run/headscale 0770 _headscale _headscale
	/var/lib/headscale 0750 _headscale _headscale"
system_accounts="_headscale"
_headscale_homedir="/var/lib/headscale"
conf_files="/etc/headscale/config.yaml"

post_extract() {
	vsed -e 's|/var/run/headscale.sock|/var/run/headscale/headscale.sock|' \
		-e 's/disable_check_updates: false/disable_check_updates: true/' \
		-i config-example.yaml
}

post_install() {
	vsv headscale
	vmkdir /etc/headscale
	vinstall config-example.yaml 755 etc/headscale config.yaml
	vsconf config-example.yaml
	vlicense LICENSE
}
