# Template file for 'unity'
pkgname=unity
version=7.7.0+23.04.20230222.2
revision=1
_ubuntu_rel=0ubuntu7
build_style=cmake
configure_args="-Wno-dev -DCOMPIZ_BUILD_WITH_RPATH=FALSE \
 -DCOMPIZ_PACKAGING_ENABLED=TRUE -DCOMPIZ_PLUGIN_INSTALL_TYPE=package \
 -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/usr \
 -DCMAKE_INSTALL_LIBDIR=lib -DCMAKE_INSTALL_SYSCONFDIR=/etc \
 -DUSE_GSETTINGS=TRUE -DENABLE_UNIT_TESTS=OFF \
 -DCMAKE_MODULE_PATH=/usr/share/cmake/Modules"
hostmakedepends="chrpath doxygen flex intltool libglvnd patchutils pkg-config
 python3-setuptools"
makedepends="appstream-glib-devel ayatana-ido-devel bamf-devel boost-devel
 cairo-devel compiz-ubuntu-devel glew-devel gnome-desktop-devel
 libayatana-indicator-devel libnotify-devel libunity-devel libunity-misc-devel
 libXfixes-devel libXi-devel nux-devel pam-devel unity-settings-daemon-devel
 zeitgeist-devel"
depends="boost clutter-gtk dbus-activation-env gjs gnome-desktop gnome-keyring
 gnome-screensaver gnome-session gsettings-ubuntu-schemas hud
 lightdm-unity-greeter notify-osd python3-xdg unity-asset-pool"
short_desc="Desktop platform based on technologies such as Nux, GTK and Compiz"
maintainer="Earldridge Jazzed Pineda <earldridgejazzedpineda@gmail.com>"
license="GPL-3.0-only"
homepage="https://unityd.org"
distfiles="https://launchpad.net/ubuntu/+archive/primary/+files/unity_${version}-${_ubuntu_rel}.tar.xz"
checksum=121cc674bf1b901d474f1de10e1d16b7d3dea6d32380af7f47ef4de2ff580c7b
keep_libtool_archives=yes
python_version=3

do_patch() {
	for i in $(grep -v '#' debian/patches/series); do
		patch -p1 -i "debian/patches/${i}"
	done

	rm -f resources/launcher_bfb.svg
	cp ${FILESDIR}/launcher_bfb.png resources
}

pre_configure() {
	export CXXFLAGS+=" -g -O0"

	export CCACHE_SLOPPINESS=time_macros
}

post_install() {
	pushd uwidgets
	python3 setup.py install --root="${DESTDIR}"
	popd
	vinstall uwidgets/uwidgets-runner.desktop 755 etc/xdg/autostart

	cp ${FILESDIR}/unity.pam ${DESTDIR}/etc/pam.d/unity

	mkdir -p ${DESTDIR}/usr/share/unity-control-center/keybindings
	ln -s \
	${DESTDIR}/usr/share/gnome-control-center/keybindings/50-unity-launchers.xml \
	${DESTDIR}/usr/share/unity-control-center/keybindings/50-unity-launchers.xml

	vsv unity7
	vsv unity-panel-service
	vsv unity-panel-service-lockscreen
}

unity-devel_package() {
	short_desc+=" - development files"
	depends="${sourcepkg}>=${version}_${revision} dee-devel libglib-devel
	 libsigc++-devel nux-devel"
	pkg_install() {
		vmove usr/include
		vmove "usr/lib/*.so"
		vmove usr/lib/pkgconfig
	}
}
