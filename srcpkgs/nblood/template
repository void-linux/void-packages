# Template file for 'nblood'
pkgname=nblood
version=r14311
revision=1
build_style=gnu-makefile
make_build_args="ARCH=${XBPS_TARGET_MACHINE}"
hostmakedepends="pkg-config nasm"
makedepends="MesaLib-devel glu-devel libvpx-devel SDL2-devel libflac-devel libvorbis-devel alsa-lib-devel"
short_desc="Reverse-engineered ports of Build games using EDuke32 engine technology"
maintainer="Mihail Ivanchev <contact@ivanchev.net>"
license="GPL-2.0-only, custom:BUILD"
homepage="https://github.com/nukeykt/NBlood.git"
distfiles="https://github.com/nukeykt/NBlood/archive/refs/tags/${version}.tar.gz"
checksum=170d1a7cd3215dd9c7c3fa6f22b953e8b4c846e3b1ba982c8209df1664b4a471
repository=nonfree
restricted=yes

case "$XBPS_TARGET_MACHINE" in
	*-musl) makedepends+=" libexecinfo-devel" ;;
esac

post_extract() {
	case "$XBPS_TARGET_MACHINE" in
		*-musl) vsed -i 's/LIBS :=/\0 -lexecinfo/' Common.mak ;;
	esac
}

do_install() {
	vbin nblood
	vmkdir /usr/share/games
	vmkdir /usr/share/games/nblood
	vcopy nblood.pk3 /usr/share/games/nblood
	vlicense package/common/buildlic.txt
}
