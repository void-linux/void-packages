# Template file for 'openvpn'
pkgname=openvpn
version=2.6.0
revision=1
build_style=gnu-configure
configure_args="$(vopt_enable pkcs11)
 $(vopt_if mbedtls --with-crypto-library=mbedtls)"
make_check_args="V=1"
hostmakedepends="pkg-config"
makedepends="$(vopt_if mbedtls mbedtls-devel openssl-devel) lzo-devel pam-devel
 $(vopt_if pkcs11 pkcs11-helper-devel) cmocka-devel libcap-ng-devel
 liblz4-devel"
short_desc="Easy-to-use, robust, and highly configurable VPN"
maintainer="Orphaned <orphan@voidlinux.org>"
license="GPL-2.0-only"
homepage="https://www.openvpn.net"
changelog="https://raw.githubusercontent.com/OpenVPN/openvpn/release/${version%.*}/Changes.rst"
distfiles="https://build.openvpn.net/downloads/releases/openvpn-${version}.tar.gz"
checksum=ebec933263c9850ef6f7ce125e2f22214be60b1cbb8ccff18892643fe083ae8f
system_accounts="_openvpn"
build_options="mbedtls pkcs11"
build_options_default="pkcs11"
desc_option_mbedtls="Build with mbedtls support"
desc_option_pkcs11="Enable support for PKCS#11"
vopt_conflict mbedtls pkcs11
# CI does not allow to create dummy network interfaces
make_check=ci-skip

post_install() {
	vsv openvpn
	vmkdir usr/share/examples/${pkgname}
	cp -r sample/sample-config-files/* ${DESTDIR}/usr/share/examples/${pkgname}

	rm -r ${DESTDIR}/usr/include
}
