From 759c1c7a915083f3da46960ff82fa2a3566a7065 Mon Sep 17 00:00:00 2001
From: Isaac Freund <mail@isaacfreund.com>
Date: Wed, 3 Nov 2021 14:21:35 +0100
Subject: [PATCH] Enable PIE for river, riverctl, rivertile

There is sadly not yet a standard way to do this exposed by the zig
build system. See: https://github.com/ziglang/zig/issues/7201
---
 build.zig | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/build.zig b/build.zig
index 9829633..180179f 100644
--- a/build.zig
+++ b/build.zig
@@ -89,6 +89,7 @@ pub fn build(b: *zbs.Builder) !void {
         const river = b.addExecutable("river", "river/main.zig");
         river.setTarget(target);
         river.setBuildMode(mode);
+        river.pie = true;
         river.addOptions("build_options", options);
 
         addServerDeps(river, scanner);
@@ -100,6 +101,7 @@ pub fn build(b: *zbs.Builder) !void {
         const riverctl = b.addExecutable("riverctl", "riverctl/main.zig");
         riverctl.setTarget(target);
         riverctl.setBuildMode(mode);
+        riverctl.pie = true;
         riverctl.addOptions("build_options", options);
 
         riverctl.step.dependOn(&scanner.step);
@@ -120,6 +122,7 @@ pub fn build(b: *zbs.Builder) !void {
         const rivertile = b.addExecutable("rivertile", "rivertile/main.zig");
         rivertile.setTarget(target);
         rivertile.setBuildMode(mode);
+        rivertile.pie = true;
         rivertile.addOptions("build_options", options);
 
         rivertile.step.dependOn(&scanner.step);
-- 
2.35.1

