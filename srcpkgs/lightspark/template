# Template file for 'lightspark'
pkgname=lightspark
version=0.4.5
distfiles="http://launchpad.net/lightspark/trunk/$pkgname-$version/+download/$pkgname-$version.tar.gz"
build_style=custom-install
short_desc="Modern, free, open-source flash player implementation"
maintainer="Juan RP <xtraeme@gmail.com>"
checksum=b6d9dbd57d61f7ca5b645e290c1ec4b21c739ab8f6601ff75400b89a65226404
long_desc="
 Lightspark features:

  * JIT compilation of Actionscript to native x86 bytecode using LLVM
  * Hardware accelerated rendering using OpenGL Shaders (GLSL)
  * Very good and robust support for current-generation Actionscript 3
  * A new, clean, codebase exploiting multithreading and optimized for modern
    hardware. Designed from scratch after the official Flash documentation was
    released."

gtk_iconcache_dirs="/usr/share/icons/hicolor"

Add_dependency run libgcc
Add_dependency run glibc
Add_dependency run libstdc++
Add_dependency run zlib
Add_dependency run libffi
Add_dependency run libxml++
Add_dependency run libpcre
Add_dependency run glib
Add_dependency run glibmm
Add_dependency run libcurl
Add_dependency run boost
Add_dependency run fontconfig
Add_dependency run libX11
Add_dependency run gtk+
Add_dependency run MesaLib
Add_dependency run SDL
Add_dependency run ftgl
Add_dependency run glew
Add_dependency run ffmpeg
Add_dependency run cairo
Add_dependency run libpulseaudio

Add_dependency build pkg-config
Add_dependency build cmake
Add_dependency build libffi-devel
Add_dependency build libX11-devel
Add_dependency build fontconfig-devel
Add_dependency build zlib-devel
Add_dependency build boost-devel
Add_dependency build SDL-devel
Add_dependency build ffmpeg-devel
Add_dependency build libcurl-devel
Add_dependency build gtk+-devel
Add_dependency build glib-devel
Add_dependency build MesaLib-devel
Add_dependency build ftgl-devel
Add_dependency build glew-devel
Add_dependency build pcre-devel
Add_dependency build libxml++-devel
Add_dependency build glibmm-devel
Add_dependency build libstdc++-devel
Add_dependency build cairo-devel
Add_dependency build pulseaudio-devel

Add_dependency full hicolor-icon-theme
Add_dependency full desktop-file-utils

do_build()
{
	# LLVM 2.8 bug.
	sed -i '22i#define alignof _alignof' scripting/abc.h

	mkdir -p ${wrksrc}/build && cd ${wrksrc}/build || return 1
	
	cmake	-DCMAKE_BUILD_TYPE=Release	\
		-DCMAKE_INSTALL_PREFIX=/usr	\
		-DAUDIO_BACKEND="pulse"		\
		-DENABLE_CURL=1			\
		-DCOMPILE_PLUGIN=1		\
		.. || return 1

	make ${makejobs} || return 1
}

do_install()
{
	cd ${wrksrc}/build || return 1
	make DESTDIR=${DESTDIR} install || return 1
}
