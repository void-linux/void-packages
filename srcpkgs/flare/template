# Template file for 'flare'
pkgname=flare
version=0.11.2
revision=1
build_style=meson
build_helper=rust
hostmakedepends="pkg-config cargo cmake gettext desktop-file-utils glib-devel gtk-update-icon-cache protobuf blueprint-compiler"
makedepends="libadwaita-devel rust-std gtksourceview5-devel"
depends="libsecret protobuf libadwaita"
short_desc="Unofficial Signal GTK client"
maintainer="Bnyro <bnyro@tutanota.com>"
license="AGPL-3.0-only"
homepage="https://gitlab.com/Schmiddiii/flare"
distfiles="https://gitlab.com/Schmiddiii/flare/-/archive/${version}/${pkgname}-${version}.tar.gz"
checksum=44022fb2735113f0f944c35191cb15ff78ccbf7f100ff16b090d70c3d0efbc86

post_patch() {
	if [ "$CROSS_BUILD" ]; then
		vsed -i src/meson.build \
			-e "s%rust_target /%'${RUST_TARGET}' / rust_target /%"
	fi
	vsed -i 's,Exec=@bindir@/flare,Exec=@bindir@/flare-desktop,g' data/de.schmidhuberj.Flare.desktop.in.in
}

pre_build() {
	if [ "$CROSS_BUILD" ]; then
		export GI_TYPELIB_PATH="${XBPS_CROSS_BASE}/usr/lib/girepository-1.0"
	fi
}

post_install() {
	vlicense LICENSE
	mv ${DESTDIR}/usr/bin/flare{,-desktop}
}
